Output: E501 Line too long (120 > 88)
  --> infra/ai/app/main.py:8:89
   |
 6 | from functools import wraps
 7 | from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
 8 | from telegram.ext import ApplicationBuilder, ContextTypes, CommandHandler, MessageHandler, CallbackQueryHandler, filters
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 9 |
10 | # --- CONFIGURATION ---
   |

E501 Line too long (111 > 88)
  --> infra/ai/app/main.py:22:89
   |
20 |             ids.append(int(stripped))
21 |         elif stripped:
22 |             logging.getLogger("Gatekeeper").error(f"ID invalide dans TELEGRAM_ALLOWED_USER_IDS : '{stripped}'")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
23 |     return ids
   |

E501 Line too long (95 > 88)
  --> infra/ai/app/main.py:26:89
   |
25 | ALLOWED_USER_IDS = parse_allowed_ids(ALLOWED_IDS_STR)
26 | logging.getLogger("Gatekeeper").info(f"Gatekeeper configur√© avec les IDs : {ALLOWED_USER_IDS}")
   |                                                                                         ^^^^^^^
27 |
28 | OPENAI_API_KEY = os.environ.get("OPENAI_API_KEY")
   |

E501 Line too long (102 > 88)
  --> infra/ai/app/main.py:37:89
   |
35 | SONARR_API_KEY = "dfa7da413b48480097f6a399080be393"
36 |
37 | logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s', level=logging.INFO)
   |                                                                                         ^^^^^^^^^^^^^^
38 | logger = logging.getLogger("Gatekeeper")
   |

E501 Line too long (91 > 88)
  --> infra/ai/app/main.py:43:89
   |
41 | def restricted(func):
42 |     @wraps(func)
43 |     async def wrapped(update: Update, context: ContextTypes.DEFAULT_TYPE, *args, **kwargs):
   |                                                                                         ^^^
44 |         user_id = update.effective_user.id
45 |         if user_id not in ALLOWED_USER_IDS:
   |

E501 Line too long (111 > 88)
  --> infra/ai/app/main.py:48:88
   |
46 |             logger.warning(f"Tentative d'acc√®s non autoris√©e de l'ID : {user_id}")
47 |             if update.message:
48 |                 await update.message.reply_text("üõë Acc√®s refus√©. Vous n'√™tes pas autoris√© √† utiliser ce bot.")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
49 |             elif update.callback_query:
50 |                 await update.callback_query.answer("üõë Acc√®s refus√©.", show_alert=True)
   |

E501 Line too long (96 > 88)
   --> infra/ai/app/main.py:129:89
    |
127 |     if target_season is not None:
128 |         payload["seasons"] = [
129 |             {"seasonNumber": s["seasonNumber"], "monitored": s["seasonNumber"] == target_season}
    |                                                                                         ^^^^^^^^
130 |             for s in item_data.get("seasons", [])
131 |         ]
    |

E501 Line too long (123 > 88)
   --> infra/ai/app/main.py:133:89
    |
131 |         ]
132 |     else:
133 |         payload["seasons"] = [{"seasonNumber": s["seasonNumber"], "monitored": True} for s in item_data.get("seasons", [])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
134 |
135 |     async with aiohttp.ClientSession() as session:
    |

E501 Line too long (95 > 88)
   --> infra/ai/app/main.py:141:89
    |
139 | # --- LOGIQUE IA ---
140 | async def process_ai_logic(prompt):
141 |     headers = {"Authorization": f"Bearer {OPENAI_API_KEY}", "Content-Type": "application/json"}
    |                                                                                         ^^^^^^^
142 |     payload = {
143 |         "model": "gpt-4o-mini",
    |

E501 Line too long (176 > 88)
   --> infra/ai/app/main.py:145:89
    |
143 | ‚Ä¶
144 | ‚Ä¶
145 | ‚Ä¶e FILM ou S√âRIE. R√©ponds en JSON: {\"type\": \"movie\"|\"series\"|\"chat\", \"query\": \"nom sans saison\"}"},
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
146 | ‚Ä¶
147 | ‚Ä¶
    |

E501 Line too long (131 > 88)
   --> infra/ai/app/main.py:160:89
    |
158 | @restricted
159 | async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
160 |     await update.message.reply_text("Salut ! Je suis ton assistant m√©dia (Gatekeeper activ√©). Envoie-moi un nom de film ou s√©rie.")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
161 |
162 | @restricted
    |

E501 Line too long (101 > 88)
   --> infra/ai/app/main.py:172:89
    |
171 |         if not results:
172 |             await update.message.reply_text(f"D√©sol√©, je n'ai rien trouv√© pour '{intent['query']}'.")
    |                                                                                         ^^^^^^^^^^^^^
173 |             return
    |

E501 Line too long (107 > 88)
   --> infra/ai/app/main.py:176:89
    |
175 |         found = results[0]
176 |         context.user_data['last_search'] = {"type": intent["type"], "item": found, "season": target_season}
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
177 |         
178 |         type_label = "le film" if intent["type"] == "movie" else "la s√©rie"
    |

E501 Line too long (160 > 88)
   --> infra/ai/app/main.py:182:89
    |
180 | ‚Ä¶', ''))
181 | ‚Ä¶
182 | ‚Ä¶['title']}* ({found['year']}){season_label}\n_{overview}_\n\nEst-ce bien ce que vous voulez ajouter ?"
    |                                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
183 | ‚Ä¶
184 | ‚Ä¶
    |

E501 Line too long (125 > 88)
   --> infra/ai/app/main.py:198:89
    |
197 |         if poster:
198 |             await update.message.reply_photo(photo=poster, caption=caption, parse_mode='Markdown', reply_markup=reply_markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
199 |         else:
200 |             await update.message.reply_text(text=caption, parse_mode='Markdown', reply_markup=reply_markup)
    |

E501 Line too long (107 > 88)
   --> infra/ai/app/main.py:200:89
    |
198 |             await update.message.reply_photo(photo=poster, caption=caption, parse_mode='Markdown', reply_markup=reply_markup)
199 |         else:
200 |             await update.message.reply_text(text=caption, parse_mode='Markdown', reply_markup=reply_markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
201 |     else:
202 |         # Chat simple
    |

E501 Line too long (99 > 88)
   --> infra/ai/app/main.py:203:89
    |
201 |     else:
202 |         # Chat simple
203 |         headers = {"Authorization": f"Bearer {OPENAI_API_KEY}", "Content-Type": "application/json"}
    |                                                                                         ^^^^^^^^^^^
204 |         payload = {"model": "gpt-4o-mini", "messages": [{"role": "user", "content": text}]}
205 |         async with aiohttp.ClientSession() as session:
    |

E501 Line too long (91 > 88)
   --> infra/ai/app/main.py:204:89
    |
202 |         # Chat simple
203 |         headers = {"Authorization": f"Bearer {OPENAI_API_KEY}", "Content-Type": "application/json"}
204 |         payload = {"model": "gpt-4o-mini", "messages": [{"role": "user", "content": text}]}
    |                                                                                         ^^^
205 |         async with aiohttp.ClientSession() as session:
206 |             async with session.post(OPENAI_URL, json=payload, headers=headers) as resp:
    |

E501 Line too long (139 > 88)
   --> infra/ai/app/main.py:230:88
    |
228 | ‚Ä¶
229 | ‚Ä¶n']})" if data['season'] else ""
230 | ‚Ä¶tion=f"‚úÖ '{data['item']['title']}'{season_txt} a √©t√© ajout√© et la recherche est lanc√©e !")
    |                                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
231 | ‚Ä¶
232 | ‚Ä¶tion="‚ùå Erreur lors de l'ajout ou m√©dia d√©j√† existant.")
    |

E501 Line too long (105 > 88)
   --> infra/ai/app/main.py:232:88
    |
230 |             await query.edit_message_caption(caption=f"‚úÖ '{data['item']['title']}'{season_txt} a √©t√© ajout√© et la recherche est lanc√©‚Ä¶
231 |         else:
232 |             await query.edit_message_caption(caption="‚ùå Erreur lors de l'ajout ou m√©dia d√©j√† existant.")
    |                                                                                         ^^^^^^^^^^^^^^^^^
233 |             
234 |     elif query.data == 'cancel_add':
    |

E501 Line too long (94 > 88)
   --> infra/ai/app/main.py:241:89
    |
240 |     application.add_handler(CommandHandler('start', start))
241 |     application.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), handle_message))
    |                                                                                         ^^^^^^
242 |     application.add_handler(CallbackQueryHandler(button_handler))
    |

E501 Line too long (99 > 88)
  --> infra/ai/maintenance/cleanup_share.py:56:89
   |
54 | def is_hdd_mounted():
55 |     """V√©rifie si le HDD de destination est accessible."""
56 |     return os.path.ismount(HDD_PATH) or os.path.ismount("/mnt/externe") or os.path.exists(HDD_PATH)
   |                                                                                         ^^^^^^^^^^^
57 |
58 | def auto_tiering_nvme_to_hdd():
   |

E501 Line too long (93 > 88)
  --> infra/ai/maintenance/cleanup_share.py:59:89
   |
58 | def auto_tiering_nvme_to_hdd():
59 |     """D√©place les fichiers les plus anciens du NVMe vers le HDD si > TARGET_NVME_PERCENT."""
   |                                                                                         ^^^^^
60 |     logging.info("V√©rification de l'espace NVMe pour Auto-Tiering...")
   |

E501 Line too long (102 > 88)
  --> infra/ai/maintenance/cleanup_share.py:63:89
   |
62 |     if not is_hdd_mounted():
63 |         logging.error(f"Le HDD cible ({HDD_PATH}) n'est pas mont√© ou accessible. Abandon du Tiering.")
   |                                                                                         ^^^^^^^^^^^^^^
64 |         return
   |

E501 Line too long (101 > 88)
  --> infra/ai/maintenance/cleanup_share.py:67:89
   |
66 |     usage_percent = get_nvme_usage_percent()
67 |     logging.info(f"Utilisation NVMe actuelle : {usage_percent:.2f}% (Cible: {TARGET_NVME_PERCENT}%)")
   |                                                                                         ^^^^^^^^^^^^^
68 |
69 |     if usage_percent <= TARGET_NVME_PERCENT:
   |

E501 Line too long (96 > 88)
  --> infra/ai/maintenance/config.py:10:89
   |
 8 | USERS_FILE = "/app/users.json" if DOCKER_MODE else "/home/jules/scripts/users.json"
 9 | CONTEXT_FILE = "/tmp/bot_context.json"
10 | SCRIPT_PATH = "/app/media_manager.py" if DOCKER_MODE else "/home/jules/scripts/media_manager.py"
   |                                                                                         ^^^^^^^^
11 |
12 | RADARR_HOST = "radarr" if DOCKER_MODE else "localhost"
   |

E501 Line too long (104 > 88)
  --> infra/ai/maintenance/handlers_admin.py:15:89
   |
13 |     def status_cmd(m):
14 |         if not is_authorized(m.from_user.id): return
15 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
   |                                                                                         ^^^^^^^^^^^^^^^^
16 |         try:
17 |             nvme = shutil.disk_usage('/')
   |

E501 Line too long (92 > 88)
  --> infra/ai/maintenance/handlers_admin.py:33:88
   |
31 |         markup = types.InlineKeyboardMarkup(row_width=1)
32 |         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"),
33 |                    types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"),
   |                                                                                         ^^^^
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |

E501 Line too long (93 > 88)
  --> infra/ai/maintenance/handlers_admin.py:34:88
   |
32 |         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"),
33 |                    types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"),
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
   |                                                                                         ^^^^^
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
36 |         bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (108 > 88)
  --> infra/ai/maintenance/handlers_admin.py:36:90
   |
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
36 |         bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^
37 |
38 |     def process_user_add(m):
   |

E501 Line too long (308 > 88)
  --> infra/ai/maintenance/handlers_admin.py:56:88
   |
54 | ‚Ä¶
55 | ‚Ä¶
56 | ‚Ä¶hare"), types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 | ‚Ä¶d, call.message.message_id, reply_markup=markup)
58 | ‚Ä¶
   |

E501 Line too long (130 > 88)
  --> infra/ai/maintenance/handlers_admin.py:57:90
   |
55 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
56 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), types.InlineKeyboardButton("üë• Utilisateurs", ‚Ä¶
57 | ‚Ä¶         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 | ‚Ä¶     elif cmd == "share":
59 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
   |

E501 Line too long (256 > 88)
  --> infra/ai/maintenance/handlers_admin.py:60:88
   |
58 | ‚Ä¶
59 | ‚Ä¶
60 | ‚Ä¶a="adm:share_owned"), types.InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 | ‚Ä¶ call.message.message_id, reply_markup=markup)
62 | ‚Ä¶
   |

E501 Line too long (130 > 88)
  --> infra/ai/maintenance/handlers_admin.py:61:88
   |
59 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
60 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), types.InlineKeyboardButton("‚ùå  ‚Ä¶
61 | ‚Ä¶         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
62 | ‚Ä¶     elif cmd == "users":
63 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
   |

E501 Line too long (308 > 88)
  --> infra/ai/maintenance/handlers_admin.py:64:88
   |
62 | ‚Ä¶
63 | ‚Ä¶
64 | ‚Ä¶ers_list"), types.InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), types.InlineKeyboardButton("‚ùå R√©voquer", callback_data="adm:users_rev"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 | ‚Ä¶at.id, call.message.message_id, reply_markup=markup)
66 | ‚Ä¶
   |

E501 Line too long (136 > 88)
  --> infra/ai/maintenance/handlers_admin.py:65:88
   |
63 | ‚Ä¶p(row_width=1)
64 | ‚Ä¶ton("üìã Lister", callback_data="adm:users_list"), types.InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), types.Inlin ‚Ä¶
65 | ‚Ä¶ des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 | ‚Ä¶
67 | ‚Ä¶sers = json.load(f)["allowed"]
   |

E501 Line too long (223 > 88)
  --> infra/ai/maintenance/handlers_admin.py:69:89
   |
67 | ‚Ä¶
68 | ‚Ä¶s])
69 | ‚Ä¶id, reply_markup=types.InlineKeyboardMarkup().add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users")), parse_mode='Markdown')
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
70 | ‚Ä¶
71 | ‚Ä¶
   |

E501 Line too long (101 > 88)
  --> infra/ai/maintenance/handlers_admin.py:78:88
   |
76 | ‚Ä¶     for u in users:
77 | ‚Ä¶         if u == SUPER_ADMIN: continue
78 | ‚Ä¶         markup.add(types.InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
   |                                                                                   ^^^^^^^^^^^^^
79 | ‚Ä¶     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
80 | ‚Ä¶     bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> infra/ai/maintenance/handlers_admin.py:79:90
   |
77 | ‚Ä¶             if u == SUPER_ADMIN: continue
78 | ‚Ä¶             markup.add(types.InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
79 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
   |                                                                                       ^
80 | ‚Ä¶         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
81 | ‚Ä¶     elif cmd == "users_del":
   |

E501 Line too long (135 > 88)
  --> infra/ai/maintenance/handlers_admin.py:80:89
   |
78 | ‚Ä¶rdButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
79 | ‚Ä¶tton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
80 | ‚Ä¶ez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
81 | ‚Ä¶
82 | ‚Ä¶
   |

E501 Line too long (166 > 88)
  --> infra/ai/maintenance/handlers_admin.py:88:89
   |
86 | ‚Ä¶
87 | ‚Ä¶.")
88 | ‚Ä¶.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instance=call.chat_instance))
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
89 | ‚Ä¶
90 | ‚Ä¶
   |

E501 Line too long (248 > 88)
  --> infra/ai/maintenance/handlers_admin.py:91:88
   |
89 | ‚Ä¶
90 | ‚Ä¶
91 | ‚Ä¶t_owned:movies"), types.InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
92 | ‚Ä¶.message_id, reply_markup=markup)
93 | ‚Ä¶
   |

E501 Line too long (116 > 88)
  --> infra/ai/maintenance/handlers_admin.py:92:89
   |
90 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=2)
91 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), types.InlineKeyboardButton("üì∫ S√©ri ‚Ä¶
92 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
93 | ‚Ä¶     elif cmd == "list_owned":
94 | ‚Ä¶         from handlers_media import list_media_unified
   |

E501 Line too long (94 > 88)
  --> infra/ai/maintenance/handlers_media.py:13:89
   |
12 | def get_storage_emoji(item):
13 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0:
   |                                                                                         ^^^^^^
14 |         return "üî¥"
15 |     path = item.get('path', '')
   |

E501 Line too long (100 > 88)
  --> infra/ai/maintenance/handlers_media.py:19:89
   |
18 | def list_media_unified(bot, m, cat, title, is_edit=False):
19 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                                                                         ^^^^^^^^^^^^
20 |     try:
21 |         items = json.loads(res.stdout); ctx = {}
   |

E501 Line too long (119 > 88)
  --> infra/ai/maintenance/handlers_media.py:36:89
   |
34 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
35 |     markup = types.InlineKeyboardMarkup(row_width=5)
36 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
38 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> infra/ai/maintenance/handlers_media.py:38:89
   |
36 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
37 |     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
38 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |                                                                                         ^
39 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E501 Line too long (98 > 88)
  --> infra/ai/maintenance/handlers_media.py:41:89
   |
39 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
40 |
41 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
   |                                                                                         ^^^^^^^^^^
42 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
43 |     endpoint = "movie" if category == "films" else "series"
   |

E501 Line too long (106 > 88)
  --> infra/ai/maintenance/handlers_media.py:45:89
   |
43 |     endpoint = "movie" if category == "films" else "series"
44 |     try:
45 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^^
46 |         r.raise_for_status(); data = r.json()
47 |         data.sort(key=lambda x: x.get('added', ''), reverse=True)
   |

E501 Line too long (145 > 88)
  --> infra/ai/maintenance/handlers_media.py:57:89
   |
55 | ‚Ä¶m.get('year', '')})\n"
56 | ‚Ä¶dth=5)
57 | ‚Ä¶rt + i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1)]
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 | ‚Ä¶
59 | ‚Ä¶
   |

E501 Line too long (112 > 88)
  --> infra/ai/maintenance/handlers_media.py:60:90
   |
58 |         markup.add(*btns)
59 |         nav_row = []
60 |         if page > 0: nav_row.append(types.InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
62 |         if nav_row: markup.row(*nav_row)
   |

E501 Line too long (130 > 88)
  --> infra/ai/maintenance/handlers_media.py:61:90
   |
59 |         nav_row = []
60 |         if page > 0: nav_row.append(types.InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
   |

E501 Line too long (89 > 88)
  --> infra/ai/maintenance/handlers_media.py:63:88
   |
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
   |                                                                                         ^
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (94 > 88)
  --> infra/ai/maintenance/handlers_media.py:64:89
   |
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
66 |     except Exception as e: bot.send_message(chat_id, f"‚ùå Erreur API : {e}")
   |

E501 Line too long (106 > 88)
  --> infra/ai/maintenance/handlers_media.py:65:89
   |
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^
66 |     except Exception as e: bot.send_message(chat_id, f"‚ùå Erreur API : {e}")
   |

E501 Line too long (107 > 88)
  --> infra/ai/maintenance/handlers_media.py:71:89
   |
69 |     @bot.message_handler(commands=['films'])
70 |     def films_cmd(m):
71 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "films", 0, True, is_authorized)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^
72 |
73 |     @bot.message_handler(commands=['series'])
   |

E501 Line too long (108 > 88)
  --> infra/ai/maintenance/handlers_media.py:75:89
   |
73 |     @bot.message_handler(commands=['series'])
74 |     def series_cmd(m):
75 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "series", 0, True, is_authorized)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^
76 |
77 |     @bot.message_handler(commands=['queue'])
   |

E501 Line too long (97 > 88)
  --> infra/ai/maintenance/handlers_media.py:83:89
   |
81 |             name = os.path.splitext(name)[0]
82 |             name = re.sub(r'[\._]', ' ', name)
83 |             match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
   |                                                                                         ^^^^^^^^^
84 |             title = match.group(1).strip() if match else name
85 |             year = match.group(2) if match else ""
   |

E501 Line too long (158 > 88)
  --> infra/ai/maintenance/handlers_media.py:86:89
   |
84 | ‚Ä¶name
85 | ‚Ä¶
86 | ‚Ä¶\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b']
   |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
87 | ‚Ä¶e
88 | ‚Ä¶n, flags=re.IGNORECASE)
   |

E501 Line too long (96 > 88)
  --> infra/ai/maintenance/handlers_media.py:91:89
   |
89 |             return re.sub(r'\s+', ' ', clean).strip()
90 |         try:
91 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                                                                         ^^^^^^^^
92 |             if not torrents: bot.reply_to(m, "‚Ä¢ Queue vide."); return
93 |             q_text = "üì• **Queue :**\n\n"
   |

E501 Line too long (110 > 88)
  --> infra/ai/maintenance/handlers_media.py:95:89
   |
93 |             q_text = "üì• **Queue :**\n\n"
94 |             for t in torrents:
95 |                 if t['state'] in ['downloading', 'stalledDL', 'metaDL', 'queuedDL', 'checkingDL', 'pausedDL']:
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^
96 |                     clean_name = clean_title(t['name'])
97 |                     eta_sec = t.get('eta', 8640000)
   |

E501 Line too long (138 > 88)
   --> infra/ai/maintenance/handlers_media.py:99:88
    |
 97 | ‚Ä¶000)
 98 | ‚Ä¶0000 else str(timedelta(seconds=eta_sec))
 99 | ‚Ä¶}**\n  ‚îî üìä {round(t['progress']*100,1)}% | üìÇ {round(t['size']/1024**3,2)}GB | ‚è≥ {eta}\n"
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
100 | ‚Ä¶'Markdown')
101 | ‚Ä¶")
    |

E501 Line too long (153 > 88)
   --> infra/ai/maintenance/handlers_media.py:103:89
    |
101 | ‚Ä¶
102 | ‚Ä¶
103 | ‚Ä¶data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_final", "cancel")))
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
104 | ‚Ä¶
105 | ‚Ä¶
    |

E501 Line too long (96 > 88)
   --> infra/ai/maintenance/handlers_media.py:109:89
    |
108 |         if d[0] == "m_pag":
109 |             show_media_list(bot, call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                                                                                         ^^^^^^^^
110 |         elif d[0] == "m_sel":
111 |             cat, item_id = d[1], d[2]
    |

E501 Line too long (123 > 88)
   --> infra/ai/maintenance/handlers_media.py:116:89
    |
114 |             display_title = f"ID {item_id}"
115 |             try:
116 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
117 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
118 |             except: pass
    |

E501 Line too long (93 > 88)
   --> infra/ai/maintenance/handlers_media.py:117:89
    |
115 |             try:
116 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
117 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
    |                                                                                         ^^^^^
118 |             except: pass
119 |             markup = types.InlineKeyboardMarkup()
    |

E501 Line too long (107 > 88)
   --> infra/ai/maintenance/handlers_media.py:120:90
    |
118 |             except: pass
119 |             markup = types.InlineKeyboardMarkup()
120 |             markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
121 |                        types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 |                        types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |

E501 Line too long (109 > 88)
   --> infra/ai/maintenance/handlers_media.py:121:88
    |
119 | ‚Ä¶     markup = types.InlineKeyboardMarkup()
120 | ‚Ä¶     markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
121 | ‚Ä¶                types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^
122 | ‚Ä¶                types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
123 | ‚Ä¶     bot.edit_message_text(f"üéØ **Action : {display_title}**", call.message.chat.id, call.message.message_id, reply_markup=markup, pa‚Ä¶
    |

E501 Line too long (95 > 88)
   --> infra/ai/maintenance/handlers_media.py:122:90
    |
120 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
121 | ‚Ä¶                    types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 | ‚Ä¶                    types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |                                                                                       ^^^^^^^
123 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action : {display_title}**", call.message.chat.id, call.message.message_id, reply_markup=markup‚Ä¶
124 | ‚Ä¶     elif d[0] == "m_act":
    |

E501 Line too long (160 > 88)
   --> infra/ai/maintenance/handlers_media.py:123:88
    |
121 | ‚Ä¶ger", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 | ‚Ä¶ur", callback_data=f"m_pag:{d[1]}:0"))
123 | ‚Ä¶title}**", call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
124 | ‚Ä¶
125 | ‚Ä¶
    |

E501 Line too long (127 > 88)
   --> infra/ai/maintenance/handlers_media.py:131:89
    |
129 |                 endpoint = "movie" if cat == "films" else "series"
130 |                 try:
131 |                     r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
132 |                     if r.status_code == 200:
133 |                         path = r.json().get('path')
    |

E501 Line too long (96 > 88)
   --> infra/ai/maintenance/handlers_media.py:137:87
    |
135 | ‚Ä¶                     data = share_engine.generate_secure_link(path)
136 | ‚Ä¶                     if data and "video" in data:
137 | ‚Ä¶                         msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
    |                                                                                   ^^^^^^^^
138 | ‚Ä¶                         bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 | ‚Ä¶                     else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
    |

E501 Line too long (98 > 88)
   --> infra/ai/maintenance/handlers_media.py:138:89
    |
136 |                             if data and "video" in data:
137 |                                 msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
    |

E501 Line too long (90 > 88)
   --> infra/ai/maintenance/handlers_media.py:139:88
    |
137 |                                 msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
    |                                                                                         ^^
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
141 |                 except: bot.send_message(call.message.chat.id, "‚ùå Erreur API.")
    |

E501 Line too long (89 > 88)
   --> infra/ai/maintenance/handlers_media.py:140:88
    |
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
    |                                                                                         ^
141 |                 except: bot.send_message(call.message.chat.id, "‚ùå Erreur API.")
142 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E501 Line too long (127 > 88)
   --> infra/ai/maintenance/handlers_media.py:146:89
    |
144 |         elif d[0] == "sel":
145 |             try:
146 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
147 |                 markup = types.InlineKeyboardMarkup(row_width=2)
148 |                 act = "arc" if item['is_nvme'] else "res"
    |

E501 Line too long (197 > 88)
   --> infra/ai/maintenance/handlers_media.py:149:88
    |
147 | ‚Ä¶
148 | ‚Ä¶
149 | ‚Ä¶ck_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
150 | ‚Ä¶eyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
151 | ‚Ä¶ata="cancel"))
    |

E501 Line too long (142 > 88)
   --> infra/ai/maintenance/handlers_media.py:150:89
    |
148 | ‚Ä¶se "res"
149 | ‚Ä¶tton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:‚Ä¶
150 | ‚Ä¶IN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
151 | ‚Ä¶tton("‚ùå Annuler", callback_data="cancel"))
152 | ‚Ä¶'name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (92 > 88)
   --> infra/ai/maintenance/handlers_media.py:151:88
    |
149 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButto‚Ä¶
150 | ‚Ä¶         if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"‚Ä¶
151 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |                                                                                   ^^^^
152 | ‚Ä¶         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
153 | ‚Ä¶     except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
    |

E501 Line too long (126 > 88)
   --> infra/ai/maintenance/handlers_media.py:152:90
    |
150 | ‚Ä¶             if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[‚Ä¶
151 | ‚Ä¶             markup.add(types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
152 | ‚Ä¶             bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
153 | ‚Ä¶         except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
154 | ‚Ä¶     elif d[0] == "act":
    |

E501 Line too long (127 > 88)
   --> infra/ai/maintenance/handlers_media.py:156:89
    |
154 |         elif d[0] == "act":
155 |             try:
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (130 > 88)
   --> infra/ai/maintenance/handlers_media.py:157:89
    |
155 |             try:
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
159 |             except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
    |

E501 Line too long (128 > 88)
   --> infra/ai/maintenance/handlers_media.py:158:88
    |
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
159 |             except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
160 |         elif d[0] == "share_exec":
    |

E501 Line too long (127 > 88)
   --> infra/ai/maintenance/handlers_media.py:162:89
    |
160 |         elif d[0] == "share_exec":
161 |             try:
162 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
163 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
164 |                 if subtitles:
    |

E501 Line too long (103 > 88)
   --> infra/ai/maintenance/handlers_media.py:163:89
    |
161 |             try:
162 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
163 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                                                         ^^^^^^^^^^^^^^^
164 |                 if subtitles:
165 |                     markup = types.InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (263 > 88)
   --> infra/ai/maintenance/handlers_media.py:166:88
    |
164 | ‚Ä¶
165 | ‚Ä¶
166 | ‚Ä¶a=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
167 | ‚Ä¶ sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
168 | ‚Ä¶er=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |

E501 Line too long (175 > 88)
   --> infra/ai/maintenance/handlers_media.py:167:88
    |
165 | ‚Ä¶1)
166 | ‚Ä¶nk", callback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), ty‚Ä¶
167 | ‚Ä¶n{len(subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
168 | ‚Ä¶=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
169 | ‚Ä¶)
    |

E501 Line too long (191 > 88)
   --> infra/ai/maintenance/handlers_media.py:168:89
    |
166 | ‚Ä¶lback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), types.Inli‚Ä¶
167 | ‚Ä¶btitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
168 | ‚Ä¶, from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
169 | ‚Ä¶
170 | ‚Ä¶
    |

E501 Line too long (127 > 88)
   --> infra/ai/maintenance/handlers_media.py:172:89
    |
170 |         elif d[0] == "share_final":
171 |             try:
172 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
173 |                 remux_opt = True if d[2] == "remux" else False
174 |                 bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (104 > 88)
   --> infra/ai/maintenance/handlers_media.py:174:88
    |
172 | ‚Ä¶     with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
173 | ‚Ä¶     remux_opt = True if d[2] == "remux" else False
174 | ‚Ä¶     bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |                                                                               ^^^^^^^^^^^^^^^^
175 | ‚Ä¶     data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
176 | ‚Ä¶     if data and "video" in data: bot.send_message(call.message.chat.id, f"‚úÖ **Partag√©**\n\nüîó Vid√©o : `{data['video']}`", parse_mod ‚Ä¶
    |

E501 Line too long (157 > 88)
   --> infra/ai/maintenance/handlers_media.py:176:88
    |
174 | ‚Ä¶call.message.chat.id, call.message.message_id)
175 | ‚Ä¶item['path'], remux=remux_opt)
176 | ‚Ä¶sage(call.message.chat.id, f"‚úÖ **Partag√©**\n\nüîó Vid√©o : `{data['video']}`", parse_mode='Markdown')
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
177 | ‚Ä¶id, "‚ùå √âchec.")
178 | ‚Ä¶, "‚ùå Erreur interne.")
    |

E501 Line too long (112 > 88)
   --> infra/ai/maintenance/handlers_media.py:179:88
    |
177 |                 else: bot.send_message(call.message.chat.id, "‚ùå √âchec.")
178 |             except: bot.send_message(call.message.chat.id, "‚ùå Erreur interne.")
179 |         elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
    |

E501 Line too long (91 > 88)
  --> infra/ai/maintenance/handlers_search.py:10:89
   |
 9 | def stream_gpt_json(query):
10 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
   |                                                                                         ^^^
11 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
12 |     try:
   |

E501 Line too long (100 > 88)
  --> infra/ai/maintenance/handlers_search.py:11:89
   |
 9 | def stream_gpt_json(query):
10 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
11 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
   |                                                                                         ^^^^^^^^^^^^
12 |     try:
13 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [‚Ä¶
   |

E501 Line too long (204 > 88)
  --> infra/ai/maintenance/handlers_search.py:13:89
   |
11 | ‚Ä¶": \"serie|film\"}}"
12 | ‚Ä¶
13 | ‚Ä¶s=headers, json={"model": "gpt-4o-mini", "messages": [{"role": "user", "content": prompt}], "temperature": 0.1}, timeout=10)
   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | ‚Ä¶
15 | ‚Ä¶
   |

E501 Line too long (112 > 88)
  --> infra/ai/maintenance/handlers_search.py:55:89
   |
53 |                 "rootFolderPath": "/movies" if cat == "movie" else "/tv",
54 |                 "monitored": True,
55 |                 "addOptions": {"searchForMovie": True} if cat == "movie" else {"searchForMissingEpisodes": True}
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
56 |             }
57 |             payload[id_key] = item[id_key]
   |

E501 Line too long (125 > 88)
  --> infra/ai/maintenance/handlers_search.py:60:89
   |
58 |             if cat == "series": payload["languageProfileId"] = 1
59 |
60 |             r = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |             if r.status_code in [200, 201]:
62 |                 bot.edit_message_text(f"‚úÖ **Ajout√© :** `{item['title']} ({item.get('year')})`", call.message.chat.id, call.message.mes‚Ä¶
   |

E501 Line too long (166 > 88)
  --> infra/ai/maintenance/handlers_search.py:62:88
   |
60 | ‚Ä¶}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
61 | ‚Ä¶
62 | ‚Ä¶['title']} ({item.get('year')})`", call.message.chat.id, call.message.message_id, parse_mode='Markdown')
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
63 | ‚Ä¶
64 | ‚Ä¶ {r.status_code}")
   |

E501 Line too long (120 > 88)
  --> infra/ai/maintenance/handlers_search.py:78:89
   |
76 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
77 |     try:
78 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
79 |         results = r.json()
80 |         if not results: bot.send_message(m.chat.id, "‚ùå Aucun r√©sultat."); return
   |

E501 Line too long (112 > 88)
  --> infra/ai/maintenance/handlers_search.py:89:89
   |
87 |         text = f"üîç **R√©sultats pour '{titre}'**\n\n"
88 |         limit = min(len(results), 5)
89 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
90 |         markup = InlineKeyboardMarkup()
91 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |

E501 Line too long (109 > 88)
  --> infra/ai/maintenance/handlers_search.py:91:89
   |
89 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
90 |         markup = InlineKeyboardMarkup()
91 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
92 |         markup.add(*btns)
93 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (105 > 88)
  --> infra/ai/maintenance/maintain_library.py:25:89
   |
23 |         logging.info(f"Triggering task: {task_name}")
24 |         params = {"name": task_name, "action": "run"}
25 |         res = requests.post(f"{BAZARR_URL}/api/system/tasks", headers=headers, params=params, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^
26 |         return res.status_code == 200
27 |     except Exception as e:
   |

E501 Line too long (93 > 88)
  --> infra/ai/maintenance/maintain_library.py:36:89
   |
34 |     while True:
35 |         try:
36 |             res = requests.get(f"{BAZARR_URL}/api/system/tasks", headers=headers, timeout=10)
   |                                                                                         ^^^^^
37 |             tasks = res.json()
38 |             running = [t['name'] for t in tasks if t.get('status') == 'running']
   |

E501 Line too long (97 > 88)
  --> infra/ai/maintenance/maintain_library.py:52:89
   |
50 |     try:
51 |         # Search missing subtitles for Movies and Series
52 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=movies", headers=headers, timeout=10)
   |                                                                                         ^^^^^^^^^
53 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=series", headers=headers, timeout=10)
54 |     except Exception as e:
   |

E501 Line too long (97 > 88)
  --> infra/ai/maintenance/maintain_library.py:53:89
   |
51 |         # Search missing subtitles for Movies and Series
52 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=movies", headers=headers, timeout=10)
53 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=series", headers=headers, timeout=10)
   |                                                                                         ^^^^^^^^^
54 |     except Exception as e:
55 |         logging.error(f"Wanted search trigger failed: {e}")
   |

E501 Line too long (114 > 88)
  --> infra/ai/maintenance/maintain_library.py:71:89
   |
69 |         series = requests.get(f"{BAZARR_URL}/api/series", headers=headers).json()
70 |         for s in series:
71 |             episodes = requests.get(f"{BAZARR_URL}/api/episodes?seriesid={s['sonarrId']}", headers=headers).json()
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
72 |             for ep in episodes:
73 |                 has_fr = any(sub.get('language') == 'fr' for sub in ep.get('subtitles', []))
   |

E501 Line too long (92 > 88)
  --> infra/ai/maintenance/maintain_library.py:73:89
   |
71 |             episodes = requests.get(f"{BAZARR_URL}/api/episodes?seriesid={s['sonarrId']}", headers=headers).json()
72 |             for ep in episodes:
73 |                 has_fr = any(sub.get('language') == 'fr' for sub in ep.get('subtitles', []))
   |                                                                                         ^^^^
74 |                 if not has_fr:
75 |                     report.append(f"[Series] Missing FR: {s['title']} - S{ep['seasonNumber']}E{ep['episodeNumber']}")
   |

E501 Line too long (117 > 88)
  --> infra/ai/maintenance/maintain_library.py:75:89
   |
73 |                 has_fr = any(sub.get('language') == 'fr' for sub in ep.get('subtitles', []))
74 |                 if not has_fr:
75 |                     report.append(f"[Series] Missing FR: {s['title']} - S{ep['seasonNumber']}E{ep['episodeNumber']}")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
76 |                     
77 |     except Exception as e:
   |

E501 Line too long (104 > 88)
 --> infra/ai/maintenance/media_manager.py:8:89
  |
7 | DOCKER_MODE = os.environ.get("DOCKER_MODE") == "true"
8 | NVME_MOVIES = "/data/internal/media/movies" if DOCKER_MODE else "/home/jules/infra/ai/data/media/movies"
  |                                                                                         ^^^^^^^^^^^^^^^^
9 | NVME_TV = "/data/internal/media/tv" if DOCKER_MODE else "/home/jules/infra/ai/data/media/tv"
  |

E501 Line too long (92 > 88)
  --> infra/ai/maintenance/media_manager.py:9:89
   |
 7 | DOCKER_MODE = os.environ.get("DOCKER_MODE") == "true"
 8 | NVME_MOVIES = "/data/internal/media/movies" if DOCKER_MODE else "/home/jules/infra/ai/data/media/movies"
 9 | NVME_TV = "/data/internal/media/tv" if DOCKER_MODE else "/home/jules/infra/ai/data/media/tv"
   |                                                                                         ^^^^
10 |
11 | PATHS = {
   |

E501 Line too long (89 > 88)
  --> infra/ai/maintenance/media_manager.py:20:89
   |
18 |     name = os.path.splitext(name)[0]
19 |     name = re.sub(r'[\._]', ' ', name)
20 |     match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
   |                                                                                         ^
21 |     title = match.group(1).strip() if match else name
22 |     year = match.group(2) if match else ""
   |

E501 Line too long (150 > 88)
  --> infra/ai/maintenance/media_manager.py:23:89
   |
21 | ‚Ä¶
22 | ‚Ä¶
23 | ‚Ä¶ r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b']
   |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
24 | ‚Ä¶
25 | ‚Ä¶lags=re.IGNORECASE)
   |

E501 Line too long (97 > 88)
  --> infra/ai/maintenance/media_manager.py:31:89
   |
29 |     try:
30 |         if os.path.isfile(p): return os.path.getsize(p)
31 |         return sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
   |                                                                                         ^^^^^^^^^
32 |     except: return 0
   |

E501 Line too long (97 > 88)
  --> infra/ai/maintenance/media_manager.py:39:89
   |
37 |     q = query.lower().replace(" ", "")
38 |     for cat in PATHS:
39 |         for d, is_nvme in [(p, True) for p in PATHS[cat]["nvme"]] + [(PATHS[cat]["hdd"], False)]:
   |                                                                                         ^^^^^^^^^
40 |             if not os.path.exists(d): continue
41 |             for item in os.listdir(d):
   |

E501 Line too long (144 > 88)
  --> infra/ai/maintenance/media_manager.py:64:89
   |
62 | ‚Ä¶size(path)
63 | ‚Ä¶
64 | ‚Ä¶(f), "real_name": f, "size_gb": round(size / (1024**3), 2), "is_nvme": is_nvme, "path": path})
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 | ‚Ä¶], reverse=True)
   |

E501 Line too long (114 > 88)
  --> infra/ai/maintenance/media_manager.py:73:89
   |
71 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
72 |     elif cmd == "status":
73 |         u = shutil.disk_usage("/"); h = shutil.disk_usage("/mnt/externe") if os.path.exists("/mnt/externe") else u
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
74 |         print(json.dumps({"nvme_free": u.free//1024**3, "hdd_free": h.free//1024**3}))
75 |     elif cmd == "action":
   |

E501 Line too long (101 > 88)
  --> infra/ai/maintenance/media_manager.py:80:89
   |
78 |             if os.path.isdir(path): shutil.rmtree(path)
79 |             else: os.remove(path)
80 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
   |                                                                                         ^^^^^^^^^^^^^
81 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
82 |         print("Done")
   |

E501 Line too long (105 > 88)
  --> infra/ai/maintenance/media_manager.py:81:89
   |
79 |             else: os.remove(path)
80 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
81 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
   |                                                                                         ^^^^^^^^^^^^^^^^^
82 |         print("Done")
   |

E501 Line too long (91 > 88)
  --> infra/ai/maintenance/pi_bot.py:16:89
   |
14 | import share_engine
15 |
16 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
17 |
18 | # --- CONFIGURATION ---
   |

E501 Line too long (106 > 88)
  --> infra/ai/maintenance/pi_bot.py:42:89
   |
41 | def get_storage_emoji(item):
42 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0: return "üî¥"
   |                                                                                         ^^^^^^^^^^^^^^^^^^
43 |     path = item.get('path', '')
44 |     return "üìö" if path and "/mnt/externe" in path else "üöÄ"
   |

E501 Line too long (104 > 88)
  --> infra/ai/maintenance/pi_bot.py:55:90
   |
53 |                InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
54 |                InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
55 |     bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^
56 |
57 | def process_user_add(m):
   |

E501 Line too long (100 > 88)
  --> infra/ai/maintenance/pi_bot.py:69:89
   |
67 | # --- MEDIA ENGINE (ORIGINAL) ---
68 | def list_media_unified(m, cat, title, is_edit=False):
69 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                                                                         ^^^^^^^^^^^^
70 |     try:
71 |         items = json.loads(res.stdout); ctx = {}
   |

E501 Line too long (113 > 88)
  --> infra/ai/maintenance/pi_bot.py:86:89
   |
84 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
85 |     markup = InlineKeyboardMarkup(row_width=5)
86 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
87 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
88 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> infra/ai/maintenance/pi_bot.py:88:89
   |
86 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
87 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
88 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |                                                                                         ^
89 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E501 Line too long (105 > 88)
  --> infra/ai/maintenance/pi_bot.py:96:89
   |
94 |     endpoint = "movie" if category == "films" else "series"
95 |     try:
96 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |                                                                                         ^^^^^^^^^^^^^^^^^
97 |         r.raise_for_status(); data = r.json()
98 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
   |

E501 Line too long (97 > 88)
   --> infra/ai/maintenance/pi_bot.py:99:89
    |
 97 |         r.raise_for_status(); data = r.json()
 98 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
 99 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
    |                                                                                         ^^^^^^^^^
100 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
101 |         total = len(owned); start, end = page * 10, (page + 1) * 10
    |

E501 Line too long (99 > 88)
   --> infra/ai/maintenance/pi_bot.py:104:87
    |
102 |         items = owned[start:end]
103 |         if not items: bot.send_message(chat_id, "üìÇ Vide."); return
104 |         text = f"{'üé¨' if category == 'films' else 'üì∫'} **{category.capitalize()}** ({total})\n\n"
    |                                                                                         ^^^^^^^^^^^
105 |         for i, item in enumerate(items, 1):
106 |             text += f"{start + i}. {get_storage_emoji(item)} {item['title']} ({item.get('year', '')})\n"
    |

E501 Line too long (104 > 88)
   --> infra/ai/maintenance/pi_bot.py:106:89
    |
104 | ‚Ä¶     text = f"{'üé¨' if category == 'films' else 'üì∫'} **{category.capitalize()}** ({total})\n\n"
105 | ‚Ä¶     for i, item in enumerate(items, 1):
106 | ‚Ä¶         text += f"{start + i}. {get_storage_emoji(item)} {item['title']} ({item.get('year', '')})\n"
    |                                                                                       ^^^^^^^^^^^^^^^^
107 | ‚Ä¶     markup = InlineKeyboardMarkup(row_width=5)
108 | ‚Ä¶     btns = [InlineKeyboardButton(str(start+i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1‚Ä¶
    |

E501 Line too long (137 > 88)
   --> infra/ai/maintenance/pi_bot.py:108:89
    |
106 | ‚Ä¶_emoji(item)} {item['title']} ({item.get('year', '')})\n"
107 | ‚Ä¶=5)
108 | ‚Ä¶i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1)]
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
109 | ‚Ä¶
110 | ‚Ä¶
    |

E501 Line too long (102 > 88)
   --> infra/ai/maintenance/pi_bot.py:111:90
    |
109 |         markup.add(*btns)
110 |         nav = []
111 |         if page > 0: nav.append(InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
    |                                                                                         ^^^^^^^^^^^^^^
112 |         if end < total: nav.append(InlineKeyboardButton("‚û°Ô∏è", callback_data=f"m_pag:{category}:{page+1}"))
113 |         if nav: markup.row(*nav)
    |

E501 Line too long (105 > 88)
   --> infra/ai/maintenance/pi_bot.py:112:90
    |
110 |         nav = []
111 |         if page > 0: nav.append(InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
112 |         if end < total: nav.append(InlineKeyboardButton("‚û°Ô∏è", callback_data=f"m_pag:{category}:{page+1}"))
    |                                                                                         ^^^^^^^^^^^^^^^^^
113 |         if nav: markup.row(*nav)
114 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
    |

E501 Line too long (94 > 88)
   --> infra/ai/maintenance/pi_bot.py:115:89
    |
113 |         if nav: markup.row(*nav)
114 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
115 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |                                                                                         ^^^^^^
116 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
117 |     except: bot.send_message(chat_id, "‚ùå Erreur API.")
    |

E501 Line too long (106 > 88)
   --> infra/ai/maintenance/pi_bot.py:116:89
    |
114 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
115 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
116 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^^^^^^^^^
117 |     except: bot.send_message(chat_id, "‚ùå Erreur API.")
    |

E501 Line too long (91 > 88)
   --> infra/ai/maintenance/pi_bot.py:129:89
    |
127 | # --- SEARCH ENGINE (/GET) ---
128 | def stream_gpt_json(query):
129 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
    |                                                                                         ^^^
130 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
131 |     try:
    |

E501 Line too long (100 > 88)
   --> infra/ai/maintenance/pi_bot.py:130:89
    |
128 | def stream_gpt_json(query):
129 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
130 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
    |                                                                                         ^^^^^^^^^^^^
131 |     try:
132 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": ‚Ä¶
    |

E501 Line too long (204 > 88)
   --> infra/ai/maintenance/pi_bot.py:132:89
    |
130 | ‚Ä¶": \"serie|film\"}}"
131 | ‚Ä¶
132 | ‚Ä¶s=headers, json={"model": "gpt-4o-mini", "messages": [{"role": "user", "content": prompt}], "temperature": 0.1}, timeout=10)
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
133 | ‚Ä¶
134 | ‚Ä¶
    |

E501 Line too long (120 > 88)
   --> infra/ai/maintenance/pi_bot.py:152:89
    |
150 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
151 |     try:
152 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
153 |         results = r.json()
154 |         if not results: bot.send_message(m.chat.id, "‚ùå Aucun r√©sultat."); return
    |

E501 Line too long (112 > 88)
   --> infra/ai/maintenance/pi_bot.py:157:89
    |
155 |         text = f"üîç **R√©sultats pour '{titre}'**\n\n"
156 |         limit = min(len(results), 5)
157 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
158 |         markup = InlineKeyboardMarkup()
159 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |

E501 Line too long (107 > 88)
   --> infra/ai/maintenance/pi_bot.py:159:89
    |
157 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
158 |         markup = InlineKeyboardMarkup()
159 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
160 |         markup.add(*btns)
161 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
    |

E501 Line too long (107 > 88)
   --> infra/ai/maintenance/pi_bot.py:172:89
    |
170 |     # 1. New Paged UI Callbacks
171 |     if d[0] in ["m_pag", "m_sel", "m_act", "dl_sel"]:
172 |         if d[0] == "m_pag": show_media_list(call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
173 |         elif d[0] == "m_sel":
174 |             markup = InlineKeyboardMarkup()
    |

E501 Line too long (101 > 88)
   --> infra/ai/maintenance/pi_bot.py:175:90
    |
173 |         elif d[0] == "m_sel":
174 |             markup = InlineKeyboardMarkup()
175 |             markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^^
176 |                        InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
177 |                        InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |

E501 Line too long (103 > 88)
   --> infra/ai/maintenance/pi_bot.py:176:88
    |
174 | ‚Ä¶     markup = InlineKeyboardMarkup()
175 | ‚Ä¶     markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
176 | ‚Ä¶                InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
    |                                                                                   ^^^^^^^^^^^^^^^
177 | ‚Ä¶                InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
178 | ‚Ä¶     bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (89 > 88)
   --> infra/ai/maintenance/pi_bot.py:177:90
    |
175 | ‚Ä¶         markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
176 | ‚Ä¶                    InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
177 | ‚Ä¶                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |                                                                                       ^
178 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
179 | ‚Ä¶     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "üì• Ajout√©.")
    |

E501 Line too long (133 > 88)
   --> infra/ai/maintenance/pi_bot.py:178:88
    |
176 | ‚Ä¶üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
177 | ‚Ä¶‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
178 | ‚Ä¶n sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
179 | ‚Ä¶lback_query(call.id, "üì• Ajout√©.")
180 | ‚Ä¶back_query(call.id, f"Action {d[1]} enregistr√©e.", show_alert=True)
    |

E501 Line too long (112 > 88)
   --> infra/ai/maintenance/pi_bot.py:180:89
    |
178 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
179 | ‚Ä¶     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "üì• Ajout√©.")
180 | ‚Ä¶     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistr√©e.", show_alert=True)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^
181 | ‚Ä¶     return
    |

E501 Line too long (284 > 88)
   --> infra/ai/maintenance/pi_bot.py:188:88
    |
186 | ‚Ä¶
187 | ‚Ä¶
188 | ‚Ä¶, InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
189 | ‚Ä¶d, call.message.message_id, reply_markup=markup)
190 | ‚Ä¶
    |

E501 Line too long (130 > 88)
   --> infra/ai/maintenance/pi_bot.py:189:90
    |
187 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
188 | ‚Ä¶         markup.add(InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), InlineKeyboardButton("üë• Utilisateurs", callback_d ‚Ä¶
189 | ‚Ä¶         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
190 | ‚Ä¶     elif cmd == "share":
191 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (238 > 88)
   --> infra/ai/maintenance/pi_bot.py:192:88
    |
190 | ‚Ä¶
191 | ‚Ä¶
192 | ‚Ä¶:share_owned"), InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
193 | ‚Ä¶ call.message.message_id, reply_markup=markup)
194 | ‚Ä¶
    |

E501 Line too long (130 > 88)
   --> infra/ai/maintenance/pi_bot.py:193:88
    |
191 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
192 | ‚Ä¶         markup.add(InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), InlineKeyboardButton("‚ùå Contenu non ‚Ä¶
193 | ‚Ä¶         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
194 | ‚Ä¶     elif cmd == "users":
195 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (284 > 88)
   --> infra/ai/maintenance/pi_bot.py:196:88
    |
194 | ‚Ä¶
195 | ‚Ä¶
196 | ‚Ä¶st"), InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), InlineKeyboardButton("‚ùå R√©voquer", callback_data="adm:users_rev"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
197 | ‚Ä¶at.id, call.message.message_id, reply_markup=markup)
198 | ‚Ä¶
    |

E501 Line too long (136 > 88)
   --> infra/ai/maintenance/pi_bot.py:197:88
    |
195 | ‚Ä¶width=1)
196 | ‚Ä¶ Lister", callback_data="adm:users_list"), InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), InlineKeyboardButton(" ‚Ä¶
197 | ‚Ä¶ des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
198 | ‚Ä¶
199 | ‚Ä¶ = "üìã **Utilisateurs :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
    |

E501 Line too long (117 > 88)
   --> infra/ai/maintenance/pi_bot.py:199:88
    |
197 | ‚Ä¶         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
198 | ‚Ä¶     elif cmd == "users_list":
199 | ‚Ä¶         users = load_allowed_users(); text = "üìã **Utilisateurs :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
200 | ‚Ä¶         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=InlineKeyboardMarkup().add(InlineKe‚Ä¶
201 | ‚Ä¶     elif cmd == "users_add":
    |

E501 Line too long (211 > 88)
   --> infra/ai/maintenance/pi_bot.py:200:89
    |
198 | ‚Ä¶
199 | ‚Ä¶join([f"‚Ä¢ `{u}`" for u in users])
200 | ‚Ä¶id, reply_markup=InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users")), parse_mode='Markdown')
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
201 | ‚Ä¶
202 | ‚Ä¶
    |

E501 Line too long (95 > 88)
   --> infra/ai/maintenance/pi_bot.py:208:88
    |
206 | ‚Ä¶     for u in users:
207 | ‚Ä¶         if u == SUPER_ADMIN: continue
208 | ‚Ä¶         markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
    |                                                                                   ^^^^^^^
209 | ‚Ä¶     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
210 | ‚Ä¶     bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (135 > 88)
   --> infra/ai/maintenance/pi_bot.py:210:89
    |
208 | ‚Ä¶n(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
209 | ‚Ä¶Ô∏è Retour", callback_data="adm:users"))
210 | ‚Ä¶z l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
211 | ‚Ä¶
212 | ‚Ä¶wed_users()
    |

E501 Line too long (116 > 88)
   --> infra/ai/maintenance/pi_bot.py:213:89
    |
211 | ‚Ä¶     elif cmd == "users_del":
212 | ‚Ä¶         uid = int(d[2]); users = load_allowed_users()
213 | ‚Ä¶         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, "‚úÖ R√©voqu√©.")
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
214 | ‚Ä¶         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instan‚Ä¶
215 | ‚Ä¶     elif cmd == "share_owned":
    |

E501 Line too long (158 > 88)
   --> infra/ai/maintenance/pi_bot.py:214:89
    |
212 | ‚Ä¶
213 | ‚Ä¶s(users); bot.answer_callback_query(call.id, "‚úÖ R√©voqu√©.")
214 | ‚Ä¶ from_user=call.from_user, message=call.message, data="adm:users", chat_instance=call.chat_instance))
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
215 | ‚Ä¶
216 | ‚Ä¶
    |

E501 Line too long (230 > 88)
   --> infra/ai/maintenance/pi_bot.py:217:88
    |
215 | ‚Ä¶
216 | ‚Ä¶
217 | ‚Ä¶d:movies"), InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
218 | ‚Ä¶.message_id, reply_markup=markup)
219 | ‚Ä¶ True)
    |

E501 Line too long (116 > 88)
   --> infra/ai/maintenance/pi_bot.py:218:89
    |
216 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=2)
217 | ‚Ä¶         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callba ‚Ä¶
218 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
219 | ‚Ä¶     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
220 | ‚Ä¶     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |

E501 Line too long (89 > 88)
   --> infra/ai/maintenance/pi_bot.py:219:89
    |
217 | ‚Ä¶         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callba ‚Ä¶
218 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
219 | ‚Ä¶     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
    |                                                                                       ^
220 | ‚Ä¶     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
221 | ‚Ä¶     return
    |

E501 Line too long (94 > 88)
   --> infra/ai/maintenance/pi_bot.py:220:89
    |
218 |             bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
219 |         elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
220 |         elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^
221 |         return
    |

E501 Line too long (123 > 88)
   --> infra/ai/maintenance/pi_bot.py:226:89
    |
224 |     if d[0] == "sel":
225 |         try:
226 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
227 |             markup = InlineKeyboardMarkup(row_width=2)
228 |             act = "arc" if item['is_nvme'] else "res"
    |

E501 Line too long (181 > 88)
   --> infra/ai/maintenance/pi_bot.py:229:88
    |
227 | ‚Ä¶
228 | ‚Ä¶
229 | ‚Ä¶_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
230 | ‚Ä¶boardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
231 | ‚Ä¶a="cancel"))
    |

E501 Line too long (132 > 88)
   --> infra/ai/maintenance/pi_bot.py:230:88
    |
228 | ‚Ä¶     act = "arc" if item['is_nvme'] else "res"
229 | ‚Ä¶     markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("üóëÔ∏è Supprimer"‚Ä¶
230 | ‚Ä¶     if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
231 | ‚Ä¶     markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
232 | ‚Ä¶     bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (122 > 88)
   --> infra/ai/maintenance/pi_bot.py:232:90
    |
230 |             if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
231 |             markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
232 |             bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
233 |         except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
234 |     elif d[0] == "act":
    |

E501 Line too long (123 > 88)
   --> infra/ai/maintenance/pi_bot.py:236:89
    |
234 |     elif d[0] == "act":
235 |         try:
236 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
237 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
238 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (126 > 88)
   --> infra/ai/maintenance/pi_bot.py:237:89
    |
235 |         try:
236 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
237 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
238 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
239 |         except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
    |

E501 Line too long (124 > 88)
   --> infra/ai/maintenance/pi_bot.py:238:88
    |
236 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
237 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
238 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
239 |         except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
240 |     elif d[0] == "share_exec":
    |

E501 Line too long (123 > 88)
   --> infra/ai/maintenance/pi_bot.py:242:89
    |
240 |     elif d[0] == "share_exec":
241 |         try:
242 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
243 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
244 |             if subtitles:
    |

E501 Line too long (99 > 88)
   --> infra/ai/maintenance/pi_bot.py:243:89
    |
241 |         try:
242 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
243 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                                                         ^^^^^^^^^^^
244 |             if subtitles:
245 |                 markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (241 > 88)
   --> infra/ai/maintenance/pi_bot.py:246:88
    |
244 | ‚Ä¶
245 | ‚Ä¶
246 | ‚Ä¶final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
247 | ‚Ä¶s-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
248 | ‚Ä¶_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |

E501 Line too long (171 > 88)
   --> infra/ai/maintenance/pi_bot.py:247:88
    |
245 | ‚Ä¶
246 | ‚Ä¶lback_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardBu‚Ä¶
247 | ‚Ä¶len(subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
248 | ‚Ä¶from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
249 | ‚Ä¶
    |

E501 Line too long (179 > 88)
   --> infra/ai/maintenance/pi_bot.py:248:89
    |
246 | ‚Ä¶k_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardButton‚Ä¶
247 | ‚Ä¶subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
248 | ‚Ä¶_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
249 | ‚Ä¶
250 | ‚Ä¶
    |

E501 Line too long (123 > 88)
   --> infra/ai/maintenance/pi_bot.py:252:89
    |
250 |     elif d[0] == "share_final":
251 |         try:
252 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
253 |             remux_opt = True if d[2] == "remux" else False
254 |             bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (100 > 88)
   --> infra/ai/maintenance/pi_bot.py:254:88
    |
252 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
253 |             remux_opt = True if d[2] == "remux" else False
254 |             bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^
255 |             data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
256 |             if data and "video" in data:
    |

E501 Line too long (108 > 88)
   --> infra/ai/maintenance/pi_bot.py:261:88
    |
259 |             else: bot.send_message(call.message.chat.id, "‚ùå √âchec du partage.")
260 |         except: bot.send_message(call.message.chat.id, "‚ùå Erreur interne.")
261 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
262 |
263 | # --- STATUS & QUEUE ---
    |

E501 Line too long (108 > 88)
   --> infra/ai/maintenance/pi_bot.py:269:89
    |
267 |     try:
268 |         nvme = shutil.disk_usage('/')
269 |         def fmt(u): return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
270 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`"
271 |         if os.path.exists('/mnt/externe'):
    |

E501 Line too long (102 > 88)
   --> infra/ai/maintenance/pi_bot.py:281:89
    |
279 |     if not is_authorized(m.chat.id): return
280 |     try:
281 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |                                                                                         ^^^^^^^^^^^^^^
282 |         if not torrents: bot.reply_to(m, "‚Ä¢ Queue vide."); return
283 |         q_text = "üì• **Queue :**\n\n"
    |

E501 Line too long (117 > 88)
   --> infra/ai/maintenance/pi_bot.py:287:87
    |
285 |             if t['state'] in ['downloading', 'stalledDL', 'metaDL', 'queuedDL']:
286 |                 name = re.sub(r'[\._]', ' ', t['name'])
287 |                 q_text += f"‚Ä¢ **{name}**\n  ‚îî üìä {round(t['progress']*100,1)}% | üìÇ {round(t['size']/1024**3,2)}GB\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
288 |         bot.reply_to(m, q_text, parse_mode='Markdown')
289 |     except: bot.reply_to(m, "‚ùå Erreur qBit.")
    |

E501 Line too long (96 > 88)
   --> infra/ai/maintenance/pi_bot.py:295:89
    |
293 | @webhook_app.route('/')
294 | def index(): return "Bot Active"
295 | threading.Thread(target=lambda: webhook_app.run(host='0.0.0.0', port=5001), daemon=True).start()
    |                                                                                         ^^^^^^^^
296 |
297 | print("üöÄ Bot d√©marr√© avec Integrity Shield...")
    |

E501 Line too long (91 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:16:89
   |
14 | import share_engine
15 |
16 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
17 |
18 | TOKEN = os.getenv("TELEGRAM_TOKEN")
   |

E501 Line too long (96 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:27:89
   |
25 | OPENAI_KEY = os.getenv("OPENAI_KEY")
26 |
27 | SONARR_CFG = {"url": "http://localhost:8989", "key": os.getenv("SONARR_API_KEY"), "root": "/tv"}
   |                                                                                         ^^^^^^^^
28 | RADARR_CFG = {"url": "http://localhost:7878", "key": os.getenv("RADARR_API_KEY"), "root": "/movies"}
29 | PLEX_CFG = {"url": "http://localhost:32400", "token": os.getenv("PLEX_TOKEN")}
   |

E501 Line too long (100 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:28:89
   |
27 | SONARR_CFG = {"url": "http://localhost:8989", "key": os.getenv("SONARR_API_KEY"), "root": "/tv"}
28 | RADARR_CFG = {"url": "http://localhost:7878", "key": os.getenv("RADARR_API_KEY"), "root": "/movies"}
   |                                                                                         ^^^^^^^^^^^^
29 | PLEX_CFG = {"url": "http://localhost:32400", "token": os.getenv("PLEX_TOKEN")}
   |

E501 Line too long (144 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:43:90
   |
41 | ‚Ä¶
42 | ‚Ä¶
43 | ‚Ä¶e S√©curit√©** : Tentative d'acc√®s au menu admin par {m.from_user.id} (@{m.from_user.username})")
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 | ‚Ä¶
45 | ‚Ä¶
   |

E501 Line too long (104 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:50:90
   |
48 |                InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
49 |                InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
50 |     bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^
51 |
52 | def save_users(users):
   |

E501 Line too long (280 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:64:88
   |
62 | ‚Ä¶
63 | ‚Ä¶
64 | ‚Ä¶lineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 | ‚Ä¶all.message.message_id, reply_markup=markup)
   |

E501 Line too long (126 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:65:90
   |
63 |         markup = InlineKeyboardMarkup(row_width=1)
64 |         markup.add(InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), InlineKeyboardButton("üë• Utilisateurs", callback_data ‚Ä¶
65 |         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 |     
67 |     elif cmd == "share":
   |

E501 Line too long (234 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:69:88
   |
67 | ‚Ä¶
68 | ‚Ä¶
69 | ‚Ä¶re_owned"), InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
70 | ‚Ä¶l.message.message_id, reply_markup=markup)
   |

E501 Line too long (126 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:70:88
   |
68 |         markup = InlineKeyboardMarkup(row_width=1)
69 |         markup.add(InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), InlineKeyboardButton("‚ùå Contenu non po ‚Ä¶
70 |         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
71 |     
72 |     elif cmd == "users":
   |

E501 Line too long (95 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:74:88
   |
72 |     elif cmd == "users":
73 |         markup = InlineKeyboardMarkup(row_width=1)
74 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
   |                                                                                         ^^^^^^^
75 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
   |

E501 Line too long (100 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:75:88
   |
73 |         markup = InlineKeyboardMarkup(row_width=1)
74 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
75 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
   |                                                                                         ^^^^^^^^^^^^
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
77 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |

E501 Line too long (95 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:76:88
   |
74 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
75 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
   |                                                                                         ^^^^^^^
77 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
78 |         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (132 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:78:88
   |
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
77 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
78 |         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
79 |     
80 |     elif cmd == "users_list":
   |

E501 Line too long (93 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:82:88
   |
80 |     elif cmd == "users_list":
81 |         users = load_allowed_users()
82 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
   |                                                                                         ^^^^^
83 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
84 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (104 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:83:90
   |
81 |         users = load_allowed_users()
82 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
83 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
   |                                                                                         ^^^^^^^^^^^^^^^^
84 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (126 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:84:89
   |
82 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
83 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
84 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
85 |     
86 |     elif cmd == "users_add":
   |

E501 Line too long (109 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:87:88
   |
86 |     elif cmd == "users_add":
87 |         msg = bot.send_message(call.message.chat.id, "üë§ Envoyez l'ID Telegram de l'utilisateur √† ajouter :")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
88 |         bot.register_next_step_handler(msg, process_user_add)
   |

E501 Line too long (91 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:95:88
   |
93 |         for u in users:
94 |             if u == SUPER_ADMIN: continue
95 |             markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
   |                                                                                         ^^^
96 |         markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
97 |         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (131 > 88)
  --> infra/ai/maintenance/pi_bot_debug.py:97:89
   |
95 |             markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
96 |         markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
97 |         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
98 |     
99 |     elif cmd == "users_del":
   |

E501 Line too long (226 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:110:88
    |
108 | ‚Ä¶
109 | ‚Ä¶
110 | ‚Ä¶vies"), InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
111 | ‚Ä¶call.message.message_id, reply_markup=markup)
    |

E501 Line too long (128 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:111:89
    |
109 |         markup = InlineKeyboardMarkup(row_width=2)
110 |         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callback ‚Ä¶
111 |         bot.edit_message_text("S√©lectionnez la cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
112 |     
113 |     elif cmd == "list_owned":
    |

E501 Line too long (234 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:117:88
    |
116 | ‚Ä¶
117 | ‚Ä¶om du film ou de la s√©rie que vous souhaitez rechercher et partager. L'IA s'occupera de la recherche.", call.message.chat.id, call.message.message_id)
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
118 | ‚Ä¶
119 | ‚Ä¶
    |

E501 Line too long (145 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:120:88
    |
119 | ‚Ä¶
120 | ‚Ä¶n\nFonctionnalit√© en cours de d√©veloppement.", call.message.chat.id, call.message.message_id)
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
121 | ‚Ä¶
122 | ‚Ä¶ssage.chat.id, call.message.message_id)
    |

E501 Line too long (90 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:122:89
    |
120 |         bot.edit_message_text("üßπ **Nettoyage SSD**\n\nFonctionnalit√© en cours de d√©veloppement.", call.message.chat.id, call.message.‚Ä¶
121 |     
122 |     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                                                                                         ^^
123 |
124 | def process_user_add(m):
    |

E501 Line too long (100 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:139:89
    |
137 | # --- MEDIA ENGINE ---
138 | def list_media_unified(m, cat, title, is_edit=False):
139 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^
140 |     try:
141 |         items = json.loads(res.stdout)
    |

E501 Line too long (113 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:159:89
    |
157 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
158 |     markup = InlineKeyboardMarkup(row_width=5)
159 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
160 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
161 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |

E501 Line too long (89 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:161:89
    |
159 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
160 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
161 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |                                                                                         ^
162 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |

E501 Line too long (117 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:164:89
    |
162 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
163 |
164 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
165 | def media_callbacks(call):
166 |     if not is_authorized(call.from_user.id): return
    |

E501 Line too long (92 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:174:88
    |
172 |         except Exception as e:
173 |             logging.error(f"Context load failed for sel: {e}")
174 |             bot.answer_callback_query(call.id, "‚ùå Session expir√©e, relancez la recherche.")
    |                                                                                         ^^^^
175 |             return
176 |         markup = InlineKeyboardMarkup(row_width=2)
    |

E501 Line too long (100 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:178:88
    |
176 |         markup = InlineKeyboardMarkup(row_width=2)
177 |         act = "arc" if item['is_nvme'] else "res"
178 |         markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^
179 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
180 |         if call.from_user.id == SUPER_ADMIN:
    |

E501 Line too long (95 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:179:90
    |
177 |         act = "arc" if item['is_nvme'] else "res"
178 |         markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"),
179 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |                                                                                         ^^^^^^^
180 |         if call.from_user.id == SUPER_ADMIN:
181 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |

E501 Line too long (95 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:181:88
    |
179 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
180 |         if call.from_user.id == SUPER_ADMIN:
181 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                                                                         ^^^^^^^
182 |         markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
183 |         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (118 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:183:90
    |
181 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
182 |         markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
183 |         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
184 |     elif d[0] == "act":
185 |         try:
    |

E501 Line too long (122 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:192:89
    |
190 |             bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
191 |             return
192 |         res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
193 |         bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
194 |     elif d[0] == "share_exec":
    |

E501 Line too long (120 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:193:88
    |
191 |             return
192 |         res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
193 |         bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
194 |     elif d[0] == "share_exec":
195 |         try:
    |

E501 Line too long (114 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:209:88
    |
207 |         if subtitles:
208 |             markup = InlineKeyboardMarkup(row_width=1)
209 |             markup.add(InlineKeyboardButton("‚ö° Lien Rapide (Symlink)", callback_data=f"share_final:{d[1]}:link"),
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
210 |                        InlineKeyboardButton("üé¨ Remux avec Sous-titres", callback_data=f"share_final:{d[1]}:remux"),
211 |                        InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |

E501 Line too long (116 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:210:88
    |
208 | ‚Ä¶     markup = InlineKeyboardMarkup(row_width=1)
209 | ‚Ä¶     markup.add(InlineKeyboardButton("‚ö° Lien Rapide (Symlink)", callback_data=f"share_final:{d[1]}:link"),
210 | ‚Ä¶                InlineKeyboardButton("üé¨ Remux avec Sous-titres", callback_data=f"share_final:{d[1]}:remux"),
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
211 | ‚Ä¶                InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
212 | ‚Ä¶     bot.edit_message_text(f"üéØ **Options de Partage**\n{len(subtitles)} sous-titre(s) trouv√©(s).", call.message.chat.id, call.messag‚Ä¶
    |

E501 Line too long (174 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:212:88
    |
210 | ‚Ä¶tres", callback_data=f"share_final:{d[1]}:remux"),
211 | ‚Ä¶_data="cancel"))
212 | ‚Ä¶n(subtitles)} sous-titre(s) trouv√©(s).", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
213 | ‚Ä¶
214 | ‚Ä¶
    |

E501 Line too long (180 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:215:89
    |
213 | ‚Ä¶
214 | ‚Ä¶
215 | ‚Ä¶m_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
216 | ‚Ä¶
217 | ‚Ä¶
    |

E501 Line too long (150 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:227:87
    |
226 | ‚Ä¶e
227 | ‚Ä¶.." if remux_opt else "‚è≥ G√©n√©ration du lien...", call.message.chat.id, call.message.message_id)
    |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
228 | ‚Ä¶
229 | ‚Ä¶['path'], remux=remux_opt)
    |

E501 Line too long (151 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:233:87
    |
231 | ‚Ä¶
232 | ‚Ä¶
233 | ‚Ä¶nclus)**\n\nüîó Vid√©o : `{data['video']}`\n\n‚úÖ Les sous-titres ont √©t√© int√©gr√©s au fichier MKV."
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
234 | ‚Ä¶
235 | ‚Ä¶*\n\nüîó Vid√©o : `{data['video']}`\n"
    |

E501 Line too long (91 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:235:87
    |
233 | ‚Ä¶         msg = f"üé¨ **Contenu Remux√© (Softsubs inclus)**\n\nüîó Vid√©o : `{data['video']}`\n\n‚úÖ Les sous-titres ont √©t√© int√©gr√©s au fi  ‚Ä¶
234 | ‚Ä¶     else:
235 | ‚Ä¶         msg = f"‚úÖ **Contenu Partag√© (Symlink)**\n\nüîó Vid√©o : `{data['video']}`\n"
    |                                                                                   ^^^
236 | ‚Ä¶         if data.get("subtitles"):
237 | ‚Ä¶             msg += "\nüìÑ **Sous-titres (li√©s et s√©curis√©s) :**\n"
    |

E501 Line too long (106 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:242:88
    |
240 |             bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
241 |         else:
242 |             bot.send_message(call.message.chat.id, "‚ùå Erreur: √âchec du partage ou contenu hors limites.")
    |                                                                                         ^^^^^^^^^^^^^^^^^^
243 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
244 |     elif d[0] == "dl":
    |

E501 Line too long (108 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:243:88
    |
241 |         else:
242 |             bot.send_message(call.message.chat.id, "‚ùå Erreur: √âchec du partage ou contenu hors limites.")
243 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
244 |     elif d[0] == "dl":
245 |         if d[1] == "no":
    |

E501 Line too long (109 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:246:88
    |
244 |     elif d[0] == "dl":
245 |         if d[1] == "no":
246 |             bot.edit_message_text("‚ùå T√©l√©chargement annul√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
247 |             return
248 |         elif d[1] == "yes":
    |

E501 Line too long (118 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:271:89
    |
269 |                 "rootFolderPath": cfg['root'],
270 |                 "monitored": True,
271 |                 "addOptions": {"searchForMovie": True} if type_media == 'film' else {"searchForMissingEpisodes": True}
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
272 |             }
273 |             payload[id_key] = dl_data['item_id']
    |

E501 Line too long (104 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:277:88
    |
275 |                 payload["languageProfileId"] = 1
276 |
277 |             bot.edit_message_text("‚è≥ Ajout en cours...", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^
278 |             
279 |             try:
    |

E501 Line too long (133 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:280:89
    |
279 | ‚Ä¶     try:
280 | ‚Ä¶         r_add = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
281 | ‚Ä¶         if r_add.status_code in [200, 201]:
282 | ‚Ä¶             bot.edit_message_text(f"üì• **Ajout√© √† la file d'attente :** `{dl_data['found_title']} ({dl_data['year']})`\nLe t√©l√©charg‚Ä¶
    |

E501 Line too long (229 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:282:88
    |
280 | ‚Ä¶X-Api-Key": cfg['key']}, json=payload, timeout=10)
281 | ‚Ä¶
282 | ‚Ä¶_data['found_title']} ({dl_data['year']})`\nLe t√©l√©chargement va d√©buter.", call.message.chat.id, call.message.message_id, parse_mode='Markdown')
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
283 | ‚Ä¶
284 | ‚Ä¶
    |

E501 Line too long (142 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:285:88
    |
283 | ‚Ä¶
284 | ‚Ä¶: {r_add.text}")
285 | ‚Ä¶ec de l'ajout (Erreur {r_add.status_code}).", call.message.chat.id, call.message.message_id)
    |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
286 | ‚Ä¶
287 | ‚Ä¶}")
    |

E501 Line too long (131 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:288:88
    |
286 |             except Exception as e:
287 |                 logging.error(f"Arr API Error: {e}")
288 |                 bot.edit_message_text("‚ùå Erreur de communication avec le serveur.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |
290 | @bot.message_handler(commands=['status'])
    |

E501 Line too long (100 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:297:89
    |
295 |         hdd = shutil.disk_usage('/mnt/externe') # Chemin cible HDD
296 |         def fmt(u):
297 |             return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
    |                                                                                         ^^^^^^^^^^^^
298 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`\nüìö **HDD** : `{fmt(hdd)}`"
299 |         bot.reply_to(m, msg, parse_mode='Markdown')
    |

E501 Line too long (101 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:298:86
    |
296 |         def fmt(u):
297 |             return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
298 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`\nüìö **HDD** : `{fmt(hdd)}`"
    |                                                                                         ^^^^^^^^^^^^^
299 |         bot.reply_to(m, msg, parse_mode='Markdown')
300 |     except Exception:
    |

E501 Line too long (114 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:308:89
    |
306 |     try:
307 |         logging.info(f"[DEBUG_API] Interrogation Radarr √† {RADARR_CFG['url']}")
308 |         r = requests.get(f"{RADARR_CFG['url']}/api/v3/movie", headers={"X-Api-Key": RADARR_CFG['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
309 |         r.raise_for_status()
310 |         data = r.json()
    |

E501 Line too long (97 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:311:89
    |
309 |         r.raise_for_status()
310 |         data = r.json()
311 |         logging.info(f"[DEBUG_API] Status: {r.status_code} | Nombre de films re√ßus: {len(data)}")
    |                                                                                         ^^^^^^^^^
312 |         owned = [f for f in data if f.get('hasFile') is True]
313 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
    |

E501 Line too long (115 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:324:89
    |
322 |     if not is_authorized(m.chat.id): return
323 |     try:
324 |         r = requests.get(f"{SONARR_CFG['url']}/api/v3/series", headers={"X-Api-Key": SONARR_CFG['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
325 |         r.raise_for_status()
326 |         # Une s√©rie est pr√©sente si episodeFileCount > 0
    |

E501 Line too long (95 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:327:89
    |
325 |         r.raise_for_status()
326 |         # Une s√©rie est pr√©sente si episodeFileCount > 0
327 |         owned = [s for s in r.json() if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
    |                                                                                         ^^^^^^^
328 |         text = f"üì∫ **Biblioth√®que Sonarr ({len(owned)} s√©ries)**\n\n"
329 |         text += "\n".join([f"‚Ä¢ {s['title']} ‚Äî `{s['statistics']['episodeFileCount']}` √©pisodes" for s in owned])
    |

E501 Line too long (112 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:329:89
    |
327 |         owned = [s for s in r.json() if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
328 |         text = f"üì∫ **Biblioth√®que Sonarr ({len(owned)} s√©ries)**\n\n"
329 |         text += "\n".join([f"‚Ä¢ {s['title']} ‚Äî `{s['statistics']['episodeFileCount']}` √©pisodes" for s in owned])
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
330 |         bot.reply_to(m, text, parse_mode='Markdown')
331 |     except Exception:
    |

E501 Line too long (93 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:341:89
    |
339 |         name = os.path.splitext(name)[0]
340 |         name = re.sub(r'[\._]', ' ', name)
341 |         match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
    |                                                                                         ^^^^^
342 |         title = match.group(1).strip() if match else name
343 |         year = match.group(2) if match else ""
    |

E501 Line too long (154 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:344:89
    |
342 | ‚Ä¶me
343 | ‚Ä¶
344 | ‚Ä¶', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b']
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
345 | ‚Ä¶
346 | ‚Ä¶ flags=re.IGNORECASE)
    |

E501 Line too long (116 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:366:87
    |
364 |                     size = round(t['size'] / 1024**3, 2)
365 |                     clean_name = clean_title(t['name'])
366 |                     q_text += f"‚Ä¢ **{clean_name}**\n  ‚îî üì∂ {t['state']} | üìä {progress}% | ‚è≥ {eta} | üìÇ {size}GB\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
367 |     except Exception as e:
368 |         logging.error(f"qBittorrent Error: {e}")
    |

E501 Line too long (91 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:375:89
    |
373 | # --- AI HANDLER & ARR INTEGRATION ---
374 | def stream_gpt_json(query):
375 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
    |                                                                                         ^^^
376 |     prompt = f"Analyse cette demande : '{query}'. Tu DOIS extraire le titre, la saison et l'√©pisode.\n\nR√®gles de parsing :\n'S01E01'‚Ä¶
    |

E501 Line too long (453 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:376:89
    |
374 | ‚Ä¶
375 | ‚Ä¶I_KEY}"}
376 | ‚Ä¶son et l'√©pisode.\n\nR√®gles de parsing :\n'S01E01' ou 'S1E1' -> saison: 1, episode: 1\n'Saison 2' -> saison: 2, episode: null\nSi c'est un film ou incertain -> type: 'film', saison/episode: null\nSi c'est une s√©rie -> type: 'serie'\n\nRenvoie UNIQUEMENT un JSON pur : {{\"titre\": \"str\", \"saison\": \"int|null\", \"episode\": \"int|null\", \"type\": \"serie|film\"}}"
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
377 | ‚Ä¶
378 | ‚Ä¶
    |

E501 Line too long (97 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:379:89
    |
378 |     try:
379 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={
    |                                                                                         ^^^^^^^^^
380 |             "model": "gpt-4o-mini",
381 |             "messages": [{"role": "user", "content": prompt}],
    |

E501 Line too long (106 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:416:89
    |
414 |                 # Typage fort (S√©curit√©)
415 |                 parsed['titre'] = str(parsed.get('titre', ''))
416 |                 parsed['saison'] = int(parsed.get('saison')) if parsed.get('saison') is not None else None
    |                                                                                         ^^^^^^^^^^^^^^^^^^
417 |                 parsed['episode'] = int(parsed.get('episode')) if parsed.get('episode') is not None else None
418 |                 parsed['type'] = str(parsed.get('type', ''))
    |

E501 Line too long (109 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:417:89
    |
415 |                 parsed['titre'] = str(parsed.get('titre', ''))
416 |                 parsed['saison'] = int(parsed.get('saison')) if parsed.get('saison') is not None else None
417 |                 parsed['episode'] = int(parsed.get('episode')) if parsed.get('episode') is not None else None
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
418 |                 parsed['type'] = str(parsed.get('type', ''))
    |

E501 Line too long (89 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:440:88
    |
438 |         process_get_request(m, query)
439 |     else:
440 |         msg = bot.reply_to(m, "üé¨ Que veux-tu t√©l√©charger ? (Ex: Shogun S01E01 ou Dune)")
    |                                                                                         ^
441 |         bot.register_next_step_handler(msg, process_get_step)
    |

E501 Line too long (89 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:460:88
    |
459 |     if not data or "error" in data:
460 |         bot.reply_to(m, "‚ùå Le flux d'analyse a √©chou√© (Pipe Break). Donn√©es invalides.")
    |                                                                                         ^
461 |         return
    |

E501 Line too long (124 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:473:88
    |
471 |         return
472 |
473 |     bot.send_message(m.chat.id, f"üîç **Recherche en cours :** `{titre}` ({type_media.capitalize()})", parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
474 |
475 |     # 2. Phase de Routage & V√©rification de Disponibilit√© locale
    |

E501 Line too long (115 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:477:89
    |
475 |     # 2. Phase de Routage & V√©rification de Disponibilit√© locale
476 |     try:
477 |         res_local = subprocess.run(["python3", SCRIPT_PATH, "search_local", titre], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
478 |         local_items = json.loads(res_local.stdout)
479 |         if local_items:
    |

E501 Line too long (109 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:480:88
    |
478 |         local_items = json.loads(res_local.stdout)
479 |         if local_items:
480 |             bot.send_message(m.chat.id, f"‚úÖ `{titre}` est d√©j√† disponible localement dans la biblioth√®que.")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
481 |             return
482 |     except Exception as e:
    |

E501 Line too long (133 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:491:89
    |
489 |     try:
490 |         # Recherche API Sonarr/Radarr
491 |         r_lookup = requests.get(f"{cfg['url']}/api/v3/{endpoint}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=10)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
492 |         results = r_lookup.json()
    |

E501 Line too long (107 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:495:88
    |
494 |         if not results:
495 |             bot.send_message(m.chat.id, f"‚ùå `{titre}` introuvable dans les bases de donn√©es (TMDb/TVDb).")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
496 |             return
    |

E501 Line too long (112 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:504:89
    |
503 |         # Validation de Flux: V√©rification si d√©j√† dans Sonarr/Radarr
504 |         r_check = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
505 |         exists = any(str(i.get(id_key)) == str(item_id) for i in r_check.json())
    |

E501 Line too long (172 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:508:88
    |
507 | ‚Ä¶
508 | ‚Ä¶r})` est d√©j√† poss√©d√© ou en cours de t√©l√©chargement sur {'Radarr' if type_media == 'film' else 'Sonarr'}.")
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
509 | ‚Ä¶
    |

E501 Line too long (102 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:528:88
    |
526 |         except Exception as e:
527 |             logging.error(f"Context save failed: {e}")
528 |             bot.send_message(m.chat.id, "‚ùå Erreur interne lors de la pr√©paration du t√©l√©chargement.")
    |                                                                                         ^^^^^^^^^^^^^^
529 |             return
    |

E501 Line too long (102 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:550:88
    |
548 |     except requests.exceptions.RequestException as e:
549 |         logging.error(f"Arr API Error: {e}")
550 |         bot.send_message(m.chat.id, "‚ùå Erreur de communication avec les services de t√©l√©chargement.")
    |                                                                                         ^^^^^^^^^^^^^^
551 |
552 | @bot.message_handler(func=lambda m: True)
    |

E501 Line too long (96 > 88)
   --> infra/ai/maintenance/pi_bot_debug.py:560:89
    |
558 | # Webhook server start
559 | webhook_app = Flask(__name__)
560 | threading.Thread(target=lambda: webhook_app.run(host='0.0.0.0', port=5001), daemon=True).start()
    |                                                                                         ^^^^^^^^
561 |
562 | bot.infinity_polling()
    |

E501 Line too long (102 > 88)
  --> infra/ai/maintenance/share_engine.py:9:89
   |
 7 | from pathlib import Path
 8 |
 9 | SHARE_DIR = "/media_share/" if os.environ.get("DOCKER_MODE") == "true" else "/home/jules/media_share/"
   |                                                                                         ^^^^^^^^^^^^^^
10 | CONFIG_FILE = "/app/config_share.json" if os.environ.get("DOCKER_MODE") == "true" else "/home/jules/scripts/config_share.json"
11 | BASE_URL = "https://share.juleslaconfourque.fr"
   |

E501 Line too long (126 > 88)
  --> infra/ai/maintenance/share_engine.py:10:89
   |
 9 | SHARE_DIR = "/media_share/" if os.environ.get("DOCKER_MODE") == "true" else "/home/jules/media_share/"
10 | CONFIG_FILE = "/app/config_share.json" if os.environ.get("DOCKER_MODE") == "true" else "/home/jules/scripts/config_share.json"
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
11 | BASE_URL = "https://share.juleslaconfourque.fr"
   |

E501 Line too long (91 > 88)
  --> infra/ai/maintenance/share_engine.py:13:89
   |
11 | BASE_URL = "https://share.juleslaconfourque.fr"
12 |
13 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
14 |
15 | def load_config():
   |

E501 Line too long (134 > 88)
  --> infra/ai/maintenance/share_engine.py:39:89
   |
37 |                     break
38 |         
39 |         cmd = ["ffprobe", "-v", "error", "-select_streams", "v:0", "-show_entries", "stream=height", "-of", "csv=s=x:p=0", probe_path]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
40 |         res = subprocess.run(cmd, capture_output=True, text=True)
41 |         height = int(res.stdout.strip()) if res.stdout.strip().isdigit() else 0
   |

E501 Line too long (146 > 88)
  --> infra/ai/maintenance/storage_skill.py:13:88
   |
11 | ‚Ä¶ {category} introuvable."
12 | ‚Ä¶tartswith('.')]
13 | ‚Ä¶\n".join([f"‚Ä¢ {i}" for i in sorted(items)]) if items else f"üìÇ Aucun contenu dans {category}."
   |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | ‚Ä¶
15 | ‚Ä¶
   |

E501 Line too long (101 > 88)
  --> infra/ai/maintenance/storage_skill.py:19:89
   |
17 |     for name, path in [("üöÄ NVMe", "/"), ("üìö HDD", HDD_BASE)]:
18 |         usage = shutil.disk_usage(path)
19 |         report += f"{name} : {(usage.used/usage.total)*100:.1f}% ({usage.free//(2**30)} Go libres)\n"
   |                                                                                         ^^^^^^^^^^^^^
20 |     return report
   |

E501 Line too long (93 > 88)
 --> infra/ai/maintenance/test_api.py:5:89
  |
3 | RADARR_API_KEY = "75ed9e2e3922442c8c1e012e47bc0906"
4 | try:
5 |     r = requests.get(f"{RADARR_URL}/movie", headers={"X-Api-Key": RADARR_API_KEY}, timeout=5)
  |                                                                                         ^^^^^
6 |     data = r.json()
7 |     owned = [f for f in data if f.get('hasFile') is True]
  |

E501 Line too long (94 > 88)
  --> infra/ai/maintenance/test_api.py:8:89
   |
 6 |     data = r.json()
 7 |     owned = [f for f in data if f.get('hasFile') is True]
 8 |     print(f"Test Radarr : {len(data)} films au total, {len(owned)} poss√©d√©s (hasFile: True).")
   |                                                                                         ^^^^^^
 9 | except Exception as e:
10 |     print(f"Erreur Test API : {e}")
   |

E501 Line too long (113 > 88)
 --> infra/ai/maintenance/test_search.py:6:89
  |
4 | try:
5 |     query = "Inception"
6 |     r = requests.get(f"{RADARR_URL}/movie/lookup?term={query}", headers={"X-Api-Key": RADARR_API_KEY}, timeout=5)
  |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
7 |     r.raise_for_status()
8 |     results = r.json()
  |

E501 Line too long (104 > 88)
  --> infra/handlers_admin.py:15:89
   |
13 |     def status_cmd(m):
14 |         if not is_authorized(m.from_user.id): return
15 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
   |                                                                                         ^^^^^^^^^^^^^^^^
16 |         try:
17 |             nvme = shutil.disk_usage('/')
   |

E501 Line too long (92 > 88)
  --> infra/handlers_admin.py:33:88
   |
31 |         markup = types.InlineKeyboardMarkup(row_width=1)
32 |         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"),
33 |                    types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"),
   |                                                                                         ^^^^
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |

E501 Line too long (93 > 88)
  --> infra/handlers_admin.py:34:88
   |
32 |         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"),
33 |                    types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"),
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
   |                                                                                         ^^^^^
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
36 |         bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (108 > 88)
  --> infra/handlers_admin.py:36:90
   |
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
36 |         bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^
37 |
38 |     def process_user_add(m):
   |

E501 Line too long (308 > 88)
  --> infra/handlers_admin.py:56:88
   |
54 | ‚Ä¶
55 | ‚Ä¶
56 | ‚Ä¶hare"), types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 | ‚Ä¶d, call.message.message_id, reply_markup=markup)
58 | ‚Ä¶
   |

E501 Line too long (130 > 88)
  --> infra/handlers_admin.py:57:90
   |
55 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
56 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), types.InlineKeyboardButton("üë• Utilisateurs", ‚Ä¶
57 | ‚Ä¶         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 | ‚Ä¶     elif cmd == "share":
59 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
   |

E501 Line too long (256 > 88)
  --> infra/handlers_admin.py:60:88
   |
58 | ‚Ä¶
59 | ‚Ä¶
60 | ‚Ä¶a="adm:share_owned"), types.InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 | ‚Ä¶ call.message.message_id, reply_markup=markup)
62 | ‚Ä¶
   |

E501 Line too long (130 > 88)
  --> infra/handlers_admin.py:61:88
   |
59 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
60 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), types.InlineKeyboardButton("‚ùå  ‚Ä¶
61 | ‚Ä¶         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
62 | ‚Ä¶     elif cmd == "users":
63 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
   |

E501 Line too long (308 > 88)
  --> infra/handlers_admin.py:64:88
   |
62 | ‚Ä¶
63 | ‚Ä¶
64 | ‚Ä¶ers_list"), types.InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), types.InlineKeyboardButton("‚ùå R√©voquer", callback_data="adm:users_rev"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 | ‚Ä¶at.id, call.message.message_id, reply_markup=markup)
66 | ‚Ä¶
   |

E501 Line too long (136 > 88)
  --> infra/handlers_admin.py:65:88
   |
63 | ‚Ä¶p(row_width=1)
64 | ‚Ä¶ton("üìã Lister", callback_data="adm:users_list"), types.InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), types.Inlin ‚Ä¶
65 | ‚Ä¶ des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 | ‚Ä¶
67 | ‚Ä¶sers = json.load(f)["allowed"]
   |

E501 Line too long (223 > 88)
  --> infra/handlers_admin.py:69:89
   |
67 | ‚Ä¶
68 | ‚Ä¶s])
69 | ‚Ä¶id, reply_markup=types.InlineKeyboardMarkup().add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users")), parse_mode='Markdown')
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
70 | ‚Ä¶
71 | ‚Ä¶
   |

E501 Line too long (101 > 88)
  --> infra/handlers_admin.py:78:88
   |
76 | ‚Ä¶     for u in users:
77 | ‚Ä¶         if u == SUPER_ADMIN: continue
78 | ‚Ä¶         markup.add(types.InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
   |                                                                                   ^^^^^^^^^^^^^
79 | ‚Ä¶     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
80 | ‚Ä¶     bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> infra/handlers_admin.py:79:90
   |
77 | ‚Ä¶             if u == SUPER_ADMIN: continue
78 | ‚Ä¶             markup.add(types.InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
79 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
   |                                                                                       ^
80 | ‚Ä¶         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
81 | ‚Ä¶     elif cmd == "users_del":
   |

E501 Line too long (135 > 88)
  --> infra/handlers_admin.py:80:89
   |
78 | ‚Ä¶rdButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
79 | ‚Ä¶tton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
80 | ‚Ä¶ez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
81 | ‚Ä¶
82 | ‚Ä¶
   |

E501 Line too long (166 > 88)
  --> infra/handlers_admin.py:88:89
   |
86 | ‚Ä¶
87 | ‚Ä¶.")
88 | ‚Ä¶.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instance=call.chat_instance))
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
89 | ‚Ä¶
90 | ‚Ä¶
   |

E501 Line too long (248 > 88)
  --> infra/handlers_admin.py:91:88
   |
89 | ‚Ä¶
90 | ‚Ä¶
91 | ‚Ä¶t_owned:movies"), types.InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
92 | ‚Ä¶.message_id, reply_markup=markup)
93 | ‚Ä¶
   |

E501 Line too long (116 > 88)
  --> infra/handlers_admin.py:92:89
   |
90 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=2)
91 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), types.InlineKeyboardButton("üì∫ S√©ri ‚Ä¶
92 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
93 | ‚Ä¶     elif cmd == "list_owned":
94 | ‚Ä¶         from handlers_media import list_media_unified
   |

E501 Line too long (94 > 88)
  --> infra/handlers_media.py:13:89
   |
12 | def get_storage_emoji(item):
13 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0:
   |                                                                                         ^^^^^^
14 |         return "üî¥"
15 |     path = item.get('path', '')
   |

E501 Line too long (100 > 88)
  --> infra/handlers_media.py:19:89
   |
18 | def list_media_unified(bot, m, cat, title, is_edit=False):
19 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                                                                         ^^^^^^^^^^^^
20 |     try:
21 |         items = json.loads(res.stdout); ctx = {}
   |

E501 Line too long (119 > 88)
  --> infra/handlers_media.py:36:89
   |
34 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
35 |     markup = types.InlineKeyboardMarkup(row_width=5)
36 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
38 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> infra/handlers_media.py:38:89
   |
36 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
37 |     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
38 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |                                                                                         ^
39 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E501 Line too long (98 > 88)
  --> infra/handlers_media.py:41:89
   |
39 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
40 |
41 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
   |                                                                                         ^^^^^^^^^^
42 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
43 |     endpoint = "movie" if category == "films" else "series"
   |

E501 Line too long (106 > 88)
  --> infra/handlers_media.py:45:89
   |
43 |     endpoint = "movie" if category == "films" else "series"
44 |     try:
45 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^^
46 |         r.raise_for_status(); data = r.json()
47 |         data.sort(key=lambda x: x.get('added', ''), reverse=True)
   |

E501 Line too long (145 > 88)
  --> infra/handlers_media.py:57:89
   |
55 | ‚Ä¶m.get('year', '')})\n"
56 | ‚Ä¶dth=5)
57 | ‚Ä¶rt + i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1)]
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 | ‚Ä¶
59 | ‚Ä¶
   |

E501 Line too long (112 > 88)
  --> infra/handlers_media.py:60:90
   |
58 |         markup.add(*btns)
59 |         nav_row = []
60 |         if page > 0: nav_row.append(types.InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
62 |         if nav_row: markup.row(*nav_row)
   |

E501 Line too long (130 > 88)
  --> infra/handlers_media.py:61:90
   |
59 |         nav_row = []
60 |         if page > 0: nav_row.append(types.InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
   |

E501 Line too long (89 > 88)
  --> infra/handlers_media.py:63:88
   |
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
   |                                                                                         ^
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (94 > 88)
  --> infra/handlers_media.py:64:89
   |
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
66 |     except Exception as e: bot.send_message(chat_id, f"‚ùå Erreur API : {e}")
   |

E501 Line too long (106 > 88)
  --> infra/handlers_media.py:65:89
   |
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^
66 |     except Exception as e: bot.send_message(chat_id, f"‚ùå Erreur API : {e}")
   |

E501 Line too long (107 > 88)
  --> infra/handlers_media.py:71:89
   |
69 |     @bot.message_handler(commands=['films'])
70 |     def films_cmd(m):
71 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "films", 0, True, is_authorized)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^
72 |
73 |     @bot.message_handler(commands=['series'])
   |

E501 Line too long (108 > 88)
  --> infra/handlers_media.py:75:89
   |
73 |     @bot.message_handler(commands=['series'])
74 |     def series_cmd(m):
75 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "series", 0, True, is_authorized)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^
76 |
77 |     @bot.message_handler(commands=['queue'])
   |

E501 Line too long (97 > 88)
  --> infra/handlers_media.py:83:89
   |
81 |             name = os.path.splitext(name)[0]
82 |             name = re.sub(r'[\._]', ' ', name)
83 |             match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
   |                                                                                         ^^^^^^^^^
84 |             title = match.group(1).strip() if match else name
85 |             year = match.group(2) if match else ""
   |

E501 Line too long (158 > 88)
  --> infra/handlers_media.py:86:89
   |
84 | ‚Ä¶name
85 | ‚Ä¶
86 | ‚Ä¶\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b']
   |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
87 | ‚Ä¶e
88 | ‚Ä¶n, flags=re.IGNORECASE)
   |

E501 Line too long (106 > 88)
  --> infra/handlers_media.py:91:89
   |
89 |             return re.sub(r'\s+', ' ', clean).strip()
90 |         try:
91 |             r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                                                                         ^^^^^^^^^^^^^^^^^^
92 |             if not torrents: bot.reply_to(m, "‚Ä¢ Queue vide."); return
93 |             q_text = "üì• **Queue :**\n\n"
   |

E501 Line too long (110 > 88)
  --> infra/handlers_media.py:95:89
   |
93 |             q_text = "üì• **Queue :**\n\n"
94 |             for t in torrents:
95 |                 if t['state'] in ['downloading', 'stalledDL', 'metaDL', 'queuedDL', 'checkingDL', 'pausedDL']:
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^
96 |                     clean_name = clean_title(t['name'])
97 |                     eta_sec = t.get('eta', 8640000)
   |

E501 Line too long (138 > 88)
   --> infra/handlers_media.py:99:88
    |
 97 | ‚Ä¶000)
 98 | ‚Ä¶0000 else str(timedelta(seconds=eta_sec))
 99 | ‚Ä¶}**\n  ‚îî üìä {round(t['progress']*100,1)}% | üìÇ {round(t['size']/1024**3,2)}GB | ‚è≥ {eta}\n"
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
100 | ‚Ä¶'Markdown')
101 | ‚Ä¶")
    |

E501 Line too long (153 > 88)
   --> infra/handlers_media.py:103:89
    |
101 | ‚Ä¶
102 | ‚Ä¶
103 | ‚Ä¶data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_final", "cancel")))
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
104 | ‚Ä¶
105 | ‚Ä¶
    |

E501 Line too long (96 > 88)
   --> infra/handlers_media.py:109:89
    |
108 |         if d[0] == "m_pag":
109 |             show_media_list(bot, call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                                                                                         ^^^^^^^^
110 |         elif d[0] == "m_sel":
111 |             cat, item_id = d[1], d[2]
    |

E501 Line too long (123 > 88)
   --> infra/handlers_media.py:116:89
    |
114 |             display_title = f"ID {item_id}"
115 |             try:
116 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
117 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
118 |             except: pass
    |

E501 Line too long (93 > 88)
   --> infra/handlers_media.py:117:89
    |
115 |             try:
116 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
117 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
    |                                                                                         ^^^^^
118 |             except: pass
119 |             markup = types.InlineKeyboardMarkup()
    |

E501 Line too long (107 > 88)
   --> infra/handlers_media.py:120:90
    |
118 |             except: pass
119 |             markup = types.InlineKeyboardMarkup()
120 |             markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
121 |                        types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 |                        types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |

E501 Line too long (109 > 88)
   --> infra/handlers_media.py:121:88
    |
119 | ‚Ä¶     markup = types.InlineKeyboardMarkup()
120 | ‚Ä¶     markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
121 | ‚Ä¶                types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^
122 | ‚Ä¶                types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
123 | ‚Ä¶     bot.edit_message_text(f"üéØ **Action : {display_title}**", call.message.chat.id, call.message.message_id, reply_markup=markup, pa‚Ä¶
    |

E501 Line too long (95 > 88)
   --> infra/handlers_media.py:122:90
    |
120 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
121 | ‚Ä¶                    types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 | ‚Ä¶                    types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |                                                                                       ^^^^^^^
123 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action : {display_title}**", call.message.chat.id, call.message.message_id, reply_markup=markup‚Ä¶
124 | ‚Ä¶     elif d[0] == "m_act":
    |

E501 Line too long (160 > 88)
   --> infra/handlers_media.py:123:88
    |
121 | ‚Ä¶ger", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 | ‚Ä¶ur", callback_data=f"m_pag:{d[1]}:0"))
123 | ‚Ä¶title}**", call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
124 | ‚Ä¶
125 | ‚Ä¶
    |

E501 Line too long (127 > 88)
   --> infra/handlers_media.py:131:89
    |
129 |                 endpoint = "movie" if cat == "films" else "series"
130 |                 try:
131 |                     r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
132 |                     if r.status_code == 200:
133 |                         path = r.json().get('path')
    |

E501 Line too long (96 > 88)
   --> infra/handlers_media.py:137:87
    |
135 | ‚Ä¶                     data = share_engine.generate_secure_link(path)
136 | ‚Ä¶                     if data and "video" in data:
137 | ‚Ä¶                         msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
    |                                                                                   ^^^^^^^^
138 | ‚Ä¶                         bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 | ‚Ä¶                     else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
    |

E501 Line too long (98 > 88)
   --> infra/handlers_media.py:138:89
    |
136 |                             if data and "video" in data:
137 |                                 msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
    |

E501 Line too long (90 > 88)
   --> infra/handlers_media.py:139:88
    |
137 |                                 msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
    |                                                                                         ^^
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
141 |                 except: bot.send_message(call.message.chat.id, "‚ùå Erreur API.")
    |

E501 Line too long (89 > 88)
   --> infra/handlers_media.py:140:88
    |
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
    |                                                                                         ^
141 |                 except: bot.send_message(call.message.chat.id, "‚ùå Erreur API.")
142 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E501 Line too long (127 > 88)
   --> infra/handlers_media.py:146:89
    |
144 |         elif d[0] == "sel":
145 |             try:
146 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
147 |                 markup = types.InlineKeyboardMarkup(row_width=2)
148 |                 act = "arc" if item['is_nvme'] else "res"
    |

E501 Line too long (197 > 88)
   --> infra/handlers_media.py:149:88
    |
147 | ‚Ä¶
148 | ‚Ä¶
149 | ‚Ä¶ck_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
150 | ‚Ä¶eyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
151 | ‚Ä¶ata="cancel"))
    |

E501 Line too long (142 > 88)
   --> infra/handlers_media.py:150:89
    |
148 | ‚Ä¶se "res"
149 | ‚Ä¶tton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:‚Ä¶
150 | ‚Ä¶IN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
151 | ‚Ä¶tton("‚ùå Annuler", callback_data="cancel"))
152 | ‚Ä¶'name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (92 > 88)
   --> infra/handlers_media.py:151:88
    |
149 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButto‚Ä¶
150 | ‚Ä¶         if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"‚Ä¶
151 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |                                                                                   ^^^^
152 | ‚Ä¶         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
153 | ‚Ä¶     except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
    |

E501 Line too long (126 > 88)
   --> infra/handlers_media.py:152:90
    |
150 | ‚Ä¶             if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[‚Ä¶
151 | ‚Ä¶             markup.add(types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
152 | ‚Ä¶             bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
153 | ‚Ä¶         except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
154 | ‚Ä¶     elif d[0] == "act":
    |

E501 Line too long (127 > 88)
   --> infra/handlers_media.py:156:89
    |
154 |         elif d[0] == "act":
155 |             try:
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (130 > 88)
   --> infra/handlers_media.py:157:89
    |
155 |             try:
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
159 |             except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
    |

E501 Line too long (128 > 88)
   --> infra/handlers_media.py:158:88
    |
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
159 |             except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
160 |         elif d[0] == "share_exec":
    |

E501 Line too long (127 > 88)
   --> infra/handlers_media.py:162:89
    |
160 |         elif d[0] == "share_exec":
161 |             try:
162 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
163 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
164 |                 if subtitles:
    |

E501 Line too long (103 > 88)
   --> infra/handlers_media.py:163:89
    |
161 |             try:
162 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
163 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                                                         ^^^^^^^^^^^^^^^
164 |                 if subtitles:
165 |                     markup = types.InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (263 > 88)
   --> infra/handlers_media.py:166:88
    |
164 | ‚Ä¶
165 | ‚Ä¶
166 | ‚Ä¶a=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
167 | ‚Ä¶ sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
168 | ‚Ä¶er=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |

E501 Line too long (175 > 88)
   --> infra/handlers_media.py:167:88
    |
165 | ‚Ä¶1)
166 | ‚Ä¶nk", callback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), ty‚Ä¶
167 | ‚Ä¶n{len(subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
168 | ‚Ä¶=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
169 | ‚Ä¶)
    |

E501 Line too long (191 > 88)
   --> infra/handlers_media.py:168:89
    |
166 | ‚Ä¶lback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), types.Inli‚Ä¶
167 | ‚Ä¶btitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
168 | ‚Ä¶, from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
169 | ‚Ä¶
170 | ‚Ä¶
    |

E501 Line too long (127 > 88)
   --> infra/handlers_media.py:172:89
    |
170 |         elif d[0] == "share_final":
171 |             try:
172 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
173 |                 remux_opt = True if d[2] == "remux" else False
174 |                 bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (104 > 88)
   --> infra/handlers_media.py:174:88
    |
172 | ‚Ä¶     with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
173 | ‚Ä¶     remux_opt = True if d[2] == "remux" else False
174 | ‚Ä¶     bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |                                                                               ^^^^^^^^^^^^^^^^
175 | ‚Ä¶     data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
176 | ‚Ä¶     if data and "video" in data: bot.send_message(call.message.chat.id, f"‚úÖ **Partag√©**\n\nüîó Vid√©o : `{data['video']}`", parse_mod ‚Ä¶
    |

E501 Line too long (157 > 88)
   --> infra/handlers_media.py:176:88
    |
174 | ‚Ä¶call.message.chat.id, call.message.message_id)
175 | ‚Ä¶item['path'], remux=remux_opt)
176 | ‚Ä¶sage(call.message.chat.id, f"‚úÖ **Partag√©**\n\nüîó Vid√©o : `{data['video']}`", parse_mode='Markdown')
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
177 | ‚Ä¶id, "‚ùå √âchec.")
178 | ‚Ä¶, "‚ùå Erreur interne.")
    |

E501 Line too long (112 > 88)
   --> infra/handlers_media.py:179:88
    |
177 |                 else: bot.send_message(call.message.chat.id, "‚ùå √âchec.")
178 |             except: bot.send_message(call.message.chat.id, "‚ùå Erreur interne.")
179 |         elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
    |

E501 Line too long (91 > 88)
  --> infra/handlers_search.py:10:89
   |
 9 | def stream_gpt_json(query):
10 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
   |                                                                                         ^^^
11 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
12 |     try:
   |

E501 Line too long (100 > 88)
  --> infra/handlers_search.py:11:89
   |
 9 | def stream_gpt_json(query):
10 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
11 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
   |                                                                                         ^^^^^^^^^^^^
12 |     try:
13 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [‚Ä¶
   |

E501 Line too long (204 > 88)
  --> infra/handlers_search.py:13:89
   |
11 | ‚Ä¶": \"serie|film\"}}"
12 | ‚Ä¶
13 | ‚Ä¶s=headers, json={"model": "gpt-4o-mini", "messages": [{"role": "user", "content": prompt}], "temperature": 0.1}, timeout=10)
   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | ‚Ä¶
15 | ‚Ä¶
   |

E501 Line too long (112 > 88)
  --> infra/handlers_search.py:55:89
   |
53 |                 "rootFolderPath": "/movies" if cat == "movie" else "/tv",
54 |                 "monitored": True,
55 |                 "addOptions": {"searchForMovie": True} if cat == "movie" else {"searchForMissingEpisodes": True}
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
56 |             }
57 |             payload[id_key] = item[id_key]
   |

E501 Line too long (125 > 88)
  --> infra/handlers_search.py:60:89
   |
58 |             if cat == "series": payload["languageProfileId"] = 1
59 |
60 |             r = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |             if r.status_code in [200, 201]:
62 |                 bot.edit_message_text(f"‚úÖ **Ajout√© :** `{item['title']} ({item.get('year')})`", call.message.chat.id, call.message.mes‚Ä¶
   |

E501 Line too long (166 > 88)
  --> infra/handlers_search.py:62:88
   |
60 | ‚Ä¶}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
61 | ‚Ä¶
62 | ‚Ä¶['title']} ({item.get('year')})`", call.message.chat.id, call.message.message_id, parse_mode='Markdown')
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
63 | ‚Ä¶
64 | ‚Ä¶ {r.status_code}")
   |

E501 Line too long (120 > 88)
  --> infra/handlers_search.py:78:89
   |
76 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
77 |     try:
78 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
79 |         results = r.json()
80 |         if not results: bot.send_message(m.chat.id, "‚ùå Aucun r√©sultat."); return
   |

E501 Line too long (112 > 88)
  --> infra/handlers_search.py:89:89
   |
87 |         text = f"üîç **R√©sultats pour '{titre}'**\n\n"
88 |         limit = min(len(results), 5)
89 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
90 |         markup = InlineKeyboardMarkup()
91 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |

E501 Line too long (109 > 88)
  --> infra/handlers_search.py:91:89
   |
89 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
90 |         markup = InlineKeyboardMarkup()
91 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
92 |         markup.add(*btns)
93 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (132 > 88)
  --> infra/monitoring/add_ip_widgets.py:21:89
   |
19 |         "datasource": { "type": "prometheus", "uid": "Prometheus" },
20 |         "targets": [
21 |             { "expr": "last_over_time(public_ip_info{type='host'}[1h])", "format": "table", "legendFormat": "{{ip}}", "refId": "A" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |         ],
23 |         "fieldConfig": {
   |

E501 Line too long (102 > 88)
  --> infra/monitoring/add_ip_widgets.py:27:89
   |
25 |                 "color": { "mode": "fixed", "fixedColor": "blue" },
26 |                 "mappings": [],
27 |                 "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": None } ] }
   |                                                                                         ^^^^^^^^^^^^^^
28 |             }
29 |         },
   |

E501 Line too long (90 > 88)
  --> infra/monitoring/add_ip_widgets.py:30:89
   |
28 |             }
29 |         },
30 |         "options": { "textMode": "value", "colorMode": "background", "graphMode": "none" }
   |                                                                                         ^^
31 |     },
32 |     {
   |

E501 Line too long (131 > 88)
  --> infra/monitoring/add_ip_widgets.py:38:89
   |
36 |         "datasource": { "type": "prometheus", "uid": "Prometheus" },
37 |         "targets": [
38 |             { "expr": "last_over_time(public_ip_info{type='vpn'}[1h])", "format": "table", "legendFormat": "{{ip}}", "refId": "A" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
39 |         ],
40 |         "fieldConfig": {
   |

E501 Line too long (102 > 88)
  --> infra/monitoring/add_ip_widgets.py:43:89
   |
41 |             "defaults": {
42 |                 "color": { "mode": "fixed", "fixedColor": "purple" },
43 |                 "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": None } ] }
   |                                                                                         ^^^^^^^^^^^^^^
44 |             }
45 |         },
   |

E501 Line too long (90 > 88)
  --> infra/monitoring/add_ip_widgets.py:46:89
   |
44 |             }
45 |         },
46 |         "options": { "textMode": "value", "colorMode": "background", "graphMode": "none" }
   |                                                                                         ^^
47 |     }
48 | ]
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/add_ip_widgets.py:56:89
   |
54 | db["panels"] = ip_panels + db["panels"]
55 |
56 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
57 | if res.status_code == 200:
58 |     print("IP widgets added to Master Dashboard.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/apply_blueprint_ip.py:29:89
   |
27 |         panel["fieldConfig"]["defaults"]["displayName"] = "${__field.labels.ip}"
28 |
29 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
30 | if res.status_code == 200:
31 |     print("Grafana VPN IP panel forced to Name mode with ${__field.labels.ip}")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/architect_protocol_ip.py:22:89
   |
20 |         panel["fieldConfig"]["defaults"]["displayName"] = "${__field.labels.ip}"
21 |
22 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
23 | if res.status_code == 200:
24 |     print("Dashboard VPN IP panel strictly configured via the Architect Protocol.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/cleanup_legends.py:18:89
   |
16 |         panel["targets"][0]["legendFormat"] = "Usage RAM"
17 |
18 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
19 | if res.status_code == 200:
20 |     print("Legends cleaned up: CPU and RAM names are now concise.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/convert_temp_to_curve.py:25:89
   |
23 |         panel["fieldConfig"]["defaults"]["thresholds"]["mode"] = "absolute"
24 |         
25 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
26 | if res.status_code == 200:
27 |     print("Temperature panel converted to Time Series (curve).")
   |

E501 Line too long (132 > 88)
  --> infra/monitoring/create_custom_dashboard.py:47:89
   |
45 |         "datasource": { "type": "prometheus", "uid": "Prometheus" },
46 |         "targets": [
47 |           { "expr": "rate(container_network_receive_bytes_total{name=\"gluetun\"}[5m])", "legendFormat": "Download", "refId": "A" },
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
48 |           { "expr": "rate(container_network_transmit_bytes_total{name=\"gluetun\"}[5m])", "legendFormat": "Upload", "refId": "B" }
49 |         ],
   |

E501 Line too long (130 > 88)
  --> infra/monitoring/create_custom_dashboard.py:48:89
   |
46 |         "targets": [
47 |           { "expr": "rate(container_network_receive_bytes_total{name=\"gluetun\"}[5m])", "legendFormat": "Download", "refId": "A" },
48 |           { "expr": "rate(container_network_transmit_bytes_total{name=\"gluetun\"}[5m])", "legendFormat": "Upload", "refId": "B" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
49 |         ],
50 |         "fieldConfig": {
   |

E501 Line too long (146 > 88)
  --> infra/monitoring/create_custom_dashboard.py:68:89
   |
66 | ‚Ä¶: "Prometheus" },
67 | ‚Ä¶
68 | ‚Ä¶bytes{mountpoint=\"/\"} * 100) / node_filesystem_size_bytes{mountpoint=\"/\"})", "refId": "A" }
   |                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
69 | ‚Ä¶
70 | ‚Ä¶
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/definitive_ip_fix.py:22:89
   |
20 |         panel["fieldConfig"]["defaults"]["displayName"] = "${__field.labels.ip}"
21 |
22 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
23 | if res.status_code == 200:
24 |     print("Architectural fix applied: topk(1) filter and label extraction are now active.")
   |

E501 Line too long (91 > 88)
  --> infra/monitoring/definitive_ip_fix.py:24:89
   |
22 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
23 | if res.status_code == 200:
24 |     print("Architectural fix applied: topk(1) filter and label extraction are now active.")
   |                                                                                         ^^^
25 | else:
26 |     print(f"Error: {res.status_code} {res.text}")
   |

E501 Line too long (107 > 88)
  --> infra/monitoring/deploy_architect_master.py:20:89
   |
18 |         "datasource": { "type": "prometheus", "uid": "Prometheus" },
19 |         "targets": [
20 |           { "expr": "node_hwmon_temp_celsius{chip='thermal_thermal_zone0', sensor='temp0'}", "refId": "A" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^
21 |         ],
22 |         "fieldConfig": {
   |

E501 Line too long (130 > 88)
  --> infra/monitoring/deploy_architect_master.py:87:89
   |
85 |         "datasource": { "type": "prometheus", "uid": "Prometheus" },
86 |         "targets": [
87 |           { "expr": "rate(container_network_receive_bytes_total{name='gluetun'}[5m])", "legendFormat": "Download", "refId": "A" },
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
88 |           { "expr": "rate(container_network_transmit_bytes_total{name='gluetun'}[5m])", "legendFormat": "Upload", "refId": "B" }
89 |         ],
   |

E501 Line too long (128 > 88)
  --> infra/monitoring/deploy_architect_master.py:88:89
   |
86 |         "targets": [
87 |           { "expr": "rate(container_network_receive_bytes_total{name='gluetun'}[5m])", "legendFormat": "Download", "refId": "A" },
88 |           { "expr": "rate(container_network_transmit_bytes_total{name='gluetun'}[5m])", "legendFormat": "Upload", "refId": "B" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
89 |         ],
90 |         "fieldConfig": {
   |

E501 Line too long (169 > 88)
   --> infra/monitoring/deploy_architect_master.py:103:89
    |
101 | ‚Ä¶s" },
102 | ‚Ä¶
103 | ‚Ä¶oint='/'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", "legendFormat": "Root FS", "refId": "A" }
    |                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
104 | ‚Ä¶
105 | ‚Ä¶
    |

E501 Line too long (130 > 88)
  --> infra/monitoring/deploy_v2_clean.py:22:89
   |
20 |                 "gridPos": {"h": 4, "w": 12, "x": 0, "y": 0},
21 |                 "datasource": {"type": "prometheus", "uid": DS_UID},
22 |                 "targets": [{"expr": "last_over_time(public_ip_info{type='host'}[24h])", "legendFormat": "{{ip}}", "refId": "A"}],
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 |                 "options": {"textMode": "name", "reduceOptions": {"calcs": ["lastNotNull"]}},
24 |                 "fieldConfig": {"defaults": {"displayName": "${__field.labels.ip}", "color": {"mode": "fixed", "fixedColor": "blue"}}}
   |

E501 Line too long (93 > 88)
  --> infra/monitoring/deploy_v2_clean.py:23:89
   |
21 |                 "datasource": {"type": "prometheus", "uid": DS_UID},
22 |                 "targets": [{"expr": "last_over_time(public_ip_info{type='host'}[24h])", "legendFormat": "{{ip}}", "refId": "A"}],
23 |                 "options": {"textMode": "name", "reduceOptions": {"calcs": ["lastNotNull"]}},
   |                                                                                         ^^^^^
24 |                 "fieldConfig": {"defaults": {"displayName": "${__field.labels.ip}", "color": {"mode": "fixed", "fixedColor": "blue"}}}
25 |             },
   |

E501 Line too long (134 > 88)
  --> infra/monitoring/deploy_v2_clean.py:24:89
   |
22 |                 "targets": [{"expr": "last_over_time(public_ip_info{type='host'}[24h])", "legendFormat": "{{ip}}", "refId": "A"}],
23 |                 "options": {"textMode": "name", "reduceOptions": {"calcs": ["lastNotNull"]}},
24 |                 "fieldConfig": {"defaults": {"displayName": "${__field.labels.ip}", "color": {"mode": "fixed", "fixedColor": "blue"}}}
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
25 |             },
26 |             {
   |

E501 Line too long (122 > 88)
  --> infra/monitoring/deploy_v2_clean.py:31:89
   |
29 | ‚Ä¶     "gridPos": {"h": 4, "w": 12, "x": 12, "y": 0},
30 | ‚Ä¶     "datasource": {"type": "prometheus", "uid": DS_UID},
31 | ‚Ä¶     "targets": [{"expr": "topk(1, vpn_public_ip_info{ip!='Error'})", "legendFormat": "{{ip}}", "refId": "A"}],
   |                                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
32 | ‚Ä¶     "options": {"textMode": "name", "reduceOptions": {"calcs": ["lastNotNull"]}},
33 | ‚Ä¶     "fieldConfig": {"defaults": {"displayName": "${__field.labels.ip}", "color": {"mode": "fixed", "fixedColor": "purple"}}}
   |

E501 Line too long (93 > 88)
  --> infra/monitoring/deploy_v2_clean.py:32:89
   |
30 | ‚Ä¶         "datasource": {"type": "prometheus", "uid": DS_UID},
31 | ‚Ä¶         "targets": [{"expr": "topk(1, vpn_public_ip_info{ip!='Error'})", "legendFormat": "{{ip}}", "refId": "A"}],
32 | ‚Ä¶         "options": {"textMode": "name", "reduceOptions": {"calcs": ["lastNotNull"]}},
   |                                                                                   ^^^^^
33 | ‚Ä¶         "fieldConfig": {"defaults": {"displayName": "${__field.labels.ip}", "color": {"mode": "fixed", "fixedColor": "purple"}}}
34 | ‚Ä¶     },
   |

E501 Line too long (136 > 88)
  --> infra/monitoring/deploy_v2_clean.py:33:89
   |
31 | ‚Ä¶vpn_public_ip_info{ip!='Error'})", "legendFormat": "{{ip}}", "refId": "A"}],
32 | ‚Ä¶, "reduceOptions": {"calcs": ["lastNotNull"]}},
33 | ‚Ä¶displayName": "${__field.labels.ip}", "color": {"mode": "fixed", "fixedColor": "purple"}}}
   |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
34 | ‚Ä¶
35 | ‚Ä¶
   |

E501 Line too long (109 > 88)
  --> infra/monitoring/deploy_v2_clean.py:41:89
   |
39 | ‚Ä¶         "gridPos": {"h": 6, "w": 8, "x": 0, "y": 4},
40 | ‚Ä¶         "datasource": {"type": "prometheus", "uid": DS_UID},
41 | ‚Ä¶         "targets": [{"expr": "node_hwmon_temp_celsius{chip='thermal_thermal_zone0'}", "refId": "A"}],
   |                                                                                   ^^^^^^^^^^^^^^^^^^^^^
42 | ‚Ä¶         "fieldConfig": {"defaults": {"unit": "celsius", "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": Non‚Ä¶
43 | ‚Ä¶     },
   |

E501 Line too long (211 > 88)
  --> infra/monitoring/deploy_v2_clean.py:42:89
   |
40 | ‚Ä¶
41 | ‚Ä¶_zone0'}", "refId": "A"}],
42 | ‚Ä¶e": "absolute", "steps": [{"color": "green", "value": None}, {"color": "orange", "value": 65}, {"color": "red", "value": 75}]}}}
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
43 | ‚Ä¶
44 | ‚Ä¶
   |

E501 Line too long (131 > 88)
  --> infra/monitoring/deploy_v2_clean.py:49:89
   |
47 | ‚Ä¶         "gridPos": {"h": 6, "w": 8, "x": 8, "y": 4},
48 | ‚Ä¶         "datasource": {"type": "prometheus", "uid": DS_UID},
49 | ‚Ä¶         "targets": [{"expr": "100 - ((node_memory_MemAvailable_bytes * 100) / node_memory_MemTotal_bytes)", "refId": "A"}],
   |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
50 | ‚Ä¶         "fieldConfig": {"defaults": {"unit": "percent", "min": 0, "max": 100, "thresholds": {"mode": "absolute", "steps": [{"color":‚Ä¶
51 | ‚Ä¶     },
   |

E501 Line too long (233 > 88)
  --> infra/monitoring/deploy_v2_clean.py:50:89
   |
48 | ‚Ä¶
49 | ‚Ä¶ / node_memory_MemTotal_bytes)", "refId": "A"}],
50 | ‚Ä¶0, "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": None}, {"color": "orange", "value": 80}, {"color": "red", "value": 90}]}}}
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
51 | ‚Ä¶
52 | ‚Ä¶
   |

E501 Line too long (184 > 88)
  --> infra/monitoring/deploy_v2_clean.py:57:89
   |
55 | ‚Ä¶
56 | ‚Ä¶
57 | ‚Ä¶sage_seconds_total{name!=''}[1m])) by (name) * 100)", "legendFormat": "{{name}}", "instant": True, "refId": "A"}],
   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 | ‚Ä¶ 0, "max": 100}},
59 | ‚Ä¶rizontal"}
   |

E501 Line too long (138 > 88)
  --> infra/monitoring/deploy_v2_clean.py:68:89
   |
66 | ‚Ä¶     "datasource": {"type": "prometheus", "uid": DS_UID},
67 | ‚Ä¶     "targets": [
68 | ‚Ä¶         {"expr": "rate(container_network_receive_bytes_total{name='gluetun'}[5m])", "legendFormat": "Download", "refId": "A"},
   |                                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
69 | ‚Ä¶         {"expr": "rate(container_network_transmit_bytes_total{name='gluetun'}[5m])", "legendFormat": "Upload", "refId": "B"}
70 | ‚Ä¶     ],
   |

E501 Line too long (136 > 88)
  --> infra/monitoring/deploy_v2_clean.py:69:89
   |
67 | ‚Ä¶     "targets": [
68 | ‚Ä¶         {"expr": "rate(container_network_receive_bytes_total{name='gluetun'}[5m])", "legendFormat": "Download", "refId": "A"},
69 | ‚Ä¶         {"expr": "rate(container_network_transmit_bytes_total{name='gluetun'}[5m])", "legendFormat": "Upload", "refId": "B"}
   |                                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
70 | ‚Ä¶     ],
71 | ‚Ä¶     "fieldConfig": {"defaults": {"unit": "binBps"}}
   |

E501 Line too long (162 > 88)
  --> infra/monitoring/deploy_v2_clean.py:80:89
   |
78 | ‚Ä¶ DS_UID},
79 | ‚Ä¶
80 | ‚Ä¶untpoint='/'} - node_filesystem_avail_bytes{mountpoint='/'}", "legendFormat": "Utilis√©", "refId": "A"},
   |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
81 | ‚Ä¶untpoint='/'}", "legendFormat": "Total", "refId": "B"}
82 | ‚Ä¶
   |

E501 Line too long (113 > 88)
  --> infra/monitoring/deploy_v2_clean.py:81:89
   |
79 | ‚Ä¶     "targets": [
80 | ‚Ä¶         {"expr": "node_filesystem_size_bytes{mountpoint='/'} - node_filesystem_avail_bytes{mountpoint='/'}", "legendFormat": "Utilis‚Ä¶
81 | ‚Ä¶         {"expr": "node_filesystem_size_bytes{mountpoint='/'}", "legendFormat": "Total", "refId": "B"}
   |                                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^
82 | ‚Ä¶     ],
83 | ‚Ä¶     "options": {"textMode": "value_and_name", "colorMode": "background", "graphMode": "area"},
   |

E501 Line too long (106 > 88)
  --> infra/monitoring/deploy_v2_clean.py:83:89
   |
81 |                     {"expr": "node_filesystem_size_bytes{mountpoint='/'}", "legendFormat": "Total", "refId": "B"}
82 |                 ],
83 |                 "options": {"textMode": "value_and_name", "colorMode": "background", "graphMode": "area"},
   |                                                                                         ^^^^^^^^^^^^^^^^^^
84 |                 "fieldConfig": {"defaults": {"unit": "decbytes"}}
85 |             },
   |

E501 Line too long (184 > 88)
  --> infra/monitoring/deploy_v2_clean.py:92:89
   |
90 | ‚Ä¶
91 | ‚Ä¶
92 | ‚Ä¶mnt/externe'} - node_filesystem_avail_bytes{mountpoint='/mnt/externe'}", "legendFormat": "Utilis√©", "refId": "A"},
   |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
93 | ‚Ä¶mnt/externe'}", "legendFormat": "Total", "refId": "B"}
94 | ‚Ä¶
   |

E501 Line too long (124 > 88)
  --> infra/monitoring/deploy_v2_clean.py:93:89
   |
91 | ‚Ä¶     "targets": [
92 | ‚Ä¶         {"expr": "node_filesystem_size_bytes{mountpoint='/mnt/externe'} - node_filesystem_avail_bytes{mountpoint='/mnt/externe'}", "‚Ä¶
93 | ‚Ä¶         {"expr": "node_filesystem_size_bytes{mountpoint='/mnt/externe'}", "legendFormat": "Total", "refId": "B"}
   |                                                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
94 | ‚Ä¶     ],
95 | ‚Ä¶     "options": {"textMode": "value_and_name", "colorMode": "background", "graphMode": "area"},
   |

E501 Line too long (106 > 88)
  --> infra/monitoring/deploy_v2_clean.py:95:89
   |
93 |                     {"expr": "node_filesystem_size_bytes{mountpoint='/mnt/externe'}", "legendFormat": "Total", "refId": "B"}
94 |                 ],
95 |                 "options": {"textMode": "value_and_name", "colorMode": "background", "graphMode": "area"},
   |                                                                                         ^^^^^^^^^^^^^^^^^^
96 |                 "fieldConfig": {"defaults": {"unit": "decbytes"}}
97 |             }
   |

E501 Line too long (90 > 88)
  --> infra/monitoring/extend_ip_lookback.py:12:89
   |
10 |     if "IP Publique" in panel["title"]:
11 |         # Increase the lookback window to 24h to ensure we catch the last metric point
12 |         panel["targets"][0]["expr"] = panel["targets"][0]["expr"].replace("[1h]", "[24h]")
   |                                                                                         ^^
13 |         
14 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/extend_ip_lookback.py:14:89
   |
12 |         panel["targets"][0]["expr"] = panel["targets"][0]["expr"].replace("[1h]", "[24h]")
13 |         
14 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
15 | if res.status_code == 200:
16 |     print("IP widgets updated with 24h lookback window.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/filter_error_ip.py:13:89
   |
11 |         panel["targets"][0]["expr"] = 'vpn_public_ip_info{ip!="Error"}'
12 |
13 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
14 | if res.status_code == 200:
15 |     print("Grafana VPN IP panel updated to filter out 'Error' label.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/final_fix_grafana.py:13:89
   |
11 |         panel["fieldConfig"]["defaults"]["displayName"] = "${__field.labels.ip}"
12 |
13 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
14 | if res.status_code == 200:
15 |     print("Final fix applied: VPN IP extracted from labels.")
   |

E501 Line too long (99 > 88)
  --> infra/monitoring/finalize_vpn_display.py:14:89
   |
12 |         # Reset and clean overrides to show only the IP label
13 |         panel["fieldConfig"]["overrides"] = []
14 |         # In Stat panels, choosing 'name' text mode and setting displayName to the label works well
   |                                                                                         ^^^^^^^^^^^
15 |         panel["options"]["textMode"] = "name"
16 |         panel["fieldConfig"]["defaults"]["displayName"] = "${__field.labels.ip}"
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/finalize_vpn_display.py:24:89
   |
22 |         }
23 |
24 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
25 | if res.status_code == 200:
26 |     print("Grafana VPN IP panel finalized with correct metric and label extraction.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/fix_datasource_uid.py:13:89
   |
11 |         panel["datasource"]["uid"] = CORRECT_UID
12 |
13 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
14 | if res.status_code == 200:
15 |     print(f"Fixed datasource UID for all panels to {CORRECT_UID}")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/fix_final_ip_display.py:18:89
   |
16 |         panel["fieldConfig"]["defaults"]["displayName"] = "IP S√©curis√©e"
17 |
18 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
19 | if res.status_code == 200:
20 |     print("VPN/Torrent IP display fixed to show only the address.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/fix_ip_display.py:27:89
   |
25 |         panel["options"]["textMode"] = "value"
26 |
27 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
28 | if res.status_code == 200:
29 |     print("IP widgets fixed to show labels.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/fix_stat_labels.py:23:89
   |
21 |         panel["targets"][0]["legendFormat"] = "{{ip}}"
22 |
23 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
24 | if res.status_code == 200:
25 |     print("IP widgets updated: switched to label-based value display.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/fix_vpn_status.py:41:89
   |
40 | # Save updated dashboard
41 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
42 | if res.status_code == 200:
43 |     print("VPN Status panel fixed: switched to Liveness (seconds since last seen).")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/force_vpn_ip_table.py:30:89
   |
28 |             del panel["fieldConfig"]["defaults"]["displayName"]
29 |
30 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
31 | if res.status_code == 200:
32 |     print("Grafana VPN IP panel forced to Table format + IP field.")
   |

E501 Line too long (128 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:17:89
   |
15 |     "targets": [
16 |         { 
17 |             "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", 
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 |             "legendFormat": "NVME (/) - Libre : {{value}}", 
19 |             "refId": "A" 
   |

E501 Line too long (150 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:22:89
   |
20 | ‚Ä¶
21 | ‚Ä¶
22 | ‚Ä¶tes{mountpoint='/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/externe'})", 
   |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 | ‚Ä¶re : {{value}}", 
24 | ‚Ä¶
   |

E501 Line too long (96 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:56:89
   |
54 | }
55 |
56 | # On utilise une transformation Grafana pour injecter l'espace libre dans le label si possible, 
   |                                                                                         ^^^^^^^^
57 | # mais la m√©thode la plus propre en "un coup d'oeil" est de mettre deux barres par disque : 
58 | # Une pour le % et une stat pour le Go.
   |

E501 Line too long (92 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:57:89
   |
56 | # On utilise une transformation Grafana pour injecter l'espace libre dans le label si possible, 
57 | # mais la m√©thode la plus propre en "un coup d'oeil" est de mettre deux barres par disque : 
   |                                                                                         ^^^^
58 | # Une pour le % et une stat pour le Go.
   |

E501 Line too long (176 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:62:89
   |
60 | ‚Ä¶)
61 | ‚Ä¶
62 | ‚Ä¶ * 100) / node_filesystem_size_bytes{mountpoint='/'})", "legendFormat": "NVME Saturation (%)", "refId": "A" },
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
63 | ‚Ä¶ndFormat": "NVME Libre (Go)", "refId": "B" },
64 | ‚Ä¶t/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/externe'})", "legendFormat": "HDD Saturation (%)", "refId": "C" },
   |

E501 Line too long (111 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:63:89
   |
61 | storage_panel["targets"] = [
62 |     { "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", "legendForma‚Ä¶
63 |     { "expr": "node_filesystem_avail_bytes{mountpoint='/'}", "legendFormat": "NVME Libre (Go)", "refId": "B" },
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
64 |     { "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/ext‚Ä¶
65 |     { "expr": "node_filesystem_avail_bytes{mountpoint='/mnt/externe'}", "legendFormat": "HDD Libre (Go)", "refId": "D" }
   |

E501 Line too long (197 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:64:89
   |
62 | ‚Ä¶node_filesystem_size_bytes{mountpoint='/'})", "legendFormat": "NVME Saturation (%)", "refId": "A" },
63 | ‚Ä¶ "NVME Libre (Go)", "refId": "B" },
64 | ‚Ä¶} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/externe'})", "legendFormat": "HDD Saturation (%)", "refId": "C" },
   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 | ‚Ä¶endFormat": "HDD Libre (Go)", "refId": "D" }
66 | ‚Ä¶
   |

E501 Line too long (120 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:65:89
   |
63 |     { "expr": "node_filesystem_avail_bytes{mountpoint='/'}", "legendFormat": "NVME Libre (Go)", "refId": "B" },
64 |     { "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/ext‚Ä¶
65 |     { "expr": "node_filesystem_avail_bytes{mountpoint='/mnt/externe'}", "legendFormat": "HDD Libre (Go)", "refId": "D" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 | ]
   |

E501 Line too long (114 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:79:89
   |
78 | # Nettoyage et remplacement
79 | db["panels"] = [p for p in db["panels"] if "Stockage" not in p["title"] and "Saturation Disque" not in p["title"]]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
80 | db["panels"].append(storage_panel)
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/redesign_storage_clarity.py:82:89
   |
80 | db["panels"].append(storage_panel)
81 |
82 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
83 | if res.status_code == 200:
84 |     print("Dashboard Storage section redesigned for clarity.")
   |

E501 Line too long (143 > 88)
  --> infra/monitoring/redesign_storage_ratio_stat.py:17:89
   |
15 | ‚Ä¶
16 | ‚Ä¶
17 | ‚Ä¶tes{{mountpoint='{mountpoint}'}} - node_filesystem_avail_bytes{{mountpoint='{mountpoint}'}}", 
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 | ‚Ä¶
19 | ‚Ä¶
   |

E501 Line too long (159 > 88)
  --> infra/monitoring/redesign_storage_ratio_stat.py:27:89
   |
25 | ‚Ä¶
26 | ‚Ä¶
27 | ‚Ä¶ytes{{mountpoint='{mountpoint}'}} * 100) / node_filesystem_size_bytes{{mountpoint='{mountpoint}'}})", 
   |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
28 | ‚Ä¶
29 | ‚Ä¶
   |

E501 Line too long (127 > 88)
  --> infra/monitoring/redesign_storage_ratio_stat.py:40:89
   |
38 |                     "steps": [
39 |                         { "color": "green", "value": None },
40 |                         { "color": "yellow", "value": 70 * 1024*1024*1024 }, # Ce sera √©cras√© par l'override pour la saturation
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
41 |                         { "color": "red", "value": 90 * 1024*1024*1024 }
42 |                     ]
   |

E501 Line too long (113 > 88)
  --> infra/monitoring/redesign_storage_ratio_stat.py:50:89
   |
48 |                     "properties": [
49 |                         { "id": "unit", "value": "percent" },
50 |                         { "id": "custom.hideFrom", "value": { "tooltip": False, "viz": True, "legend": False } },
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
51 |                         { "id": "thresholds", "value": {
52 |                             "mode": "absolute",
   |

E501 Line too long (97 > 88)
  --> infra/monitoring/redesign_storage_ratio_stat.py:81:89
   |
80 | # Ajout des deux nouveaux panels (NVME et HDD)
81 | db["panels"].append(create_storage_stat_panel("Stockage NVME (/) : Utilis√© / Total", "/", 0, 18))
   |                                                                                         ^^^^^^^^^
82 | db["panels"].append(create_storage_stat_panel("Stockage HDD (/mnt/externe) : Utilis√© / Total", "/mnt/externe", 12, 18))
   |

E501 Line too long (119 > 88)
  --> infra/monitoring/redesign_storage_ratio_stat.py:82:89
   |
80 | # Ajout des deux nouveaux panels (NVME et HDD)
81 | db["panels"].append(create_storage_stat_panel("Stockage NVME (/) : Utilis√© / Total", "/", 0, 18))
82 | db["panels"].append(create_storage_stat_panel("Stockage HDD (/mnt/externe) : Utilis√© / Total", "/mnt/externe", 12, 18))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
83 |
84 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/redesign_storage_ratio_stat.py:84:89
   |
82 | db["panels"].append(create_storage_stat_panel("Stockage HDD (/mnt/externe) : Utilis√© / Total", "/mnt/externe", 12, 18))
83 |
84 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
85 | if res.status_code == 200:
86 |     print("Dashboard Storage section redesigned with Unified Ratio (Stat panels).")
   |

E501 Line too long (151 > 88)
  --> infra/monitoring/refactor_dashboard.py:15:89
   |
13 | ‚Ä¶
14 | ‚Ä¶
15 | ‚Ä¶_usage_seconds_total{name!=''}[1m])) by (name) * 100)", "legendFormat": "{{name}}", "refId": "A" }
   |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
16 | ‚Ä¶
17 | ‚Ä¶
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/refactor_dashboard.py:61:89
   |
60 | # Push updated dashboard
61 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
62 | if res.status_code == 200:
63 |     print("Dashboard refactored successfully according to the Blueprint.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/revert_vpn_ip.py:26:89
   |
24 |         }
25 |
26 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
27 | if res.status_code == 200:
28 |     print("VPN IP display reverted to direct metric (working state).")
   |

E501 Line too long (92 > 88)
 --> infra/monitoring/scripts/vpn_exporter.py:8:89
  |
6 |         if self.path == '/metrics':
7 |             try:
8 |                 with urllib.request.urlopen('https://api.ipify.org', timeout=5) as response:
  |                                                                                         ^^^^
9 |                     ip = response.read().decode('utf-8').strip()
  |

E501 Line too long (104 > 88)
  --> infra/monitoring/scripts/vpn_exporter.py:23:89
   |
21 |             except Exception:
22 |                 # In case of error, we return 200 but NO metrics, or a 503.
23 |                 # Returning 200 with no metrics is cleaner for Prometheus (target stays UP but no data).
   |                                                                                         ^^^^^^^^^^^^^^^^
24 |                 self.send_response(200)
25 |                 self.send_header('Content-Type', 'text/plain')
   |

E501 Line too long (101 > 88)
  --> infra/monitoring/setup_grafana.py:47:89
   |
46 |     # Modify the dashboard JSON to use our datasource if needed, 
47 |     # but the import API usually handles inputs if we provide them, or we can just replace variables.
   |                                                                                         ^^^^^^^^^^^^^
48 |     
49 |     print(f"Importing dashboard {dashboard_id}...")
   |

E501 Line too long (89 > 88)
  --> infra/monitoring/setup_grafana.py:70:89
   |
68 |         print(f"Dashboard {dashboard_id} imported successfully!")
69 |     else:
70 |         print(f"Failed to import dashboard {dashboard_id}: {res.status_code} {res.text}")
   |                                                                                         ^
71 |         
72 | if __name__ == "__main__":
   |

E501 Line too long (89 > 88)
  --> infra/monitoring/surgical_dashboard_update.py:20:89
   |
18 |     # A. Fix Temperature
19 |     if "Temp√©rature CPU" in panel["title"]:
20 |         panel["options"]["reduceOptions"] = { "calcs": ["lastNotNull"], "values": False }
   |                                                                                         ^
21 |         if "textMode" in panel["options"]:
22 |             panel["options"]["textMode"] = "value"
   |

E501 Line too long (109 > 88)
  --> infra/monitoring/surgical_dashboard_update.py:28:89
   |
26 |         panel["gridPos"] = { "h": 4, "w": 12, "x": 0, "y": 0 }
27 |     
28 |     if any(title in panel["title"] for title in ["IP qBittorrent", "IP Publique (VPN)", "IP Torrent & VPN"]):
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
29 |         panel["title"] = "IP Torrent & VPN (S√©curis√©)"
30 |         panel["gridPos"] = { "h": 4, "w": 12, "x": 12, "y": 0 }
   |

E501 Line too long (111 > 88)
  --> infra/monitoring/surgical_dashboard_update.py:59:89
   |
57 |     "datasource": { "type": "prometheus", "uid": "Prometheus" },
58 |     "targets": [
59 |         { "expr": "100 - ((node_memory_MemAvailable_bytes * 100) / node_memory_MemTotal_bytes)", "refId": "A" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
60 |     ],
61 |     "fieldConfig": {
   |

E501 Line too long (145 > 88)
  --> infra/monitoring/surgical_dashboard_update.py:83:89
   |
81 | ‚Ä¶Prometheus" },
82 | ‚Ä¶
83 | ‚Ä¶s_total{device=~"nvme.*|sd.*"}[5m])) by (device)', "legendFormat": "{{device}}", "refId": "A" }
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
84 | ‚Ä¶
85 | ‚Ä¶
   |

E501 Line too long (98 > 88)
   --> infra/monitoring/surgical_dashboard_update.py:101:89
    |
 99 | db["panels"] = unique_panels
100 |
101 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
    |                                                                                         ^^^^^^^^^^
102 | if res.status_code == 200:
103 |     print("Dashboard surgically updated: Vitals added and noise removed.")
    |

E501 Line too long (109 > 88)
  --> infra/monitoring/update_grafana_temp.py:17:89
   |
15 | for panel in db["panels"]:
16 |     if panel["id"] == 1:
17 |         panel["targets"][0]["expr"] = "node_hwmon_temp_celsius{chip='thermal_thermal_zone0', sensor='temp0'}"
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
18 |         panel["fieldConfig"]["defaults"]["unit"] = "celsius"
19 |         panel["fieldConfig"]["defaults"]["decimals"] = 1
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/update_grafana_temp.py:22:89
   |
21 | # Save updated dashboard
22 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
23 | if res.status_code == 200:
24 |     print("Custom dashboard updated with specific CPU temperature target.")
   |

E501 Line too long (124 > 88)
  --> infra/monitoring/update_ips.py:17:89
   |
15 |     try:
16 |         # Use wget as curl is missing in gluetun
17 |         vpn_ip = subprocess.check_output("docker exec gluetun wget -qO- https://api.ipify.org", shell=True).decode().strip()
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 |     except:
19 |         vpn_ip = "Unknown"
   |

E501 Line too long (128 > 88)
  --> infra/monitoring/update_storage_master.py:21:89
   |
19 |     "targets": [
20 |         { 
21 |             "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", 
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |             "legendFormat": "NVME (System /)", 
23 |             "refId": "A" 
   |

E501 Line too long (150 > 88)
  --> infra/monitoring/update_storage_master.py:26:89
   |
24 | ‚Ä¶
25 | ‚Ä¶
26 | ‚Ä¶tes{mountpoint='/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/externe'})", 
   |                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
27 | ‚Ä¶", 
28 | ‚Ä¶
   |

E501 Line too long (95 > 88)
  --> infra/monitoring/update_storage_master.py:46:89
   |
44 |         }
45 |     },
46 |     "options": { "displayMode": "gradient", "orientation": "horizontal", "showUnfilled": True }
   |                                                                                         ^^^^^^^
47 | }
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/update_storage_master.py:54:89
   |
52 | db["panels"].append(storage_panel)
53 |
54 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
55 | if res.status_code == 200:
56 |     print("Storage section updated with NVME and HDD tracking.")
   |

E501 Line too long (180 > 88)
  --> infra/monitoring/update_storage_ratio.py:17:89
   |
15 | ‚Ä¶
16 | ‚Ä¶
17 | ‚Ä¶'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", "legendFormat": "NVME Saturation (%)", "refId": "A" },
   |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
18 | ‚Ä¶_filesystem_avail_bytes{mountpoint='/'}", "legendFormat": "NVME Utilis√©", "refId": "B" },
19 | ‚Ä¶endFormat": "NVME Total", "refId": "C" },
   |

E501 Line too long (157 > 88)
  --> infra/monitoring/update_storage_ratio.py:18:89
   |
16 | ‚Ä¶
17 | ‚Ä¶ountpoint='/'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", "legendFormat": "NVME Saturation (%)", "refId": "A" },
18 | ‚Ä¶='/'} - node_filesystem_avail_bytes{mountpoint='/'}", "legendFormat": "NVME Utilis√©", "refId": "B" },
   |                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 | ‚Ä¶='/'}", "legendFormat": "NVME Total", "refId": "C" },
20 | ‚Ä¶
   |

E501 Line too long (109 > 88)
  --> infra/monitoring/update_storage_ratio.py:19:89
   |
17 | ‚Ä¶     { "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", "legendFor‚Ä¶
18 | ‚Ä¶     { "expr": "node_filesystem_size_bytes{mountpoint='/'} - node_filesystem_avail_bytes{mountpoint='/'}", "legendFormat": "NVME Util‚Ä¶
19 | ‚Ä¶     { "expr": "node_filesystem_size_bytes{mountpoint='/'}", "legendFormat": "NVME Total", "refId": "C" },
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^
20 | ‚Ä¶     # HDD
21 | ‚Ä¶     { "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/e‚Ä¶
   |

E501 Line too long (201 > 88)
  --> infra/monitoring/update_storage_ratio.py:21:89
   |
19 | ‚Ä¶: "NVME Total", "refId": "C" },
20 | ‚Ä¶
21 | ‚Ä¶e'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/externe'})", "legendFormat": "HDD Saturation (%)", "refId": "D" },
   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 | ‚Ä¶e_filesystem_avail_bytes{mountpoint='/mnt/externe'}", "legendFormat": "HDD Utilis√©", "refId": "E" },
23 | ‚Ä¶gendFormat": "HDD Total", "refId": "F" }
   |

E501 Line too long (178 > 88)
  --> infra/monitoring/update_storage_ratio.py:22:89
   |
20 | ‚Ä¶
21 | ‚Ä¶/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/externe'})", "legendFormat": "HDD Saturation (%)", "refId": "D" },
22 | ‚Ä¶rne'} - node_filesystem_avail_bytes{mountpoint='/mnt/externe'}", "legendFormat": "HDD Utilis√©", "refId": "E" },
   |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
23 | ‚Ä¶rne'}", "legendFormat": "HDD Total", "refId": "F" }
24 | ‚Ä¶
   |

E501 Line too long (118 > 88)
  --> infra/monitoring/update_storage_ratio.py:23:89
   |
21 |         { "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt‚Ä¶
22 |         { "expr": "node_filesystem_size_bytes{mountpoint='/mnt/externe'} - node_filesystem_avail_bytes{mountpoint='/mnt/externe'}", "l‚Ä¶
23 |         { "expr": "node_filesystem_size_bytes{mountpoint='/mnt/externe'}", "legendFormat": "HDD Total", "refId": "F" }
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
24 |     ],
25 |     "fieldConfig": {
   |

E501 Line too long (95 > 88)
  --> infra/monitoring/update_storage_ratio.py:45:89
   |
43 |                 "properties": [
44 |                     { "id": "unit", "value": "decbytes" },
45 |                     { "id": "color", "value": { "mode": "fixed", "fixedColor": "light-blue" } }
   |                                                                                         ^^^^^^^
46 |                 ]
47 |             }
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/update_storage_ratio.py:66:89
   |
64 | db["panels"].append(storage_panel)
65 |
66 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
67 | if res.status_code == 200:
68 |     print("Dashboard Storage section updated to Ratio format (Used / Total).")
   |

E501 Line too long (132 > 88)
  --> infra/monitoring/update_storage_units.py:18:89
   |
16 |             # NVME - Percentage
17 |             { 
18 |                 "expr": "100 - ((node_filesystem_avail_bytes{mountpoint='/'} * 100) / node_filesystem_size_bytes{mountpoint='/'})", 
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
19 |                 "legendFormat": "NVME (%)", 
20 |                 "refId": "A" 
   |

E501 Line too long (154 > 88)
  --> infra/monitoring/update_storage_units.py:30:89
   |
28 | ‚Ä¶
29 | ‚Ä¶
30 | ‚Ä¶bytes{mountpoint='/mnt/externe'} * 100) / node_filesystem_size_bytes{mountpoint='/mnt/externe'})", 
   |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
31 | ‚Ä¶
32 | ‚Ä¶
   |

E501 Line too long (89 > 88)
  --> infra/monitoring/update_storage_units.py:48:89
   |
46 |                 "properties": [
47 |                     { "id": "unit", "value": "decbytes" },
48 |                     { "id": "color", "value": { "mode": "fixed", "fixedColor": "blue" } }
   |                                                                                         ^
49 |                 ]
50 |             },
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/update_storage_units.py:63:89
   |
61 |         panel["options"]["orientation"] = "horizontal"
62 |
63 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
64 | if res.status_code == 200:
65 |     print("Storage section updated with absolute GB values.")
   |

E501 Line too long (98 > 88)
  --> infra/monitoring/update_vpn_metric.py:12:89
   |
10 |         panel["targets"][0]["expr"] = "last_over_time(vpn_public_ip_info[24h])"
11 |
12 | res = requests.post(f"{GRAFANA_URL}/api/dashboards/db", json={"dashboard": db, "overwrite": True})
   |                                                                                         ^^^^^^^^^^
13 | if res.status_code == 200:
14 |     print("VPN IP widget updated to use the new robust vpn_exporter metric.")
   |

E501 Line too long (91 > 88)
  --> infra/pi_bot.py:16:89
   |
14 | import share_engine
15 |
16 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
17 |
18 | # --- CONFIGURATION ---
   |

E501 Line too long (106 > 88)
  --> infra/pi_bot.py:42:89
   |
41 | def get_storage_emoji(item):
42 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0: return "üî¥"
   |                                                                                         ^^^^^^^^^^^^^^^^^^
43 |     path = item.get('path', '')
44 |     return "üìö" if path and "/mnt/externe" in path else "üöÄ"
   |

E501 Line too long (104 > 88)
  --> infra/pi_bot.py:55:90
   |
53 |                InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
54 |                InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
55 |     bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^
56 |
57 | def process_user_add(m):
   |

E501 Line too long (100 > 88)
  --> infra/pi_bot.py:69:89
   |
67 | # --- MEDIA ENGINE (ORIGINAL) ---
68 | def list_media_unified(m, cat, title, is_edit=False):
69 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                                                                         ^^^^^^^^^^^^
70 |     try:
71 |         items = json.loads(res.stdout); ctx = {}
   |

E501 Line too long (113 > 88)
  --> infra/pi_bot.py:86:89
   |
84 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
85 |     markup = InlineKeyboardMarkup(row_width=5)
86 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
87 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
88 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> infra/pi_bot.py:88:89
   |
86 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
87 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
88 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |                                                                                         ^
89 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E501 Line too long (105 > 88)
  --> infra/pi_bot.py:96:89
   |
94 |     endpoint = "movie" if category == "films" else "series"
95 |     try:
96 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |                                                                                         ^^^^^^^^^^^^^^^^^
97 |         r.raise_for_status(); data = r.json()
98 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
   |

E501 Line too long (97 > 88)
   --> infra/pi_bot.py:99:89
    |
 97 |         r.raise_for_status(); data = r.json()
 98 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
 99 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
    |                                                                                         ^^^^^^^^^
100 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
101 |         total = len(owned); start, end = page * 10, (page + 1) * 10
    |

E501 Line too long (99 > 88)
   --> infra/pi_bot.py:104:87
    |
102 |         items = owned[start:end]
103 |         if not items: bot.send_message(chat_id, "üìÇ Vide."); return
104 |         text = f"{'üé¨' if category == 'films' else 'üì∫'} **{category.capitalize()}** ({total})\n\n"
    |                                                                                         ^^^^^^^^^^^
105 |         for i, item in enumerate(items, 1):
106 |             text += f"{start + i}. {get_storage_emoji(item)} {item['title']} ({item.get('year', '')})\n"
    |

E501 Line too long (104 > 88)
   --> infra/pi_bot.py:106:89
    |
104 | ‚Ä¶     text = f"{'üé¨' if category == 'films' else 'üì∫'} **{category.capitalize()}** ({total})\n\n"
105 | ‚Ä¶     for i, item in enumerate(items, 1):
106 | ‚Ä¶         text += f"{start + i}. {get_storage_emoji(item)} {item['title']} ({item.get('year', '')})\n"
    |                                                                                       ^^^^^^^^^^^^^^^^
107 | ‚Ä¶     markup = InlineKeyboardMarkup(row_width=5)
108 | ‚Ä¶     btns = [InlineKeyboardButton(str(start+i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1‚Ä¶
    |

E501 Line too long (137 > 88)
   --> infra/pi_bot.py:108:89
    |
106 | ‚Ä¶_emoji(item)} {item['title']} ({item.get('year', '')})\n"
107 | ‚Ä¶=5)
108 | ‚Ä¶i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1)]
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
109 | ‚Ä¶
110 | ‚Ä¶
    |

E501 Line too long (102 > 88)
   --> infra/pi_bot.py:111:90
    |
109 |         markup.add(*btns)
110 |         nav = []
111 |         if page > 0: nav.append(InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
    |                                                                                         ^^^^^^^^^^^^^^
112 |         if end < total: nav.append(InlineKeyboardButton("‚û°Ô∏è", callback_data=f"m_pag:{category}:{page+1}"))
113 |         if nav: markup.row(*nav)
    |

E501 Line too long (105 > 88)
   --> infra/pi_bot.py:112:90
    |
110 |         nav = []
111 |         if page > 0: nav.append(InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
112 |         if end < total: nav.append(InlineKeyboardButton("‚û°Ô∏è", callback_data=f"m_pag:{category}:{page+1}"))
    |                                                                                         ^^^^^^^^^^^^^^^^^
113 |         if nav: markup.row(*nav)
114 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
    |

E501 Line too long (94 > 88)
   --> infra/pi_bot.py:115:89
    |
113 |         if nav: markup.row(*nav)
114 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
115 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |                                                                                         ^^^^^^
116 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
117 |     except: bot.send_message(chat_id, "‚ùå Erreur API.")
    |

E501 Line too long (106 > 88)
   --> infra/pi_bot.py:116:89
    |
114 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
115 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
116 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^^^^^^^^^
117 |     except: bot.send_message(chat_id, "‚ùå Erreur API.")
    |

E501 Line too long (91 > 88)
   --> infra/pi_bot.py:129:89
    |
127 | # --- SEARCH ENGINE (/GET) ---
128 | def stream_gpt_json(query):
129 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
    |                                                                                         ^^^
130 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
131 |     try:
    |

E501 Line too long (100 > 88)
   --> infra/pi_bot.py:130:89
    |
128 | def stream_gpt_json(query):
129 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
130 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
    |                                                                                         ^^^^^^^^^^^^
131 |     try:
132 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": ‚Ä¶
    |

E501 Line too long (204 > 88)
   --> infra/pi_bot.py:132:89
    |
130 | ‚Ä¶": \"serie|film\"}}"
131 | ‚Ä¶
132 | ‚Ä¶s=headers, json={"model": "gpt-4o-mini", "messages": [{"role": "user", "content": prompt}], "temperature": 0.1}, timeout=10)
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
133 | ‚Ä¶
134 | ‚Ä¶
    |

E501 Line too long (120 > 88)
   --> infra/pi_bot.py:152:89
    |
150 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
151 |     try:
152 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
153 |         results = r.json()
154 |         if not results: bot.send_message(m.chat.id, "‚ùå Aucun r√©sultat."); return
    |

E501 Line too long (112 > 88)
   --> infra/pi_bot.py:157:89
    |
155 |         text = f"üîç **R√©sultats pour '{titre}'**\n\n"
156 |         limit = min(len(results), 5)
157 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
158 |         markup = InlineKeyboardMarkup()
159 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |

E501 Line too long (107 > 88)
   --> infra/pi_bot.py:159:89
    |
157 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
158 |         markup = InlineKeyboardMarkup()
159 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
160 |         markup.add(*btns)
161 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
    |

E501 Line too long (107 > 88)
   --> infra/pi_bot.py:172:89
    |
170 |     # 1. New Paged UI Callbacks
171 |     if d[0] in ["m_pag", "m_sel", "m_act", "dl_sel"]:
172 |         if d[0] == "m_pag": show_media_list(call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
173 |         elif d[0] == "m_sel":
174 |             markup = InlineKeyboardMarkup()
    |

E501 Line too long (101 > 88)
   --> infra/pi_bot.py:175:90
    |
173 |         elif d[0] == "m_sel":
174 |             markup = InlineKeyboardMarkup()
175 |             markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^^
176 |                        InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
177 |                        InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |

E501 Line too long (103 > 88)
   --> infra/pi_bot.py:176:88
    |
174 | ‚Ä¶     markup = InlineKeyboardMarkup()
175 | ‚Ä¶     markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
176 | ‚Ä¶                InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
    |                                                                                   ^^^^^^^^^^^^^^^
177 | ‚Ä¶                InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
178 | ‚Ä¶     bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (89 > 88)
   --> infra/pi_bot.py:177:90
    |
175 | ‚Ä¶         markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
176 | ‚Ä¶                    InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
177 | ‚Ä¶                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |                                                                                       ^
178 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
179 | ‚Ä¶     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "üì• Ajout√©.")
    |

E501 Line too long (133 > 88)
   --> infra/pi_bot.py:178:88
    |
176 | ‚Ä¶üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
177 | ‚Ä¶‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
178 | ‚Ä¶n sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
179 | ‚Ä¶lback_query(call.id, "üì• Ajout√©.")
180 | ‚Ä¶back_query(call.id, f"Action {d[1]} enregistr√©e.", show_alert=True)
    |

E501 Line too long (112 > 88)
   --> infra/pi_bot.py:180:89
    |
178 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
179 | ‚Ä¶     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "üì• Ajout√©.")
180 | ‚Ä¶     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistr√©e.", show_alert=True)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^
181 | ‚Ä¶     return
    |

E501 Line too long (284 > 88)
   --> infra/pi_bot.py:188:88
    |
186 | ‚Ä¶
187 | ‚Ä¶
188 | ‚Ä¶, InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
189 | ‚Ä¶d, call.message.message_id, reply_markup=markup)
190 | ‚Ä¶
    |

E501 Line too long (130 > 88)
   --> infra/pi_bot.py:189:90
    |
187 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
188 | ‚Ä¶         markup.add(InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), InlineKeyboardButton("üë• Utilisateurs", callback_d ‚Ä¶
189 | ‚Ä¶         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
190 | ‚Ä¶     elif cmd == "share":
191 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (238 > 88)
   --> infra/pi_bot.py:192:88
    |
190 | ‚Ä¶
191 | ‚Ä¶
192 | ‚Ä¶:share_owned"), InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
193 | ‚Ä¶ call.message.message_id, reply_markup=markup)
194 | ‚Ä¶
    |

E501 Line too long (130 > 88)
   --> infra/pi_bot.py:193:88
    |
191 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
192 | ‚Ä¶         markup.add(InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), InlineKeyboardButton("‚ùå Contenu non ‚Ä¶
193 | ‚Ä¶         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
194 | ‚Ä¶     elif cmd == "users":
195 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (284 > 88)
   --> infra/pi_bot.py:196:88
    |
194 | ‚Ä¶
195 | ‚Ä¶
196 | ‚Ä¶st"), InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), InlineKeyboardButton("‚ùå R√©voquer", callback_data="adm:users_rev"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
197 | ‚Ä¶at.id, call.message.message_id, reply_markup=markup)
198 | ‚Ä¶
    |

E501 Line too long (136 > 88)
   --> infra/pi_bot.py:197:88
    |
195 | ‚Ä¶width=1)
196 | ‚Ä¶ Lister", callback_data="adm:users_list"), InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), InlineKeyboardButton(" ‚Ä¶
197 | ‚Ä¶ des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
198 | ‚Ä¶
199 | ‚Ä¶ = "üìã **Utilisateurs :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
    |

E501 Line too long (117 > 88)
   --> infra/pi_bot.py:199:88
    |
197 | ‚Ä¶         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
198 | ‚Ä¶     elif cmd == "users_list":
199 | ‚Ä¶         users = load_allowed_users(); text = "üìã **Utilisateurs :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
200 | ‚Ä¶         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=InlineKeyboardMarkup().add(InlineKe‚Ä¶
201 | ‚Ä¶     elif cmd == "users_add":
    |

E501 Line too long (211 > 88)
   --> infra/pi_bot.py:200:89
    |
198 | ‚Ä¶
199 | ‚Ä¶join([f"‚Ä¢ `{u}`" for u in users])
200 | ‚Ä¶id, reply_markup=InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users")), parse_mode='Markdown')
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
201 | ‚Ä¶
202 | ‚Ä¶
    |

E501 Line too long (95 > 88)
   --> infra/pi_bot.py:208:88
    |
206 | ‚Ä¶     for u in users:
207 | ‚Ä¶         if u == SUPER_ADMIN: continue
208 | ‚Ä¶         markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
    |                                                                                   ^^^^^^^
209 | ‚Ä¶     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
210 | ‚Ä¶     bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (135 > 88)
   --> infra/pi_bot.py:210:89
    |
208 | ‚Ä¶n(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
209 | ‚Ä¶Ô∏è Retour", callback_data="adm:users"))
210 | ‚Ä¶z l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
211 | ‚Ä¶
212 | ‚Ä¶wed_users()
    |

E501 Line too long (116 > 88)
   --> infra/pi_bot.py:213:89
    |
211 | ‚Ä¶     elif cmd == "users_del":
212 | ‚Ä¶         uid = int(d[2]); users = load_allowed_users()
213 | ‚Ä¶         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, "‚úÖ R√©voqu√©.")
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
214 | ‚Ä¶         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instan‚Ä¶
215 | ‚Ä¶     elif cmd == "share_owned":
    |

E501 Line too long (158 > 88)
   --> infra/pi_bot.py:214:89
    |
212 | ‚Ä¶
213 | ‚Ä¶s(users); bot.answer_callback_query(call.id, "‚úÖ R√©voqu√©.")
214 | ‚Ä¶ from_user=call.from_user, message=call.message, data="adm:users", chat_instance=call.chat_instance))
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
215 | ‚Ä¶
216 | ‚Ä¶
    |

E501 Line too long (230 > 88)
   --> infra/pi_bot.py:217:88
    |
215 | ‚Ä¶
216 | ‚Ä¶
217 | ‚Ä¶d:movies"), InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
218 | ‚Ä¶.message_id, reply_markup=markup)
219 | ‚Ä¶ True)
    |

E501 Line too long (116 > 88)
   --> infra/pi_bot.py:218:89
    |
216 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=2)
217 | ‚Ä¶         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callba ‚Ä¶
218 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
219 | ‚Ä¶     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
220 | ‚Ä¶     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |

E501 Line too long (89 > 88)
   --> infra/pi_bot.py:219:89
    |
217 | ‚Ä¶         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callba ‚Ä¶
218 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
219 | ‚Ä¶     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
    |                                                                                       ^
220 | ‚Ä¶     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
221 | ‚Ä¶     return
    |

E501 Line too long (94 > 88)
   --> infra/pi_bot.py:220:89
    |
218 |             bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
219 |         elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
220 |         elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^
221 |         return
    |

E501 Line too long (123 > 88)
   --> infra/pi_bot.py:226:89
    |
224 |     if d[0] == "sel":
225 |         try:
226 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
227 |             markup = InlineKeyboardMarkup(row_width=2)
228 |             act = "arc" if item['is_nvme'] else "res"
    |

E501 Line too long (181 > 88)
   --> infra/pi_bot.py:229:88
    |
227 | ‚Ä¶
228 | ‚Ä¶
229 | ‚Ä¶_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
230 | ‚Ä¶boardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
231 | ‚Ä¶a="cancel"))
    |

E501 Line too long (132 > 88)
   --> infra/pi_bot.py:230:88
    |
228 | ‚Ä¶     act = "arc" if item['is_nvme'] else "res"
229 | ‚Ä¶     markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("üóëÔ∏è Supprimer"‚Ä¶
230 | ‚Ä¶     if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
231 | ‚Ä¶     markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
232 | ‚Ä¶     bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (122 > 88)
   --> infra/pi_bot.py:232:90
    |
230 |             if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
231 |             markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
232 |             bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
233 |         except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
234 |     elif d[0] == "act":
    |

E501 Line too long (123 > 88)
   --> infra/pi_bot.py:236:89
    |
234 |     elif d[0] == "act":
235 |         try:
236 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
237 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
238 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (126 > 88)
   --> infra/pi_bot.py:237:89
    |
235 |         try:
236 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
237 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
238 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
239 |         except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
    |

E501 Line too long (124 > 88)
   --> infra/pi_bot.py:238:88
    |
236 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
237 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
238 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
239 |         except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
240 |     elif d[0] == "share_exec":
    |

E501 Line too long (123 > 88)
   --> infra/pi_bot.py:242:89
    |
240 |     elif d[0] == "share_exec":
241 |         try:
242 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
243 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
244 |             if subtitles:
    |

E501 Line too long (99 > 88)
   --> infra/pi_bot.py:243:89
    |
241 |         try:
242 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
243 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                                                         ^^^^^^^^^^^
244 |             if subtitles:
245 |                 markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (241 > 88)
   --> infra/pi_bot.py:246:88
    |
244 | ‚Ä¶
245 | ‚Ä¶
246 | ‚Ä¶final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
247 | ‚Ä¶s-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
248 | ‚Ä¶_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |

E501 Line too long (171 > 88)
   --> infra/pi_bot.py:247:88
    |
245 | ‚Ä¶
246 | ‚Ä¶lback_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardBu‚Ä¶
247 | ‚Ä¶len(subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
248 | ‚Ä¶from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
249 | ‚Ä¶
    |

E501 Line too long (179 > 88)
   --> infra/pi_bot.py:248:89
    |
246 | ‚Ä¶k_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardButton‚Ä¶
247 | ‚Ä¶subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
248 | ‚Ä¶_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
249 | ‚Ä¶
250 | ‚Ä¶
    |

E501 Line too long (123 > 88)
   --> infra/pi_bot.py:252:89
    |
250 |     elif d[0] == "share_final":
251 |         try:
252 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
253 |             remux_opt = True if d[2] == "remux" else False
254 |             bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (100 > 88)
   --> infra/pi_bot.py:254:88
    |
252 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
253 |             remux_opt = True if d[2] == "remux" else False
254 |             bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^
255 |             data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
256 |             if data and "video" in data:
    |

E501 Line too long (108 > 88)
   --> infra/pi_bot.py:261:88
    |
259 |             else: bot.send_message(call.message.chat.id, "‚ùå √âchec du partage.")
260 |         except: bot.send_message(call.message.chat.id, "‚ùå Erreur interne.")
261 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
262 |
263 | # --- STATUS & QUEUE ---
    |

E501 Line too long (108 > 88)
   --> infra/pi_bot.py:269:89
    |
267 |     try:
268 |         nvme = shutil.disk_usage('/')
269 |         def fmt(u): return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
270 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`"
271 |         if os.path.exists('/mnt/externe'):
    |

E501 Line too long (102 > 88)
   --> infra/pi_bot.py:281:89
    |
279 |     if not is_authorized(m.chat.id): return
280 |     try:
281 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |                                                                                         ^^^^^^^^^^^^^^
282 |         if not torrents: bot.reply_to(m, "‚Ä¢ Queue vide."); return
283 |         q_text = "üì• **Queue :**\n\n"
    |

E501 Line too long (117 > 88)
   --> infra/pi_bot.py:287:87
    |
285 |             if t['state'] in ['downloading', 'stalledDL', 'metaDL', 'queuedDL']:
286 |                 name = re.sub(r'[\._]', ' ', t['name'])
287 |                 q_text += f"‚Ä¢ **{name}**\n  ‚îî üìä {round(t['progress']*100,1)}% | üìÇ {round(t['size']/1024**3,2)}GB\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
288 |         bot.reply_to(m, q_text, parse_mode='Markdown')
289 |     except: bot.reply_to(m, "‚ùå Erreur qBit.")
    |

E501 Line too long (96 > 88)
   --> infra/pi_bot.py:295:89
    |
293 | @webhook_app.route('/')
294 | def index(): return "Bot Active"
295 | threading.Thread(target=lambda: webhook_app.run(host='0.0.0.0', port=5001), daemon=True).start()
    |                                                                                         ^^^^^^^^
296 |
297 | print("üöÄ Bot d√©marr√© avec Integrity Shield...")
    |

E501 Line too long (91 > 88)
  --> infra/pi_bot_debug.py:16:89
   |
14 | import share_engine
15 |
16 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
17 |
18 | TOKEN = os.getenv("TELEGRAM_TOKEN")
   |

E501 Line too long (96 > 88)
  --> infra/pi_bot_debug.py:27:89
   |
25 | OPENAI_KEY = os.getenv("OPENAI_KEY")
26 |
27 | SONARR_CFG = {"url": "http://localhost:8989", "key": os.getenv("SONARR_API_KEY"), "root": "/tv"}
   |                                                                                         ^^^^^^^^
28 | RADARR_CFG = {"url": "http://localhost:7878", "key": os.getenv("RADARR_API_KEY"), "root": "/movies"}
29 | PLEX_CFG = {"url": "http://localhost:32400", "token": os.getenv("PLEX_TOKEN")}
   |

E501 Line too long (100 > 88)
  --> infra/pi_bot_debug.py:28:89
   |
27 | SONARR_CFG = {"url": "http://localhost:8989", "key": os.getenv("SONARR_API_KEY"), "root": "/tv"}
28 | RADARR_CFG = {"url": "http://localhost:7878", "key": os.getenv("RADARR_API_KEY"), "root": "/movies"}
   |                                                                                         ^^^^^^^^^^^^
29 | PLEX_CFG = {"url": "http://localhost:32400", "token": os.getenv("PLEX_TOKEN")}
   |

E501 Line too long (144 > 88)
  --> infra/pi_bot_debug.py:43:90
   |
41 | ‚Ä¶
42 | ‚Ä¶
43 | ‚Ä¶e S√©curit√©** : Tentative d'acc√®s au menu admin par {m.from_user.id} (@{m.from_user.username})")
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
44 | ‚Ä¶
45 | ‚Ä¶
   |

E501 Line too long (104 > 88)
  --> infra/pi_bot_debug.py:50:90
   |
48 |                InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
49 |                InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
50 |     bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^
51 |
52 | def save_users(users):
   |

E501 Line too long (280 > 88)
  --> infra/pi_bot_debug.py:64:88
   |
62 | ‚Ä¶
63 | ‚Ä¶
64 | ‚Ä¶lineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 | ‚Ä¶all.message.message_id, reply_markup=markup)
   |

E501 Line too long (126 > 88)
  --> infra/pi_bot_debug.py:65:90
   |
63 |         markup = InlineKeyboardMarkup(row_width=1)
64 |         markup.add(InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), InlineKeyboardButton("üë• Utilisateurs", callback_data ‚Ä¶
65 |         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 |     
67 |     elif cmd == "share":
   |

E501 Line too long (234 > 88)
  --> infra/pi_bot_debug.py:69:88
   |
67 | ‚Ä¶
68 | ‚Ä¶
69 | ‚Ä¶re_owned"), InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
70 | ‚Ä¶l.message.message_id, reply_markup=markup)
   |

E501 Line too long (126 > 88)
  --> infra/pi_bot_debug.py:70:88
   |
68 |         markup = InlineKeyboardMarkup(row_width=1)
69 |         markup.add(InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), InlineKeyboardButton("‚ùå Contenu non po ‚Ä¶
70 |         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
71 |     
72 |     elif cmd == "users":
   |

E501 Line too long (95 > 88)
  --> infra/pi_bot_debug.py:74:88
   |
72 |     elif cmd == "users":
73 |         markup = InlineKeyboardMarkup(row_width=1)
74 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
   |                                                                                         ^^^^^^^
75 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
   |

E501 Line too long (100 > 88)
  --> infra/pi_bot_debug.py:75:88
   |
73 |         markup = InlineKeyboardMarkup(row_width=1)
74 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
75 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
   |                                                                                         ^^^^^^^^^^^^
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
77 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |

E501 Line too long (95 > 88)
  --> infra/pi_bot_debug.py:76:88
   |
74 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
75 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
   |                                                                                         ^^^^^^^
77 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
78 |         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (132 > 88)
  --> infra/pi_bot_debug.py:78:88
   |
76 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
77 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
78 |         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
79 |     
80 |     elif cmd == "users_list":
   |

E501 Line too long (93 > 88)
  --> infra/pi_bot_debug.py:82:88
   |
80 |     elif cmd == "users_list":
81 |         users = load_allowed_users()
82 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
   |                                                                                         ^^^^^
83 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
84 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (104 > 88)
  --> infra/pi_bot_debug.py:83:90
   |
81 |         users = load_allowed_users()
82 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
83 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
   |                                                                                         ^^^^^^^^^^^^^^^^
84 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (126 > 88)
  --> infra/pi_bot_debug.py:84:89
   |
82 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
83 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
84 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
85 |     
86 |     elif cmd == "users_add":
   |

E501 Line too long (109 > 88)
  --> infra/pi_bot_debug.py:87:88
   |
86 |     elif cmd == "users_add":
87 |         msg = bot.send_message(call.message.chat.id, "üë§ Envoyez l'ID Telegram de l'utilisateur √† ajouter :")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
88 |         bot.register_next_step_handler(msg, process_user_add)
   |

E501 Line too long (91 > 88)
  --> infra/pi_bot_debug.py:95:88
   |
93 |         for u in users:
94 |             if u == SUPER_ADMIN: continue
95 |             markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
   |                                                                                         ^^^
96 |         markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
97 |         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (131 > 88)
  --> infra/pi_bot_debug.py:97:89
   |
95 |             markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
96 |         markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
97 |         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
98 |     
99 |     elif cmd == "users_del":
   |

E501 Line too long (226 > 88)
   --> infra/pi_bot_debug.py:110:88
    |
108 | ‚Ä¶
109 | ‚Ä¶
110 | ‚Ä¶vies"), InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
111 | ‚Ä¶call.message.message_id, reply_markup=markup)
    |

E501 Line too long (128 > 88)
   --> infra/pi_bot_debug.py:111:89
    |
109 |         markup = InlineKeyboardMarkup(row_width=2)
110 |         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callback ‚Ä¶
111 |         bot.edit_message_text("S√©lectionnez la cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
112 |     
113 |     elif cmd == "list_owned":
    |

E501 Line too long (234 > 88)
   --> infra/pi_bot_debug.py:117:88
    |
116 | ‚Ä¶
117 | ‚Ä¶om du film ou de la s√©rie que vous souhaitez rechercher et partager. L'IA s'occupera de la recherche.", call.message.chat.id, call.message.message_id)
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
118 | ‚Ä¶
119 | ‚Ä¶
    |

E501 Line too long (145 > 88)
   --> infra/pi_bot_debug.py:120:88
    |
119 | ‚Ä¶
120 | ‚Ä¶n\nFonctionnalit√© en cours de d√©veloppement.", call.message.chat.id, call.message.message_id)
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
121 | ‚Ä¶
122 | ‚Ä¶ssage.chat.id, call.message.message_id)
    |

E501 Line too long (90 > 88)
   --> infra/pi_bot_debug.py:122:89
    |
120 |         bot.edit_message_text("üßπ **Nettoyage SSD**\n\nFonctionnalit√© en cours de d√©veloppement.", call.message.chat.id, call.message.‚Ä¶
121 |     
122 |     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                                                                                         ^^
123 |
124 | def process_user_add(m):
    |

E501 Line too long (100 > 88)
   --> infra/pi_bot_debug.py:139:89
    |
137 | # --- MEDIA ENGINE ---
138 | def list_media_unified(m, cat, title, is_edit=False):
139 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^
140 |     try:
141 |         items = json.loads(res.stdout)
    |

E501 Line too long (113 > 88)
   --> infra/pi_bot_debug.py:159:89
    |
157 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
158 |     markup = InlineKeyboardMarkup(row_width=5)
159 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
160 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
161 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |

E501 Line too long (89 > 88)
   --> infra/pi_bot_debug.py:161:89
    |
159 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
160 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
161 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |                                                                                         ^
162 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |

E501 Line too long (117 > 88)
   --> infra/pi_bot_debug.py:164:89
    |
162 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
163 |
164 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
165 | def media_callbacks(call):
166 |     if not is_authorized(call.from_user.id): return
    |

E501 Line too long (92 > 88)
   --> infra/pi_bot_debug.py:174:88
    |
172 |         except Exception as e:
173 |             logging.error(f"Context load failed for sel: {e}")
174 |             bot.answer_callback_query(call.id, "‚ùå Session expir√©e, relancez la recherche.")
    |                                                                                         ^^^^
175 |             return
176 |         markup = InlineKeyboardMarkup(row_width=2)
    |

E501 Line too long (100 > 88)
   --> infra/pi_bot_debug.py:178:88
    |
176 |         markup = InlineKeyboardMarkup(row_width=2)
177 |         act = "arc" if item['is_nvme'] else "res"
178 |         markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^
179 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
180 |         if call.from_user.id == SUPER_ADMIN:
    |

E501 Line too long (95 > 88)
   --> infra/pi_bot_debug.py:179:90
    |
177 |         act = "arc" if item['is_nvme'] else "res"
178 |         markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"),
179 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |                                                                                         ^^^^^^^
180 |         if call.from_user.id == SUPER_ADMIN:
181 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |

E501 Line too long (95 > 88)
   --> infra/pi_bot_debug.py:181:88
    |
179 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
180 |         if call.from_user.id == SUPER_ADMIN:
181 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                                                                         ^^^^^^^
182 |         markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
183 |         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (118 > 88)
   --> infra/pi_bot_debug.py:183:90
    |
181 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
182 |         markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
183 |         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
184 |     elif d[0] == "act":
185 |         try:
    |

E501 Line too long (122 > 88)
   --> infra/pi_bot_debug.py:192:89
    |
190 |             bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
191 |             return
192 |         res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
193 |         bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
194 |     elif d[0] == "share_exec":
    |

E501 Line too long (120 > 88)
   --> infra/pi_bot_debug.py:193:88
    |
191 |             return
192 |         res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
193 |         bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
194 |     elif d[0] == "share_exec":
195 |         try:
    |

E501 Line too long (114 > 88)
   --> infra/pi_bot_debug.py:209:88
    |
207 |         if subtitles:
208 |             markup = InlineKeyboardMarkup(row_width=1)
209 |             markup.add(InlineKeyboardButton("‚ö° Lien Rapide (Symlink)", callback_data=f"share_final:{d[1]}:link"),
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
210 |                        InlineKeyboardButton("üé¨ Remux avec Sous-titres", callback_data=f"share_final:{d[1]}:remux"),
211 |                        InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |

E501 Line too long (116 > 88)
   --> infra/pi_bot_debug.py:210:88
    |
208 | ‚Ä¶     markup = InlineKeyboardMarkup(row_width=1)
209 | ‚Ä¶     markup.add(InlineKeyboardButton("‚ö° Lien Rapide (Symlink)", callback_data=f"share_final:{d[1]}:link"),
210 | ‚Ä¶                InlineKeyboardButton("üé¨ Remux avec Sous-titres", callback_data=f"share_final:{d[1]}:remux"),
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
211 | ‚Ä¶                InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
212 | ‚Ä¶     bot.edit_message_text(f"üéØ **Options de Partage**\n{len(subtitles)} sous-titre(s) trouv√©(s).", call.message.chat.id, call.messag‚Ä¶
    |

E501 Line too long (174 > 88)
   --> infra/pi_bot_debug.py:212:88
    |
210 | ‚Ä¶tres", callback_data=f"share_final:{d[1]}:remux"),
211 | ‚Ä¶_data="cancel"))
212 | ‚Ä¶n(subtitles)} sous-titre(s) trouv√©(s).", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
213 | ‚Ä¶
214 | ‚Ä¶
    |

E501 Line too long (180 > 88)
   --> infra/pi_bot_debug.py:215:89
    |
213 | ‚Ä¶
214 | ‚Ä¶
215 | ‚Ä¶m_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
216 | ‚Ä¶
217 | ‚Ä¶
    |

E501 Line too long (150 > 88)
   --> infra/pi_bot_debug.py:227:87
    |
226 | ‚Ä¶e
227 | ‚Ä¶.." if remux_opt else "‚è≥ G√©n√©ration du lien...", call.message.chat.id, call.message.message_id)
    |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
228 | ‚Ä¶
229 | ‚Ä¶['path'], remux=remux_opt)
    |

E501 Line too long (151 > 88)
   --> infra/pi_bot_debug.py:233:87
    |
231 | ‚Ä¶
232 | ‚Ä¶
233 | ‚Ä¶nclus)**\n\nüîó Vid√©o : `{data['video']}`\n\n‚úÖ Les sous-titres ont √©t√© int√©gr√©s au fichier MKV."
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
234 | ‚Ä¶
235 | ‚Ä¶*\n\nüîó Vid√©o : `{data['video']}`\n"
    |

E501 Line too long (91 > 88)
   --> infra/pi_bot_debug.py:235:87
    |
233 | ‚Ä¶         msg = f"üé¨ **Contenu Remux√© (Softsubs inclus)**\n\nüîó Vid√©o : `{data['video']}`\n\n‚úÖ Les sous-titres ont √©t√© int√©gr√©s au fi  ‚Ä¶
234 | ‚Ä¶     else:
235 | ‚Ä¶         msg = f"‚úÖ **Contenu Partag√© (Symlink)**\n\nüîó Vid√©o : `{data['video']}`\n"
    |                                                                                   ^^^
236 | ‚Ä¶         if data.get("subtitles"):
237 | ‚Ä¶             msg += "\nüìÑ **Sous-titres (li√©s et s√©curis√©s) :**\n"
    |

E501 Line too long (106 > 88)
   --> infra/pi_bot_debug.py:242:88
    |
240 |             bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
241 |         else:
242 |             bot.send_message(call.message.chat.id, "‚ùå Erreur: √âchec du partage ou contenu hors limites.")
    |                                                                                         ^^^^^^^^^^^^^^^^^^
243 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
244 |     elif d[0] == "dl":
    |

E501 Line too long (108 > 88)
   --> infra/pi_bot_debug.py:243:88
    |
241 |         else:
242 |             bot.send_message(call.message.chat.id, "‚ùå Erreur: √âchec du partage ou contenu hors limites.")
243 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
244 |     elif d[0] == "dl":
245 |         if d[1] == "no":
    |

E501 Line too long (109 > 88)
   --> infra/pi_bot_debug.py:246:88
    |
244 |     elif d[0] == "dl":
245 |         if d[1] == "no":
246 |             bot.edit_message_text("‚ùå T√©l√©chargement annul√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
247 |             return
248 |         elif d[1] == "yes":
    |

E501 Line too long (118 > 88)
   --> infra/pi_bot_debug.py:271:89
    |
269 |                 "rootFolderPath": cfg['root'],
270 |                 "monitored": True,
271 |                 "addOptions": {"searchForMovie": True} if type_media == 'film' else {"searchForMissingEpisodes": True}
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
272 |             }
273 |             payload[id_key] = dl_data['item_id']
    |

E501 Line too long (104 > 88)
   --> infra/pi_bot_debug.py:277:88
    |
275 |                 payload["languageProfileId"] = 1
276 |
277 |             bot.edit_message_text("‚è≥ Ajout en cours...", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^
278 |             
279 |             try:
    |

E501 Line too long (133 > 88)
   --> infra/pi_bot_debug.py:280:89
    |
279 | ‚Ä¶     try:
280 | ‚Ä¶         r_add = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
281 | ‚Ä¶         if r_add.status_code in [200, 201]:
282 | ‚Ä¶             bot.edit_message_text(f"üì• **Ajout√© √† la file d'attente :** `{dl_data['found_title']} ({dl_data['year']})`\nLe t√©l√©charg‚Ä¶
    |

E501 Line too long (229 > 88)
   --> infra/pi_bot_debug.py:282:88
    |
280 | ‚Ä¶X-Api-Key": cfg['key']}, json=payload, timeout=10)
281 | ‚Ä¶
282 | ‚Ä¶_data['found_title']} ({dl_data['year']})`\nLe t√©l√©chargement va d√©buter.", call.message.chat.id, call.message.message_id, parse_mode='Markdown')
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
283 | ‚Ä¶
284 | ‚Ä¶
    |

E501 Line too long (142 > 88)
   --> infra/pi_bot_debug.py:285:88
    |
283 | ‚Ä¶
284 | ‚Ä¶: {r_add.text}")
285 | ‚Ä¶ec de l'ajout (Erreur {r_add.status_code}).", call.message.chat.id, call.message.message_id)
    |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
286 | ‚Ä¶
287 | ‚Ä¶}")
    |

E501 Line too long (131 > 88)
   --> infra/pi_bot_debug.py:288:88
    |
286 |             except Exception as e:
287 |                 logging.error(f"Arr API Error: {e}")
288 |                 bot.edit_message_text("‚ùå Erreur de communication avec le serveur.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |
290 | @bot.message_handler(commands=['status'])
    |

E501 Line too long (100 > 88)
   --> infra/pi_bot_debug.py:297:89
    |
295 |         hdd = shutil.disk_usage('/mnt/externe') # Chemin cible HDD
296 |         def fmt(u):
297 |             return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
    |                                                                                         ^^^^^^^^^^^^
298 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`\nüìö **HDD** : `{fmt(hdd)}`"
299 |         bot.reply_to(m, msg, parse_mode='Markdown')
    |

E501 Line too long (101 > 88)
   --> infra/pi_bot_debug.py:298:86
    |
296 |         def fmt(u):
297 |             return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
298 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`\nüìö **HDD** : `{fmt(hdd)}`"
    |                                                                                         ^^^^^^^^^^^^^
299 |         bot.reply_to(m, msg, parse_mode='Markdown')
300 |     except Exception:
    |

E501 Line too long (114 > 88)
   --> infra/pi_bot_debug.py:308:89
    |
306 |     try:
307 |         logging.info(f"[DEBUG_API] Interrogation Radarr √† {RADARR_CFG['url']}")
308 |         r = requests.get(f"{RADARR_CFG['url']}/api/v3/movie", headers={"X-Api-Key": RADARR_CFG['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
309 |         r.raise_for_status()
310 |         data = r.json()
    |

E501 Line too long (97 > 88)
   --> infra/pi_bot_debug.py:311:89
    |
309 |         r.raise_for_status()
310 |         data = r.json()
311 |         logging.info(f"[DEBUG_API] Status: {r.status_code} | Nombre de films re√ßus: {len(data)}")
    |                                                                                         ^^^^^^^^^
312 |         owned = [f for f in data if f.get('hasFile') is True]
313 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
    |

E501 Line too long (115 > 88)
   --> infra/pi_bot_debug.py:324:89
    |
322 |     if not is_authorized(m.chat.id): return
323 |     try:
324 |         r = requests.get(f"{SONARR_CFG['url']}/api/v3/series", headers={"X-Api-Key": SONARR_CFG['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
325 |         r.raise_for_status()
326 |         # Une s√©rie est pr√©sente si episodeFileCount > 0
    |

E501 Line too long (95 > 88)
   --> infra/pi_bot_debug.py:327:89
    |
325 |         r.raise_for_status()
326 |         # Une s√©rie est pr√©sente si episodeFileCount > 0
327 |         owned = [s for s in r.json() if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
    |                                                                                         ^^^^^^^
328 |         text = f"üì∫ **Biblioth√®que Sonarr ({len(owned)} s√©ries)**\n\n"
329 |         text += "\n".join([f"‚Ä¢ {s['title']} ‚Äî `{s['statistics']['episodeFileCount']}` √©pisodes" for s in owned])
    |

E501 Line too long (112 > 88)
   --> infra/pi_bot_debug.py:329:89
    |
327 |         owned = [s for s in r.json() if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
328 |         text = f"üì∫ **Biblioth√®que Sonarr ({len(owned)} s√©ries)**\n\n"
329 |         text += "\n".join([f"‚Ä¢ {s['title']} ‚Äî `{s['statistics']['episodeFileCount']}` √©pisodes" for s in owned])
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
330 |         bot.reply_to(m, text, parse_mode='Markdown')
331 |     except Exception:
    |

E501 Line too long (93 > 88)
   --> infra/pi_bot_debug.py:341:89
    |
339 |         name = os.path.splitext(name)[0]
340 |         name = re.sub(r'[\._]', ' ', name)
341 |         match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
    |                                                                                         ^^^^^
342 |         title = match.group(1).strip() if match else name
343 |         year = match.group(2) if match else ""
    |

E501 Line too long (154 > 88)
   --> infra/pi_bot_debug.py:344:89
    |
342 | ‚Ä¶me
343 | ‚Ä¶
344 | ‚Ä¶', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b']
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
345 | ‚Ä¶
346 | ‚Ä¶ flags=re.IGNORECASE)
    |

E501 Line too long (116 > 88)
   --> infra/pi_bot_debug.py:366:87
    |
364 |                     size = round(t['size'] / 1024**3, 2)
365 |                     clean_name = clean_title(t['name'])
366 |                     q_text += f"‚Ä¢ **{clean_name}**\n  ‚îî üì∂ {t['state']} | üìä {progress}% | ‚è≥ {eta} | üìÇ {size}GB\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
367 |     except Exception as e:
368 |         logging.error(f"qBittorrent Error: {e}")
    |

E501 Line too long (91 > 88)
   --> infra/pi_bot_debug.py:375:89
    |
373 | # --- AI HANDLER & ARR INTEGRATION ---
374 | def stream_gpt_json(query):
375 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
    |                                                                                         ^^^
376 |     prompt = f"Analyse cette demande : '{query}'. Tu DOIS extraire le titre, la saison et l'√©pisode.\n\nR√®gles de parsing :\n'S01E01'‚Ä¶
    |

E501 Line too long (453 > 88)
   --> infra/pi_bot_debug.py:376:89
    |
374 | ‚Ä¶
375 | ‚Ä¶I_KEY}"}
376 | ‚Ä¶son et l'√©pisode.\n\nR√®gles de parsing :\n'S01E01' ou 'S1E1' -> saison: 1, episode: 1\n'Saison 2' -> saison: 2, episode: null\nSi c'est un film ou incertain -> type: 'film', saison/episode: null\nSi c'est une s√©rie -> type: 'serie'\n\nRenvoie UNIQUEMENT un JSON pur : {{\"titre\": \"str\", \"saison\": \"int|null\", \"episode\": \"int|null\", \"type\": \"serie|film\"}}"
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
377 | ‚Ä¶
378 | ‚Ä¶
    |

E501 Line too long (97 > 88)
   --> infra/pi_bot_debug.py:379:89
    |
378 |     try:
379 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={
    |                                                                                         ^^^^^^^^^
380 |             "model": "gpt-4o-mini",
381 |             "messages": [{"role": "user", "content": prompt}],
    |

E501 Line too long (106 > 88)
   --> infra/pi_bot_debug.py:416:89
    |
414 |                 # Typage fort (S√©curit√©)
415 |                 parsed['titre'] = str(parsed.get('titre', ''))
416 |                 parsed['saison'] = int(parsed.get('saison')) if parsed.get('saison') is not None else None
    |                                                                                         ^^^^^^^^^^^^^^^^^^
417 |                 parsed['episode'] = int(parsed.get('episode')) if parsed.get('episode') is not None else None
418 |                 parsed['type'] = str(parsed.get('type', ''))
    |

E501 Line too long (109 > 88)
   --> infra/pi_bot_debug.py:417:89
    |
415 |                 parsed['titre'] = str(parsed.get('titre', ''))
416 |                 parsed['saison'] = int(parsed.get('saison')) if parsed.get('saison') is not None else None
417 |                 parsed['episode'] = int(parsed.get('episode')) if parsed.get('episode') is not None else None
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
418 |                 parsed['type'] = str(parsed.get('type', ''))
    |

E501 Line too long (89 > 88)
   --> infra/pi_bot_debug.py:440:88
    |
438 |         process_get_request(m, query)
439 |     else:
440 |         msg = bot.reply_to(m, "üé¨ Que veux-tu t√©l√©charger ? (Ex: Shogun S01E01 ou Dune)")
    |                                                                                         ^
441 |         bot.register_next_step_handler(msg, process_get_step)
    |

E501 Line too long (89 > 88)
   --> infra/pi_bot_debug.py:460:88
    |
459 |     if not data or "error" in data:
460 |         bot.reply_to(m, "‚ùå Le flux d'analyse a √©chou√© (Pipe Break). Donn√©es invalides.")
    |                                                                                         ^
461 |         return
    |

E501 Line too long (124 > 88)
   --> infra/pi_bot_debug.py:473:88
    |
471 |         return
472 |
473 |     bot.send_message(m.chat.id, f"üîç **Recherche en cours :** `{titre}` ({type_media.capitalize()})", parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
474 |
475 |     # 2. Phase de Routage & V√©rification de Disponibilit√© locale
    |

E501 Line too long (115 > 88)
   --> infra/pi_bot_debug.py:477:89
    |
475 |     # 2. Phase de Routage & V√©rification de Disponibilit√© locale
476 |     try:
477 |         res_local = subprocess.run(["python3", SCRIPT_PATH, "search_local", titre], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
478 |         local_items = json.loads(res_local.stdout)
479 |         if local_items:
    |

E501 Line too long (109 > 88)
   --> infra/pi_bot_debug.py:480:88
    |
478 |         local_items = json.loads(res_local.stdout)
479 |         if local_items:
480 |             bot.send_message(m.chat.id, f"‚úÖ `{titre}` est d√©j√† disponible localement dans la biblioth√®que.")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
481 |             return
482 |     except Exception as e:
    |

E501 Line too long (133 > 88)
   --> infra/pi_bot_debug.py:491:89
    |
489 |     try:
490 |         # Recherche API Sonarr/Radarr
491 |         r_lookup = requests.get(f"{cfg['url']}/api/v3/{endpoint}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=10)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
492 |         results = r_lookup.json()
    |

E501 Line too long (107 > 88)
   --> infra/pi_bot_debug.py:495:88
    |
494 |         if not results:
495 |             bot.send_message(m.chat.id, f"‚ùå `{titre}` introuvable dans les bases de donn√©es (TMDb/TVDb).")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
496 |             return
    |

E501 Line too long (112 > 88)
   --> infra/pi_bot_debug.py:504:89
    |
503 |         # Validation de Flux: V√©rification si d√©j√† dans Sonarr/Radarr
504 |         r_check = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
505 |         exists = any(str(i.get(id_key)) == str(item_id) for i in r_check.json())
    |

E501 Line too long (172 > 88)
   --> infra/pi_bot_debug.py:508:88
    |
507 | ‚Ä¶
508 | ‚Ä¶r})` est d√©j√† poss√©d√© ou en cours de t√©l√©chargement sur {'Radarr' if type_media == 'film' else 'Sonarr'}.")
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
509 | ‚Ä¶
    |

E501 Line too long (102 > 88)
   --> infra/pi_bot_debug.py:528:88
    |
526 |         except Exception as e:
527 |             logging.error(f"Context save failed: {e}")
528 |             bot.send_message(m.chat.id, "‚ùå Erreur interne lors de la pr√©paration du t√©l√©chargement.")
    |                                                                                         ^^^^^^^^^^^^^^
529 |             return
    |

E501 Line too long (102 > 88)
   --> infra/pi_bot_debug.py:550:88
    |
548 |     except requests.exceptions.RequestException as e:
549 |         logging.error(f"Arr API Error: {e}")
550 |         bot.send_message(m.chat.id, "‚ùå Erreur de communication avec les services de t√©l√©chargement.")
    |                                                                                         ^^^^^^^^^^^^^^
551 |
552 | @bot.message_handler(func=lambda m: True)
    |

E501 Line too long (96 > 88)
   --> infra/pi_bot_debug.py:560:89
    |
558 | # Webhook server start
559 | webhook_app = Flask(__name__)
560 | threading.Thread(target=lambda: webhook_app.run(host='0.0.0.0', port=5001), daemon=True).start()
    |                                                                                         ^^^^^^^^
561 |
562 | bot.infinity_polling()
    |

E501 Line too long (93 > 88)
 --> infra/test_api.py:5:89
  |
3 | RADARR_API_KEY = "75ed9e2e3922442c8c1e012e47bc0906"
4 | try:
5 |     r = requests.get(f"{RADARR_URL}/movie", headers={"X-Api-Key": RADARR_API_KEY}, timeout=5)
  |                                                                                         ^^^^^
6 |     data = r.json()
7 |     owned = [f for f in data if f.get('hasFile') is True]
  |

E501 Line too long (94 > 88)
  --> infra/test_api.py:8:89
   |
 6 |     data = r.json()
 7 |     owned = [f for f in data if f.get('hasFile') is True]
 8 |     print(f"Test Radarr : {len(data)} films au total, {len(owned)} poss√©d√©s (hasFile: True).")
   |                                                                                         ^^^^^^
 9 | except Exception as e:
10 |     print(f"Erreur Test API : {e}")
   |

E501 Line too long (113 > 88)
 --> infra/test_search.py:6:89
  |
4 | try:
5 |     query = "Inception"
6 |     r = requests.get(f"{RADARR_URL}/movie/lookup?term={query}", headers={"X-Api-Key": RADARR_API_KEY}, timeout=5)
  |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
7 |     r.raise_for_status()
8 |     results = r.json()
  |

E501 Line too long (99 > 88)
  --> scripts/cleanup_share.py:57:89
   |
55 | def is_hdd_mounted():
56 |     """V√©rifie si le HDD de destination est accessible."""
57 |     return os.path.ismount(HDD_PATH) or os.path.ismount("/mnt/externe") or os.path.exists(HDD_PATH)
   |                                                                                         ^^^^^^^^^^^
58 |
59 | def auto_tiering_nvme_to_hdd():
   |

E501 Line too long (93 > 88)
  --> scripts/cleanup_share.py:60:89
   |
59 | def auto_tiering_nvme_to_hdd():
60 |     """D√©place les fichiers les plus anciens du NVMe vers le HDD si > TARGET_NVME_PERCENT."""
   |                                                                                         ^^^^^
61 |     logging.info("V√©rification de l'espace NVMe pour Auto-Tiering...")
   |

E501 Line too long (102 > 88)
  --> scripts/cleanup_share.py:64:89
   |
63 |     if not is_hdd_mounted():
64 |         logging.error(f"Le HDD cible ({HDD_PATH}) n'est pas mont√© ou accessible. Abandon du Tiering.")
   |                                                                                         ^^^^^^^^^^^^^^
65 |         return
   |

E501 Line too long (101 > 88)
  --> scripts/cleanup_share.py:68:89
   |
67 |     usage_percent = get_nvme_usage_percent()
68 |     logging.info(f"Utilisation NVMe actuelle : {usage_percent:.2f}% (Cible: {TARGET_NVME_PERCENT}%)")
   |                                                                                         ^^^^^^^^^^^^^
69 |
70 |     if usage_percent <= TARGET_NVME_PERCENT:
   |

E501 Line too long (89 > 88)
   --> scripts/cleanup_share.py:150:89
    |
148 |                 try:
149 |                     os.symlink(hdd_item_path, nvme_item_path)
150 |                     logging.info(f"Symlink recr√©√© : {nvme_item_path} -> {hdd_item_path}")
    |                                                                                         ^
151 |                 except Exception as e:
152 |                     logging.error(f"Erreur cr√©ation symlink pour {item} : {e}")
    |

E501 Line too long (110 > 88)
  --> scripts/config.py:18:89
   |
16 | # --- File Paths ---
17 | # En Docker, on pr√©f√®re utiliser /data ou /config mont√©s comme volumes
18 | USERS_FILE = get_env("USERS_FILE", "/app/users.json" if DOCKER_MODE else os.path.join(BASE_DIR, "users.json"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^
19 | CONTEXT_FILE = get_env("CONTEXT_FILE", "/tmp/bot_context.json")
20 | SCRIPT_PATH = get_env("SCRIPT_PATH", "/app/media_manager.py" if DOCKER_MODE else os.path.join(BASE_DIR, "media_manager.py"))
   |

E501 Line too long (124 > 88)
  --> scripts/config.py:20:89
   |
18 | USERS_FILE = get_env("USERS_FILE", "/app/users.json" if DOCKER_MODE else os.path.join(BASE_DIR, "users.json"))
19 | CONTEXT_FILE = get_env("CONTEXT_FILE", "/tmp/bot_context.json")
20 | SCRIPT_PATH = get_env("SCRIPT_PATH", "/app/media_manager.py" if DOCKER_MODE else os.path.join(BASE_DIR, "media_manager.py"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
21 |
22 | # --- Services Networking ---
   |

E501 Line too long (104 > 88)
  --> scripts/handlers_admin.py:15:89
   |
13 |     def status_cmd(m):
14 |         if not is_authorized(m.from_user.id): return
15 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
   |                                                                                         ^^^^^^^^^^^^^^^^
16 |         try:
17 |             nvme = shutil.disk_usage('/')
   |

E501 Line too long (92 > 88)
  --> scripts/handlers_admin.py:33:88
   |
31 |         markup = types.InlineKeyboardMarkup(row_width=1)
32 |         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"),
33 |                    types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"),
   |                                                                                         ^^^^
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |

E501 Line too long (93 > 88)
  --> scripts/handlers_admin.py:34:88
   |
32 |         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"),
33 |                    types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"),
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
   |                                                                                         ^^^^^
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
36 |         bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (108 > 88)
  --> scripts/handlers_admin.py:36:90
   |
34 |                    types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
35 |                    types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
36 |         bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^
37 |
38 |     def process_user_add(m):
   |

E501 Line too long (308 > 88)
  --> scripts/handlers_admin.py:56:88
   |
54 | ‚Ä¶
55 | ‚Ä¶
56 | ‚Ä¶hare"), types.InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), types.InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), types.InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
57 | ‚Ä¶d, call.message.message_id, reply_markup=markup)
58 | ‚Ä¶
   |

E501 Line too long (130 > 88)
  --> scripts/handlers_admin.py:57:90
   |
55 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
56 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), types.InlineKeyboardButton("üë• Utilisateurs", ‚Ä¶
57 | ‚Ä¶         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 | ‚Ä¶     elif cmd == "share":
59 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
   |

E501 Line too long (256 > 88)
  --> scripts/handlers_admin.py:60:88
   |
58 | ‚Ä¶
59 | ‚Ä¶
60 | ‚Ä¶a="adm:share_owned"), types.InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 | ‚Ä¶ call.message.message_id, reply_markup=markup)
62 | ‚Ä¶
   |

E501 Line too long (130 > 88)
  --> scripts/handlers_admin.py:61:88
   |
59 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
60 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), types.InlineKeyboardButton("‚ùå  ‚Ä¶
61 | ‚Ä¶         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
62 | ‚Ä¶     elif cmd == "users":
63 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=1)
   |

E501 Line too long (308 > 88)
  --> scripts/handlers_admin.py:64:88
   |
62 | ‚Ä¶
63 | ‚Ä¶
64 | ‚Ä¶ers_list"), types.InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), types.InlineKeyboardButton("‚ùå R√©voquer", callback_data="adm:users_rev"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
65 | ‚Ä¶at.id, call.message.message_id, reply_markup=markup)
66 | ‚Ä¶
   |

E501 Line too long (136 > 88)
  --> scripts/handlers_admin.py:65:88
   |
63 | ‚Ä¶p(row_width=1)
64 | ‚Ä¶ton("üìã Lister", callback_data="adm:users_list"), types.InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), types.Inlin ‚Ä¶
65 | ‚Ä¶ des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 | ‚Ä¶
67 | ‚Ä¶sers = json.load(f)["allowed"]
   |

E501 Line too long (223 > 88)
  --> scripts/handlers_admin.py:69:89
   |
67 | ‚Ä¶
68 | ‚Ä¶s])
69 | ‚Ä¶id, reply_markup=types.InlineKeyboardMarkup().add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users")), parse_mode='Markdown')
   |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
70 | ‚Ä¶
71 | ‚Ä¶
   |

E501 Line too long (101 > 88)
  --> scripts/handlers_admin.py:78:88
   |
76 | ‚Ä¶     for u in users:
77 | ‚Ä¶         if u == SUPER_ADMIN: continue
78 | ‚Ä¶         markup.add(types.InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
   |                                                                                   ^^^^^^^^^^^^^
79 | ‚Ä¶     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
80 | ‚Ä¶     bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> scripts/handlers_admin.py:79:90
   |
77 | ‚Ä¶             if u == SUPER_ADMIN: continue
78 | ‚Ä¶             markup.add(types.InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
79 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
   |                                                                                       ^
80 | ‚Ä¶         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
81 | ‚Ä¶     elif cmd == "users_del":
   |

E501 Line too long (135 > 88)
  --> scripts/handlers_admin.py:80:89
   |
78 | ‚Ä¶rdButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
79 | ‚Ä¶tton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
80 | ‚Ä¶ez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
81 | ‚Ä¶
82 | ‚Ä¶
   |

E501 Line too long (166 > 88)
  --> scripts/handlers_admin.py:88:89
   |
86 | ‚Ä¶
87 | ‚Ä¶.")
88 | ‚Ä¶.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instance=call.chat_instance))
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
89 | ‚Ä¶
90 | ‚Ä¶
   |

E501 Line too long (248 > 88)
  --> scripts/handlers_admin.py:91:88
   |
89 | ‚Ä¶
90 | ‚Ä¶
91 | ‚Ä¶t_owned:movies"), types.InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
92 | ‚Ä¶.message_id, reply_markup=markup)
93 | ‚Ä¶
   |

E501 Line too long (116 > 88)
  --> scripts/handlers_admin.py:92:89
   |
90 | ‚Ä¶         markup = types.InlineKeyboardMarkup(row_width=2)
91 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), types.InlineKeyboardButton("üì∫ S√©ri ‚Ä¶
92 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
93 | ‚Ä¶     elif cmd == "list_owned":
94 | ‚Ä¶         from handlers_media import list_media_unified
   |

E501 Line too long (94 > 88)
  --> scripts/handlers_media.py:13:89
   |
12 | def get_storage_emoji(item):
13 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0:
   |                                                                                         ^^^^^^
14 |         return "üî¥"
15 |     path = item.get('path', '')
   |

E501 Line too long (100 > 88)
  --> scripts/handlers_media.py:19:89
   |
18 | def list_media_unified(bot, m, cat, title, is_edit=False):
19 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                                                                         ^^^^^^^^^^^^
20 |     try:
21 |         items = json.loads(res.stdout); ctx = {}
   |

E501 Line too long (119 > 88)
  --> scripts/handlers_media.py:36:89
   |
34 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
35 |     markup = types.InlineKeyboardMarkup(row_width=5)
36 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
37 |     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
38 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> scripts/handlers_media.py:38:89
   |
36 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
37 |     markup.add(types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
38 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |                                                                                         ^
39 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E501 Line too long (98 > 88)
  --> scripts/handlers_media.py:41:89
   |
39 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
40 |
41 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
   |                                                                                         ^^^^^^^^^^
42 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
43 |     endpoint = "movie" if category == "films" else "series"
   |

E501 Line too long (106 > 88)
  --> scripts/handlers_media.py:45:89
   |
43 |     endpoint = "movie" if category == "films" else "series"
44 |     try:
45 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^^
46 |         r.raise_for_status(); data = r.json()
47 |         data.sort(key=lambda x: x.get('added', ''), reverse=True)
   |

E501 Line too long (145 > 88)
  --> scripts/handlers_media.py:57:89
   |
55 | ‚Ä¶m.get('year', '')})\n"
56 | ‚Ä¶dth=5)
57 | ‚Ä¶rt + i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1)]
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
58 | ‚Ä¶
59 | ‚Ä¶
   |

E501 Line too long (112 > 88)
  --> scripts/handlers_media.py:60:90
   |
58 |         markup.add(*btns)
59 |         nav_row = []
60 |         if page > 0: nav_row.append(types.InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
62 |         if nav_row: markup.row(*nav_row)
   |

E501 Line too long (130 > 88)
  --> scripts/handlers_media.py:61:90
   |
59 |         nav_row = []
60 |         if page > 0: nav_row.append(types.InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
   |

E501 Line too long (89 > 88)
  --> scripts/handlers_media.py:63:88
   |
61 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"‚û°Ô∏è ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
   |                                                                                         ^
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (94 > 88)
  --> scripts/handlers_media.py:64:89
   |
62 |         if nav_row: markup.row(*nav_row)
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
66 |     except Exception as e: bot.send_message(chat_id, f"‚ùå Erreur API : {e}")
   |

E501 Line too long (106 > 88)
  --> scripts/handlers_media.py:65:89
   |
63 |         markup.add(types.InlineKeyboardButton("üè† Menu Admin", callback_data="adm:main"))
64 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
65 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^
66 |     except Exception as e: bot.send_message(chat_id, f"‚ùå Erreur API : {e}")
   |

E501 Line too long (107 > 88)
  --> scripts/handlers_media.py:71:89
   |
69 |     @bot.message_handler(commands=['films'])
70 |     def films_cmd(m):
71 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "films", 0, True, is_authorized)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^
72 |
73 |     @bot.message_handler(commands=['series'])
   |

E501 Line too long (108 > 88)
  --> scripts/handlers_media.py:75:89
   |
73 |     @bot.message_handler(commands=['series'])
74 |     def series_cmd(m):
75 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "series", 0, True, is_authorized)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^
76 |
77 |     @bot.message_handler(commands=['queue'])
   |

E501 Line too long (97 > 88)
  --> scripts/handlers_media.py:83:89
   |
81 |             name = os.path.splitext(name)[0]
82 |             name = re.sub(r'[\._]', ' ', name)
83 |             match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
   |                                                                                         ^^^^^^^^^
84 |             title = match.group(1).strip() if match else name
85 |             year = match.group(2) if match else ""
   |

E501 Line too long (158 > 88)
  --> scripts/handlers_media.py:86:89
   |
84 | ‚Ä¶name
85 | ‚Ä¶
86 | ‚Ä¶\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b']
   |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
87 | ‚Ä¶e
88 | ‚Ä¶n, flags=re.IGNORECASE)
   |

E501 Line too long (96 > 88)
  --> scripts/handlers_media.py:91:89
   |
89 |             return re.sub(r'\s+', ' ', clean).strip()
90 |         try:
91 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                                                                         ^^^^^^^^
92 |             if not torrents: bot.reply_to(m, "‚Ä¢ Queue vide."); return
93 |             q_text = "üì• **Queue :**\n\n"
   |

E501 Line too long (110 > 88)
  --> scripts/handlers_media.py:95:89
   |
93 |             q_text = "üì• **Queue :**\n\n"
94 |             for t in torrents:
95 |                 if t['state'] in ['downloading', 'stalledDL', 'metaDL', 'queuedDL', 'checkingDL', 'pausedDL']:
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^
96 |                     clean_name = clean_title(t['name'])
97 |                     eta_sec = t.get('eta', 8640000)
   |

E501 Line too long (138 > 88)
   --> scripts/handlers_media.py:99:88
    |
 97 | ‚Ä¶000)
 98 | ‚Ä¶0000 else str(timedelta(seconds=eta_sec))
 99 | ‚Ä¶}**\n  ‚îî üìä {round(t['progress']*100,1)}% | üìÇ {round(t['size']/1024**3,2)}GB | ‚è≥ {eta}\n"
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
100 | ‚Ä¶'Markdown')
101 | ‚Ä¶")
    |

E501 Line too long (153 > 88)
   --> scripts/handlers_media.py:103:89
    |
101 | ‚Ä¶
102 | ‚Ä¶
103 | ‚Ä¶data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_final", "cancel")))
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
104 | ‚Ä¶
105 | ‚Ä¶
    |

E501 Line too long (96 > 88)
   --> scripts/handlers_media.py:109:89
    |
108 |         if d[0] == "m_pag":
109 |             show_media_list(bot, call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                                                                                         ^^^^^^^^
110 |         elif d[0] == "m_sel":
111 |             cat, item_id = d[1], d[2]
    |

E501 Line too long (123 > 88)
   --> scripts/handlers_media.py:116:89
    |
114 |             display_title = f"ID {item_id}"
115 |             try:
116 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
117 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
118 |             except: pass
    |

E501 Line too long (93 > 88)
   --> scripts/handlers_media.py:117:89
    |
115 |             try:
116 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
117 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
    |                                                                                         ^^^^^
118 |             except: pass
119 |             markup = types.InlineKeyboardMarkup()
    |

E501 Line too long (107 > 88)
   --> scripts/handlers_media.py:120:90
    |
118 |             except: pass
119 |             markup = types.InlineKeyboardMarkup()
120 |             markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
121 |                        types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 |                        types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |

E501 Line too long (109 > 88)
   --> scripts/handlers_media.py:121:88
    |
119 | ‚Ä¶     markup = types.InlineKeyboardMarkup()
120 | ‚Ä¶     markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
121 | ‚Ä¶                types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^
122 | ‚Ä¶                types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
123 | ‚Ä¶     bot.edit_message_text(f"üéØ **Action : {display_title}**", call.message.chat.id, call.message.message_id, reply_markup=markup, pa‚Ä¶
    |

E501 Line too long (95 > 88)
   --> scripts/handlers_media.py:122:90
    |
120 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
121 | ‚Ä¶                    types.InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 | ‚Ä¶                    types.InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |                                                                                       ^^^^^^^
123 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action : {display_title}**", call.message.chat.id, call.message.message_id, reply_markup=markup‚Ä¶
124 | ‚Ä¶     elif d[0] == "m_act":
    |

E501 Line too long (160 > 88)
   --> scripts/handlers_media.py:123:88
    |
121 | ‚Ä¶ger", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
122 | ‚Ä¶ur", callback_data=f"m_pag:{d[1]}:0"))
123 | ‚Ä¶title}**", call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
    |                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
124 | ‚Ä¶
125 | ‚Ä¶
    |

E501 Line too long (127 > 88)
   --> scripts/handlers_media.py:131:89
    |
129 |                 endpoint = "movie" if cat == "films" else "series"
130 |                 try:
131 |                     r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
132 |                     if r.status_code == 200:
133 |                         path = r.json().get('path')
    |

E501 Line too long (96 > 88)
   --> scripts/handlers_media.py:137:87
    |
135 | ‚Ä¶                     data = share_engine.generate_secure_link(path)
136 | ‚Ä¶                     if data and "video" in data:
137 | ‚Ä¶                         msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
    |                                                                                   ^^^^^^^^
138 | ‚Ä¶                         bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 | ‚Ä¶                     else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
    |

E501 Line too long (98 > 88)
   --> scripts/handlers_media.py:138:89
    |
136 |                             if data and "video" in data:
137 |                                 msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
    |

E501 Line too long (90 > 88)
   --> scripts/handlers_media.py:139:88
    |
137 |                                 msg = f"‚úÖ **Lien de partage g√©n√©r√© :**\n\nüîó `{data['video']}`"
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
    |                                                                                         ^^
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
141 |                 except: bot.send_message(call.message.chat.id, "‚ùå Erreur API.")
    |

E501 Line too long (89 > 88)
   --> scripts/handlers_media.py:140:88
    |
138 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
139 |                             else: bot.send_message(call.message.chat.id, "‚ùå √âchec lien.")
140 |                         else: bot.send_message(call.message.chat.id, "‚ùå Chemin absent.")
    |                                                                                         ^
141 |                 except: bot.send_message(call.message.chat.id, "‚ùå Erreur API.")
142 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E501 Line too long (127 > 88)
   --> scripts/handlers_media.py:146:89
    |
144 |         elif d[0] == "sel":
145 |             try:
146 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
147 |                 markup = types.InlineKeyboardMarkup(row_width=2)
148 |                 act = "arc" if item['is_nvme'] else "res"
    |

E501 Line too long (197 > 88)
   --> scripts/handlers_media.py:149:88
    |
147 | ‚Ä¶
148 | ‚Ä¶
149 | ‚Ä¶ck_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
150 | ‚Ä¶eyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
151 | ‚Ä¶ata="cancel"))
    |

E501 Line too long (142 > 88)
   --> scripts/handlers_media.py:150:89
    |
148 | ‚Ä¶se "res"
149 | ‚Ä¶tton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:‚Ä¶
150 | ‚Ä¶IN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
151 | ‚Ä¶tton("‚ùå Annuler", callback_data="cancel"))
152 | ‚Ä¶'name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (92 > 88)
   --> scripts/handlers_media.py:151:88
    |
149 | ‚Ä¶         markup.add(types.InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButto‚Ä¶
150 | ‚Ä¶         if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"‚Ä¶
151 | ‚Ä¶         markup.add(types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |                                                                                   ^^^^
152 | ‚Ä¶         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
153 | ‚Ä¶     except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
    |

E501 Line too long (126 > 88)
   --> scripts/handlers_media.py:152:90
    |
150 | ‚Ä¶             if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[‚Ä¶
151 | ‚Ä¶             markup.add(types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
152 | ‚Ä¶             bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
153 | ‚Ä¶         except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
154 | ‚Ä¶     elif d[0] == "act":
    |

E501 Line too long (127 > 88)
   --> scripts/handlers_media.py:156:89
    |
154 |         elif d[0] == "act":
155 |             try:
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (130 > 88)
   --> scripts/handlers_media.py:157:89
    |
155 |             try:
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
159 |             except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
    |

E501 Line too long (128 > 88)
   --> scripts/handlers_media.py:158:88
    |
156 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
157 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
158 |                 bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
159 |             except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
160 |         elif d[0] == "share_exec":
    |

E501 Line too long (127 > 88)
   --> scripts/handlers_media.py:162:89
    |
160 |         elif d[0] == "share_exec":
161 |             try:
162 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
163 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
164 |                 if subtitles:
    |

E501 Line too long (103 > 88)
   --> scripts/handlers_media.py:163:89
    |
161 |             try:
162 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
163 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                                                         ^^^^^^^^^^^^^^^
164 |                 if subtitles:
165 |                     markup = types.InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (263 > 88)
   --> scripts/handlers_media.py:166:88
    |
164 | ‚Ä¶
165 | ‚Ä¶
166 | ‚Ä¶a=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), types.InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
167 | ‚Ä¶ sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
168 | ‚Ä¶er=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |

E501 Line too long (175 > 88)
   --> scripts/handlers_media.py:167:88
    |
165 | ‚Ä¶1)
166 | ‚Ä¶nk", callback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), ty‚Ä¶
167 | ‚Ä¶n{len(subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
168 | ‚Ä¶=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
169 | ‚Ä¶)
    |

E501 Line too long (191 > 88)
   --> scripts/handlers_media.py:168:89
    |
166 | ‚Ä¶lback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), types.Inli‚Ä¶
167 | ‚Ä¶btitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
168 | ‚Ä¶, from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
169 | ‚Ä¶
170 | ‚Ä¶
    |

E501 Line too long (127 > 88)
   --> scripts/handlers_media.py:172:89
    |
170 |         elif d[0] == "share_final":
171 |             try:
172 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
173 |                 remux_opt = True if d[2] == "remux" else False
174 |                 bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (104 > 88)
   --> scripts/handlers_media.py:174:88
    |
172 | ‚Ä¶     with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
173 | ‚Ä¶     remux_opt = True if d[2] == "remux" else False
174 | ‚Ä¶     bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |                                                                               ^^^^^^^^^^^^^^^^
175 | ‚Ä¶     data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
176 | ‚Ä¶     if data and "video" in data: bot.send_message(call.message.chat.id, f"‚úÖ **Partag√©**\n\nüîó Vid√©o : `{data['video']}`", parse_mod ‚Ä¶
    |

E501 Line too long (157 > 88)
   --> scripts/handlers_media.py:176:88
    |
174 | ‚Ä¶call.message.chat.id, call.message.message_id)
175 | ‚Ä¶item['path'], remux=remux_opt)
176 | ‚Ä¶sage(call.message.chat.id, f"‚úÖ **Partag√©**\n\nüîó Vid√©o : `{data['video']}`", parse_mode='Markdown')
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
177 | ‚Ä¶id, "‚ùå √âchec.")
178 | ‚Ä¶, "‚ùå Erreur interne.")
    |

E501 Line too long (112 > 88)
   --> scripts/handlers_media.py:179:88
    |
177 |                 else: bot.send_message(call.message.chat.id, "‚ùå √âchec.")
178 |             except: bot.send_message(call.message.chat.id, "‚ùå Erreur interne.")
179 |         elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
    |

E501 Line too long (91 > 88)
  --> scripts/handlers_search.py:10:89
   |
 9 | def stream_gpt_json(query):
10 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
   |                                                                                         ^^^
11 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
12 |     try:
   |

E501 Line too long (100 > 88)
  --> scripts/handlers_search.py:11:89
   |
 9 | def stream_gpt_json(query):
10 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
11 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
   |                                                                                         ^^^^^^^^^^^^
12 |     try:
13 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [‚Ä¶
   |

E501 Line too long (204 > 88)
  --> scripts/handlers_search.py:13:89
   |
11 | ‚Ä¶": \"serie|film\"}}"
12 | ‚Ä¶
13 | ‚Ä¶s=headers, json={"model": "gpt-4o-mini", "messages": [{"role": "user", "content": prompt}], "temperature": 0.1}, timeout=10)
   |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | ‚Ä¶
15 | ‚Ä¶
   |

E501 Line too long (112 > 88)
  --> scripts/handlers_search.py:55:89
   |
53 |                 "rootFolderPath": "/movies" if cat == "movie" else "/tv",
54 |                 "monitored": True,
55 |                 "addOptions": {"searchForMovie": True} if cat == "movie" else {"searchForMissingEpisodes": True}
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
56 |             }
57 |             payload[id_key] = item[id_key]
   |

E501 Line too long (125 > 88)
  --> scripts/handlers_search.py:60:89
   |
58 |             if cat == "series": payload["languageProfileId"] = 1
59 |
60 |             r = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
61 |             if r.status_code in [200, 201]:
62 |                 bot.edit_message_text(f"‚úÖ **Ajout√© :** `{item['title']} ({item.get('year')})`", call.message.chat.id, call.message.mes‚Ä¶
   |

E501 Line too long (166 > 88)
  --> scripts/handlers_search.py:62:88
   |
60 | ‚Ä¶}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
61 | ‚Ä¶
62 | ‚Ä¶['title']} ({item.get('year')})`", call.message.chat.id, call.message.message_id, parse_mode='Markdown')
   |                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
63 | ‚Ä¶
64 | ‚Ä¶ {r.status_code}")
   |

E501 Line too long (120 > 88)
  --> scripts/handlers_search.py:78:89
   |
76 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
77 |     try:
78 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
79 |         results = r.json()
80 |         if not results: bot.send_message(m.chat.id, "‚ùå Aucun r√©sultat."); return
   |

E501 Line too long (112 > 88)
  --> scripts/handlers_search.py:89:89
   |
87 |         text = f"üîç **R√©sultats pour '{titre}'**\n\n"
88 |         limit = min(len(results), 5)
89 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
90 |         markup = InlineKeyboardMarkup()
91 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |

E501 Line too long (109 > 88)
  --> scripts/handlers_search.py:91:89
   |
89 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
90 |         markup = InlineKeyboardMarkup()
91 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
92 |         markup.add(*btns)
93 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (102 > 88)
  --> scripts/maintain_library.py:11:89
   |
 9 | API_KEY = "1f875e27320201d7671e1d9a9f2d7983"
10 | LANG_FILTER = "fr"  # Focus on French subtitles
11 | REPORT_PATH = os.path.join(os.path.dirname(os.path.abspath(__file__)), "library_integrity_report.log")
   |                                                                                         ^^^^^^^^^^^^^^
12 |
13 | logging.basicConfig(
   |

E501 Line too long (105 > 88)
  --> scripts/maintain_library.py:26:89
   |
24 |         logging.info(f"Triggering task: {task_name}")
25 |         params = {"name": task_name, "action": "run"}
26 |         res = requests.post(f"{BAZARR_URL}/api/system/tasks", headers=headers, params=params, timeout=10)
   |                                                                                         ^^^^^^^^^^^^^^^^^
27 |         return res.status_code == 200
28 |     except Exception as e:
   |

E501 Line too long (93 > 88)
  --> scripts/maintain_library.py:37:89
   |
35 |     while True:
36 |         try:
37 |             res = requests.get(f"{BAZARR_URL}/api/system/tasks", headers=headers, timeout=10)
   |                                                                                         ^^^^^
38 |             tasks = res.json()
39 |             running = [t['name'] for t in tasks if t.get('status') == 'running']
   |

E501 Line too long (97 > 88)
  --> scripts/maintain_library.py:53:89
   |
51 |     try:
52 |         # Search missing subtitles for Movies and Series
53 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=movies", headers=headers, timeout=10)
   |                                                                                         ^^^^^^^^^
54 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=series", headers=headers, timeout=10)
55 |     except Exception as e:
   |

E501 Line too long (97 > 88)
  --> scripts/maintain_library.py:54:89
   |
52 |         # Search missing subtitles for Movies and Series
53 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=movies", headers=headers, timeout=10)
54 |         requests.post(f"{BAZARR_URL}/api/wanted/search?type=series", headers=headers, timeout=10)
   |                                                                                         ^^^^^^^^^
55 |     except Exception as e:
56 |         logging.error(f"Wanted search trigger failed: {e}")
   |

E501 Line too long (114 > 88)
  --> scripts/maintain_library.py:72:89
   |
70 |         series = requests.get(f"{BAZARR_URL}/api/series", headers=headers).json()
71 |         for s in series:
72 |             episodes = requests.get(f"{BAZARR_URL}/api/episodes?seriesid={s['sonarrId']}", headers=headers).json()
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
73 |             for ep in episodes:
74 |                 has_fr = any(sub.get('language') == 'fr' for sub in ep.get('subtitles', []))
   |

E501 Line too long (92 > 88)
  --> scripts/maintain_library.py:74:89
   |
72 |             episodes = requests.get(f"{BAZARR_URL}/api/episodes?seriesid={s['sonarrId']}", headers=headers).json()
73 |             for ep in episodes:
74 |                 has_fr = any(sub.get('language') == 'fr' for sub in ep.get('subtitles', []))
   |                                                                                         ^^^^
75 |                 if not has_fr:
76 |                     report.append(f"[Series] Missing FR: {s['title']} - S{ep['seasonNumber']}E{ep['episodeNumber']}")
   |

E501 Line too long (117 > 88)
  --> scripts/maintain_library.py:76:89
   |
74 |                 has_fr = any(sub.get('language') == 'fr' for sub in ep.get('subtitles', []))
75 |                 if not has_fr:
76 |                     report.append(f"[Series] Missing FR: {s['title']} - S{ep['seasonNumber']}E{ep['episodeNumber']}")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
77 |                     
78 |     except Exception as e:
   |

E501 Line too long (112 > 88)
  --> scripts/media_manager.py:9:89
   |
 7 | DOCKER_MODE = os.environ.get("DOCKER_MODE") == "true"
 8 | HOME = os.path.expanduser("~")
 9 | NVME_MOVIES = "/data/internal/media/movies" if DOCKER_MODE else os.path.join(HOME, "infra/ai/data/media/movies")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
10 | NVME_TV = "/data/internal/media/tv" if DOCKER_MODE else os.path.join(HOME, "infra/ai/data/media/tv")
11 | HDD_ROOT = "/data/external" if DOCKER_MODE else "/mnt/externe"
   |

E501 Line too long (100 > 88)
  --> scripts/media_manager.py:10:89
   |
 8 | HOME = os.path.expanduser("~")
 9 | NVME_MOVIES = "/data/internal/media/movies" if DOCKER_MODE else os.path.join(HOME, "infra/ai/data/media/movies")
10 | NVME_TV = "/data/internal/media/tv" if DOCKER_MODE else os.path.join(HOME, "infra/ai/data/media/tv")
   |                                                                                         ^^^^^^^^^^^^
11 | HDD_ROOT = "/data/external" if DOCKER_MODE else "/mnt/externe"
   |

E501 Line too long (89 > 88)
  --> scripts/media_manager.py:22:89
   |
20 |     name = os.path.splitext(name)[0]
21 |     name = re.sub(r'[\._]', ' ', name)
22 |     match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
   |                                                                                         ^
23 |     title = match.group(1).strip() if match else name
24 |     year = match.group(2) if match else ""
   |

E501 Line too long (167 > 88)
  --> scripts/media_manager.py:25:89
   |
23 | ‚Ä¶
24 | ‚Ä¶
25 | ‚Ä¶C\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b', r'\bS\d+E\d+\b']
   |                             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
26 | ‚Ä¶
27 | ‚Ä¶IGNORECASE)
   |

E501 Line too long (94 > 88)
  --> scripts/media_manager.py:33:89
   |
31 |     try:
32 |         if os.path.isfile(p): return os.path.getsize(p)
33 |         return sum(os.path.getsize(os.path.join(r, f)) for r, d, fs in os.walk(p) for f in fs)
   |                                                                                         ^^^^^^
34 |     except Exception:
35 |         return 0
   |

E501 Line too long (97 > 88)
  --> scripts/media_manager.py:42:89
   |
40 |     q = query.lower().replace(" ", "")
41 |     for cat in PATHS:
42 |         for d, is_nvme in [(p, True) for p in PATHS[cat]["nvme"]] + [(PATHS[cat]["hdd"], False)]:
   |                                                                                         ^^^^^^^^^
43 |             if not os.path.exists(d): continue
44 |             for item in os.listdir(d):
   |

E501 Line too long (144 > 88)
  --> scripts/media_manager.py:67:89
   |
65 | ‚Ä¶size(path)
66 | ‚Ä¶
67 | ‚Ä¶(f), "real_name": f, "size_gb": round(size / (1024**3), 2), "is_nvme": is_nvme, "path": path})
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
68 | ‚Ä¶], reverse=True)
   |

E501 Line too long (102 > 88)
  --> scripts/media_manager.py:76:89
   |
74 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
75 |     elif cmd == "status":
76 |         u = shutil.disk_usage("/"); h = shutil.disk_usage(HDD_ROOT) if os.path.exists(HDD_ROOT) else u
   |                                                                                         ^^^^^^^^^^^^^^
77 |         print(json.dumps({"nvme_free": u.free//1024**3, "hdd_free": h.free//1024**3}))
78 |     elif cmd == "action":
   |

E501 Line too long (101 > 88)
  --> scripts/media_manager.py:83:89
   |
81 |             if os.path.isdir(path): shutil.rmtree(path)
82 |             else: os.remove(path)
83 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
   |                                                                                         ^^^^^^^^^^^^^
84 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
85 |         print("Done")
   |

E501 Line too long (105 > 88)
  --> scripts/media_manager.py:84:89
   |
82 |             else: os.remove(path)
83 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
84 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
   |                                                                                         ^^^^^^^^^^^^^^^^^
85 |         print("Done")
   |

E501 Line too long (91 > 88)
  --> scripts/pi_bot.py:16:89
   |
14 | import share_engine
15 |
16 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
17 |
18 | # --- CONFIGURATION ---
   |

E501 Line too long (106 > 88)
  --> scripts/pi_bot.py:43:89
   |
42 | def get_storage_emoji(item):
43 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0: return "üî¥"
   |                                                                                         ^^^^^^^^^^^^^^^^^^
44 |     path = item.get('path', '')
45 |     return "üìö" if path and "/mnt/externe" in path else "üöÄ"
   |

E501 Line too long (104 > 88)
  --> scripts/pi_bot.py:56:90
   |
54 |                InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
55 |                InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
56 |     bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^
57 |
58 | def process_user_add(m):
   |

E501 Line too long (100 > 88)
  --> scripts/pi_bot.py:70:89
   |
68 | # --- MEDIA ENGINE (ORIGINAL) ---
69 | def list_media_unified(m, cat, title, is_edit=False):
70 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                                                                         ^^^^^^^^^^^^
71 |     try:
72 |         items = json.loads(res.stdout); ctx = {}
   |

E501 Line too long (113 > 88)
  --> scripts/pi_bot.py:87:89
   |
85 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
86 |     markup = InlineKeyboardMarkup(row_width=5)
87 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
88 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
89 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |

E501 Line too long (89 > 88)
  --> scripts/pi_bot.py:89:89
   |
87 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
88 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
89 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |                                                                                         ^
90 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E501 Line too long (105 > 88)
  --> scripts/pi_bot.py:97:89
   |
95 |     endpoint = "movie" if category == "films" else "series"
96 |     try:
97 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |                                                                                         ^^^^^^^^^^^^^^^^^
98 |         r.raise_for_status(); data = r.json()
99 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
   |

E501 Line too long (97 > 88)
   --> scripts/pi_bot.py:100:89
    |
 98 |         r.raise_for_status(); data = r.json()
 99 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
100 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
    |                                                                                         ^^^^^^^^^
101 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
102 |         total = len(owned); start, end = page * 10, (page + 1) * 10
    |

E501 Line too long (99 > 88)
   --> scripts/pi_bot.py:105:87
    |
103 |         items = owned[start:end]
104 |         if not items: bot.send_message(chat_id, "üìÇ Vide."); return
105 |         text = f"{'üé¨' if category == 'films' else 'üì∫'} **{category.capitalize()}** ({total})\n\n"
    |                                                                                         ^^^^^^^^^^^
106 |         for i, item in enumerate(items, 1):
107 |             text += f"{start + i}. {get_storage_emoji(item)} {item['title']} ({item.get('year', '')})\n"
    |

E501 Line too long (104 > 88)
   --> scripts/pi_bot.py:107:89
    |
105 | ‚Ä¶     text = f"{'üé¨' if category == 'films' else 'üì∫'} **{category.capitalize()}** ({total})\n\n"
106 | ‚Ä¶     for i, item in enumerate(items, 1):
107 | ‚Ä¶         text += f"{start + i}. {get_storage_emoji(item)} {item['title']} ({item.get('year', '')})\n"
    |                                                                                       ^^^^^^^^^^^^^^^^
108 | ‚Ä¶     markup = InlineKeyboardMarkup(row_width=5)
109 | ‚Ä¶     btns = [InlineKeyboardButton(str(start+i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1‚Ä¶
    |

E501 Line too long (137 > 88)
   --> scripts/pi_bot.py:109:89
    |
107 | ‚Ä¶_emoji(item)} {item['title']} ({item.get('year', '')})\n"
108 | ‚Ä¶=5)
109 | ‚Ä¶i), callback_data=f"m_sel:{category}:{items[i-1]['id']}") for i in range(1, len(items)+1)]
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
110 | ‚Ä¶
111 | ‚Ä¶
    |

E501 Line too long (102 > 88)
   --> scripts/pi_bot.py:112:90
    |
110 |         markup.add(*btns)
111 |         nav = []
112 |         if page > 0: nav.append(InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
    |                                                                                         ^^^^^^^^^^^^^^
113 |         if end < total: nav.append(InlineKeyboardButton("‚û°Ô∏è", callback_data=f"m_pag:{category}:{page+1}"))
114 |         if nav: markup.row(*nav)
    |

E501 Line too long (105 > 88)
   --> scripts/pi_bot.py:113:90
    |
111 |         nav = []
112 |         if page > 0: nav.append(InlineKeyboardButton("‚¨ÖÔ∏è", callback_data=f"m_pag:{category}:{page-1}"))
113 |         if end < total: nav.append(InlineKeyboardButton("‚û°Ô∏è", callback_data=f"m_pag:{category}:{page+1}"))
    |                                                                                         ^^^^^^^^^^^^^^^^^
114 |         if nav: markup.row(*nav)
115 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
    |

E501 Line too long (94 > 88)
   --> scripts/pi_bot.py:116:89
    |
114 |         if nav: markup.row(*nav)
115 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
116 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |                                                                                         ^^^^^^
117 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
118 |     except: bot.send_message(chat_id, "‚ùå Erreur API.")
    |

E501 Line too long (106 > 88)
   --> scripts/pi_bot.py:117:89
    |
115 |         markup.add(InlineKeyboardButton("üè† Menu Principal", callback_data="adm:main"))
116 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
117 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^^^^^^^^^
118 |     except: bot.send_message(chat_id, "‚ùå Erreur API.")
    |

E501 Line too long (91 > 88)
   --> scripts/pi_bot.py:130:89
    |
128 | # --- SEARCH ENGINE (/GET) ---
129 | def stream_gpt_json(query):
130 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
    |                                                                                         ^^^
131 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
132 |     try:
    |

E501 Line too long (100 > 88)
   --> scripts/pi_bot.py:131:89
    |
129 | def stream_gpt_json(query):
130 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
131 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
    |                                                                                         ^^^^^^^^^^^^
132 |     try:
133 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": ‚Ä¶
    |

E501 Line too long (204 > 88)
   --> scripts/pi_bot.py:133:89
    |
131 | ‚Ä¶": \"serie|film\"}}"
132 | ‚Ä¶
133 | ‚Ä¶s=headers, json={"model": "gpt-4o-mini", "messages": [{"role": "user", "content": prompt}], "temperature": 0.1}, timeout=10)
    |          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
134 | ‚Ä¶
135 | ‚Ä¶
    |

E501 Line too long (120 > 88)
   --> scripts/pi_bot.py:153:89
    |
151 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
152 |     try:
153 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
154 |         results = r.json()
155 |         if not results: bot.send_message(m.chat.id, "‚ùå Aucun r√©sultat."); return
    |

E501 Line too long (112 > 88)
   --> scripts/pi_bot.py:158:89
    |
156 |         text = f"üîç **R√©sultats pour '{titre}'**\n\n"
157 |         limit = min(len(results), 5)
158 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
159 |         markup = InlineKeyboardMarkup()
160 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |

E501 Line too long (107 > 88)
   --> scripts/pi_bot.py:160:89
    |
158 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
159 |         markup = InlineKeyboardMarkup()
160 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
161 |         markup.add(*btns)
162 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
    |

E501 Line too long (107 > 88)
   --> scripts/pi_bot.py:173:89
    |
171 |     # 1. New Paged UI Callbacks
172 |     if d[0] in ["m_pag", "m_sel", "m_act", "dl_sel"]:
173 |         if d[0] == "m_pag": show_media_list(call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
174 |         elif d[0] == "m_sel":
175 |             markup = InlineKeyboardMarkup()
    |

E501 Line too long (101 > 88)
   --> scripts/pi_bot.py:176:90
    |
174 |         elif d[0] == "m_sel":
175 |             markup = InlineKeyboardMarkup()
176 |             markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^^
177 |                        InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
178 |                        InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |

E501 Line too long (103 > 88)
   --> scripts/pi_bot.py:177:88
    |
175 | ‚Ä¶     markup = InlineKeyboardMarkup()
176 | ‚Ä¶     markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
177 | ‚Ä¶                InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
    |                                                                                   ^^^^^^^^^^^^^^^
178 | ‚Ä¶                InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
179 | ‚Ä¶     bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (89 > 88)
   --> scripts/pi_bot.py:178:90
    |
176 | ‚Ä¶         markup.add(InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
177 | ‚Ä¶                    InlineKeyboardButton("üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
178 | ‚Ä¶                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
    |                                                                                       ^
179 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
180 | ‚Ä¶     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "üì• Ajout√©.")
    |

E501 Line too long (133 > 88)
   --> scripts/pi_bot.py:179:88
    |
177 | ‚Ä¶üîó Partager", callback_data=f"m_act:share:{d[1]}:{d[2]}"),
178 | ‚Ä¶‚¨ÖÔ∏è Retour", callback_data=f"m_pag:{d[1]}:0"))
179 | ‚Ä¶n sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
180 | ‚Ä¶lback_query(call.id, "üì• Ajout√©.")
181 | ‚Ä¶back_query(call.id, f"Action {d[1]} enregistr√©e.", show_alert=True)
    |

E501 Line too long (112 > 88)
   --> scripts/pi_bot.py:181:89
    |
179 | ‚Ä¶         bot.edit_message_text(f"üéØ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
180 | ‚Ä¶     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "üì• Ajout√©.")
181 | ‚Ä¶     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistr√©e.", show_alert=True)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^
182 | ‚Ä¶     return
    |

E501 Line too long (284 > 88)
   --> scripts/pi_bot.py:189:88
    |
187 | ‚Ä¶
188 | ‚Ä¶
189 | ‚Ä¶, InlineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
190 | ‚Ä¶d, call.message.message_id, reply_markup=markup)
191 | ‚Ä¶
    |

E501 Line too long (130 > 88)
   --> scripts/pi_bot.py:190:90
    |
188 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
189 | ‚Ä¶         markup.add(InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), InlineKeyboardButton("üë• Utilisateurs", callback_d ‚Ä¶
190 | ‚Ä¶         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
191 | ‚Ä¶     elif cmd == "share":
192 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (238 > 88)
   --> scripts/pi_bot.py:193:88
    |
191 | ‚Ä¶
192 | ‚Ä¶
193 | ‚Ä¶:share_owned"), InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
194 | ‚Ä¶ call.message.message_id, reply_markup=markup)
195 | ‚Ä¶
    |

E501 Line too long (130 > 88)
   --> scripts/pi_bot.py:194:88
    |
192 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
193 | ‚Ä¶         markup.add(InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), InlineKeyboardButton("‚ùå Contenu non ‚Ä¶
194 | ‚Ä¶         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
195 | ‚Ä¶     elif cmd == "users":
196 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (284 > 88)
   --> scripts/pi_bot.py:197:88
    |
195 | ‚Ä¶
196 | ‚Ä¶
197 | ‚Ä¶st"), InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), InlineKeyboardButton("‚ùå R√©voquer", callback_data="adm:users_rev"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
198 | ‚Ä¶at.id, call.message.message_id, reply_markup=markup)
199 | ‚Ä¶
    |

E501 Line too long (136 > 88)
   --> scripts/pi_bot.py:198:88
    |
196 | ‚Ä¶width=1)
197 | ‚Ä¶ Lister", callback_data="adm:users_list"), InlineKeyboardButton("‚ûï Ajouter", callback_data="adm:users_add"), InlineKeyboardButton(" ‚Ä¶
198 | ‚Ä¶ des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
199 | ‚Ä¶
200 | ‚Ä¶ = "üìã **Utilisateurs :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
    |

E501 Line too long (117 > 88)
   --> scripts/pi_bot.py:200:88
    |
198 | ‚Ä¶         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
199 | ‚Ä¶     elif cmd == "users_list":
200 | ‚Ä¶         users = load_allowed_users(); text = "üìã **Utilisateurs :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
201 | ‚Ä¶         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=InlineKeyboardMarkup().add(InlineKe‚Ä¶
202 | ‚Ä¶     elif cmd == "users_add":
    |

E501 Line too long (211 > 88)
   --> scripts/pi_bot.py:201:89
    |
199 | ‚Ä¶
200 | ‚Ä¶join([f"‚Ä¢ `{u}`" for u in users])
201 | ‚Ä¶id, reply_markup=InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users")), parse_mode='Markdown')
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
202 | ‚Ä¶
203 | ‚Ä¶
    |

E501 Line too long (95 > 88)
   --> scripts/pi_bot.py:209:88
    |
207 | ‚Ä¶     for u in users:
208 | ‚Ä¶         if u == SUPER_ADMIN: continue
209 | ‚Ä¶         markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
    |                                                                                   ^^^^^^^
210 | ‚Ä¶     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
211 | ‚Ä¶     bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (135 > 88)
   --> scripts/pi_bot.py:211:89
    |
209 | ‚Ä¶n(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
210 | ‚Ä¶Ô∏è Retour", callback_data="adm:users"))
211 | ‚Ä¶z l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
212 | ‚Ä¶
213 | ‚Ä¶wed_users()
    |

E501 Line too long (116 > 88)
   --> scripts/pi_bot.py:214:89
    |
212 | ‚Ä¶     elif cmd == "users_del":
213 | ‚Ä¶         uid = int(d[2]); users = load_allowed_users()
214 | ‚Ä¶         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, "‚úÖ R√©voqu√©.")
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
215 | ‚Ä¶         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instan‚Ä¶
216 | ‚Ä¶     elif cmd == "share_owned":
    |

E501 Line too long (158 > 88)
   --> scripts/pi_bot.py:215:89
    |
213 | ‚Ä¶
214 | ‚Ä¶s(users); bot.answer_callback_query(call.id, "‚úÖ R√©voqu√©.")
215 | ‚Ä¶ from_user=call.from_user, message=call.message, data="adm:users", chat_instance=call.chat_instance))
    |                                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
216 | ‚Ä¶
217 | ‚Ä¶
    |

E501 Line too long (230 > 88)
   --> scripts/pi_bot.py:218:88
    |
216 | ‚Ä¶
217 | ‚Ä¶
218 | ‚Ä¶d:movies"), InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
219 | ‚Ä¶.message_id, reply_markup=markup)
220 | ‚Ä¶ True)
    |

E501 Line too long (116 > 88)
   --> scripts/pi_bot.py:219:89
    |
217 | ‚Ä¶         markup = InlineKeyboardMarkup(row_width=2)
218 | ‚Ä¶         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callba ‚Ä¶
219 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
220 | ‚Ä¶     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
221 | ‚Ä¶     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |

E501 Line too long (89 > 88)
   --> scripts/pi_bot.py:220:89
    |
218 | ‚Ä¶         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callba ‚Ä¶
219 | ‚Ä¶         bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
220 | ‚Ä¶     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
    |                                                                                       ^
221 | ‚Ä¶     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
222 | ‚Ä¶     return
    |

E501 Line too long (94 > 88)
   --> scripts/pi_bot.py:221:89
    |
219 |             bot.edit_message_text("Cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
220 |         elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
221 |         elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^
222 |         return
    |

E501 Line too long (123 > 88)
   --> scripts/pi_bot.py:227:89
    |
225 |     if d[0] == "sel":
226 |         try:
227 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
228 |             markup = InlineKeyboardMarkup(row_width=2)
229 |             act = "arc" if item['is_nvme'] else "res"
    |

E501 Line too long (181 > 88)
   --> scripts/pi_bot.py:230:88
    |
228 | ‚Ä¶
229 | ‚Ä¶
230 | ‚Ä¶_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
231 | ‚Ä¶boardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
232 | ‚Ä¶a="cancel"))
    |

E501 Line too long (132 > 88)
   --> scripts/pi_bot.py:231:88
    |
229 | ‚Ä¶     act = "arc" if item['is_nvme'] else "res"
230 | ‚Ä¶     markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("üóëÔ∏è Supprimer"‚Ä¶
231 | ‚Ä¶     if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
232 | ‚Ä¶     markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
233 | ‚Ä¶     bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (122 > 88)
   --> scripts/pi_bot.py:233:90
    |
231 |             if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
232 |             markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
233 |             bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
234 |         except: bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
235 |     elif d[0] == "act":
    |

E501 Line too long (123 > 88)
   --> scripts/pi_bot.py:237:89
    |
235 |     elif d[0] == "act":
236 |         try:
237 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
238 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
239 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (126 > 88)
   --> scripts/pi_bot.py:238:89
    |
236 |         try:
237 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
238 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
239 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
240 |         except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
    |

E501 Line too long (124 > 88)
   --> scripts/pi_bot.py:239:88
    |
237 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
238 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
239 |             bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
240 |         except: bot.answer_callback_query(call.id, "‚ùå Erreur.")
241 |     elif d[0] == "share_exec":
    |

E501 Line too long (123 > 88)
   --> scripts/pi_bot.py:243:89
    |
241 |     elif d[0] == "share_exec":
242 |         try:
243 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
244 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
245 |             if subtitles:
    |

E501 Line too long (99 > 88)
   --> scripts/pi_bot.py:244:89
    |
242 |         try:
243 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
244 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                                                         ^^^^^^^^^^^
245 |             if subtitles:
246 |                 markup = InlineKeyboardMarkup(row_width=1)
    |

E501 Line too long (241 > 88)
   --> scripts/pi_bot.py:247:88
    |
245 | ‚Ä¶
246 | ‚Ä¶
247 | ‚Ä¶final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
248 | ‚Ä¶s-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
249 | ‚Ä¶_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |

E501 Line too long (171 > 88)
   --> scripts/pi_bot.py:248:88
    |
246 | ‚Ä¶
247 | ‚Ä¶lback_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardBu‚Ä¶
248 | ‚Ä¶len(subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
249 | ‚Ä¶from_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
250 | ‚Ä¶
    |

E501 Line too long (179 > 88)
   --> scripts/pi_bot.py:249:89
    |
247 | ‚Ä¶k_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("üé¨ Remux", callback_data=f"share_final:{d[1]}:remux"), InlineKeyboardButton‚Ä¶
248 | ‚Ä¶subtitles)} sous-titres trouv√©s.", call.message.chat.id, call.message.message_id, reply_markup=markup)
249 | ‚Ä¶_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
250 | ‚Ä¶
251 | ‚Ä¶
    |

E501 Line too long (123 > 88)
   --> scripts/pi_bot.py:253:89
    |
251 |     elif d[0] == "share_final":
252 |         try:
253 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
254 |             remux_opt = True if d[2] == "remux" else False
255 |             bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |

E501 Line too long (100 > 88)
   --> scripts/pi_bot.py:255:88
    |
253 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
254 |             remux_opt = True if d[2] == "remux" else False
255 |             bot.edit_message_text("‚è≥ Traitement...", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^
256 |             data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
257 |             if data and "video" in data:
    |

E501 Line too long (108 > 88)
   --> scripts/pi_bot.py:262:88
    |
260 |             else: bot.send_message(call.message.chat.id, "‚ùå √âchec du partage.")
261 |         except: bot.send_message(call.message.chat.id, "‚ùå Erreur interne.")
262 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
263 |
264 | # --- STATUS & QUEUE ---
    |

E501 Line too long (108 > 88)
   --> scripts/pi_bot.py:270:89
    |
268 |     try:
269 |         nvme = shutil.disk_usage('/')
270 |         def fmt(u): return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
271 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`"
272 |         if os.path.exists('/mnt/externe'):
    |

E501 Line too long (102 > 88)
   --> scripts/pi_bot.py:282:89
    |
280 |     if not is_authorized(m.chat.id): return
281 |     try:
282 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |                                                                                         ^^^^^^^^^^^^^^
283 |         if not torrents: bot.reply_to(m, "‚Ä¢ Queue vide."); return
284 |         q_text = "üì• **Queue :**\n\n"
    |

E501 Line too long (117 > 88)
   --> scripts/pi_bot.py:288:87
    |
286 |             if t['state'] in ['downloading', 'stalledDL', 'metaDL', 'queuedDL']:
287 |                 name = re.sub(r'[\._]', ' ', t['name'])
288 |                 q_text += f"‚Ä¢ **{name}**\n  ‚îî üìä {round(t['progress']*100,1)}% | üìÇ {round(t['size']/1024**3,2)}GB\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
289 |         bot.reply_to(m, q_text, parse_mode='Markdown')
290 |     except: bot.reply_to(m, "‚ùå Erreur qBit.")
    |

E501 Line too long (96 > 88)
   --> scripts/pi_bot.py:296:89
    |
294 | @webhook_app.route('/')
295 | def index(): return "Bot Active"
296 | threading.Thread(target=lambda: webhook_app.run(host='0.0.0.0', port=5001), daemon=True).start()
    |                                                                                         ^^^^^^^^
297 |
298 | print("üöÄ Bot d√©marr√© avec Integrity Shield...")
    |

E501 Line too long (91 > 88)
  --> scripts/pi_bot_debug.py:16:89
   |
14 | import share_engine
15 |
16 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
17 |
18 | TOKEN = os.getenv("TELEGRAM_TOKEN")
   |

E501 Line too long (96 > 88)
  --> scripts/pi_bot_debug.py:28:89
   |
26 | OPENAI_KEY = os.getenv("OPENAI_KEY")
27 |
28 | SONARR_CFG = {"url": "http://localhost:8989", "key": os.getenv("SONARR_API_KEY"), "root": "/tv"}
   |                                                                                         ^^^^^^^^
29 | RADARR_CFG = {"url": "http://localhost:7878", "key": os.getenv("RADARR_API_KEY"), "root": "/movies"}
30 | PLEX_CFG = {"url": "http://localhost:32400", "token": os.getenv("PLEX_TOKEN")}
   |

E501 Line too long (100 > 88)
  --> scripts/pi_bot_debug.py:29:89
   |
28 | SONARR_CFG = {"url": "http://localhost:8989", "key": os.getenv("SONARR_API_KEY"), "root": "/tv"}
29 | RADARR_CFG = {"url": "http://localhost:7878", "key": os.getenv("RADARR_API_KEY"), "root": "/movies"}
   |                                                                                         ^^^^^^^^^^^^
30 | PLEX_CFG = {"url": "http://localhost:32400", "token": os.getenv("PLEX_TOKEN")}
   |

E501 Line too long (144 > 88)
  --> scripts/pi_bot_debug.py:44:90
   |
42 | ‚Ä¶
43 | ‚Ä¶
44 | ‚Ä¶e S√©curit√©** : Tentative d'acc√®s au menu admin par {m.from_user.id} (@{m.from_user.username})")
   |                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
45 | ‚Ä¶
46 | ‚Ä¶
   |

E501 Line too long (104 > 88)
  --> scripts/pi_bot_debug.py:51:90
   |
49 |                InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"),
50 |                InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
51 |     bot.send_message(m.chat.id, "üõ†Ô∏è **Menu Administrateur**", reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^
52 |
53 | def save_users(users):
   |

E501 Line too long (280 > 88)
  --> scripts/pi_bot_debug.py:65:88
   |
63 | ‚Ä¶
64 | ‚Ä¶
65 | ‚Ä¶lineKeyboardButton("üë• Utilisateurs", callback_data="adm:users"), InlineKeyboardButton("üßπ Nettoyage SSD", callback_data="adm:clean"), InlineKeyboardButton("üîô Fermer", callback_data="adm:close"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
66 | ‚Ä¶all.message.message_id, reply_markup=markup)
   |

E501 Line too long (126 > 88)
  --> scripts/pi_bot_debug.py:66:90
   |
64 |         markup = InlineKeyboardMarkup(row_width=1)
65 |         markup.add(InlineKeyboardButton("üìÇ Partage", callback_data="adm:share"), InlineKeyboardButton("üë• Utilisateurs", callback_data ‚Ä¶
66 |         bot.edit_message_text("üõ†Ô∏è **Menu Administrateur**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
67 |     
68 |     elif cmd == "share":
   |

E501 Line too long (234 > 88)
  --> scripts/pi_bot_debug.py:70:88
   |
68 | ‚Ä¶
69 | ‚Ä¶
70 | ‚Ä¶re_owned"), InlineKeyboardButton("‚ùå Contenu non poss√©d√©", callback_data="adm:share_new"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
71 | ‚Ä¶l.message.message_id, reply_markup=markup)
   |

E501 Line too long (126 > 88)
  --> scripts/pi_bot_debug.py:71:88
   |
69 |         markup = InlineKeyboardMarkup(row_width=1)
70 |         markup.add(InlineKeyboardButton("‚úÖ Contenu poss√©d√©", callback_data="adm:share_owned"), InlineKeyboardButton("‚ùå Contenu non po ‚Ä¶
71 |         bot.edit_message_text("üìÇ **Gestion du Partage**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
72 |     
73 |     elif cmd == "users":
   |

E501 Line too long (95 > 88)
  --> scripts/pi_bot_debug.py:75:88
   |
73 |     elif cmd == "users":
74 |         markup = InlineKeyboardMarkup(row_width=1)
75 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
   |                                                                                         ^^^^^^^
76 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
77 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
   |

E501 Line too long (100 > 88)
  --> scripts/pi_bot_debug.py:76:88
   |
74 |         markup = InlineKeyboardMarkup(row_width=1)
75 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
76 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
   |                                                                                         ^^^^^^^^^^^^
77 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
78 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
   |

E501 Line too long (95 > 88)
  --> scripts/pi_bot_debug.py:77:88
   |
75 |         markup.add(InlineKeyboardButton("üìã Lister les acc√®s", callback_data="adm:users_list"),
76 |                    InlineKeyboardButton("‚ûï Ajouter un utilisateur", callback_data="adm:users_add"),
77 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
   |                                                                                         ^^^^^^^
78 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
79 |         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (132 > 88)
  --> scripts/pi_bot_debug.py:79:88
   |
77 |                    InlineKeyboardButton("‚ùå R√©voquer un acc√®s", callback_data="adm:users_rev"),
78 |                    InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:main"))
79 |         bot.edit_message_text("üë• **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
80 |     
81 |     elif cmd == "users_list":
   |

E501 Line too long (93 > 88)
  --> scripts/pi_bot_debug.py:83:88
   |
81 |     elif cmd == "users_list":
82 |         users = load_allowed_users()
83 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
   |                                                                                         ^^^^^
84 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
85 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (104 > 88)
  --> scripts/pi_bot_debug.py:84:90
   |
82 |         users = load_allowed_users()
83 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
84 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
   |                                                                                         ^^^^^^^^^^^^^^^^
85 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |

E501 Line too long (126 > 88)
  --> scripts/pi_bot_debug.py:85:89
   |
83 |         text = "üìã **Utilisateurs autoris√©s :**\n\n" + "\n".join([f"‚Ä¢ `{u}`" for u in users])
84 |         markup = InlineKeyboardMarkup().add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
85 |         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=markup, parse_mode='Markdown')
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
86 |     
87 |     elif cmd == "users_add":
   |

E501 Line too long (109 > 88)
  --> scripts/pi_bot_debug.py:88:88
   |
87 |     elif cmd == "users_add":
88 |         msg = bot.send_message(call.message.chat.id, "üë§ Envoyez l'ID Telegram de l'utilisateur √† ajouter :")
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
89 |         bot.register_next_step_handler(msg, process_user_add)
   |

E501 Line too long (91 > 88)
  --> scripts/pi_bot_debug.py:96:88
   |
94 |         for u in users:
95 |             if u == SUPER_ADMIN: continue
96 |             markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
   |                                                                                         ^^^
97 |         markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
98 |         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
   |

E501 Line too long (131 > 88)
   --> scripts/pi_bot_debug.py:98:89
    |
 96 |             markup.add(InlineKeyboardButton(f"‚ùå {u}", callback_data=f"adm:users_del:{u}"))
 97 |         markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:users"))
 98 |         bot.edit_message_text("S√©lectionnez l'ID √† r√©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
 99 |     
100 |     elif cmd == "users_del":
    |

E501 Line too long (226 > 88)
   --> scripts/pi_bot_debug.py:111:88
    |
109 | ‚Ä¶
110 | ‚Ä¶
111 | ‚Ä¶vies"), InlineKeyboardButton("üì∫ S√©ries", callback_data="adm:list_owned:series"), InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share"))
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
112 | ‚Ä¶call.message.message_id, reply_markup=markup)
    |

E501 Line too long (128 > 88)
   --> scripts/pi_bot_debug.py:112:89
    |
110 |         markup = InlineKeyboardMarkup(row_width=2)
111 |         markup.add(InlineKeyboardButton("üé¨ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("üì∫ S√©ries", callback ‚Ä¶
112 |         bot.edit_message_text("S√©lectionnez la cat√©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
113 |     
114 |     elif cmd == "list_owned":
    |

E501 Line too long (234 > 88)
   --> scripts/pi_bot_debug.py:118:88
    |
117 | ‚Ä¶
118 | ‚Ä¶om du film ou de la s√©rie que vous souhaitez rechercher et partager. L'IA s'occupera de la recherche.", call.message.chat.id, call.message.message_id)
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
119 | ‚Ä¶
120 | ‚Ä¶
    |

E501 Line too long (145 > 88)
   --> scripts/pi_bot_debug.py:121:88
    |
120 | ‚Ä¶
121 | ‚Ä¶n\nFonctionnalit√© en cours de d√©veloppement.", call.message.chat.id, call.message.message_id)
    |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
122 | ‚Ä¶
123 | ‚Ä¶ssage.chat.id, call.message.message_id)
    |

E501 Line too long (90 > 88)
   --> scripts/pi_bot_debug.py:123:89
    |
121 |         bot.edit_message_text("üßπ **Nettoyage SSD**\n\nFonctionnalit√© en cours de d√©veloppement.", call.message.chat.id, call.message.‚Ä¶
122 |     
123 |     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                                                                                         ^^
124 |
125 | def process_user_add(m):
    |

E501 Line too long (100 > 88)
   --> scripts/pi_bot_debug.py:140:89
    |
138 | # --- MEDIA ENGINE ---
139 | def list_media_unified(m, cat, title, is_edit=False):
140 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^
141 |     try:
142 |         items = json.loads(res.stdout)
    |

E501 Line too long (113 > 88)
   --> scripts/pi_bot_debug.py:160:89
    |
158 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
159 |     markup = InlineKeyboardMarkup(row_width=5)
160 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
161 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
162 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |

E501 Line too long (89 > 88)
   --> scripts/pi_bot_debug.py:162:89
    |
160 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
161 |     markup.add(InlineKeyboardButton("‚¨ÖÔ∏è Retour", callback_data="adm:share_owned"))
162 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |                                                                                         ^
163 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |

E501 Line too long (117 > 88)
   --> scripts/pi_bot_debug.py:165:89
    |
163 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
164 |
165 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
166 | def media_callbacks(call):
167 |     if not is_authorized(call.from_user.id): return
    |

E501 Line too long (92 > 88)
   --> scripts/pi_bot_debug.py:175:88
    |
173 |         except Exception as e:
174 |             logging.error(f"Context load failed for sel: {e}")
175 |             bot.answer_callback_query(call.id, "‚ùå Session expir√©e, relancez la recherche.")
    |                                                                                         ^^^^
176 |             return
177 |         markup = InlineKeyboardMarkup(row_width=2)
    |

E501 Line too long (100 > 88)
   --> scripts/pi_bot_debug.py:179:88
    |
177 |         markup = InlineKeyboardMarkup(row_width=2)
178 |         act = "arc" if item['is_nvme'] else "res"
179 |         markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"),
    |                                                                                         ^^^^^^^^^^^^
180 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
181 |         if call.from_user.id == SUPER_ADMIN:
    |

E501 Line too long (95 > 88)
   --> scripts/pi_bot_debug.py:180:90
    |
178 |         act = "arc" if item['is_nvme'] else "res"
179 |         markup.add(InlineKeyboardButton("üì¶ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"),
180 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
    |                                                                                         ^^^^^^^
181 |         if call.from_user.id == SUPER_ADMIN:
182 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |

E501 Line too long (95 > 88)
   --> scripts/pi_bot_debug.py:182:88
    |
180 |                    InlineKeyboardButton("üóëÔ∏è Supprimer", callback_data=f"act:del:{d[1]}:{d[2]}"))
181 |         if call.from_user.id == SUPER_ADMIN:
182 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
    |                                                                                         ^^^^^^^
183 |         markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
184 |         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E501 Line too long (118 > 88)
   --> scripts/pi_bot_debug.py:184:90
    |
182 |             markup.add(InlineKeyboardButton("üîó Partager", callback_data=f"share_exec:{d[2]}"))
183 |         markup.add(InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
184 |         bot.edit_message_text(f"üõ†Ô∏è {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
185 |     elif d[0] == "act":
186 |         try:
    |

E501 Line too long (122 > 88)
   --> scripts/pi_bot_debug.py:193:89
    |
191 |             bot.answer_callback_query(call.id, "‚ùå Session expir√©e.")
192 |             return
193 |         res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
194 |         bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
195 |     elif d[0] == "share_exec":
    |

E501 Line too long (120 > 88)
   --> scripts/pi_bot_debug.py:194:88
    |
192 |             return
193 |         res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
194 |         bot.edit_message_text(f"‚úÖ {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
195 |     elif d[0] == "share_exec":
196 |         try:
    |

E501 Line too long (114 > 88)
   --> scripts/pi_bot_debug.py:210:88
    |
208 |         if subtitles:
209 |             markup = InlineKeyboardMarkup(row_width=1)
210 |             markup.add(InlineKeyboardButton("‚ö° Lien Rapide (Symlink)", callback_data=f"share_final:{d[1]}:link"),
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
211 |                        InlineKeyboardButton("üé¨ Remux avec Sous-titres", callback_data=f"share_final:{d[1]}:remux"),
212 |                        InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
    |

E501 Line too long (116 > 88)
   --> scripts/pi_bot_debug.py:211:88
    |
209 | ‚Ä¶     markup = InlineKeyboardMarkup(row_width=1)
210 | ‚Ä¶     markup.add(InlineKeyboardButton("‚ö° Lien Rapide (Symlink)", callback_data=f"share_final:{d[1]}:link"),
211 | ‚Ä¶                InlineKeyboardButton("üé¨ Remux avec Sous-titres", callback_data=f"share_final:{d[1]}:remux"),
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
212 | ‚Ä¶                InlineKeyboardButton("‚ùå Annuler", callback_data="cancel"))
213 | ‚Ä¶     bot.edit_message_text(f"üéØ **Options de Partage**\n{len(subtitles)} sous-titre(s) trouv√©(s).", call.message.chat.id, call.messag‚Ä¶
    |

E501 Line too long (174 > 88)
   --> scripts/pi_bot_debug.py:213:88
    |
211 | ‚Ä¶tres", callback_data=f"share_final:{d[1]}:remux"),
212 | ‚Ä¶_data="cancel"))
213 | ‚Ä¶n(subtitles)} sous-titre(s) trouv√©(s).", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
214 | ‚Ä¶
215 | ‚Ä¶
    |

E501 Line too long (180 > 88)
   --> scripts/pi_bot_debug.py:216:89
    |
214 | ‚Ä¶
215 | ‚Ä¶
216 | ‚Ä¶m_user=call.from_user, message=call.message, data=f"share_final:{d[1]}:link", chat_instance=call.chat_instance))
    |                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
217 | ‚Ä¶
218 | ‚Ä¶
    |

E501 Line too long (150 > 88)
   --> scripts/pi_bot_debug.py:228:87
    |
227 | ‚Ä¶e
228 | ‚Ä¶.." if remux_opt else "‚è≥ G√©n√©ration du lien...", call.message.chat.id, call.message.message_id)
    |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
229 | ‚Ä¶
230 | ‚Ä¶['path'], remux=remux_opt)
    |

E501 Line too long (151 > 88)
   --> scripts/pi_bot_debug.py:234:87
    |
232 | ‚Ä¶
233 | ‚Ä¶
234 | ‚Ä¶nclus)**\n\nüîó Vid√©o : `{data['video']}`\n\n‚úÖ Les sous-titres ont √©t√© int√©gr√©s au fichier MKV."
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
235 | ‚Ä¶
236 | ‚Ä¶*\n\nüîó Vid√©o : `{data['video']}`\n"
    |

E501 Line too long (91 > 88)
   --> scripts/pi_bot_debug.py:236:87
    |
234 | ‚Ä¶         msg = f"üé¨ **Contenu Remux√© (Softsubs inclus)**\n\nüîó Vid√©o : `{data['video']}`\n\n‚úÖ Les sous-titres ont √©t√© int√©gr√©s au fi  ‚Ä¶
235 | ‚Ä¶     else:
236 | ‚Ä¶         msg = f"‚úÖ **Contenu Partag√© (Symlink)**\n\nüîó Vid√©o : `{data['video']}`\n"
    |                                                                                   ^^^
237 | ‚Ä¶         if data.get("subtitles"):
238 | ‚Ä¶             msg += "\nüìÑ **Sous-titres (li√©s et s√©curis√©s) :**\n"
    |

E501 Line too long (106 > 88)
   --> scripts/pi_bot_debug.py:243:88
    |
241 |             bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
242 |         else:
243 |             bot.send_message(call.message.chat.id, "‚ùå Erreur: √âchec du partage ou contenu hors limites.")
    |                                                                                         ^^^^^^^^^^^^^^^^^^
244 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
245 |     elif d[0] == "dl":
    |

E501 Line too long (108 > 88)
   --> scripts/pi_bot_debug.py:244:88
    |
242 |         else:
243 |             bot.send_message(call.message.chat.id, "‚ùå Erreur: √âchec du partage ou contenu hors limites.")
244 |     elif d[0] == "cancel": bot.edit_message_text("‚ùå Ferm√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^
245 |     elif d[0] == "dl":
246 |         if d[1] == "no":
    |

E501 Line too long (109 > 88)
   --> scripts/pi_bot_debug.py:247:88
    |
245 |     elif d[0] == "dl":
246 |         if d[1] == "no":
247 |             bot.edit_message_text("‚ùå T√©l√©chargement annul√©.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
248 |             return
249 |         elif d[1] == "yes":
    |

E501 Line too long (118 > 88)
   --> scripts/pi_bot_debug.py:272:89
    |
270 |                 "rootFolderPath": cfg['root'],
271 |                 "monitored": True,
272 |                 "addOptions": {"searchForMovie": True} if type_media == 'film' else {"searchForMissingEpisodes": True}
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
273 |             }
274 |             payload[id_key] = dl_data['item_id']
    |

E501 Line too long (104 > 88)
   --> scripts/pi_bot_debug.py:278:88
    |
276 |                 payload["languageProfileId"] = 1
277 |
278 |             bot.edit_message_text("‚è≥ Ajout en cours...", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^
279 |             
280 |             try:
    |

E501 Line too long (133 > 88)
   --> scripts/pi_bot_debug.py:281:89
    |
280 | ‚Ä¶     try:
281 | ‚Ä¶         r_add = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
    |                                                                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
282 | ‚Ä¶         if r_add.status_code in [200, 201]:
283 | ‚Ä¶             bot.edit_message_text(f"üì• **Ajout√© √† la file d'attente :** `{dl_data['found_title']} ({dl_data['year']})`\nLe t√©l√©charg‚Ä¶
    |

E501 Line too long (229 > 88)
   --> scripts/pi_bot_debug.py:283:88
    |
281 | ‚Ä¶X-Api-Key": cfg['key']}, json=payload, timeout=10)
282 | ‚Ä¶
283 | ‚Ä¶_data['found_title']} ({dl_data['year']})`\nLe t√©l√©chargement va d√©buter.", call.message.chat.id, call.message.message_id, parse_mode='Markdown')
    |      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
284 | ‚Ä¶
285 | ‚Ä¶
    |

E501 Line too long (142 > 88)
   --> scripts/pi_bot_debug.py:286:88
    |
284 | ‚Ä¶
285 | ‚Ä¶: {r_add.text}")
286 | ‚Ä¶ec de l'ajout (Erreur {r_add.status_code}).", call.message.chat.id, call.message.message_id)
    |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
287 | ‚Ä¶
288 | ‚Ä¶}")
    |

E501 Line too long (131 > 88)
   --> scripts/pi_bot_debug.py:289:88
    |
287 |             except Exception as e:
288 |                 logging.error(f"Arr API Error: {e}")
289 |                 bot.edit_message_text("‚ùå Erreur de communication avec le serveur.", call.message.chat.id, call.message.message_id)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
290 |
291 | @bot.message_handler(commands=['status'])
    |

E501 Line too long (100 > 88)
   --> scripts/pi_bot_debug.py:298:89
    |
296 |         hdd = shutil.disk_usage('/mnt/externe') # Chemin cible HDD
297 |         def fmt(u):
298 |             return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
    |                                                                                         ^^^^^^^^^^^^
299 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`\nüìö **HDD** : `{fmt(hdd)}`"
300 |         bot.reply_to(m, msg, parse_mode='Markdown')
    |

E501 Line too long (101 > 88)
   --> scripts/pi_bot_debug.py:299:86
    |
297 |         def fmt(u):
298 |             return f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({(u.used/u.total)*100:.1f}%)"
299 |         msg = f"üìä **Stockage Temps R√©el**\n\nüöÄ **NVMe** : `{fmt(nvme)}`\nüìö **HDD** : `{fmt(hdd)}`"
    |                                                                                         ^^^^^^^^^^^^^
300 |         bot.reply_to(m, msg, parse_mode='Markdown')
301 |     except Exception:
    |

E501 Line too long (114 > 88)
   --> scripts/pi_bot_debug.py:309:89
    |
307 |     try:
308 |         logging.info(f"[DEBUG_API] Interrogation Radarr √† {RADARR_CFG['url']}")
309 |         r = requests.get(f"{RADARR_CFG['url']}/api/v3/movie", headers={"X-Api-Key": RADARR_CFG['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
310 |         r.raise_for_status()
311 |         data = r.json()
    |

E501 Line too long (97 > 88)
   --> scripts/pi_bot_debug.py:312:89
    |
310 |         r.raise_for_status()
311 |         data = r.json()
312 |         logging.info(f"[DEBUG_API] Status: {r.status_code} | Nombre de films re√ßus: {len(data)}")
    |                                                                                         ^^^^^^^^^
313 |         owned = [f for f in data if f.get('hasFile') is True]
314 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
    |

E501 Line too long (115 > 88)
   --> scripts/pi_bot_debug.py:325:89
    |
323 |     if not is_authorized(m.chat.id): return
324 |     try:
325 |         r = requests.get(f"{SONARR_CFG['url']}/api/v3/series", headers={"X-Api-Key": SONARR_CFG['key']}, timeout=5)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
326 |         r.raise_for_status()
327 |         # Une s√©rie est pr√©sente si episodeFileCount > 0
    |

E501 Line too long (95 > 88)
   --> scripts/pi_bot_debug.py:328:89
    |
326 |         r.raise_for_status()
327 |         # Une s√©rie est pr√©sente si episodeFileCount > 0
328 |         owned = [s for s in r.json() if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
    |                                                                                         ^^^^^^^
329 |         text = f"üì∫ **Biblioth√®que Sonarr ({len(owned)} s√©ries)**\n\n"
330 |         text += "\n".join([f"‚Ä¢ {s['title']} ‚Äî `{s['statistics']['episodeFileCount']}` √©pisodes" for s in owned])
    |

E501 Line too long (112 > 88)
   --> scripts/pi_bot_debug.py:330:89
    |
328 |         owned = [s for s in r.json() if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
329 |         text = f"üì∫ **Biblioth√®que Sonarr ({len(owned)} s√©ries)**\n\n"
330 |         text += "\n".join([f"‚Ä¢ {s['title']} ‚Äî `{s['statistics']['episodeFileCount']}` √©pisodes" for s in owned])
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
331 |         bot.reply_to(m, text, parse_mode='Markdown')
332 |     except Exception:
    |

E501 Line too long (93 > 88)
   --> scripts/pi_bot_debug.py:342:89
    |
340 |         name = os.path.splitext(name)[0]
341 |         name = re.sub(r'[\._]', ' ', name)
342 |         match = re.search(r'(.*?)\s*[\(\[]?((?:19|20)\d{2})[\)\]]?(.*)', name, re.IGNORECASE)
    |                                                                                         ^^^^^
343 |         title = match.group(1).strip() if match else name
344 |         year = match.group(2) if match else ""
    |

E501 Line too long (154 > 88)
   --> scripts/pi_bot_debug.py:345:89
    |
343 | ‚Ä¶me
344 | ‚Ä¶
345 | ‚Ä¶', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bSeason\s*\d*\b']
    |                                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
346 | ‚Ä¶
347 | ‚Ä¶ flags=re.IGNORECASE)
    |

E501 Line too long (116 > 88)
   --> scripts/pi_bot_debug.py:367:87
    |
365 |                     size = round(t['size'] / 1024**3, 2)
366 |                     clean_name = clean_title(t['name'])
367 |                     q_text += f"‚Ä¢ **{clean_name}**\n  ‚îî üì∂ {t['state']} | üìä {progress}% | ‚è≥ {eta} | üìÇ {size}GB\n"
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
368 |     except Exception as e:
369 |         logging.error(f"qBittorrent Error: {e}")
    |

E501 Line too long (91 > 88)
   --> scripts/pi_bot_debug.py:376:89
    |
374 | # --- AI HANDLER & ARR INTEGRATION ---
375 | def stream_gpt_json(query):
376 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
    |                                                                                         ^^^
377 |     prompt = f"Analyse cette demande : '{query}'. Tu DOIS extraire le titre, la saison et l'√©pisode.\n\nR√®gles de parsing :\n'S01E01'‚Ä¶
    |

E501 Line too long (453 > 88)
   --> scripts/pi_bot_debug.py:377:89
    |
375 | ‚Ä¶
376 | ‚Ä¶I_KEY}"}
377 | ‚Ä¶son et l'√©pisode.\n\nR√®gles de parsing :\n'S01E01' ou 'S1E1' -> saison: 1, episode: 1\n'Saison 2' -> saison: 2, episode: null\nSi c'est un film ou incertain -> type: 'film', saison/episode: null\nSi c'est une s√©rie -> type: 'serie'\n\nRenvoie UNIQUEMENT un JSON pur : {{\"titre\": \"str\", \"saison\": \"int|null\", \"episode\": \"int|null\", \"type\": \"serie|film\"}}"
    |       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
378 | ‚Ä¶
379 | ‚Ä¶
    |

E501 Line too long (97 > 88)
   --> scripts/pi_bot_debug.py:380:89
    |
379 |     try:
380 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={
    |                                                                                         ^^^^^^^^^
381 |             "model": "gpt-4o-mini",
382 |             "messages": [{"role": "user", "content": prompt}],
    |

E501 Line too long (106 > 88)
   --> scripts/pi_bot_debug.py:417:89
    |
415 |                 # Typage fort (S√©curit√©)
416 |                 parsed['titre'] = str(parsed.get('titre', ''))
417 |                 parsed['saison'] = int(parsed.get('saison')) if parsed.get('saison') is not None else None
    |                                                                                         ^^^^^^^^^^^^^^^^^^
418 |                 parsed['episode'] = int(parsed.get('episode')) if parsed.get('episode') is not None else None
419 |                 parsed['type'] = str(parsed.get('type', ''))
    |

E501 Line too long (109 > 88)
   --> scripts/pi_bot_debug.py:418:89
    |
416 |                 parsed['titre'] = str(parsed.get('titre', ''))
417 |                 parsed['saison'] = int(parsed.get('saison')) if parsed.get('saison') is not None else None
418 |                 parsed['episode'] = int(parsed.get('episode')) if parsed.get('episode') is not None else None
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
419 |                 parsed['type'] = str(parsed.get('type', ''))
    |

E501 Line too long (89 > 88)
   --> scripts/pi_bot_debug.py:441:88
    |
439 |         process_get_request(m, query)
440 |     else:
441 |         msg = bot.reply_to(m, "üé¨ Que veux-tu t√©l√©charger ? (Ex: Shogun S01E01 ou Dune)")
    |                                                                                         ^
442 |         bot.register_next_step_handler(msg, process_get_step)
    |

E501 Line too long (89 > 88)
   --> scripts/pi_bot_debug.py:461:88
    |
460 |     if not data or "error" in data:
461 |         bot.reply_to(m, "‚ùå Le flux d'analyse a √©chou√© (Pipe Break). Donn√©es invalides.")
    |                                                                                         ^
462 |         return
    |

E501 Line too long (124 > 88)
   --> scripts/pi_bot_debug.py:474:88
    |
472 |         return
473 |
474 |     bot.send_message(m.chat.id, f"üîç **Recherche en cours :** `{titre}` ({type_media.capitalize()})", parse_mode='Markdown')
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
475 |
476 |     # 2. Phase de Routage & V√©rification de Disponibilit√© locale
    |

E501 Line too long (115 > 88)
   --> scripts/pi_bot_debug.py:478:89
    |
476 |     # 2. Phase de Routage & V√©rification de Disponibilit√© locale
477 |     try:
478 |         res_local = subprocess.run(["python3", SCRIPT_PATH, "search_local", titre], capture_output=True, text=True)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
479 |         local_items = json.loads(res_local.stdout)
480 |         if local_items:
    |

E501 Line too long (109 > 88)
   --> scripts/pi_bot_debug.py:481:88
    |
479 |         local_items = json.loads(res_local.stdout)
480 |         if local_items:
481 |             bot.send_message(m.chat.id, f"‚úÖ `{titre}` est d√©j√† disponible localement dans la biblioth√®que.")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^
482 |             return
483 |     except Exception as e:
    |

E501 Line too long (133 > 88)
   --> scripts/pi_bot_debug.py:492:89
    |
490 |     try:
491 |         # Recherche API Sonarr/Radarr
492 |         r_lookup = requests.get(f"{cfg['url']}/api/v3/{endpoint}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=10)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
493 |         results = r_lookup.json()
    |

E501 Line too long (107 > 88)
   --> scripts/pi_bot_debug.py:496:88
    |
495 |         if not results:
496 |             bot.send_message(m.chat.id, f"‚ùå `{titre}` introuvable dans les bases de donn√©es (TMDb/TVDb).")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^
497 |             return
    |

E501 Line too long (112 > 88)
   --> scripts/pi_bot_debug.py:505:89
    |
504 |         # Validation de Flux: V√©rification si d√©j√† dans Sonarr/Radarr
505 |         r_check = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^
506 |         exists = any(str(i.get(id_key)) == str(item_id) for i in r_check.json())
    |

E501 Line too long (172 > 88)
   --> scripts/pi_bot_debug.py:509:88
    |
508 | ‚Ä¶
509 | ‚Ä¶r})` est d√©j√† poss√©d√© ou en cours de t√©l√©chargement sur {'Radarr' if type_media == 'film' else 'Sonarr'}.")
    |                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
510 | ‚Ä¶
    |

E501 Line too long (102 > 88)
   --> scripts/pi_bot_debug.py:529:88
    |
527 |         except Exception as e:
528 |             logging.error(f"Context save failed: {e}")
529 |             bot.send_message(m.chat.id, "‚ùå Erreur interne lors de la pr√©paration du t√©l√©chargement.")
    |                                                                                         ^^^^^^^^^^^^^^
530 |             return
    |

E501 Line too long (102 > 88)
   --> scripts/pi_bot_debug.py:551:88
    |
549 |     except requests.exceptions.RequestException as e:
550 |         logging.error(f"Arr API Error: {e}")
551 |         bot.send_message(m.chat.id, "‚ùå Erreur de communication avec les services de t√©l√©chargement.")
    |                                                                                         ^^^^^^^^^^^^^^
552 |
553 | @bot.message_handler(func=lambda m: True)
    |

E501 Line too long (96 > 88)
   --> scripts/pi_bot_debug.py:561:89
    |
559 | # Webhook server start
560 | webhook_app = Flask(__name__)
561 | threading.Thread(target=lambda: webhook_app.run(host='0.0.0.0', port=5001), daemon=True).start()
    |                                                                                         ^^^^^^^^
562 |
563 | bot.infinity_polling()
    |

E501 Line too long (102 > 88)
  --> scripts/share_engine.py:13:89
   |
11 | HOME = os.path.expanduser("~")
12 | SHARE_DIR = "/media_share/" if DOCKER_MODE else os.path.join(HOME, "media_share/")
13 | CONFIG_FILE = "/app/config_share.json" if DOCKER_MODE else os.path.join(BASE_DIR, "config_share.json")
   |                                                                                         ^^^^^^^^^^^^^^
14 | BASE_URL = "https://share.juleslaconfourque.fr"
   |

E501 Line too long (91 > 88)
  --> scripts/share_engine.py:16:89
   |
14 | BASE_URL = "https://share.juleslaconfourque.fr"
15 |
16 | logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
   |                                                                                         ^^^
17 |
18 | def load_config():
   |

E501 Line too long (134 > 88)
  --> scripts/share_engine.py:42:89
   |
40 |                     break
41 |         
42 |         cmd = ["ffprobe", "-v", "error", "-select_streams", "v:0", "-show_entries", "stream=height", "-of", "csv=s=x:p=0", probe_path]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
43 |         try:
44 |             res = subprocess.run(cmd, capture_output=True, text=True, timeout=5)
   |

E501 Line too long (118 > 88)
   --> scripts/share_engine.py:108:89
    |
107 |     if size_gb > config.get('max_gb', 4.0) or height > config.get('max_res', 1080):
108 |         logging.warning(f"Limits exceeded: {size_gb}GB > {config.get('max_gb')}, {height}p > {config.get('max_res')}")
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
109 |         return None
    |

E501 Line too long (89 > 88)
   --> scripts/share_engine.py:124:89
    |
122 |         logging.info(f"Starting remux to {video_share_name}")
123 |         if remux_subtitles(src, subtitles, video_dest_path):
124 |             return {"video": f"{current_base_url}/{video_share_name}", "type": "remuxed"}
    |                                                                                         ^
125 |         logging.error("Remux failed")
    |

E501 Line too long (100 > 88)
   --> scripts/share_engine.py:138:89
    |
136 |         return None
137 |
138 |     result = {"video": f"{current_base_url}/{video_share_name}", "subtitles": [], "type": "symlink"}
    |                                                                                         ^^^^^^^^^^^^
139 |     for sub in subtitles:
140 |         sub_share_name = f"{unique_hash}_{sub.name}"
    |

E501 Line too long (146 > 88)
  --> scripts/storage_skill.py:13:88
   |
11 | ‚Ä¶ {category} introuvable."
12 | ‚Ä¶tartswith('.')]
13 | ‚Ä¶\n".join([f"‚Ä¢ {i}" for i in sorted(items)]) if items else f"üìÇ Aucun contenu dans {category}."
   |                                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 | ‚Ä¶
15 | ‚Ä¶
   |

E501 Line too long (101 > 88)
  --> scripts/storage_skill.py:19:89
   |
17 |     for name, path in [("üöÄ NVMe", "/"), ("üìö HDD", HDD_BASE)]:
18 |         usage = shutil.disk_usage(path)
19 |         report += f"{name} : {(usage.used/usage.total)*100:.1f}% ({usage.free//(2**30)} Go libres)\n"
   |                                                                                         ^^^^^^^^^^^^^
20 |     return report
   |

E501 Line too long (93 > 88)
 --> scripts/test_api.py:5:89
  |
3 | RADARR_API_KEY = "75ed9e2e3922442c8c1e012e47bc0906"
4 | try:
5 |     r = requests.get(f"{RADARR_URL}/movie", headers={"X-Api-Key": RADARR_API_KEY}, timeout=5)
  |                                                                                         ^^^^^
6 |     data = r.json()
7 |     owned = [f for f in data if f.get('hasFile') is True]
  |

E501 Line too long (94 > 88)
  --> scripts/test_api.py:8:89
   |
 6 |     data = r.json()
 7 |     owned = [f for f in data if f.get('hasFile') is True]
 8 |     print(f"Test Radarr : {len(data)} films au total, {len(owned)} poss√©d√©s (hasFile: True).")
   |                                                                                         ^^^^^^
 9 | except Exception as e:
10 |     print(f"Erreur Test API : {e}")
   |

E501 Line too long (113 > 88)
 --> scripts/test_search.py:6:89
  |
4 | try:
5 |     query = "Inception"
6 |     r = requests.get(f"{RADARR_URL}/movie/lookup?term={query}", headers={"X-Api-Key": RADARR_API_KEY}, timeout=5)
  |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
7 |     r.raise_for_status()
8 |     results = r.json()
  |

E501 Line too long (114 > 88)
  --> scripts/tests/test_admin.py:41:89
   |
40 |     # Mock disk_usage
41 |     mocker.patch('shutil.disk_usage', return_value=MagicMock(total=100*1024**3, used=50*1024**3, free=50*1024**3))
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^
42 |     mocker.patch('os.path.exists', return_value=True)
   |

E501 Line too long (97 > 88)
   --> scripts/tests/test_admin.py:131:89
    |
130 |     # We need to find the process_user_add function. 
131 |     # It's local to register_admin_handlers, but we can capture it via register_next_step_handler
    |                                                                                         ^^^^^^^^^
132 |     
133 |     # Simulate triggering the callback that registers the next step
    |

E501 Line too long (90 > 88)
  --> scripts/tests/test_cleanup.py:64:89
   |
62 |     import cleanup_share
63 |     # 20% used, target is 50%
64 |     mocker.patch('shutil.disk_usage', return_value=MagicMock(total=100, used=20, free=80))
   |                                                                                         ^^
65 |     mocker.patch('cleanup_share.is_hdd_mounted', return_value=True)
   |

E501 Line too long (93 > 88)
  --> scripts/tests/test_cleanup.py:96:89
   |
95 |     # Mock os.walk to find a movie
96 |     mocker.patch('os.walk', return_value=[('/tmp/nvme/Movies/Titanic', [], ['titanic.mkv'])])
   |                                                                                         ^^^^^
97 |     mocker.patch('os.path.islink', return_value=False)
98 |     # st_atime=100 (old), size=40
   |

E501 Line too long (116 > 88)
   --> scripts/tests/test_cleanup.py:109:89
    |
107 |     # Path translation: rel_path should be 'Movies/Titanic/titanic.mkv'
108 |     # dest_path should be '/tmp/hdd/Movies/Titanic/titanic.mkv'
109 |     mock_move.assert_called_once_with('/tmp/nvme/Movies/Titanic/titanic.mkv', '/tmp/hdd/Movies/Titanic/titanic.mkv')
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
110 |     mock_symlink.assert_called_once_with('/tmp/hdd/Movies/Titanic/titanic.mkv', '/tmp/nvme/Movies/Titanic/titanic.mkv')
111 |     mock_makedirs.assert_called_once_with('/tmp/hdd/Movies/Titanic', exist_ok=True)
    |

E501 Line too long (119 > 88)
   --> scripts/tests/test_cleanup.py:110:89
    |
108 |     # dest_path should be '/tmp/hdd/Movies/Titanic/titanic.mkv'
109 |     mock_move.assert_called_once_with('/tmp/nvme/Movies/Titanic/titanic.mkv', '/tmp/hdd/Movies/Titanic/titanic.mkv')
110 |     mock_symlink.assert_called_once_with('/tmp/hdd/Movies/Titanic/titanic.mkv', '/tmp/nvme/Movies/Titanic/titanic.mkv')
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
111 |     mock_makedirs.assert_called_once_with('/tmp/hdd/Movies/Titanic', exist_ok=True)
    |

E501 Line too long (90 > 88)
   --> scripts/tests/test_cleanup.py:115:89
    |
113 | def test_auto_tiering_rollback_on_failure(mock_paths, mocker):
114 |     import cleanup_share
115 |     mocker.patch('shutil.disk_usage', return_value=MagicMock(total=100, used=80, free=20))
    |                                                                                         ^^
116 |     mocker.patch('cleanup_share.is_hdd_mounted', return_value=True)
117 |     mocker.patch('os.walk', return_value=[('/tmp/nvme/Movies', [], ['fail.mkv'])])
    |

E501 Line too long (89 > 88)
   --> scripts/tests/test_cleanup.py:127:89
    |
126 |     # Rollback mocks
127 |     mocker.patch('os.path.exists', side_effect=lambda p: p == '/tmp/hdd/Movies/fail.mkv')
    |                                                                                         ^
128 |     mock_rollback_move = mocker.patch('shutil.move') # Will be called again for rollback
    |

E501 Line too long (100 > 88)
   --> scripts/tests/test_cleanup.py:138:89
    |
136 |     import cleanup_share
137 |     # Mock existence des dossiers HDD
138 |     mocker.patch('os.path.exists', side_effect=lambda p: p in ['/tmp/hdd/Films', '/tmp/hdd/Series'])
    |                                                                                         ^^^^^^^^^^^^
139 |     mocker.patch('os.makedirs')
    |

E501 Line too long (97 > 88)
   --> scripts/tests/test_cleanup.py:142:89
    |
141 |     # Mock contenu du HDD (un film pr√©sent)
142 |     mocker.patch('os.listdir', side_effect=lambda p: ['Zootopia_2_2025'] if 'Films' in p else [])
    |                                                                                         ^^^^^^^^^
143 |     
144 |     # Simuler que le lien NVMe n'existe PAS
    |

E501 Line too long (93 > 88)
  --> scripts/tests/test_config.py:14:89
   |
12 |         # Telegram token format: bot_id:alphanumeric_string (approx 45-50 chars total)
13 |         token_pattern = r"^\d+:[a-zA-Z0-9_-]{35,}$"
14 |         assert re.match(token_pattern, config.TOKEN), f"Token format invalid: {config.TOKEN}"
   |                                                                                         ^^^^^
15 |     
16 |     assert hasattr(config, "SUPER_ADMIN")
   |

E712 Avoid equality comparisons to `True`; use `config.is_authorized(config.SUPER_ADMIN):` for truth checks
  --> scripts/tests/test_config.py:31:12
   |
29 | def test_is_authorized_super_admin():
30 |     import config
31 |     assert config.is_authorized(config.SUPER_ADMIN) == True
   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Replace with `config.is_authorized(config.SUPER_ADMIN)`

E501 Line too long (90 > 88)
  --> scripts/tests/test_library.py:63:89
   |
61 |     movies_res.json.return_value = [
62 |         {'title': 'Movie 1', 'year': 2021, 'subtitles': [{'language': 'fr'}]},
63 |         {'title': 'Movie 2', 'year': 2022, 'subtitles': [{'language': 'en'}]} # Missing FR
   |                                                                                         ^^
64 |     ]
   |

E501 Line too long (95 > 88)
  --> scripts/tests/test_library.py:73:89
   |
71 |     episodes_res = MagicMock()
72 |     episodes_res.json.return_value = [
73 |         {'seasonNumber': 1, 'episodeNumber': 1, 'subtitles': [{'language': 'en'}]} # Missing FR
   |                                                                                         ^^^^^^^
74 |     ]
   |

E501 Line too long (103 > 88)
  --> scripts/tests/test_managers.py:12:89
   |
10 | def test_clean_media_name():
11 |     import media_manager
12 |     assert media_manager.clean_media_name("Inception.2010.1080p.BluRay.x264.mkv") == "Inception (2010)"
   |                                                                                         ^^^^^^^^^^^^^^^
13 |     assert media_manager.clean_media_name("The.Boys.S01E01.720p.WEB-DL.mkv") == "The Boys"
14 |     assert media_manager.clean_media_name("Avatar.The.Way.Of.Water.2160p.4k.HEVC.mkv") == "Avatar The Way Of Water"
   |

E501 Line too long (90 > 88)
  --> scripts/tests/test_managers.py:13:89
   |
11 |     import media_manager
12 |     assert media_manager.clean_media_name("Inception.2010.1080p.BluRay.x264.mkv") == "Inception (2010)"
13 |     assert media_manager.clean_media_name("The.Boys.S01E01.720p.WEB-DL.mkv") == "The Boys"
   |                                                                                         ^^
14 |     assert media_manager.clean_media_name("Avatar.The.Way.Of.Water.2160p.4k.HEVC.mkv") == "Avatar The Way Of Water"
   |

E501 Line too long (115 > 88)
  --> scripts/tests/test_managers.py:14:89
   |
12 |     assert media_manager.clean_media_name("Inception.2010.1080p.BluRay.x264.mkv") == "Inception (2010)"
13 |     assert media_manager.clean_media_name("The.Boys.S01E01.720p.WEB-DL.mkv") == "The Boys"
14 |     assert media_manager.clean_media_name("Avatar.The.Way.Of.Water.2160p.4k.HEVC.mkv") == "Avatar The Way Of Water"
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
15 |
16 | def test_get_size_file(tmp_path):
   |

E501 Line too long (111 > 88)
  --> scripts/tests/test_managers.py:31:89
   |
29 |     f2.write_text("def")
30 |     # Note: media_manager.get_size uses os.walk(p) for r, d, f in os.walk(p) for f in fs
31 |     # Actually the code has: sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
32 |     # Wait, the code I read was: sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
33 |     # Actually it should be os.path.join(r, f). Let's check that.
   |

E501 Line too long (115 > 88)
  --> scripts/tests/test_managers.py:32:89
   |
30 |     # Note: media_manager.get_size uses os.walk(p) for r, d, f in os.walk(p) for f in fs
31 |     # Actually the code has: sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
32 |     # Wait, the code I read was: sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^
33 |     # Actually it should be os.path.join(r, f). Let's check that.
34 |     assert media_manager.get_size(str(d)) == 6
   |

E501 Line too long (98 > 88)
  --> scripts/tests/test_managers.py:39:89
   |
37 |     import media_manager
38 |     mocker.patch('os.path.exists', return_value=True)
39 |     mocker.patch('os.listdir', side_effect=lambda p: ['Titanic.1997.mkv'] if 'Films' in p else [])
   |                                                                                         ^^^^^^^^^^
40 |     mocker.patch('media_manager.get_size', return_value=2*1024**3)
   |

E501 Line too long (111 > 88)
  --> scripts/tests/test_media.py:83:89
   |
82 |     # Mock data with 25 items
83 |     mock_data = [{"id": i, "title": f"Movie {i}", "added": f"2023-01-{i:02d}T12:00:00Z"} for i in range(1, 26)]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
84 |     # Items 1-10 (page 0), 11-20 (page 1), 21-25 (page 2)
85 |     # Sorted reverse added -> Movie 25, 24, ..., 1
   |

E501 Line too long (111 > 88)
   --> scripts/tests/test_media.py:155:89
    |
154 |     # Mock API with pagination data
155 |     mock_data = [{"id": i, "title": f"Movie {i}", "added": f"2023-01-{i:02d}T12:00:00Z"} for i in range(1, 26)]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
156 |     mock_response = MagicMock()
157 |     mock_response.json.return_value = mock_data
    |

E501 Line too long (113 > 88)
  --> scripts/tests/test_search.py:67:89
   |
66 |     # Mock Radarr lookup API
67 |     mock_results = [{"title": "Titanic", "year": 1997, "titleSlug": "titanic-1997", "tmdbId": 597, "images": []}]
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^
68 |     mock_response = MagicMock()
69 |     mock_response.json.return_value = mock_results
   |

E501 Line too long (108 > 88)
  --> scripts/tests/test_search.py:90:89
   |
88 | def test_process_get_request_no_results(mock_bot, mocker):
89 |     import handlers_search
90 |     mocker.patch('handlers_search.stream_gpt_json', return_value='{"titre": "Nonexistent", "type": "film"}')
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^
91 |     
92 |     mock_response = MagicMock()
   |

E501 Line too long (126 > 88)
   --> scripts/tests/test_search.py:113:89
    |
111 |         "456_search": {
112 |             "cat": "movie",
113 |             "results": [{"title": "Titanic", "year": 1997, "titleSlug": "titanic-1997", "tmdbId": 597, "images": [], "id": 0}]
    |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |         }
115 |     }
    |

E501 Line too long (111 > 88)
  --> scripts/tests/test_share.py:45:89
   |
43 |     mocker.patch('share_engine.CONFIG_FILE', str(mock_config_file))
44 |     mocker.patch('share_engine.SHARE_DIR', str(share_dir))
45 |     mocker.patch('share_engine.DOCKER_MODE', True) # Set to True to skip path translation logic for simple test
   |                                                                                         ^^^^^^^^^^^^^^^^^^^^^^^
46 |     
47 |     # Create source
   |

E501 Line too long (92 > 88)
  --> scripts/tests/test_share.py:60:89
   |
58 |     assert result['type'] == 'symlink'
59 |
60 | def test_generate_secure_link_limit_exceeded(mock_config_file, share_dir, tmp_path, mocker):
   |                                                                                         ^^^^
61 |     import share_engine
62 |     mocker.patch('share_engine.CONFIG_FILE', str(mock_config_file))
   |

Found 863 errors.
No fixes available (1 hidden fix can be enabled with the `--unsafe-fixes` option).
Exit Code: 1
Process Group PGID: 321277