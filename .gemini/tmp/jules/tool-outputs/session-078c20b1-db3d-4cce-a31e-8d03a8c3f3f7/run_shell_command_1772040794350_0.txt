Output: Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Collecting ruff
  Downloading ruff-0.15.2-py3-none-manylinux_2_17_aarch64.manylinux2014_aarch64.whl (10.5 MB)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 10.5/10.5 MB 71.0 MB/s eta 0:00:00
Collecting bandit
  Downloading bandit-1.9.4-py3-none-any.whl (134 kB)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 134.7/134.7 kB 19.0 MB/s eta 0:00:00
Collecting PyYAML>=5.3.1
  Downloading pyyaml-6.0.3-cp311-cp311-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl (775 kB)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 775.6/775.6 kB 71.7 MB/s eta 0:00:00
Collecting stevedore>=1.20.0
  Downloading stevedore-5.7.0-py3-none-any.whl (54 kB)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 54.5/54.5 kB 7.9 MB/s eta 0:00:00
Collecting rich
  Downloading rich-14.3.3-py3-none-any.whl (310 kB)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 310.5/310.5 kB 42.1 MB/s eta 0:00:00
Collecting markdown-it-py>=2.2.0
  Downloading https://www.piwheels.org/simple/markdown-it-py/markdown_it_py-4.0.0-py3-none-any.whl (87 kB)
     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 87.3/87.3 kB 1.6 MB/s eta 0:00:00
Requirement already satisfied: pygments<3.0.0,>=2.13.0 in ./scripts/venv/lib/python3.11/site-packages (from rich->bandit) (2.19.2)
Collecting mdurl~=0.1
  Downloading https://www.piwheels.org/simple/mdurl/mdurl-0.1.2-py3-none-any.whl (10.0 kB)
Installing collected packages: stevedore, ruff, PyYAML, mdurl, markdown-it-py, rich, bandit
Successfully installed PyYAML-6.0.3 bandit-1.9.4 markdown-it-py-4.0.0 mdurl-0.1.2 rich-14.3.3 ruff-0.15.2 stevedore-5.7.0
F401 [*] `asyncio` imported but unused
 --> infra/ai/app/main.py:1:8
  |
1 | import asyncio
  |        ^^^^^^^
2 | import logging
3 | import os
  |
help: Remove unused import: `asyncio`

E701 Multiple statements on one line (colon)
  --> infra/ai/app/main.py:58:16
   |
56 | # --- UTILS ---
57 | def get_first_sentences(text, n=2):
58 |     if not text: return "Pas de rÃ©sumÃ© disponible."
   |                ^
59 |     sentences = re.split(r'(?<=[.!?])\s+', text)
60 |     return " ".join(sentences[:n])
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/app/main.py:86:68
   |
84 |                 def score(item):
85 |                     s = 0
86 |                     if item['title'].lower() == clean_query.lower(): s += 100
   |                                                                    ^
87 |                     if target_year and item.get('year') == target_year: s += 50
88 |                     return s
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/app/main.py:87:71
   |
85 |                     s = 0
86 |                     if item['title'].lower() == clean_query.lower(): s += 100
87 |                     if target_year and item.get('year') == target_year: s += 50
   |                                                                       ^
88 |                     return s
   |

F401 [*] `pathlib.Path` imported but unused
 --> infra/ai/maintenance/cleanup_share.py:5:21
  |
3 | import time
4 | import logging
5 | from pathlib import Path
  |                     ^^^^
6 |
7 | # --- CONFIGURATION GLOBALE ---
  |
help: Remove unused import: `pathlib.Path`

F541 [*] f-string without any placeholders
   --> infra/ai/maintenance/cleanup_share.py:113:26
    |
111 |             # CrÃ©ation du symlink pour tromper Sonarr/Radarr
112 |             os.symlink(dest_path, file_path)
113 |             logging.info(f"Migration rÃ©ussie : Symlink crÃ©Ã© sur le NVMe.")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
114 |             
115 |         except Exception as e:
    |
help: Remove extraneous `f` prefix

E722 Do not use bare `except`
   --> infra/ai/maintenance/cleanup_share.py:122:18
    |
120 |                      shutil.move(dest_path, file_path)
121 |                      logging.info(f"Rollback rÃ©ussi pour {file_path}")
122 |                  except:
    |                  ^^^^^^
123 |                      pass
    |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/config.py:1:1
  |
1 | import json, os
  | ^^^^^^^^^^^^^^^
2 |
3 | DOCKER_MODE = os.environ.get("DOCKER_MODE", "false") == "true"
  |
help: Split imports

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/config.py:21:26
   |
20 | def is_authorized(uid):
21 |     if uid == SUPER_ADMIN: return True
   |                          ^
22 |     try:
23 |         with open(USERS_FILE, 'r') as f:
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/config.py:25:5
   |
23 |         with open(USERS_FILE, 'r') as f:
24 |             return uid in json.load(f)["allowed"]
25 |     except: return False
   |     ^^^^^^
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/config.py:25:11
   |
23 |         with open(USERS_FILE, 'r') as f:
24 |             return uid in json.load(f)["allowed"]
25 |     except: return False
   |           ^
   |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/handlers_admin.py:1:1
  |
1 | import telebot, os, shutil, json, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Split imports

F401 [*] `telebot` imported but unused
 --> infra/ai/maintenance/handlers_admin.py:1:8
  |
1 | import telebot, os, shutil, json, logging
  |        ^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Remove unused import

F401 [*] `logging` imported but unused
 --> infra/ai/maintenance/handlers_admin.py:1:35
  |
1 | import telebot, os, shutil, json, logging
  |                                   ^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Remove unused import

F403 `from config import *` used; unable to detect undefined names
 --> infra/ai/maintenance/handlers_admin.py:3:1
  |
1 | import telebot, os, shutil, json, logging
2 | from telebot import types
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 |
5 | def save_users(users):
  |

F405 `USERS_FILE` may be undefined, or defined from star imports
 --> infra/ai/maintenance/handlers_admin.py:6:15
  |
5 | def save_users(users):
6 |     with open(USERS_FILE, "w") as f:
  |               ^^^^^^^^^^
7 |         json.dump({"allowed": users}, f)
  |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:12:45
   |
10 |     @bot.message_handler(commands=['status'])
11 |     def status_cmd(m):
12 |         if not is_authorized(m.from_user.id): return
   |                                             ^
13 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
14 |         try:
   |

E731 Do not assign a `lambda` expression, use a `def`
  --> infra/ai/maintenance/handlers_admin.py:13:9
   |
11 |     def status_cmd(m):
12 |         if not is_authorized(m.from_user.id): return
13 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 |         try:
15 |             nvme = shutil.disk_usage('/')
   |
help: Rewrite `fmt` as a `def`

F541 [*] f-string without any placeholders
  --> infra/ai/maintenance/handlers_admin.py:21:24
   |
19 |                 msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
20 |             else:
21 |                 msg += f"\nâš ï¸ **HDD** : `Non dÃ©tectÃ© sur /mnt/externe`"
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |             bot.reply_to(m, msg, parse_mode='Markdown')
23 |         except Exception as e:
   |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:28:45
   |
26 |     @bot.message_handler(commands=['admin'])
27 |     def admin_menu(m):
28 |         if not is_authorized(m.from_user.id): return
   |                                             ^
29 |         markup = types.InlineKeyboardMarkup(row_width=1)
30 |         markup.add(types.InlineKeyboardButton("ğŸ“‚ Partage", callback_data="adm:share"),
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_admin.py:39:23
   |
37 |         try:
38 |             uid = int(m.text)
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:39:44
   |
37 |         try:
38 |             uid = int(m.text)
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_admin.py:41:34
   |
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |                                  ^
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:43:17
   |
41 |                 users.append(uid); save_users(users)
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |                 ^
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_admin.py:44:9
   |
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |         ^^^^^^
45 |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:44:15
   |
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |               ^
45 |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:48:48
   |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
47 |     def admin_callback_router(call):
48 |         if not is_authorized(call.from_user.id): return
   |                                                ^
49 |         d = call.data.split(":")
50 |         cmd = d[1]
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_admin.py:65:23
   |
63 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
64 | â€¦     elif cmd == "users_list":
65 | â€¦         with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                     ^^^^^^^^^^
66 | â€¦         text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
67 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=types.InlineKeyboardMarkup().add(typâ€¦
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:65:44
   |
63 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
64 | â€¦     elif cmd == "users_list":
65 | â€¦         with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                          ^
66 | â€¦         text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
67 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=types.InlineKeyboardMarkup().add(typâ€¦
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_admin.py:72:23
   |
70 |             bot.register_next_step_handler(msg, process_user_add)
71 |         elif cmd == "users_rev":
72 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:72:44
   |
70 |             bot.register_next_step_handler(msg, process_user_add)
71 |         elif cmd == "users_rev":
72 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
   |

F405 `SUPER_ADMIN` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_admin.py:75:25
   |
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
75 |                 if u == SUPER_ADMIN: continue
   |                         ^^^^^^^^^^^
76 |                 markup.add(types.InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
77 |             markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:75:36
   |
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
75 |                 if u == SUPER_ADMIN: continue
   |                                    ^
76 |                 markup.add(types.InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
77 |             markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_admin.py:81:23
   |
79 |         elif cmd == "users_del":
80 |             uid = int(d[2])
81 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
82 |             if uid in users:
83 |                 users.remove(uid)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_admin.py:81:44
   |
79 |         elif cmd == "users_del":
80 |             uid = int(d[2])
81 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
82 |             if uid in users:
83 |                 users.remove(uid)
   |

F541 [*] f-string without any placeholders
  --> infra/ai/maintenance/handlers_admin.py:85:52
   |
83 | â€¦             users.remove(uid)
84 | â€¦             save_users(users)
85 | â€¦             bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
   |                                                  ^^^^^^^^^^^^^^
86 | â€¦         admin_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chatâ€¦
87 | â€¦     elif cmd == "share_owned":
   |
help: Remove extraneous `f` prefix

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/handlers_media.py:1:1
  |
1 | import requests, logging, os, json, subprocess, re, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import timedelta
3 | from telebot import types
  |
help: Split imports

F401 [*] `logging` imported but unused
 --> infra/ai/maintenance/handlers_media.py:1:18
  |
1 | import requests, logging, os, json, subprocess, re, pathlib
  |                  ^^^^^^^
2 | from datetime import timedelta
3 | from telebot import types
  |
help: Remove unused import: `logging`

F403 `from config import *` used; unable to detect undefined names
 --> infra/ai/maintenance/handlers_media.py:4:1
  |
2 | from datetime import timedelta
3 | from telebot import types
4 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
5 | import share_engine
  |

F405 `SCRIPT_PATH` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_media.py:14:38
   |
13 | def list_media_unified(bot, m, cat, title, is_edit=False):
14 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                      ^^^^^^^^^^^
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_media.py:16:39
   |
14 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
   |                                       ^
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_media.py:17:27
   |
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
   |                           ^^^^^^^^^^^^
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:18:16
   |
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_media.py:18:39
   |
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                                       ^^^^^^^^^^^^
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_media.py:19:13
   |
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |             ^^^^^^
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:19:19
   |
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |                   ^
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_media.py:21:19
   |
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                   ^^^^^^^^^^^^
22 |     except: return
23 |     if not items:
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:21:42
   |
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
22 |     except: return
23 |     if not items:
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_media.py:22:5
   |
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
22 |     except: return
   |     ^^^^^^
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:22:11
   |
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
22 |     except: return
   |           ^
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:25:19
   |
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
25 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
   |                   ^
26 |         else: bot.send_message(m.chat.id, msg)
27 |         return
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:26:13
   |
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
25 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
26 |         else: bot.send_message(m.chat.id, msg)
   |             ^
27 |         return
28 |     text = f"{title} : {cat}\n\n"
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:29:36
   |
27 |         return
28 |     text = f"{title} : {cat}\n\n"
29 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
   |                                    ^
30 |     markup = types.InlineKeyboardMarkup(row_width=5)
31 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:33:15
   |
31 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
32 |     markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
33 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |               ^
34 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:34:9
   |
32 |     markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
33 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
34 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |         ^
35 |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_media.py:37:11
   |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
37 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
   |           ^^^^^^^^^^
38 |     endpoint = "movie" if category == "films" else "series"
39 |     try:
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_media.py:37:50
   |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
37 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
   |                                                  ^^^^^^^^^^
38 |     endpoint = "movie" if category == "films" else "series"
39 |     try:
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_media.py:41:29
   |
39 |     try:
40 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
41 |         r.raise_for_status(); data = r.json()
   |                             ^
42 |         data.sort(key=lambda x: x.get('added', ''), reverse=True)
43 |         total = len(data)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:46:21
   |
44 |         start, end = page * 10, (page + 1) * 10
45 |         items = data[start:end]
46 |         if not items: bot.send_message(chat_id, "Vide."); return
   |                     ^
47 |         text = f"**{category.capitalize()} ({total})**\n\n"
48 |         for i, item in enumerate(items, 1):
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_media.py:46:57
   |
44 |         start, end = page * 10, (page + 1) * 10
45 |         items = data[start:end]
46 |         if not items: bot.send_message(chat_id, "Vide."); return
   |                                                         ^
47 |         text = f"**{category.capitalize()} ({total})**\n\n"
48 |         for i, item in enumerate(items, 1):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:55:20
   |
53 |         markup.add(*btns)
54 |         nav_row = []
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
   |                    ^
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
57 |         if nav_row: markup.row(*nav_row)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:56:23
   |
54 |         nav_row = []
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
   |                       ^
57 |         if nav_row: markup.row(*nav_row)
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:57:19
   |
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
57 |         if nav_row: markup.row(*nav_row)
   |                   ^
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:59:18
   |
57 |         if nav_row: markup.row(*nav_row)
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |                  ^
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:60:13
   |
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |             ^
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:61:26
   |
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |                          ^
62 |
63 | def register_media_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:66:36
   |
64 |     @bot.message_handler(commands=['films'])
65 |     def films_cmd(m):
66 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "films", 0, True, is_authorized)
   |                                    ^
67 |
68 |     @bot.message_handler(commands=['series'])
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:70:36
   |
68 |     @bot.message_handler(commands=['series'])
69 |     def series_cmd(m):
70 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "series", 0, True, is_authorized)
   |                                    ^
71 |
72 |     @bot.message_handler(commands=['queue'])
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:74:40
   |
72 |     @bot.message_handler(commands=['queue'])
73 |     def queue_command(m):
74 |         if not is_authorized(m.chat.id): return
   |                                        ^
75 |         def clean_title(name):
76 |             name = os.path.splitext(name)[0]
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:83:28
   |
81 | â€¦         tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b'â€¦
82 | â€¦         clean = f"{title} ({year})" if year else title
83 | â€¦         for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
   |                          ^
84 | â€¦         return re.sub(r'\s+', ' ', clean).strip()
85 | â€¦     try:
   |

F405 `QBIT_URL` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_media.py:86:33
   |
84 |             return re.sub(r'\s+', ' ', clean).strip()
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                 ^^^^^^^^
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_media.py:86:76
   |
84 |             return re.sub(r'\s+', ' ', clean).strip()
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                                                            ^
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:87:28
   |
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
   |                            ^
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
89 |             for t in torrents:
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_media.py:87:62
   |
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
   |                                                              ^
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
89 |             for t in torrents:
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_media.py:96:9
   |
94 |                     q_text += f"â€¢ **{clean_name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB | â³ {eta}  â€¦
95 |             bot.reply_to(m, q_text, parse_mode='Markdown')
96 |         except: bot.reply_to(m, "âŒ Erreur qBit.")
   |         ^^^^^^
97 |
98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_â€¦
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_media.py:96:15
   |
94 |                     q_text += f"â€¢ **{clean_name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB | â³ {eta}  â€¦
95 |             bot.reply_to(m, q_text, parse_mode='Markdown')
96 |         except: bot.reply_to(m, "âŒ Erreur qBit.")
   |               ^
97 |
98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_â€¦
   |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:100:48
    |
 98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "shareâ€¦
 99 |     def media_callback_router(call):
100 |         if not is_authorized(call.from_user.id): return
    |                                                ^
101 |         d = call.data.split(":")
    |

F405 `RADARR_CFG` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:107:19
    |
105 |         elif d[0] == "m_sel":
106 |             cat, item_id = d[1], d[2]
107 |             cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                   ^^^^^^^^^^
108 |             endpoint = "movie" if cat == "films" else "series"
109 |             display_title = f"ID {item_id}"
    |

F405 `SONARR_CFG` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:107:53
    |
105 |         elif d[0] == "m_sel":
106 |             cat, item_id = d[1], d[2]
107 |             cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                                                     ^^^^^^^^^^
108 |             endpoint = "movie" if cat == "films" else "series"
109 |             display_title = f"ID {item_id}"
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:112:40
    |
110 |             try:
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
    |                                        ^
113 |             except: pass
114 |             markup = types.InlineKeyboardMarkup()
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/handlers_media.py:113:13
    |
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
113 |             except: pass
    |             ^^^^^^
114 |             markup = types.InlineKeyboardMarkup()
115 |             markup.add(types.InlineKeyboardButton("ğŸ—‘ï¸ Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:113:19
    |
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
113 |             except: pass
    |                   ^
114 |             markup = types.InlineKeyboardMarkup()
115 |             markup.add(types.InlineKeyboardButton("ğŸ—‘ï¸ Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |

F405 `RADARR_CFG` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:123:23
    |
121 |             if action == "share":
122 |                 bot.answer_callback_query(call.id, "â³ GÃ©nÃ©ration du lien...")
123 |                 cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                       ^^^^^^^^^^
124 |                 endpoint = "movie" if cat == "films" else "series"
125 |                 try:
    |

F405 `SONARR_CFG` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:123:57
    |
121 |             if action == "share":
122 |                 bot.answer_callback_query(call.id, "â³ GÃ©nÃ©ration du lien...")
123 |                 cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                                                         ^^^^^^^^^^
124 |                 endpoint = "movie" if cat == "films" else "series"
125 |                 try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:134:33
    |
132 |                                 msg = f"âœ… **Lien de partage gÃ©nÃ©rÃ© :**\n\nğŸ”— `{data['video']}`"
133 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
    |                                 ^
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:135:29
    |
133 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
    |                             ^
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/handlers_media.py:136:17
    |
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |                 ^^^^^^
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:136:23
    |
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |                       ^
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:137:17
    |
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |                 ^
138 |
139 |         elif d[0] == "sel":
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:141:27
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                           ^^^^^^^^^^^^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:141:50
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                  ^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/handlers_media.py:141:70
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                      ^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

F405 `SUPER_ADMIN` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:145:41
    |
143 | â€¦     act = "arc" if item['is_nvme'] else "res"
144 | â€¦     markup.add(types.InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("ğŸ—‘â€¦
145 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                               ^^^^^^^^^^^
146 | â€¦     markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:145:52
    |
143 | â€¦     act = "arc" if item['is_nvme'] else "res"
144 | â€¦     markup.add(types.InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("ğŸ—‘â€¦
145 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                                          ^
146 | â€¦     markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/handlers_media.py:148:13
    |
146 |                 markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 |                 bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
148 |             except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |             ^^^^^^
149 |         elif d[0] == "act":
150 |             try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:148:19
    |
146 |                 markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 |                 bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
148 |             except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |                   ^
149 |         elif d[0] == "act":
150 |             try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:151:27
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                           ^^^^^^^^^^^^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:151:50
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                  ^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/handlers_media.py:151:70
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                      ^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

F405 `SCRIPT_PATH` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:152:50
    |
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                  ^^^^^^^^^^^
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/handlers_media.py:154:13
    |
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |             ^^^^^^
155 |         elif d[0] == "share_exec":
156 |             try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:154:19
    |
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |                   ^
155 |         elif d[0] == "share_exec":
156 |             try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:157:27
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                           ^^^^^^^^^^^^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:157:50
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                  ^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/handlers_media.py:157:70
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                      ^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/handlers_media.py:158:49
    |
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                 ^
159 |                 if subtitles:
160 |                     markup = types.InlineKeyboardMarkup(row_width=1)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:163:21
    |
161 | â€¦                 markup.add(types.InlineKeyboardButton("âš¡ Symlink", callback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardBâ€¦
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
    |                   ^
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
165 | â€¦     elif d[0] == "share_final":
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/handlers_media.py:164:13
    |
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |           ^^^^^^
165 | â€¦     elif d[0] == "share_final":
166 | â€¦         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:164:19
    |
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |                 ^
165 | â€¦     elif d[0] == "share_final":
166 | â€¦         try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/ai/maintenance/handlers_media.py:167:27
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                           ^^^^^^^^^^^^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:167:50
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                  ^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/handlers_media.py:167:70
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                      ^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:171:44
    |
169 | â€¦         bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
170 | â€¦         data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
171 | â€¦         if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", parse â€¦
    |                                      ^
172 | â€¦         else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦     except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:172:21
    |
170 | â€¦             data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
    |                   ^
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/handlers_media.py:173:13
    |
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |           ^^^^^^
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:173:19
    |
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |                 ^
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/handlers_media.py:174:30
    |
172 |                 else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 |             except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
174 |         elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                              ^
    |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/handlers_search.py:1:1
  |
1 | import telebot, json, requests, re, logging, os
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  |
help: Split imports

F401 [*] `telebot` imported but unused
 --> infra/ai/maintenance/handlers_search.py:1:8
  |
1 | import telebot, json, requests, re, logging, os
  |        ^^^^^^^
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  |
help: Remove unused import: `telebot`

F403 `from config import *` used; unable to detect undefined names
 --> infra/ai/maintenance/handlers_search.py:3:1
  |
1 | import telebot, json, requests, re, logging, os
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 |
5 | def stream_gpt_json(query):
  |

F405 `OPENAI_KEY` may be undefined, or defined from star imports
 --> infra/ai/maintenance/handlers_search.py:6:79
  |
5 | def stream_gpt_json(query):
6 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
  |                                                                               ^^^^^^^^^^
7 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
8 |     try:
  |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_search.py:11:5
   |
 9 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [â€¦
10 |         return res.json()['choices'][0]['message']['content']
11 |     except: return None
   |     ^^^^^^
12 |
13 | def register_search_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:11:11
   |
 9 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [â€¦
10 |         return res.json()['choices'][0]['message']['content']
11 |     except: return None
   |           ^
12 |
13 | def register_search_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:16:45
   |
14 |     @bot.message_handler(commands=['get'])
15 |     def handle_get(m):
16 |         if not is_authorized(m.from_user.id): return
   |                                             ^
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:18:26
   |
16 |         if not is_authorized(m.from_user.id): return
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
   |                          ^
19 |         else: bot.reply_to(m, "ğŸ¬ Que veux-tu ? (Ex: /get Titanic)")
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:19:13
   |
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
19 |         else: bot.reply_to(m, "ğŸ¬ Que veux-tu ? (Ex: /get Titanic)")
   |             ^
20 |
21 |     @bot.message_handler(func=lambda m: True)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:23:40
   |
21 |     @bot.message_handler(func=lambda m: True)
22 |     def handle_ai_request(m):
23 |         if not is_authorized(m.chat.id): return
   |                                        ^
24 |         if m.text.startswith('/'): return
25 |         process_get_request(bot, m, m.text)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:24:34
   |
22 |     def handle_ai_request(m):
23 |         if not is_authorized(m.chat.id): return
24 |         if m.text.startswith('/'): return
   |                                  ^
25 |         process_get_request(bot, m, m.text)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:29:48
   |
27 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("dl_sel:"))
28 |     def download_callback_handler(call):
29 |         if not is_authorized(call.from_user.id): return
   |                                                ^
30 |         d = call.data.split(":")
31 |         cat, idx = d[1], int(d[2])
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:33:23
   |
31 |         cat, idx = d[1], int(d[2])
32 |         try:
33 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
   |                       ^^^^^^^^^^^^
34 |             search_data = ctx.get(f"{call.message.chat.id}_search")
35 |             if not search_data:
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:33:46
   |
31 |         cat, idx = d[1], int(d[2])
32 |         try:
33 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
   |                                              ^
34 |             search_data = ctx.get(f"{call.message.chat.id}_search")
35 |             if not search_data:
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:40:19
   |
39 |             item = search_data['results'][idx]
40 |             cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                   ^^^^^^^^^^
41 |             endpoint = "movie" if cat == "movie" else "series"
42 |             id_key = "tmdbId" if cat == "movie" else "tvdbId"
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:40:53
   |
39 |             item = search_data['results'][idx]
40 |             cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                                                     ^^^^^^^^^^
41 |             endpoint = "movie" if cat == "movie" else "series"
42 |             id_key = "tmdbId" if cat == "movie" else "tvdbId"
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:54:31
   |
52 |             }
53 |             payload[id_key] = item[id_key]
54 |             if cat == "series": payload["languageProfileId"] = 1
   |                               ^
55 |
56 |             r = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_search.py:70:30
   |
68 |     try:
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
   |                              ^
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_search.py:71:5
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |     ^^^^^^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:71:11
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |           ^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_search.py:71:26
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |                          ^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:72:11
   |
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |           ^^^^^^^^^^
73 |     try:
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:72:45
   |
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                                             ^^^^^^^^^^
73 |     try:
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:76:23
   |
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
75 |         results = r.json()
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
   |                       ^
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/handlers_search.py:76:73
   |
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
75 |         results = r.json()
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
   |                                                                          ^
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:78:27
   |
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |                           ^^^^^^^^^^^^
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:79:16
   |
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:79:39
   |
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                                       ^^^^^^^^^^^^
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_search.py:80:13
   |
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |             ^^^^^^
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:80:19
   |
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |                   ^
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/ai/maintenance/handlers_search.py:82:19
   |
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                   ^^^^^^^^^^^^
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:82:42
   |
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:85:52
   |
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
85 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
   |                                                    ^
86 |         markup = InlineKeyboardMarkup()
87 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/handlers_search.py:90:5
   |
88 |         markup.add(*btns)
89 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
90 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
   |     ^^^^^^
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/handlers_search.py:90:11
   |
88 |         markup.add(*btns)
89 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
90 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
   |           ^
   |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/main.py:1:1
  |
1 | import telebot, threading, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from flask import Flask
3 | from config import *
  |
help: Split imports

F403 `from config import *` used; unable to detect undefined names
 --> infra/ai/maintenance/main.py:3:1
  |
1 | import telebot, threading, logging
2 | from flask import Flask
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 | from handlers_admin import register_admin_handlers
5 | from handlers_media import register_media_handlers
  |

F405 `TOKEN` may be undefined, or defined from star imports
  --> infra/ai/maintenance/main.py:9:23
   |
 8 | # --- CONFIGURATION PRINCIPALE ---
 9 | bot = telebot.TeleBot(TOKEN)
   |                       ^^^^^
10 |
11 | # --- FLASK SERVER ---
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> infra/ai/maintenance/main.py:30:34
   |
29 |     # 2. Register Modules
30 |     register_admin_handlers(bot, is_authorized)
   |                                  ^^^^^^^^^^^^^
31 |     register_media_handlers(bot, is_authorized)
32 |     register_search_handlers(bot, is_authorized)
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> infra/ai/maintenance/main.py:31:34
   |
29 |     # 2. Register Modules
30 |     register_admin_handlers(bot, is_authorized)
31 |     register_media_handlers(bot, is_authorized)
   |                                  ^^^^^^^^^^^^^
32 |     register_search_handlers(bot, is_authorized)
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> infra/ai/maintenance/main.py:32:35
   |
30 |     register_admin_handlers(bot, is_authorized)
31 |     register_media_handlers(bot, is_authorized)
32 |     register_search_handlers(bot, is_authorized)
   |                                   ^^^^^^^^^^^^^
33 |     
34 |     print("ğŸš€ Bot dÃ©marrÃ© en mode modulaire (Orchestrateur Clean)...")
   |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/media_manager.py:1:1
  |
1 | import os, shutil, sys, json, re, subprocess
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 |
3 | DOCKER_MODE = os.environ.get("DOCKER_MODE") == "true"
  |
help: Split imports

F401 [*] `subprocess` imported but unused
 --> infra/ai/maintenance/media_manager.py:1:35
  |
1 | import os, shutil, sys, json, re, subprocess
  |                                   ^^^^^^^^^^
2 |
3 | DOCKER_MODE = os.environ.get("DOCKER_MODE") == "true"
  |
help: Remove unused import: `subprocess`

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:21:20
   |
19 |     tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bâ€¦
20 |     clean = f"{title} ({year})" if year else title
21 |     for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
   |                    ^
22 |     return re.sub(r'\s+', ' ', clean).strip()
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:26:29
   |
24 | def get_size(p):
25 |     try:
26 |         if os.path.isfile(p): return os.path.getsize(p)
   |                             ^
27 |         return sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
28 |     except: return 0
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/media_manager.py:28:5
   |
26 |         if os.path.isfile(p): return os.path.getsize(p)
27 |         return sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
28 |     except: return 0
   |     ^^^^^^
29 |
30 | def find_local_media(query):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:28:11
   |
26 |         if os.path.isfile(p): return os.path.getsize(p)
27 |         return sum(os.path.getsize(os.path.join(r, d, f)) for r, d, fs in os.walk(p) for f in fs)
28 |     except: return 0
   |           ^
29 |
30 | def find_local_media(query):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:36:37
   |
34 |     for cat in PATHS:
35 |         for d, is_nvme in [(p, True) for p in PATHS[cat]["nvme"]] + [(PATHS[cat]["hdd"], False)]:
36 |             if not os.path.exists(d): continue
   |                                     ^
37 |             for item in os.listdir(d):
38 |                 if q in item.lower().replace(" ", "").replace(".", ""):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:53:16
   |
51 |     media = []
52 |     conf = PATHS.get(category)
53 |     if not conf: return []
   |                ^
54 |     for d, is_nvme in [(p, True) for p in conf["nvme"]] + [(conf["hdd"], False)]:
55 |         if not os.path.exists(d): continue
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:55:33
   |
53 |     if not conf: return []
54 |     for d, is_nvme in [(p, True) for p in conf["nvme"]] + [(conf["hdd"], False)]:
55 |         if not os.path.exists(d): continue
   |                                 ^
56 |         for f in os.listdir(d):
57 |             if f.startswith('.'): continue
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:57:33
   |
55 |         if not os.path.exists(d): continue
56 |         for f in os.listdir(d):
57 |             if f.startswith('.'): continue
   |                                 ^
58 |             path = os.path.join(d, f); size = get_size(path)
59 |             if size < MIN_SIZE_BYTES: continue
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/media_manager.py:58:38
   |
56 | â€¦     for f in os.listdir(d):
57 | â€¦         if f.startswith('.'): continue
58 | â€¦         path = os.path.join(d, f); size = get_size(path)
   |                                    ^
59 | â€¦         if size < MIN_SIZE_BYTES: continue
60 | â€¦         media.append({"name": clean_media_name(f), "real_name": f, "size_gb": round(size / (1024**3), 2), "is_nvme": is_nvme, "path"â€¦
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:59:37
   |
57 |             if f.startswith('.'): continue
58 |             path = os.path.join(d, f); size = get_size(path)
59 |             if size < MIN_SIZE_BYTES: continue
   |                                     ^
60 |             media.append({"name": clean_media_name(f), "real_name": f, "size_gb": round(size / (1024**3), 2), "is_nvme": is_nvme, "patâ€¦
61 |     return sorted(media, key=lambda x: x['size_gb'], reverse=True)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:64:25
   |
63 | if __name__ == "__main__":
64 |     if len(sys.argv) < 2: sys.exit(1)
   |                         ^
65 |     cmd = sys.argv[1]
66 |     if cmd == "json_list": print(json.dumps(get_media_list(sys.argv[2])))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:66:26
   |
64 |     if len(sys.argv) < 2: sys.exit(1)
65 |     cmd = sys.argv[1]
66 |     if cmd == "json_list": print(json.dumps(get_media_list(sys.argv[2])))
   |                          ^
67 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
68 |     elif cmd == "status":
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:67:31
   |
65 |     cmd = sys.argv[1]
66 |     if cmd == "json_list": print(json.dumps(get_media_list(sys.argv[2])))
67 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
   |                               ^
68 |     elif cmd == "status":
69 |         u = shutil.disk_usage("/"); h = shutil.disk_usage("/mnt/externe") if os.path.exists("/mnt/externe") else u
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/media_manager.py:69:35
   |
67 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
68 |     elif cmd == "status":
69 |         u = shutil.disk_usage("/"); h = shutil.disk_usage("/mnt/externe") if os.path.exists("/mnt/externe") else u
   |                                   ^
70 |         print(json.dumps({"nvme_free": u.free//1024**3, "hdd_free": h.free//1024**3}))
71 |     elif cmd == "action":
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:74:35
   |
72 |         act, cat, path = sys.argv[2], sys.argv[3], sys.argv[4]
73 |         if act == "del":
74 |             if os.path.isdir(path): shutil.rmtree(path)
   |                                   ^
75 |             else: os.remove(path)
76 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:75:17
   |
73 |         if act == "del":
74 |             if os.path.isdir(path): shutil.rmtree(path)
75 |             else: os.remove(path)
   |                 ^
76 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
77 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:76:26
   |
74 |             if os.path.isdir(path): shutil.rmtree(path)
75 |             else: os.remove(path)
76 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
   |                          ^
77 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
78 |         print("Done")
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/media_manager.py:77:26
   |
75 |             else: os.remove(path)
76 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
77 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
   |                          ^
78 |         print("Done")
   |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/pi_bot.py:1:1
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import datetime, timedelta
3 | from telebot import types
  |
help: Split imports

F401 [*] `time` imported but unused
 --> infra/ai/maintenance/pi_bot.py:1:62
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  |                                                              ^^^^
2 | from datetime import datetime, timedelta
3 | from telebot import types
  |
help: Remove unused import: `time`

F401 [*] `datetime.datetime` imported but unused
 --> infra/ai/maintenance/pi_bot.py:2:22
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                      ^^^^^^^^
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import

F401 [*] `datetime.timedelta` imported but unused
 --> infra/ai/maintenance/pi_bot.py:2:32
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                                ^^^^^^^^^
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import

F401 [*] `flask.request` imported but unused
 --> infra/ai/maintenance/pi_bot.py:5:26
  |
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
5 | from flask import Flask, request
  |                          ^^^^^^^
6 | import share_engine
  |
help: Remove unused import: `flask.request`

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:24:8
   |
22 | # --- UTILS & STORAGE ---
23 | def load_allowed_users():
24 |     try: return json.load(open(USERS_FILE))["allowed"]
   |        ^
25 |     except: return [SUPER_ADMIN]
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/pi_bot.py:25:5
   |
23 | def load_allowed_users():
24 |     try: return json.load(open(USERS_FILE))["allowed"]
25 |     except: return [SUPER_ADMIN]
   |     ^^^^^^
26 |
27 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:25:11
   |
23 | def load_allowed_users():
24 |     try: return json.load(open(USERS_FILE))["allowed"]
25 |     except: return [SUPER_ADMIN]
   |           ^
26 |
27 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:34:94
   |
33 | def get_storage_emoji(item):
34 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0: return "ğŸ”´"
   |                                                                                              ^
35 |     path = item.get('path', '')
36 |     return "ğŸ“š" if path and "/mnt/externe" in path else "ğŸš€"
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:41:37
   |
39 | @bot.message_handler(commands=['admin'])
40 | def admin_main(m):
41 |     if m.from_user.id != SUPER_ADMIN: return
   |                                     ^
42 |     markup = InlineKeyboardMarkup(row_width=1)
43 |     markup.add(InlineKeyboardButton("ğŸ“‚ Partage", callback_data="adm:share"),
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/pi_bot.py:54:30
   |
52 |         users = load_allowed_users()
53 |         if uid not in users:
54 |             users.append(uid); save_users(users)
   |                              ^
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:56:13
   |
54 |             users.append(uid); save_users(users)
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |             ^
57 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/pi_bot.py:57:5
   |
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
57 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |     ^^^^^^
58 |
59 | # --- MEDIA ENGINE (ORIGINAL) ---
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:57:11
   |
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
57 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |           ^
58 |
59 | # --- MEDIA ENGINE (ORIGINAL) ---
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/pi_bot.py:63:39
   |
61 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
62 |     try:
63 |         items = json.loads(res.stdout); ctx = {}
   |                                       ^
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:65:16
   |
63 |         items = json.loads(res.stdout); ctx = {}
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
66 |             except: ctx = {}
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/pi_bot.py:66:13
   |
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
66 |             except: ctx = {}
   |             ^^^^^^
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:66:19
   |
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
66 |             except: ctx = {}
   |                   ^
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:68:42
   |
66 |             except: ctx = {}
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
69 |     except: return
70 |     if not items:
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/pi_bot.py:69:5
   |
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
69 |     except: return
   |     ^^^^^^
70 |     if not items:
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:69:11
   |
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
69 |     except: return
   |           ^
70 |     if not items:
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:72:19
   |
70 |     if not items:
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
72 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
   |                   ^
73 |         else: bot.send_message(m.chat.id, msg)
74 |         return
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:73:13
   |
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
72 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
73 |         else: bot.send_message(m.chat.id, msg)
   |             ^
74 |         return
75 |     text = f"ğŸ¬ {title} : {cat}\n\n"
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:76:36
   |
74 |         return
75 |     text = f"ğŸ¬ {title} : {cat}\n\n"
76 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
   |                                    ^
77 |     markup = InlineKeyboardMarkup(row_width=5)
78 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:80:15
   |
78 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
79 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
80 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |               ^
81 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:81:9
   |
79 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
80 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
81 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |         ^
82 |
83 | # --- PAGED MEDIA UI (LIVE API) ---
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/pi_bot.py:89:29
   |
87 |     try:
88 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
89 |         r.raise_for_status(); data = r.json()
   |                             ^
90 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:90:31
   |
88 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
89 |         r.raise_for_status(); data = r.json()
90 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
   |                               ^
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
92 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:91:13
   |
89 |         r.raise_for_status(); data = r.json()
90 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
   |             ^
92 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/pi_bot.py:93:27
   |
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
92 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
   |                           ^
94 |         items = owned[start:end]
95 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot.py:95:21
   |
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
94 |         items = owned[start:end]
95 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |                     ^
96 |         text = f"{'ğŸ¬' if category == 'films' else 'ğŸ“º'} **{category.capitalize()}** ({total})\n\n"
97 |         for i, item in enumerate(items, 1):
   |

E702 Multiple statements on one line (semicolon)
  --> infra/ai/maintenance/pi_bot.py:95:59
   |
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
94 |         items = owned[start:end]
95 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |                                                            ^
96 |         text = f"{'ğŸ¬' if category == 'films' else 'ğŸ“º'} **{category.capitalize()}** ({total})\n\n"
97 |         for i, item in enumerate(items, 1):
   |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:103:20
    |
101 |         markup.add(*btns)
102 |         nav = []
103 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
    |                    ^
104 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
105 |         if nav: markup.row(*nav)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:104:23
    |
102 |         nav = []
103 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
104 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
    |                       ^
105 |         if nav: markup.row(*nav)
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:105:15
    |
103 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
104 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
105 |         if nav: markup.row(*nav)
    |               ^
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:107:18
    |
105 |         if nav: markup.row(*nav)
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |                  ^
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:108:13
    |
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
    |             ^
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:109:5
    |
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |     ^^^^^^
110 |
111 | @bot.message_handler(commands=['films'])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:109:11
    |
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |           ^
110 |
111 | @bot.message_handler(commands=['films'])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:113:32
    |
111 | @bot.message_handler(commands=['films'])
112 | def films_cmd(m):
113 |     if is_authorized(m.chat.id): show_media_list(m.chat.id, None, "films", 0, True)
    |                                ^
114 |
115 | @bot.message_handler(commands=['series'])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:117:32
    |
115 | @bot.message_handler(commands=['series'])
116 | def series_cmd(m):
117 |     if is_authorized(m.chat.id): show_media_list(m.chat.id, None, "series", 0, True)
    |                                ^
118 |
119 | # --- SEARCH ENGINE (/GET) ---
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:126:5
    |
124 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": â€¦
125 |         return res.json()['choices'][0]['message']['content']
126 |     except: return None
    |     ^^^^^^
127 |
128 | @bot.message_handler(commands=['get'])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:126:11
    |
124 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": â€¦
125 |         return res.json()['choices'][0]['message']['content']
126 |     except: return None
    |           ^
127 |
128 | @bot.message_handler(commands=['get'])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:130:36
    |
128 | @bot.message_handler(commands=['get'])
129 | def handle_get(m):
130 |     if not is_authorized(m.chat.id): return
    |                                    ^
131 |     parts = m.text.split(' ', 1)
132 |     if len(parts) > 1: process_get_request(m, parts[1])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:132:22
    |
130 |     if not is_authorized(m.chat.id): return
131 |     parts = m.text.split(' ', 1)
132 |     if len(parts) > 1: process_get_request(m, parts[1])
    |                      ^
133 |     else: bot.reply_to(m, "ğŸ¬ Que veux-tu ?")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:133:9
    |
131 |     parts = m.text.split(' ', 1)
132 |     if len(parts) > 1: process_get_request(m, parts[1])
133 |     else: bot.reply_to(m, "ğŸ¬ Que veux-tu ?")
    |         ^
134 |
135 | def process_get_request(m, query):
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:140:30
    |
138 |     try:
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
    |                              ^
141 |     except: titre = query; cat = "movie"
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:141:5
    |
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
141 |     except: titre = query; cat = "movie"
    |     ^^^^^^
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
143 |     try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:141:11
    |
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
141 |     except: titre = query; cat = "movie"
    |           ^
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
143 |     try:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:141:26
    |
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
141 |     except: titre = query; cat = "movie"
    |                          ^
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
143 |     try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:146:23
    |
144 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
145 |         results = r.json()
146 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
    |                       ^
147 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
148 |         limit = min(len(results), 5)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:146:73
    |
144 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
145 |         results = r.json()
146 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
    |                                                                          ^
147 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
148 |         limit = min(len(results), 5)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:149:52
    |
147 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
148 |         limit = min(len(results), 5)
149 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
    |                                                    ^
150 |         markup = InlineKeyboardMarkup()
151 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:154:5
    |
152 |         markup.add(*btns)
153 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
154 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
    |     ^^^^^^
155 |
156 | # --- MASTER CALLBACK ROUTER ---
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:154:11
    |
152 |         markup.add(*btns)
153 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
154 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
    |           ^
155 |
156 | # --- MASTER CALLBACK ROUTER ---
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:159:44
    |
157 | @bot.callback_query_handler(func=lambda call: True)
158 | def master_router(call):
159 |     if not is_authorized(call.from_user.id): return
    |                                            ^
160 |     d = call.data.split(":")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:164:27
    |
162 |     # 1. New Paged UI Callbacks
163 |     if d[0] in ["m_pag", "m_sel", "m_act", "dl_sel"]:
164 |         if d[0] == "m_pag": show_media_list(call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                           ^
165 |         elif d[0] == "m_sel":
166 |             markup = InlineKeyboardMarkup()
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:171:30
    |
169 | â€¦                    InlineKeyboardButton("â¬…ï¸ Retour", callback_data=f"m_pag:{d[1]}:0"))
170 | â€¦         bot.edit_message_text(f"ğŸ¯ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
171 | â€¦     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "ğŸ“¥ AjoutÃ©.")
    |                            ^
172 | â€¦     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistrÃ©e.", show_alert=True)
173 | â€¦     return
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:172:29
    |
170 | â€¦         bot.edit_message_text(f"ğŸ¯ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
171 | â€¦     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "ğŸ“¥ AjoutÃ©.")
172 | â€¦     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistrÃ©e.", show_alert=True)
    |                           ^
173 | â€¦     return
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:191:41
    |
189 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
190 | â€¦     elif cmd == "users_list":
191 | â€¦         users = load_allowed_users(); text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
    |                                       ^
192 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=InlineKeyboardMarkup().add(InlineKeâ€¦
193 | â€¦     elif cmd == "users_add":
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:197:41
    |
195 |             bot.register_next_step_handler(msg, process_user_add)
196 |         elif cmd == "users_rev":
197 |             users = load_allowed_users(); markup = InlineKeyboardMarkup(row_width=1)
    |                                         ^
198 |             for u in users:
199 |                 if u == SUPER_ADMIN: continue
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:199:36
    |
197 |             users = load_allowed_users(); markup = InlineKeyboardMarkup(row_width=1)
198 |             for u in users:
199 |                 if u == SUPER_ADMIN: continue
    |                                    ^
200 |                 markup.add(InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
201 |             markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:204:28
    |
202 | â€¦         bot.edit_message_text("SÃ©lectionnez l'ID Ã  rÃ©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
    |                          ^
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:205:28
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                          ^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:205:47
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                             ^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:205:66
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                                                ^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |

F541 [*] f-string without any placeholders
   --> infra/ai/maintenance/pi_bot.py:205:103
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                                                                                     ^^^^^^^^^^^^^^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:211:33
    |
209 | â€¦         markup.add(InlineKeyboardButton("ğŸ¬ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("ğŸ“º SÃ©ries", callba â€¦
210 | â€¦         bot.edit_message_text("CatÃ©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
211 | â€¦     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
    |                               ^
212 | â€¦     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
213 | â€¦     return
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:212:28
    |
210 |             bot.edit_message_text("CatÃ©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
211 |         elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
212 |         elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                            ^
213 |         return
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:218:46
    |
216 |     if d[0] == "sel":
217 |         try:
218 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                              ^
219 |             markup = InlineKeyboardMarkup(row_width=2)
220 |             act = "arc" if item['is_nvme'] else "res"
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:218:66
    |
216 |     if d[0] == "sel":
217 |         try:
218 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                  ^
219 |             markup = InlineKeyboardMarkup(row_width=2)
220 |             act = "arc" if item['is_nvme'] else "res"
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:222:48
    |
220 | â€¦     act = "arc" if item['is_nvme'] else "res"
221 | â€¦     markup.add(InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("ğŸ—‘ï¸ Supprimer"â€¦
222 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                                          ^
223 | â€¦     markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
224 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:225:9
    |
223 |             markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
224 |             bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
225 |         except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |         ^^^^^^
226 |     elif d[0] == "act":
227 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:225:15
    |
223 |             markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
224 |             bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
225 |         except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |               ^
226 |     elif d[0] == "act":
227 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:228:46
    |
226 |     elif d[0] == "act":
227 |         try:
228 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                              ^
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:228:66
    |
226 |     elif d[0] == "act":
227 |         try:
228 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                  ^
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:231:9
    |
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
231 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |         ^^^^^^
232 |     elif d[0] == "share_exec":
233 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:231:15
    |
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
231 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |               ^
232 |     elif d[0] == "share_exec":
233 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:234:46
    |
232 |     elif d[0] == "share_exec":
233 |         try:
234 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                              ^
235 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
236 |             if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:234:66
    |
232 |     elif d[0] == "share_exec":
233 |         try:
234 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                  ^
235 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
236 |             if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:235:45
    |
233 |         try:
234 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
235 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                             ^
236 |             if subtitles:
237 |                 markup = InlineKeyboardMarkup(row_width=1)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:240:17
    |
238 |                 markup.add(InlineKeyboardButton("âš¡ Symlink", callback_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("ğŸ¬ Remu â€¦
239 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
240 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
    |                 ^
241 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
242 |     elif d[0] == "share_final":
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:241:9
    |
239 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
240 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
241 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |         ^^^^^^
242 |     elif d[0] == "share_final":
243 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:241:15
    |
239 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
240 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
241 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |               ^
242 |     elif d[0] == "share_final":
243 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:244:46
    |
242 |     elif d[0] == "share_final":
243 |         try:
244 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                              ^
245 |             remux_opt = True if d[2] == "remux" else False
246 |             bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:244:66
    |
242 |     elif d[0] == "share_final":
243 |         try:
244 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                  ^
245 |             remux_opt = True if d[2] == "remux" else False
246 |             bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:251:17
    |
249 |                 msg = f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`"
250 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
    |                 ^
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:252:9
    |
250 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |         ^^^^^^
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:252:15
    |
250 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |               ^
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:253:26
    |
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                          ^
254 |
255 | # --- STATUS & QUEUE ---
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:258:36
    |
256 | @bot.message_handler(commands=['status'])
257 | def status_command(m):
258 |     if not is_authorized(m.chat.id): return
    |                                    ^
259 |     try:
260 |         nvme = shutil.disk_usage('/')
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:267:5
    |
265 |             msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
266 |         bot.reply_to(m, msg, parse_mode='Markdown')
267 |     except: bot.reply_to(m, "âŒ Erreur lecture disque.")
    |     ^^^^^^
268 |
269 | @bot.message_handler(commands=['queue'])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:267:11
    |
265 |             msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
266 |         bot.reply_to(m, msg, parse_mode='Markdown')
267 |     except: bot.reply_to(m, "âŒ Erreur lecture disque.")
    |           ^
268 |
269 | @bot.message_handler(commands=['queue'])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:271:36
    |
269 | @bot.message_handler(commands=['queue'])
270 | def queue_command(m):
271 |     if not is_authorized(m.chat.id): return
    |                                    ^
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:273:82
    |
271 |     if not is_authorized(m.chat.id): return
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |                                                                                  ^
274 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
275 |         q_text = "ğŸ“¥ **Queue :**\n\n"
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:274:24
    |
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
274 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
    |                        ^
275 |         q_text = "ğŸ“¥ **Queue :**\n\n"
276 |         for t in torrents:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/ai/maintenance/pi_bot.py:274:58
    |
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
274 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
    |                                                          ^
275 |         q_text = "ğŸ“¥ **Queue :**\n\n"
276 |         for t in torrents:
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot.py:281:5
    |
279 |                 q_text += f"â€¢ **{name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB\n"
280 |         bot.reply_to(m, q_text, parse_mode='Markdown')
281 |     except: bot.reply_to(m, "âŒ Erreur qBit.")
    |     ^^^^^^
282 |
283 | # --- STARTUP ---
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot.py:281:11
    |
279 |                 q_text += f"â€¢ **{name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB\n"
280 |         bot.reply_to(m, q_text, parse_mode='Markdown')
281 |     except: bot.reply_to(m, "âŒ Erreur qBit.")
    |           ^
282 |
283 | # --- STARTUP ---
    |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/pi_bot_debug.py:1:1
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Split imports

F401 [*] `time` imported but unused
 --> infra/ai/maintenance/pi_bot_debug.py:1:62
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  |                                                              ^^^^
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import: `time`

F401 [*] `datetime.datetime` imported but unused
 --> infra/ai/maintenance/pi_bot_debug.py:2:22
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                      ^^^^^^^^
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
4 | from flask import Flask, request
  |
help: Remove unused import: `datetime.datetime`

F401 [*] `telebot.types.BotCommand` imported but unused
 --> infra/ai/maintenance/pi_bot_debug.py:3:27
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                           ^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `telebot.types.BotCommandScopeChat` imported but unused
 --> infra/ai/maintenance/pi_bot_debug.py:3:39
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                                       ^^^^^^^^^^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `telebot.types.BotCommandScopeDefault` imported but unused
 --> infra/ai/maintenance/pi_bot_debug.py:3:60
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                                                            ^^^^^^^^^^^^^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `flask.request` imported but unused
 --> infra/ai/maintenance/pi_bot_debug.py:4:26
  |
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
4 | from flask import Flask, request
  |                          ^^^^^^^
5 | import share_engine
  |
help: Remove unused import: `flask.request`

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot_debug.py:25:8
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
   |        ^
26 |     except: return [SUPER_ADMIN]
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/pi_bot_debug.py:26:5
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
26 |     except: return [SUPER_ADMIN]
   |     ^^^^^^
27 |
28 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot_debug.py:26:11
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
26 |     except: return [SUPER_ADMIN]
   |           ^
27 |
28 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot_debug.py:49:40
   |
47 | @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
48 | def admin_router(call):
49 |     if call.from_user.id != SUPER_ADMIN: return
   |                                        ^
50 |     parts = call.data.split(":")
51 |     cmd = parts[1]
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/pi_bot_debug.py:85:32
   |
83 |         markup = InlineKeyboardMarkup(row_width=1)
84 |         for u in users:
85 |             if u == SUPER_ADMIN: continue
   |                                ^
86 |             markup.add(InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
87 |         markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:113:24
    |
111 |         bot.edit_message_text("ğŸ§¹ **Nettoyage SSD**\n\nFonctionnalitÃ© en cours de dÃ©veloppement.", call.message.chat.id, call.message.â€¦
112 |     
113 |     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                        ^
114 |
115 | def process_user_add(m):
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot_debug.py:125:5
    |
123 |         else:
124 |             bot.reply_to(m, "â„¹ï¸ Cet utilisateur est dÃ©jÃ  autorisÃ©.")
125 |     except:
    |     ^^^^^^
126 |         bot.reply_to(m, "âŒ ID invalide. Veuillez envoyer un nombre.")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:135:16
    |
133 |         ctx = {}
134 |         if os.path.exists(CONTEXT_FILE):
135 |             try: ctx = json.load(open(CONTEXT_FILE))
    |                ^
136 |             except: ctx = {}
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot_debug.py:136:13
    |
134 |         if os.path.exists(CONTEXT_FILE):
135 |             try: ctx = json.load(open(CONTEXT_FILE))
136 |             except: ctx = {}
    |             ^^^^^^
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
138 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:136:19
    |
134 |         if os.path.exists(CONTEXT_FILE):
135 |             try: ctx = json.load(open(CONTEXT_FILE))
136 |             except: ctx = {}
    |                   ^
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
138 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:138:42
    |
136 |             except: ctx = {}
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
138 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |                                          ^
139 |     except Exception as e:
140 |         logging.error(f"Context save failed: {e}")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:144:19
    |
142 |     if not items:
143 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
144 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
    |                   ^
145 |         else: bot.send_message(m.chat.id, msg)
146 |         return
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:145:13
    |
143 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
144 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
145 |         else: bot.send_message(m.chat.id, msg)
    |             ^
146 |         return
147 |     text = f"ğŸ¬ {title} : {cat}\n\n"
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:148:36
    |
146 |         return
147 |     text = f"ğŸ¬ {title} : {cat}\n\n"
148 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
    |                                    ^
149 |     markup = InlineKeyboardMarkup(row_width=5)
150 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:152:15
    |
150 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
151 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
152 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |               ^
153 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:153:9
    |
151 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
152 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
153 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |         ^
154 |
155 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:157:44
    |
155 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
156 | def media_callbacks(call):
157 |     if not is_authorized(call.from_user.id): return
    |                                            ^
158 |     d = call.data.split(":")
159 |     if d[0] == "sel":
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:161:46
    |
159 |     if d[0] == "sel":
160 |         try:
161 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
162 |             item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
163 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:177:46
    |
175 |     elif d[0] == "act":
176 |         try:
177 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
178 |             item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
179 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:187:46
    |
185 |     elif d[0] == "share_exec":
186 |         try:
187 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
188 |             item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
189 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:210:46
    |
208 |     elif d[0] == "share_final":
209 |         try:
210 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
211 |             item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
212 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:234:26
    |
232 |         else:
233 |             bot.send_message(call.message.chat.id, "âŒ Erreur: Ã‰chec du partage ou contenu hors limites.")
234 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                          ^
235 |     elif d[0] == "dl":
236 |         if d[1] == "no":
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:241:50
    |
239 |         elif d[1] == "yes":
240 |             try:
241 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                                  ^
242 |                 dl_data = ctx.get(str(call.message.chat.id) + "_dl")
243 |                 if not dl_data:
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/ai/maintenance/pi_bot_debug.py:246:33
    |
244 |                     bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
245 |                     return
246 |             except Exception as e:
    |                                 ^
247 |                 bot.answer_callback_query(call.id, "âŒ Erreur de session.")
248 |                 return
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:283:36
    |
281 | @bot.message_handler(commands=['status'])
282 | def status_command(m):
283 |     if not is_authorized(m.chat.id): return
    |                                    ^
284 |     try:
285 |         nvme = shutil.disk_usage('/')
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/ai/maintenance/pi_bot_debug.py:291:25
    |
289 |         msg = f"ğŸ“Š **Stockage Temps RÃ©el**\n\nğŸš€ **NVMe** : `{fmt(nvme)}`\nğŸ“š **HDD** : `{fmt(hdd)}`"
290 |         bot.reply_to(m, msg, parse_mode='Markdown')
291 |     except Exception as e:
    |                         ^
292 |         bot.reply_to(m, "âŒ Erreur de lecture disque temps rÃ©el.")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:296:36
    |
294 | @bot.message_handler(commands=['films'])
295 | def films_command(m):
296 |     if not is_authorized(m.chat.id): return
    |                                    ^
297 |     try:
298 |         logging.info(f"[DEBUG_API] Interrogation Radarr Ã  {RADARR_CFG['url']}")
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/ai/maintenance/pi_bot_debug.py:308:25
    |
306 |         text += "\n".join([f"â€¢ {f['title']} ({f['year']})" for f in owned[:50]])
307 |         bot.reply_to(m, text, parse_mode='Markdown')
308 |     except Exception as e:
    |                         ^
309 |         bot.reply_to(m, "âŒ Erreur API Radarr (Consultez les logs).")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:313:36
    |
311 | @bot.message_handler(commands=['series'])
312 | def series_command(m):
313 |     if not is_authorized(m.chat.id): return
    |                                    ^
314 |     try:
315 |         r = requests.get(f"{SONARR_CFG['url']}/api/v3/series", headers={"X-Api-Key": SONARR_CFG['key']}, timeout=5)
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/ai/maintenance/pi_bot_debug.py:322:25
    |
320 |         text += "\n".join([f"â€¢ {s['title']} â€” `{s['statistics']['episodeFileCount']}` Ã©pisodes" for s in owned])
321 |         bot.reply_to(m, text, parse_mode='Markdown')
322 |     except Exception as e:
    |                         ^
323 |         bot.reply_to(m, "âŒ Erreur API Sonarr (Consultez les logs).")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:327:36
    |
325 | @bot.message_handler(commands=['queue'])
326 | def queue_command(m):
327 |     if not is_authorized(m.chat.id): return
    |                                    ^
328 |     
329 |     def clean_title(name):
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:337:24
    |
335 | â€¦     tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', râ€¦
336 | â€¦     clean = f"{title} ({year})" if year else title
337 | â€¦     for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
    |                      ^
338 | â€¦     return re.sub(r'\s+', ' ', clean).strip()
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:351:42
    |
349 |                     progress = round(t['progress'] * 100, 1)
350 |                     eta_sec = t['eta']
351 |                     if eta_sec >= 8640000: eta = "âˆ"
    |                                          ^
352 |                     else:
353 |                         eta = str(timedelta(seconds=eta_sec)).split(".")[0]
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:425:36
    |
423 | @bot.message_handler(commands=['get'])
424 | def handle_get_command_entry(m):
425 |     if not is_authorized(m.chat.id): return
    |                                    ^
426 |     parts = m.text.split(' ', 1)
427 |     if len(parts) > 1 and parts[1].strip():
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:435:36
    |
434 | def process_get_step(m):
435 |     if not is_authorized(m.chat.id): return
    |                                    ^
436 |     if m.text.startswith('/'):
437 |         return
    |

F841 Local variable `saison` is assigned to but never used
   --> infra/ai/maintenance/pi_bot_debug.py:458:9
    |
456 |         titre = str(data.get('titre'))
457 |         type_media = str(data.get('type'))
458 |         saison = int(data['saison']) if data.get('saison') is not None else None
    |         ^^^^^^
459 |         episode = int(data['episode']) if data.get('episode') is not None else None
460 |     except (ValueError, TypeError):
    |
help: Remove assignment to unused variable `saison`

F841 Local variable `episode` is assigned to but never used
   --> infra/ai/maintenance/pi_bot_debug.py:459:9
    |
457 |         type_media = str(data.get('type'))
458 |         saison = int(data['saison']) if data.get('saison') is not None else None
459 |         episode = int(data['episode']) if data.get('episode') is not None else None
    |         ^^^^^^^
460 |     except (ValueError, TypeError):
461 |         bot.reply_to(m, "âŒ Erreur de formatage des mÃ©tadonnÃ©es extraites.")
    |
help: Remove assignment to unused variable `episode`

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:506:20
    |
504 |             ctx = {}
505 |             if os.path.exists(CONTEXT_FILE):
506 |                 try: ctx = json.load(open(CONTEXT_FILE))
    |                    ^
507 |                 except: ctx = {}
508 |             ctx[str(m.chat.id) + "_dl"] = {
    |

E722 Do not use bare `except`
   --> infra/ai/maintenance/pi_bot_debug.py:507:17
    |
505 |             if os.path.exists(CONTEXT_FILE):
506 |                 try: ctx = json.load(open(CONTEXT_FILE))
507 |                 except: ctx = {}
    |                 ^^^^^^
508 |             ctx[str(m.chat.id) + "_dl"] = {
509 |                 "type_media": type_media,
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:507:23
    |
505 |             if os.path.exists(CONTEXT_FILE):
506 |                 try: ctx = json.load(open(CONTEXT_FILE))
507 |                 except: ctx = {}
    |                       ^
508 |             ctx[str(m.chat.id) + "_dl"] = {
509 |                 "type_media": type_media,
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:516:46
    |
514 |                 "images": item.get('images')
515 |             }
516 |             with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |                                              ^
517 |         except Exception as e:
518 |             logging.error(f"Context save failed: {e}")
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:545:36
    |
543 | @bot.message_handler(func=lambda m: True)
544 | def handle_ai_request(m):
545 |     if not is_authorized(m.chat.id): return
    |                                    ^
546 |     if m.text.startswith('/'): return # Ignore native commands
547 |     process_get_request(m, m.text)
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/pi_bot_debug.py:546:30
    |
544 | def handle_ai_request(m):
545 |     if not is_authorized(m.chat.id): return
546 |     if m.text.startswith('/'): return # Ignore native commands
    |                              ^
547 |     process_get_request(m, m.text)
    |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/share_engine.py:1:1
  |
1 | import os, json, subprocess, hashlib, time, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from pathlib import Path
3 | from datetime import datetime
  |
help: Split imports

F401 [*] `datetime.datetime` imported but unused
 --> infra/ai/maintenance/share_engine.py:3:22
  |
1 | import os, json, subprocess, hashlib, time, logging
2 | from pathlib import Path
3 | from datetime import datetime
  |                      ^^^^^^^^
4 |
5 | SHARE_DIR = "/media_share/" if os.environ.get("DOCKER_MODE") == "true" else "/home/jules/media_share/"
  |
help: Remove unused import: `datetime.datetime`

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/share_engine.py:13:41
   |
11 | def load_config():
12 |     try:
13 |         with open(CONFIG_FILE, 'r') as f: return json.load(f)
   |                                         ^
14 |     except: return {"max_gb": 4.0, "max_res": 1080}
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/share_engine.py:14:5
   |
12 |     try:
13 |         with open(CONFIG_FILE, 'r') as f: return json.load(f)
14 |     except: return {"max_gb": 4.0, "max_res": 1080}
   |     ^^^^^^
15 |
16 | def get_video_info(path):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/share_engine.py:14:11
   |
12 |     try:
13 |         with open(CONFIG_FILE, 'r') as f: return json.load(f)
14 |     except: return {"max_gb": 4.0, "max_res": 1080}
   |           ^
15 |
16 | def get_video_info(path):
   |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/share_engine.py:112:36
    |
111 |     try:
112 |         if video_dest_path.exists(): video_dest_path.unlink()
    |                                    ^
113 |         os.symlink(src, video_dest_path)
114 |     except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/ai/maintenance/share_engine.py:129:38
    |
127 |         sub_dest_path = Path(SHARE_DIR) / sub_share_name
128 |         try:
129 |             if sub_dest_path.exists(): sub_dest_path.unlink()
    |                                      ^
130 |             os.symlink(sub, sub_dest_path)
131 |             result["subtitles"].append(f"{BASE_URL}/{sub_share_name}")
    |

E401 [*] Multiple imports on one line
 --> infra/ai/maintenance/storage_manager.py:1:1
  |
1 | import os, shutil, sys
  | ^^^^^^^^^^^^^^^^^^^^^^
2 |
3 | NVME_DIR = "/data/media/films"
  |
help: Split imports

F401 [*] `shutil` imported but unused
 --> infra/ai/maintenance/storage_manager.py:1:12
  |
1 | import os, shutil, sys
  |            ^^^^^^
2 |
3 | NVME_DIR = "/data/media/films"
  |
help: Remove unused import: `shutil`

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_manager.py:9:29
   |
 7 |     s = 0
 8 |     try:
 9 |         if os.path.isfile(p): s = os.path.getsize(p)
   |                             ^
10 |         else:
11 |             for r, d, f in os.walk(p):
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_manager.py:12:30
   |
10 |         else:
11 |             for r, d, f in os.walk(p):
12 |                 for file in f: s += os.path.getsize(os.path.join(r, file))
   |                              ^
13 |     except: return 0
14 |     return round(s / (1024**3), 2)
   |

E722 Do not use bare `except`
  --> infra/ai/maintenance/storage_manager.py:13:5
   |
11 |             for r, d, f in os.walk(p):
12 |                 for file in f: s += os.path.getsize(os.path.join(r, file))
13 |     except: return 0
   |     ^^^^^^
14 |     return round(s / (1024**3), 2)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_manager.py:13:11
   |
11 |             for r, d, f in os.walk(p):
12 |                 for file in f: s += os.path.getsize(os.path.join(r, file))
13 |     except: return 0
   |           ^
14 |     return round(s / (1024**3), 2)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_manager.py:17:32
   |
16 | def list_items(path):
17 |     if not os.path.exists(path): return f"âŒ {path} absent."
   |                                ^
18 |     items = [f for f in os.listdir(path) if not f.startswith('.')]
19 |     out = f"ğŸ“‚ **{os.path.basename(path)}** :\n"
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_manager.py:28:21
   |
26 | if __name__ == "__main__":
27 |     arg = sys.argv[1] if len(sys.argv) > 1 else ""
28 |     if arg == "nvme": print(list_items(NVME_DIR))
   |                     ^
29 |     elif arg == "hdd": print(list_items(HDD_DIR))
30 |     else: print("Commande reÃ§ue : " + arg)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_manager.py:29:22
   |
27 |     arg = sys.argv[1] if len(sys.argv) > 1 else ""
28 |     if arg == "nvme": print(list_items(NVME_DIR))
29 |     elif arg == "hdd": print(list_items(HDD_DIR))
   |                      ^
30 |     else: print("Commande reÃ§ue : " + arg)
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_manager.py:30:9
   |
28 |     if arg == "nvme": print(list_items(NVME_DIR))
29 |     elif arg == "hdd": print(list_items(HDD_DIR))
30 |     else: print("Commande reÃ§ue : " + arg)
   |         ^
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_skill.py:11:32
   |
 9 | def list_media(category="movies"):
10 |     path = PATHS.get(category)
11 |     if not os.path.exists(path): return f"âŒ Dossier {category} introuvable."
   |                                ^
12 |     items = [f for f in os.listdir(path) if not f.startswith('.')]
13 |     return f"ğŸ¥ **{category.capitalize()} :**\n" + "\n".join([f"â€¢ {i}" for i in sorted(items)]) if items else f"ğŸ“‚ Aucun contenu dans { â€¦
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_skill.py:25:53
   |
23 |     if len(sys.argv) > 1:
24 |         cmd = sys.argv[1]
25 |         if cmd == "list_media" and len(sys.argv) > 2: print(list_media(sys.argv[2]))
   |                                                     ^
26 |         elif cmd == "get_status": print(get_status())
   |

E701 Multiple statements on one line (colon)
  --> infra/ai/maintenance/storage_skill.py:26:33
   |
24 |         cmd = sys.argv[1]
25 |         if cmd == "list_media" and len(sys.argv) > 2: print(list_media(sys.argv[2]))
26 |         elif cmd == "get_status": print(get_status())
   |                                 ^
   |

E401 [*] Multiple imports on one line
 --> infra/config.py:1:1
  |
1 | import json, os
  | ^^^^^^^^^^^^^^^
2 |
3 | # --- Helper ---
  |
help: Split imports

E701 Multiple statements on one line (colon)
  --> infra/config.py:29:26
   |
28 | def is_authorized(uid):
29 |     if uid == SUPER_ADMIN: return True
   |                          ^
30 |     try:
31 |         if not os.path.exists(USERS_FILE):
   |

E401 [*] Multiple imports on one line
 --> infra/handlers_admin.py:1:1
  |
1 | import telebot, os, shutil, json, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Split imports

F401 [*] `telebot` imported but unused
 --> infra/handlers_admin.py:1:8
  |
1 | import telebot, os, shutil, json, logging
  |        ^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Remove unused import

F401 [*] `logging` imported but unused
 --> infra/handlers_admin.py:1:35
  |
1 | import telebot, os, shutil, json, logging
  |                                   ^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Remove unused import

F403 `from config import *` used; unable to detect undefined names
 --> infra/handlers_admin.py:3:1
  |
1 | import telebot, os, shutil, json, logging
2 | from telebot import types
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 |
5 | def save_users(users):
  |

F405 `USERS_FILE` may be undefined, or defined from star imports
 --> infra/handlers_admin.py:6:15
  |
5 | def save_users(users):
6 |     with open(USERS_FILE, "w") as f:
  |               ^^^^^^^^^^
7 |         json.dump({"allowed": users}, f)
  |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:12:45
   |
10 |     @bot.message_handler(commands=['status'])
11 |     def status_cmd(m):
12 |         if not is_authorized(m.from_user.id): return
   |                                             ^
13 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
14 |         try:
   |

E731 Do not assign a `lambda` expression, use a `def`
  --> infra/handlers_admin.py:13:9
   |
11 |     def status_cmd(m):
12 |         if not is_authorized(m.from_user.id): return
13 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 |         try:
15 |             nvme = shutil.disk_usage('/')
   |
help: Rewrite `fmt` as a `def`

F541 [*] f-string without any placeholders
  --> infra/handlers_admin.py:21:24
   |
19 |                 msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
20 |             else:
21 |                 msg += f"\nâš ï¸ **HDD** : `Non dÃ©tectÃ© sur /mnt/externe`"
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |             bot.reply_to(m, msg, parse_mode='Markdown')
23 |         except Exception as e:
   |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:28:45
   |
26 |     @bot.message_handler(commands=['admin'])
27 |     def admin_menu(m):
28 |         if not is_authorized(m.from_user.id): return
   |                                             ^
29 |         markup = types.InlineKeyboardMarkup(row_width=1)
30 |         markup.add(types.InlineKeyboardButton("ğŸ“‚ Partage", callback_data="adm:share"),
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/handlers_admin.py:39:23
   |
37 |         try:
38 |             uid = int(m.text)
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:39:44
   |
37 |         try:
38 |             uid = int(m.text)
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_admin.py:41:34
   |
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |                                  ^
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:43:17
   |
41 |                 users.append(uid); save_users(users)
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |                 ^
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |

E722 Do not use bare `except`
  --> infra/handlers_admin.py:44:9
   |
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |         ^^^^^^
45 |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:44:15
   |
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |               ^
45 |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:48:48
   |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
47 |     def admin_callback_router(call):
48 |         if not is_authorized(call.from_user.id): return
   |                                                ^
49 |         d = call.data.split(":")
50 |         cmd = d[1]
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/handlers_admin.py:65:23
   |
63 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
64 | â€¦     elif cmd == "users_list":
65 | â€¦         with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                     ^^^^^^^^^^
66 | â€¦         text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
67 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=types.InlineKeyboardMarkup().add(typâ€¦
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:65:44
   |
63 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
64 | â€¦     elif cmd == "users_list":
65 | â€¦         with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                          ^
66 | â€¦         text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
67 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=types.InlineKeyboardMarkup().add(typâ€¦
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/handlers_admin.py:72:23
   |
70 |             bot.register_next_step_handler(msg, process_user_add)
71 |         elif cmd == "users_rev":
72 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:72:44
   |
70 |             bot.register_next_step_handler(msg, process_user_add)
71 |         elif cmd == "users_rev":
72 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
   |

F405 `SUPER_ADMIN` may be undefined, or defined from star imports
  --> infra/handlers_admin.py:75:25
   |
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
75 |                 if u == SUPER_ADMIN: continue
   |                         ^^^^^^^^^^^
76 |                 markup.add(types.InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
77 |             markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:75:36
   |
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
75 |                 if u == SUPER_ADMIN: continue
   |                                    ^
76 |                 markup.add(types.InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
77 |             markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> infra/handlers_admin.py:81:23
   |
79 |         elif cmd == "users_del":
80 |             uid = int(d[2])
81 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
82 |             if uid in users:
83 |                 users.remove(uid)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_admin.py:81:44
   |
79 |         elif cmd == "users_del":
80 |             uid = int(d[2])
81 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
82 |             if uid in users:
83 |                 users.remove(uid)
   |

F541 [*] f-string without any placeholders
  --> infra/handlers_admin.py:85:52
   |
83 | â€¦             users.remove(uid)
84 | â€¦             save_users(users)
85 | â€¦             bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
   |                                                  ^^^^^^^^^^^^^^
86 | â€¦         admin_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chatâ€¦
87 | â€¦     elif cmd == "share_owned":
   |
help: Remove extraneous `f` prefix

E401 [*] Multiple imports on one line
 --> infra/handlers_media.py:1:1
  |
1 | import requests, logging, os, json, subprocess, re, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import timedelta
3 | from telebot import types
  |
help: Split imports

F401 [*] `logging` imported but unused
 --> infra/handlers_media.py:1:18
  |
1 | import requests, logging, os, json, subprocess, re, pathlib
  |                  ^^^^^^^
2 | from datetime import timedelta
3 | from telebot import types
  |
help: Remove unused import: `logging`

F403 `from config import *` used; unable to detect undefined names
 --> infra/handlers_media.py:4:1
  |
2 | from datetime import timedelta
3 | from telebot import types
4 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
5 | import share_engine
  |

F405 `SCRIPT_PATH` may be undefined, or defined from star imports
  --> infra/handlers_media.py:14:38
   |
13 | def list_media_unified(bot, m, cat, title, is_edit=False):
14 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                      ^^^^^^^^^^^
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_media.py:16:39
   |
14 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
   |                                       ^
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/handlers_media.py:17:27
   |
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
   |                           ^^^^^^^^^^^^
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:18:16
   |
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/handlers_media.py:18:39
   |
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                                       ^^^^^^^^^^^^
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

E722 Do not use bare `except`
  --> infra/handlers_media.py:19:13
   |
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |             ^^^^^^
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:19:19
   |
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |                   ^
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/handlers_media.py:21:19
   |
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                   ^^^^^^^^^^^^
22 |     except: return
23 |     if not items:
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:21:42
   |
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
22 |     except: return
23 |     if not items:
   |

E722 Do not use bare `except`
  --> infra/handlers_media.py:22:5
   |
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
22 |     except: return
   |     ^^^^^^
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:22:11
   |
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
22 |     except: return
   |           ^
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:25:19
   |
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
25 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
   |                   ^
26 |         else: bot.send_message(m.chat.id, msg)
27 |         return
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:26:13
   |
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
25 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
26 |         else: bot.send_message(m.chat.id, msg)
   |             ^
27 |         return
28 |     text = f"{title} : {cat}\n\n"
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:29:36
   |
27 |         return
28 |     text = f"{title} : {cat}\n\n"
29 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
   |                                    ^
30 |     markup = types.InlineKeyboardMarkup(row_width=5)
31 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:33:15
   |
31 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
32 |     markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
33 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |               ^
34 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:34:9
   |
32 |     markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
33 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
34 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |         ^
35 |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> infra/handlers_media.py:37:11
   |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
37 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
   |           ^^^^^^^^^^
38 |     endpoint = "movie" if category == "films" else "series"
39 |     try:
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> infra/handlers_media.py:37:50
   |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
37 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
   |                                                  ^^^^^^^^^^
38 |     endpoint = "movie" if category == "films" else "series"
39 |     try:
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_media.py:41:29
   |
39 |     try:
40 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
41 |         r.raise_for_status(); data = r.json()
   |                             ^
42 |         data.sort(key=lambda x: x.get('added', ''), reverse=True)
43 |         total = len(data)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:46:21
   |
44 |         start, end = page * 10, (page + 1) * 10
45 |         items = data[start:end]
46 |         if not items: bot.send_message(chat_id, "Vide."); return
   |                     ^
47 |         text = f"**{category.capitalize()} ({total})**\n\n"
48 |         for i, item in enumerate(items, 1):
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_media.py:46:57
   |
44 |         start, end = page * 10, (page + 1) * 10
45 |         items = data[start:end]
46 |         if not items: bot.send_message(chat_id, "Vide."); return
   |                                                         ^
47 |         text = f"**{category.capitalize()} ({total})**\n\n"
48 |         for i, item in enumerate(items, 1):
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:55:20
   |
53 |         markup.add(*btns)
54 |         nav_row = []
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
   |                    ^
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
57 |         if nav_row: markup.row(*nav_row)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:56:23
   |
54 |         nav_row = []
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
   |                       ^
57 |         if nav_row: markup.row(*nav_row)
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:57:19
   |
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
57 |         if nav_row: markup.row(*nav_row)
   |                   ^
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:59:18
   |
57 |         if nav_row: markup.row(*nav_row)
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |                  ^
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:60:13
   |
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |             ^
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:61:26
   |
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |                          ^
62 |
63 | def register_media_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:66:36
   |
64 |     @bot.message_handler(commands=['films'])
65 |     def films_cmd(m):
66 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "films", 0, True, is_authorized)
   |                                    ^
67 |
68 |     @bot.message_handler(commands=['series'])
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:70:36
   |
68 |     @bot.message_handler(commands=['series'])
69 |     def series_cmd(m):
70 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "series", 0, True, is_authorized)
   |                                    ^
71 |
72 |     @bot.message_handler(commands=['queue'])
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:74:40
   |
72 |     @bot.message_handler(commands=['queue'])
73 |     def queue_command(m):
74 |         if not is_authorized(m.chat.id): return
   |                                        ^
75 |         def clean_title(name):
76 |             name = os.path.splitext(name)[0]
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:83:28
   |
81 | â€¦         tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b'â€¦
82 | â€¦         clean = f"{title} ({year})" if year else title
83 | â€¦         for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
   |                          ^
84 | â€¦         return re.sub(r'\s+', ' ', clean).strip()
85 | â€¦     try:
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_media.py:86:86
   |
84 |             return re.sub(r'\s+', ' ', clean).strip()
85 |         try:
86 |             r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                                                                      ^
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:87:28
   |
85 |         try:
86 |             r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
   |                            ^
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
89 |             for t in torrents:
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_media.py:87:62
   |
85 |         try:
86 |             r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
   |                                                              ^
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
89 |             for t in torrents:
   |

E722 Do not use bare `except`
  --> infra/handlers_media.py:96:9
   |
94 |                     q_text += f"â€¢ **{clean_name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB | â³ {eta}  â€¦
95 |             bot.reply_to(m, q_text, parse_mode='Markdown')
96 |         except: bot.reply_to(m, "âŒ Erreur qBit.")
   |         ^^^^^^
97 |
98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_â€¦
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_media.py:96:15
   |
94 |                     q_text += f"â€¢ **{clean_name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB | â³ {eta}  â€¦
95 |             bot.reply_to(m, q_text, parse_mode='Markdown')
96 |         except: bot.reply_to(m, "âŒ Erreur qBit.")
   |               ^
97 |
98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_â€¦
   |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:100:48
    |
 98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "shareâ€¦
 99 |     def media_callback_router(call):
100 |         if not is_authorized(call.from_user.id): return
    |                                                ^
101 |         d = call.data.split(":")
    |

F405 `RADARR_CFG` may be undefined, or defined from star imports
   --> infra/handlers_media.py:107:19
    |
105 |         elif d[0] == "m_sel":
106 |             cat, item_id = d[1], d[2]
107 |             cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                   ^^^^^^^^^^
108 |             endpoint = "movie" if cat == "films" else "series"
109 |             display_title = f"ID {item_id}"
    |

F405 `SONARR_CFG` may be undefined, or defined from star imports
   --> infra/handlers_media.py:107:53
    |
105 |         elif d[0] == "m_sel":
106 |             cat, item_id = d[1], d[2]
107 |             cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                                                     ^^^^^^^^^^
108 |             endpoint = "movie" if cat == "films" else "series"
109 |             display_title = f"ID {item_id}"
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:112:40
    |
110 |             try:
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
    |                                        ^
113 |             except: pass
114 |             markup = types.InlineKeyboardMarkup()
    |

E722 Do not use bare `except`
   --> infra/handlers_media.py:113:13
    |
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
113 |             except: pass
    |             ^^^^^^
114 |             markup = types.InlineKeyboardMarkup()
115 |             markup.add(types.InlineKeyboardButton("ğŸ—‘ï¸ Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:113:19
    |
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
113 |             except: pass
    |                   ^
114 |             markup = types.InlineKeyboardMarkup()
115 |             markup.add(types.InlineKeyboardButton("ğŸ—‘ï¸ Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |

F405 `RADARR_CFG` may be undefined, or defined from star imports
   --> infra/handlers_media.py:123:23
    |
121 |             if action == "share":
122 |                 bot.answer_callback_query(call.id, "â³ GÃ©nÃ©ration du lien...")
123 |                 cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                       ^^^^^^^^^^
124 |                 endpoint = "movie" if cat == "films" else "series"
125 |                 try:
    |

F405 `SONARR_CFG` may be undefined, or defined from star imports
   --> infra/handlers_media.py:123:57
    |
121 |             if action == "share":
122 |                 bot.answer_callback_query(call.id, "â³ GÃ©nÃ©ration du lien...")
123 |                 cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                                                         ^^^^^^^^^^
124 |                 endpoint = "movie" if cat == "films" else "series"
125 |                 try:
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:134:33
    |
132 |                                 msg = f"âœ… **Lien de partage gÃ©nÃ©rÃ© :**\n\nğŸ”— `{data['video']}`"
133 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
    |                                 ^
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:135:29
    |
133 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
    |                             ^
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E722 Do not use bare `except`
   --> infra/handlers_media.py:136:17
    |
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |                 ^^^^^^
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:136:23
    |
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |                       ^
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:137:17
    |
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |                 ^
138 |
139 |         elif d[0] == "sel":
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/handlers_media.py:141:27
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                           ^^^^^^^^^^^^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:141:50
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                  ^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

E702 Multiple statements on one line (semicolon)
   --> infra/handlers_media.py:141:70
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                      ^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

F405 `SUPER_ADMIN` may be undefined, or defined from star imports
   --> infra/handlers_media.py:145:41
    |
143 | â€¦     act = "arc" if item['is_nvme'] else "res"
144 | â€¦     markup.add(types.InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("ğŸ—‘â€¦
145 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                               ^^^^^^^^^^^
146 | â€¦     markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:145:52
    |
143 | â€¦     act = "arc" if item['is_nvme'] else "res"
144 | â€¦     markup.add(types.InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("ğŸ—‘â€¦
145 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                                          ^
146 | â€¦     markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E722 Do not use bare `except`
   --> infra/handlers_media.py:148:13
    |
146 |                 markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 |                 bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
148 |             except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |             ^^^^^^
149 |         elif d[0] == "act":
150 |             try:
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:148:19
    |
146 |                 markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 |                 bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
148 |             except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |                   ^
149 |         elif d[0] == "act":
150 |             try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/handlers_media.py:151:27
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                           ^^^^^^^^^^^^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:151:50
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                  ^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/handlers_media.py:151:70
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                      ^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

F405 `SCRIPT_PATH` may be undefined, or defined from star imports
   --> infra/handlers_media.py:152:50
    |
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                  ^^^^^^^^^^^
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |

E722 Do not use bare `except`
   --> infra/handlers_media.py:154:13
    |
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |             ^^^^^^
155 |         elif d[0] == "share_exec":
156 |             try:
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:154:19
    |
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |                   ^
155 |         elif d[0] == "share_exec":
156 |             try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/handlers_media.py:157:27
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                           ^^^^^^^^^^^^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:157:50
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                  ^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/handlers_media.py:157:70
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                      ^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/handlers_media.py:158:49
    |
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                 ^
159 |                 if subtitles:
160 |                     markup = types.InlineKeyboardMarkup(row_width=1)
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:163:21
    |
161 | â€¦                 markup.add(types.InlineKeyboardButton("âš¡ Symlink", callback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardBâ€¦
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
    |                   ^
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
165 | â€¦     elif d[0] == "share_final":
    |

E722 Do not use bare `except`
   --> infra/handlers_media.py:164:13
    |
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |           ^^^^^^
165 | â€¦     elif d[0] == "share_final":
166 | â€¦         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:164:19
    |
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |                 ^
165 | â€¦     elif d[0] == "share_final":
166 | â€¦         try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> infra/handlers_media.py:167:27
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                           ^^^^^^^^^^^^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:167:50
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                  ^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/handlers_media.py:167:70
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                      ^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:171:44
    |
169 | â€¦         bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
170 | â€¦         data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
171 | â€¦         if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", parse â€¦
    |                                      ^
172 | â€¦         else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦     except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:172:21
    |
170 | â€¦             data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
    |                   ^
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> infra/handlers_media.py:173:13
    |
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |           ^^^^^^
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:173:19
    |
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |                 ^
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/handlers_media.py:174:30
    |
172 |                 else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 |             except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
174 |         elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                              ^
    |

E401 [*] Multiple imports on one line
 --> infra/handlers_search.py:1:1
  |
1 | import telebot, json, requests, re, logging, os
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  |
help: Split imports

F401 [*] `telebot` imported but unused
 --> infra/handlers_search.py:1:8
  |
1 | import telebot, json, requests, re, logging, os
  |        ^^^^^^^
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  |
help: Remove unused import: `telebot`

F403 `from config import *` used; unable to detect undefined names
 --> infra/handlers_search.py:3:1
  |
1 | import telebot, json, requests, re, logging, os
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 |
5 | def stream_gpt_json(query):
  |

F405 `OPENAI_KEY` may be undefined, or defined from star imports
 --> infra/handlers_search.py:6:79
  |
5 | def stream_gpt_json(query):
6 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
  |                                                                               ^^^^^^^^^^
7 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
8 |     try:
  |

E722 Do not use bare `except`
  --> infra/handlers_search.py:11:5
   |
 9 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [â€¦
10 |         return res.json()['choices'][0]['message']['content']
11 |     except: return None
   |     ^^^^^^
12 |
13 | def register_search_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:11:11
   |
 9 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [â€¦
10 |         return res.json()['choices'][0]['message']['content']
11 |     except: return None
   |           ^
12 |
13 | def register_search_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:16:45
   |
14 |     @bot.message_handler(commands=['get'])
15 |     def handle_get(m):
16 |         if not is_authorized(m.from_user.id): return
   |                                             ^
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:18:26
   |
16 |         if not is_authorized(m.from_user.id): return
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
   |                          ^
19 |         else: bot.reply_to(m, "ğŸ¬ Que veux-tu ? (Ex: /get Titanic)")
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:19:13
   |
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
19 |         else: bot.reply_to(m, "ğŸ¬ Que veux-tu ? (Ex: /get Titanic)")
   |             ^
20 |
21 |     @bot.message_handler(func=lambda m: True)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:23:40
   |
21 |     @bot.message_handler(func=lambda m: True)
22 |     def handle_ai_request(m):
23 |         if not is_authorized(m.chat.id): return
   |                                        ^
24 |         if m.text.startswith('/'): return
25 |         process_get_request(bot, m, m.text)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:24:34
   |
22 |     def handle_ai_request(m):
23 |         if not is_authorized(m.chat.id): return
24 |         if m.text.startswith('/'): return
   |                                  ^
25 |         process_get_request(bot, m, m.text)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:29:48
   |
27 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("dl_sel:"))
28 |     def download_callback_handler(call):
29 |         if not is_authorized(call.from_user.id): return
   |                                                ^
30 |         d = call.data.split(":")
31 |         cat, idx = d[1], int(d[2])
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/handlers_search.py:33:23
   |
31 |         cat, idx = d[1], int(d[2])
32 |         try:
33 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
   |                       ^^^^^^^^^^^^
34 |             search_data = ctx.get(f"{call.message.chat.id}_search")
35 |             if not search_data:
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:33:46
   |
31 |         cat, idx = d[1], int(d[2])
32 |         try:
33 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
   |                                              ^
34 |             search_data = ctx.get(f"{call.message.chat.id}_search")
35 |             if not search_data:
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> infra/handlers_search.py:40:19
   |
39 |             item = search_data['results'][idx]
40 |             cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                   ^^^^^^^^^^
41 |             endpoint = "movie" if cat == "movie" else "series"
42 |             id_key = "tmdbId" if cat == "movie" else "tvdbId"
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> infra/handlers_search.py:40:53
   |
39 |             item = search_data['results'][idx]
40 |             cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                                                     ^^^^^^^^^^
41 |             endpoint = "movie" if cat == "movie" else "series"
42 |             id_key = "tmdbId" if cat == "movie" else "tvdbId"
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:54:31
   |
52 |             }
53 |             payload[id_key] = item[id_key]
54 |             if cat == "series": payload["languageProfileId"] = 1
   |                               ^
55 |
56 |             r = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_search.py:70:30
   |
68 |     try:
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
   |                              ^
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |

E722 Do not use bare `except`
  --> infra/handlers_search.py:71:5
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |     ^^^^^^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:71:11
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |           ^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_search.py:71:26
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |                          ^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> infra/handlers_search.py:72:11
   |
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |           ^^^^^^^^^^
73 |     try:
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> infra/handlers_search.py:72:45
   |
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                                             ^^^^^^^^^^
73 |     try:
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:76:23
   |
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
75 |         results = r.json()
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
   |                       ^
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |

E702 Multiple statements on one line (semicolon)
  --> infra/handlers_search.py:76:73
   |
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
75 |         results = r.json()
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
   |                                                                          ^
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/handlers_search.py:78:27
   |
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |                           ^^^^^^^^^^^^
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:79:16
   |
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/handlers_search.py:79:39
   |
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                                       ^^^^^^^^^^^^
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
   |

E722 Do not use bare `except`
  --> infra/handlers_search.py:80:13
   |
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |             ^^^^^^
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:80:19
   |
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |                   ^
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> infra/handlers_search.py:82:19
   |
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                   ^^^^^^^^^^^^
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:82:42
   |
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:85:52
   |
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
85 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
   |                                                    ^
86 |         markup = InlineKeyboardMarkup()
87 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |

E722 Do not use bare `except`
  --> infra/handlers_search.py:90:5
   |
88 |         markup.add(*btns)
89 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
90 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
   |     ^^^^^^
   |

E701 Multiple statements on one line (colon)
  --> infra/handlers_search.py:90:11
   |
88 |         markup.add(*btns)
89 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
90 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
   |           ^
   |

E401 [*] Multiple imports on one line
 --> infra/main.py:1:1
  |
1 | import telebot, threading, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from flask import Flask
3 | from config import *
  |
help: Split imports

F403 `from config import *` used; unable to detect undefined names
 --> infra/main.py:3:1
  |
1 | import telebot, threading, logging
2 | from flask import Flask
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 | from handlers_admin import register_admin_handlers
5 | from handlers_media import register_media_handlers
  |

F405 `TOKEN` may be undefined, or defined from star imports
  --> infra/main.py:9:23
   |
 8 | # --- CONFIGURATION PRINCIPALE ---
 9 | bot = telebot.TeleBot(TOKEN)
   |                       ^^^^^
10 |
11 | # --- FLASK SERVER ---
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> infra/main.py:30:34
   |
29 |     # 2. Register Modules
30 |     register_admin_handlers(bot, is_authorized)
   |                                  ^^^^^^^^^^^^^
31 |     register_media_handlers(bot, is_authorized)
32 |     register_search_handlers(bot, is_authorized)
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> infra/main.py:31:34
   |
29 |     # 2. Register Modules
30 |     register_admin_handlers(bot, is_authorized)
31 |     register_media_handlers(bot, is_authorized)
   |                                  ^^^^^^^^^^^^^
32 |     register_search_handlers(bot, is_authorized)
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> infra/main.py:32:35
   |
30 |     register_admin_handlers(bot, is_authorized)
31 |     register_media_handlers(bot, is_authorized)
32 |     register_search_handlers(bot, is_authorized)
   |                                   ^^^^^^^^^^^^^
33 |     
34 |     print("ğŸš€ Bot dÃ©marrÃ© en mode modulaire (Orchestrateur Clean)...")
   |

F401 [*] `json` imported but unused
 --> infra/monitoring/add_ip_widgets.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/apply_blueprint_ip.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/architect_protocol_ip.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/convert_temp_to_curve.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/create_custom_dashboard.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/definitive_ip_fix.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/deploy_architect_master.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/deploy_v2_clean.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/extend_ip_lookback.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/filter_error_ip.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/final_fix_grafana.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/finalize_vpn_display.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/fix_datasource_uid.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/fix_final_ip_display.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/fix_ip_display.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/fix_stat_labels.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/fix_vpn_status.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/force_vpn_ip_table.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/redesign_storage_clarity.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/redesign_storage_ratio_stat.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/revert_vpn_ip.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F841 [*] Local variable `e` is assigned to but never used
  --> infra/monitoring/scripts/vpn_exporter.py:21:33
   |
19 |                 metric_line = 'vpn_public_ip_info{ip="' + str(ip) + '"} 1\n'
20 |                 self.wfile.write(metric_line.encode('utf-8'))
21 |             except Exception as e:
   |                                 ^
22 |                 # In case of error, we return 200 but NO metrics, or a 503.
23 |                 # Returning 200 with no metrics is cleaner for Prometheus (target stays UP but no data).
   |
help: Remove assignment to unused variable `e`

F401 [*] `json` imported but unused
 --> infra/monitoring/update_grafana_temp.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

E722 Do not use bare `except`
  --> infra/monitoring/update_ips.py:10:5
   |
 8 |     try:
 9 |         return requests.get("https://api.ipify.org", timeout=5).text
10 |     except:
   |     ^^^^^^
11 |         return "Unknown"
   |

E722 Do not use bare `except`
  --> infra/monitoring/update_ips.py:18:5
   |
16 |         # Use wget as curl is missing in gluetun
17 |         vpn_ip = subprocess.check_output("docker exec gluetun wget -qO- https://api.ipify.org", shell=True).decode().strip()
18 |     except:
   |     ^^^^^^
19 |         vpn_ip = "Unknown"
   |

F401 [*] `json` imported but unused
 --> infra/monitoring/update_storage_master.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/update_storage_ratio.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/update_storage_units.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

F401 [*] `json` imported but unused
 --> infra/monitoring/update_vpn_metric.py:2:8
  |
1 | import requests
2 | import json
  |        ^^^^
3 |
4 | GRAFANA_URL = "http://admin:Japlcdb33@localhost:3100"
  |
help: Remove unused import: `json`

E401 [*] Multiple imports on one line
 --> infra/pi_bot.py:1:1
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import datetime, timedelta
3 | from telebot import types
  |
help: Split imports

F401 [*] `time` imported but unused
 --> infra/pi_bot.py:1:62
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  |                                                              ^^^^
2 | from datetime import datetime, timedelta
3 | from telebot import types
  |
help: Remove unused import: `time`

F401 [*] `datetime.datetime` imported but unused
 --> infra/pi_bot.py:2:22
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                      ^^^^^^^^
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import

F401 [*] `datetime.timedelta` imported but unused
 --> infra/pi_bot.py:2:32
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                                ^^^^^^^^^
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import

F401 [*] `flask.request` imported but unused
 --> infra/pi_bot.py:5:26
  |
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
5 | from flask import Flask, request
  |                          ^^^^^^^
6 | import share_engine
  |
help: Remove unused import: `flask.request`

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:24:8
   |
22 | # --- UTILS & STORAGE ---
23 | def load_allowed_users():
24 |     try: return json.load(open(USERS_FILE))["allowed"]
   |        ^
25 |     except: return [SUPER_ADMIN]
   |

E722 Do not use bare `except`
  --> infra/pi_bot.py:25:5
   |
23 | def load_allowed_users():
24 |     try: return json.load(open(USERS_FILE))["allowed"]
25 |     except: return [SUPER_ADMIN]
   |     ^^^^^^
26 |
27 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:25:11
   |
23 | def load_allowed_users():
24 |     try: return json.load(open(USERS_FILE))["allowed"]
25 |     except: return [SUPER_ADMIN]
   |           ^
26 |
27 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:34:94
   |
33 | def get_storage_emoji(item):
34 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0: return "ğŸ”´"
   |                                                                                              ^
35 |     path = item.get('path', '')
36 |     return "ğŸ“š" if path and "/mnt/externe" in path else "ğŸš€"
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:41:37
   |
39 | @bot.message_handler(commands=['admin'])
40 | def admin_main(m):
41 |     if m.from_user.id != SUPER_ADMIN: return
   |                                     ^
42 |     markup = InlineKeyboardMarkup(row_width=1)
43 |     markup.add(InlineKeyboardButton("ğŸ“‚ Partage", callback_data="adm:share"),
   |

E702 Multiple statements on one line (semicolon)
  --> infra/pi_bot.py:54:30
   |
52 |         users = load_allowed_users()
53 |         if uid not in users:
54 |             users.append(uid); save_users(users)
   |                              ^
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:56:13
   |
54 |             users.append(uid); save_users(users)
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |             ^
57 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |

E722 Do not use bare `except`
  --> infra/pi_bot.py:57:5
   |
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
57 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |     ^^^^^^
58 |
59 | # --- MEDIA ENGINE (ORIGINAL) ---
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:57:11
   |
55 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
56 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
57 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |           ^
58 |
59 | # --- MEDIA ENGINE (ORIGINAL) ---
   |

E702 Multiple statements on one line (semicolon)
  --> infra/pi_bot.py:63:39
   |
61 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
62 |     try:
63 |         items = json.loads(res.stdout); ctx = {}
   |                                       ^
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:65:16
   |
63 |         items = json.loads(res.stdout); ctx = {}
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
66 |             except: ctx = {}
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

E722 Do not use bare `except`
  --> infra/pi_bot.py:66:13
   |
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
66 |             except: ctx = {}
   |             ^^^^^^
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:66:19
   |
64 |         if os.path.exists(CONTEXT_FILE):
65 |             try: ctx = json.load(open(CONTEXT_FILE))
66 |             except: ctx = {}
   |                   ^
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:68:42
   |
66 |             except: ctx = {}
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
69 |     except: return
70 |     if not items:
   |

E722 Do not use bare `except`
  --> infra/pi_bot.py:69:5
   |
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
69 |     except: return
   |     ^^^^^^
70 |     if not items:
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:69:11
   |
67 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
68 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
69 |     except: return
   |           ^
70 |     if not items:
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:72:19
   |
70 |     if not items:
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
72 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
   |                   ^
73 |         else: bot.send_message(m.chat.id, msg)
74 |         return
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:73:13
   |
71 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
72 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
73 |         else: bot.send_message(m.chat.id, msg)
   |             ^
74 |         return
75 |     text = f"ğŸ¬ {title} : {cat}\n\n"
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:76:36
   |
74 |         return
75 |     text = f"ğŸ¬ {title} : {cat}\n\n"
76 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
   |                                    ^
77 |     markup = InlineKeyboardMarkup(row_width=5)
78 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:80:15
   |
78 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
79 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
80 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |               ^
81 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:81:9
   |
79 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
80 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
81 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |         ^
82 |
83 | # --- PAGED MEDIA UI (LIVE API) ---
   |

E702 Multiple statements on one line (semicolon)
  --> infra/pi_bot.py:89:29
   |
87 |     try:
88 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
89 |         r.raise_for_status(); data = r.json()
   |                             ^
90 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:90:31
   |
88 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
89 |         r.raise_for_status(); data = r.json()
90 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
   |                               ^
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
92 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:91:13
   |
89 |         r.raise_for_status(); data = r.json()
90 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
   |             ^
92 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
   |

E702 Multiple statements on one line (semicolon)
  --> infra/pi_bot.py:93:27
   |
91 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
92 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
   |                           ^
94 |         items = owned[start:end]
95 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot.py:95:21
   |
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
94 |         items = owned[start:end]
95 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |                     ^
96 |         text = f"{'ğŸ¬' if category == 'films' else 'ğŸ“º'} **{category.capitalize()}** ({total})\n\n"
97 |         for i, item in enumerate(items, 1):
   |

E702 Multiple statements on one line (semicolon)
  --> infra/pi_bot.py:95:59
   |
93 |         total = len(owned); start, end = page * 10, (page + 1) * 10
94 |         items = owned[start:end]
95 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |                                                            ^
96 |         text = f"{'ğŸ¬' if category == 'films' else 'ğŸ“º'} **{category.capitalize()}** ({total})\n\n"
97 |         for i, item in enumerate(items, 1):
   |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:103:20
    |
101 |         markup.add(*btns)
102 |         nav = []
103 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
    |                    ^
104 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
105 |         if nav: markup.row(*nav)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:104:23
    |
102 |         nav = []
103 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
104 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
    |                       ^
105 |         if nav: markup.row(*nav)
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:105:15
    |
103 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
104 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
105 |         if nav: markup.row(*nav)
    |               ^
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:107:18
    |
105 |         if nav: markup.row(*nav)
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |                  ^
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:108:13
    |
106 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
    |             ^
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:109:5
    |
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |     ^^^^^^
110 |
111 | @bot.message_handler(commands=['films'])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:109:11
    |
107 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
108 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
109 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |           ^
110 |
111 | @bot.message_handler(commands=['films'])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:113:32
    |
111 | @bot.message_handler(commands=['films'])
112 | def films_cmd(m):
113 |     if is_authorized(m.chat.id): show_media_list(m.chat.id, None, "films", 0, True)
    |                                ^
114 |
115 | @bot.message_handler(commands=['series'])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:117:32
    |
115 | @bot.message_handler(commands=['series'])
116 | def series_cmd(m):
117 |     if is_authorized(m.chat.id): show_media_list(m.chat.id, None, "series", 0, True)
    |                                ^
118 |
119 | # --- SEARCH ENGINE (/GET) ---
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:126:5
    |
124 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": â€¦
125 |         return res.json()['choices'][0]['message']['content']
126 |     except: return None
    |     ^^^^^^
127 |
128 | @bot.message_handler(commands=['get'])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:126:11
    |
124 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": â€¦
125 |         return res.json()['choices'][0]['message']['content']
126 |     except: return None
    |           ^
127 |
128 | @bot.message_handler(commands=['get'])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:130:36
    |
128 | @bot.message_handler(commands=['get'])
129 | def handle_get(m):
130 |     if not is_authorized(m.chat.id): return
    |                                    ^
131 |     parts = m.text.split(' ', 1)
132 |     if len(parts) > 1: process_get_request(m, parts[1])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:132:22
    |
130 |     if not is_authorized(m.chat.id): return
131 |     parts = m.text.split(' ', 1)
132 |     if len(parts) > 1: process_get_request(m, parts[1])
    |                      ^
133 |     else: bot.reply_to(m, "ğŸ¬ Que veux-tu ?")
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:133:9
    |
131 |     parts = m.text.split(' ', 1)
132 |     if len(parts) > 1: process_get_request(m, parts[1])
133 |     else: bot.reply_to(m, "ğŸ¬ Que veux-tu ?")
    |         ^
134 |
135 | def process_get_request(m, query):
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:140:30
    |
138 |     try:
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
    |                              ^
141 |     except: titre = query; cat = "movie"
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:141:5
    |
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
141 |     except: titre = query; cat = "movie"
    |     ^^^^^^
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
143 |     try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:141:11
    |
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
141 |     except: titre = query; cat = "movie"
    |           ^
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
143 |     try:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:141:26
    |
139 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
140 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
141 |     except: titre = query; cat = "movie"
    |                          ^
142 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
143 |     try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:146:23
    |
144 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
145 |         results = r.json()
146 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
    |                       ^
147 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
148 |         limit = min(len(results), 5)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:146:73
    |
144 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
145 |         results = r.json()
146 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
    |                                                                          ^
147 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
148 |         limit = min(len(results), 5)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:149:52
    |
147 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
148 |         limit = min(len(results), 5)
149 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
    |                                                    ^
150 |         markup = InlineKeyboardMarkup()
151 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:154:5
    |
152 |         markup.add(*btns)
153 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
154 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
    |     ^^^^^^
155 |
156 | # --- MASTER CALLBACK ROUTER ---
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:154:11
    |
152 |         markup.add(*btns)
153 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
154 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
    |           ^
155 |
156 | # --- MASTER CALLBACK ROUTER ---
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:159:44
    |
157 | @bot.callback_query_handler(func=lambda call: True)
158 | def master_router(call):
159 |     if not is_authorized(call.from_user.id): return
    |                                            ^
160 |     d = call.data.split(":")
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:164:27
    |
162 |     # 1. New Paged UI Callbacks
163 |     if d[0] in ["m_pag", "m_sel", "m_act", "dl_sel"]:
164 |         if d[0] == "m_pag": show_media_list(call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                           ^
165 |         elif d[0] == "m_sel":
166 |             markup = InlineKeyboardMarkup()
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:171:30
    |
169 | â€¦                    InlineKeyboardButton("â¬…ï¸ Retour", callback_data=f"m_pag:{d[1]}:0"))
170 | â€¦         bot.edit_message_text(f"ğŸ¯ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
171 | â€¦     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "ğŸ“¥ AjoutÃ©.")
    |                            ^
172 | â€¦     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistrÃ©e.", show_alert=True)
173 | â€¦     return
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:172:29
    |
170 | â€¦         bot.edit_message_text(f"ğŸ¯ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
171 | â€¦     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "ğŸ“¥ AjoutÃ©.")
172 | â€¦     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistrÃ©e.", show_alert=True)
    |                           ^
173 | â€¦     return
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:191:41
    |
189 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
190 | â€¦     elif cmd == "users_list":
191 | â€¦         users = load_allowed_users(); text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
    |                                       ^
192 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=InlineKeyboardMarkup().add(InlineKeâ€¦
193 | â€¦     elif cmd == "users_add":
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:197:41
    |
195 |             bot.register_next_step_handler(msg, process_user_add)
196 |         elif cmd == "users_rev":
197 |             users = load_allowed_users(); markup = InlineKeyboardMarkup(row_width=1)
    |                                         ^
198 |             for u in users:
199 |                 if u == SUPER_ADMIN: continue
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:199:36
    |
197 |             users = load_allowed_users(); markup = InlineKeyboardMarkup(row_width=1)
198 |             for u in users:
199 |                 if u == SUPER_ADMIN: continue
    |                                    ^
200 |                 markup.add(InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
201 |             markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:204:28
    |
202 | â€¦         bot.edit_message_text("SÃ©lectionnez l'ID Ã  rÃ©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
    |                          ^
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:205:28
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                          ^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:205:47
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                             ^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:205:66
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                                                ^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |

F541 [*] f-string without any placeholders
   --> infra/pi_bot.py:205:103
    |
203 | â€¦     elif cmd == "users_del":
204 | â€¦         uid = int(d[2]); users = load_allowed_users()
205 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                                                                                     ^^^^^^^^^^^^^^
206 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
207 | â€¦     elif cmd == "share_owned":
    |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:211:33
    |
209 | â€¦         markup.add(InlineKeyboardButton("ğŸ¬ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("ğŸ“º SÃ©ries", callba â€¦
210 | â€¦         bot.edit_message_text("CatÃ©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
211 | â€¦     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
    |                               ^
212 | â€¦     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
213 | â€¦     return
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:212:28
    |
210 |             bot.edit_message_text("CatÃ©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
211 |         elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
212 |         elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                            ^
213 |         return
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:218:46
    |
216 |     if d[0] == "sel":
217 |         try:
218 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                              ^
219 |             markup = InlineKeyboardMarkup(row_width=2)
220 |             act = "arc" if item['is_nvme'] else "res"
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:218:66
    |
216 |     if d[0] == "sel":
217 |         try:
218 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                  ^
219 |             markup = InlineKeyboardMarkup(row_width=2)
220 |             act = "arc" if item['is_nvme'] else "res"
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:222:48
    |
220 | â€¦     act = "arc" if item['is_nvme'] else "res"
221 | â€¦     markup.add(InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("ğŸ—‘ï¸ Supprimer"â€¦
222 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                                          ^
223 | â€¦     markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
224 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:225:9
    |
223 |             markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
224 |             bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
225 |         except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |         ^^^^^^
226 |     elif d[0] == "act":
227 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:225:15
    |
223 |             markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
224 |             bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
225 |         except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |               ^
226 |     elif d[0] == "act":
227 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:228:46
    |
226 |     elif d[0] == "act":
227 |         try:
228 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                              ^
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:228:66
    |
226 |     elif d[0] == "act":
227 |         try:
228 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                  ^
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:231:9
    |
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
231 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |         ^^^^^^
232 |     elif d[0] == "share_exec":
233 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:231:15
    |
229 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
230 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
231 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |               ^
232 |     elif d[0] == "share_exec":
233 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:234:46
    |
232 |     elif d[0] == "share_exec":
233 |         try:
234 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                              ^
235 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
236 |             if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:234:66
    |
232 |     elif d[0] == "share_exec":
233 |         try:
234 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                  ^
235 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
236 |             if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:235:45
    |
233 |         try:
234 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
235 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                             ^
236 |             if subtitles:
237 |                 markup = InlineKeyboardMarkup(row_width=1)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:240:17
    |
238 |                 markup.add(InlineKeyboardButton("âš¡ Symlink", callback_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("ğŸ¬ Remu â€¦
239 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
240 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
    |                 ^
241 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
242 |     elif d[0] == "share_final":
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:241:9
    |
239 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
240 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
241 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |         ^^^^^^
242 |     elif d[0] == "share_final":
243 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:241:15
    |
239 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
240 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
241 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |               ^
242 |     elif d[0] == "share_final":
243 |         try:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:244:46
    |
242 |     elif d[0] == "share_final":
243 |         try:
244 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                              ^
245 |             remux_opt = True if d[2] == "remux" else False
246 |             bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:244:66
    |
242 |     elif d[0] == "share_final":
243 |         try:
244 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                  ^
245 |             remux_opt = True if d[2] == "remux" else False
246 |             bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:251:17
    |
249 |                 msg = f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`"
250 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
    |                 ^
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:252:9
    |
250 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |         ^^^^^^
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:252:15
    |
250 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |               ^
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:253:26
    |
251 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
252 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
253 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                          ^
254 |
255 | # --- STATUS & QUEUE ---
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:258:36
    |
256 | @bot.message_handler(commands=['status'])
257 | def status_command(m):
258 |     if not is_authorized(m.chat.id): return
    |                                    ^
259 |     try:
260 |         nvme = shutil.disk_usage('/')
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:267:5
    |
265 |             msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
266 |         bot.reply_to(m, msg, parse_mode='Markdown')
267 |     except: bot.reply_to(m, "âŒ Erreur lecture disque.")
    |     ^^^^^^
268 |
269 | @bot.message_handler(commands=['queue'])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:267:11
    |
265 |             msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
266 |         bot.reply_to(m, msg, parse_mode='Markdown')
267 |     except: bot.reply_to(m, "âŒ Erreur lecture disque.")
    |           ^
268 |
269 | @bot.message_handler(commands=['queue'])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:271:36
    |
269 | @bot.message_handler(commands=['queue'])
270 | def queue_command(m):
271 |     if not is_authorized(m.chat.id): return
    |                                    ^
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:273:82
    |
271 |     if not is_authorized(m.chat.id): return
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |                                                                                  ^
274 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
275 |         q_text = "ğŸ“¥ **Queue :**\n\n"
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:274:24
    |
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
274 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
    |                        ^
275 |         q_text = "ğŸ“¥ **Queue :**\n\n"
276 |         for t in torrents:
    |

E702 Multiple statements on one line (semicolon)
   --> infra/pi_bot.py:274:58
    |
272 |     try:
273 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
274 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
    |                                                          ^
275 |         q_text = "ğŸ“¥ **Queue :**\n\n"
276 |         for t in torrents:
    |

E722 Do not use bare `except`
   --> infra/pi_bot.py:281:5
    |
279 |                 q_text += f"â€¢ **{name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB\n"
280 |         bot.reply_to(m, q_text, parse_mode='Markdown')
281 |     except: bot.reply_to(m, "âŒ Erreur qBit.")
    |     ^^^^^^
282 |
283 | # --- STARTUP ---
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot.py:281:11
    |
279 |                 q_text += f"â€¢ **{name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB\n"
280 |         bot.reply_to(m, q_text, parse_mode='Markdown')
281 |     except: bot.reply_to(m, "âŒ Erreur qBit.")
    |           ^
282 |
283 | # --- STARTUP ---
    |

E401 [*] Multiple imports on one line
 --> infra/pi_bot_debug.py:1:1
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Split imports

F401 [*] `time` imported but unused
 --> infra/pi_bot_debug.py:1:62
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  |                                                              ^^^^
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import: `time`

F401 [*] `datetime.datetime` imported but unused
 --> infra/pi_bot_debug.py:2:22
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                      ^^^^^^^^
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
4 | from flask import Flask, request
  |
help: Remove unused import: `datetime.datetime`

F401 [*] `telebot.types.BotCommand` imported but unused
 --> infra/pi_bot_debug.py:3:27
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                           ^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `telebot.types.BotCommandScopeChat` imported but unused
 --> infra/pi_bot_debug.py:3:39
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                                       ^^^^^^^^^^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `telebot.types.BotCommandScopeDefault` imported but unused
 --> infra/pi_bot_debug.py:3:60
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                                                            ^^^^^^^^^^^^^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `flask.request` imported but unused
 --> infra/pi_bot_debug.py:4:26
  |
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
4 | from flask import Flask, request
  |                          ^^^^^^^
5 | import share_engine
  |
help: Remove unused import: `flask.request`

E701 Multiple statements on one line (colon)
  --> infra/pi_bot_debug.py:25:8
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
   |        ^
26 |     except: return [SUPER_ADMIN]
   |

E722 Do not use bare `except`
  --> infra/pi_bot_debug.py:26:5
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
26 |     except: return [SUPER_ADMIN]
   |     ^^^^^^
27 |
28 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot_debug.py:26:11
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
26 |     except: return [SUPER_ADMIN]
   |           ^
27 |
28 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot_debug.py:49:40
   |
47 | @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
48 | def admin_router(call):
49 |     if call.from_user.id != SUPER_ADMIN: return
   |                                        ^
50 |     parts = call.data.split(":")
51 |     cmd = parts[1]
   |

E701 Multiple statements on one line (colon)
  --> infra/pi_bot_debug.py:85:32
   |
83 |         markup = InlineKeyboardMarkup(row_width=1)
84 |         for u in users:
85 |             if u == SUPER_ADMIN: continue
   |                                ^
86 |             markup.add(InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
87 |         markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:113:24
    |
111 |         bot.edit_message_text("ğŸ§¹ **Nettoyage SSD**\n\nFonctionnalitÃ© en cours de dÃ©veloppement.", call.message.chat.id, call.message.â€¦
112 |     
113 |     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                        ^
114 |
115 | def process_user_add(m):
    |

E722 Do not use bare `except`
   --> infra/pi_bot_debug.py:125:5
    |
123 |         else:
124 |             bot.reply_to(m, "â„¹ï¸ Cet utilisateur est dÃ©jÃ  autorisÃ©.")
125 |     except:
    |     ^^^^^^
126 |         bot.reply_to(m, "âŒ ID invalide. Veuillez envoyer un nombre.")
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:135:16
    |
133 |         ctx = {}
134 |         if os.path.exists(CONTEXT_FILE):
135 |             try: ctx = json.load(open(CONTEXT_FILE))
    |                ^
136 |             except: ctx = {}
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
    |

E722 Do not use bare `except`
   --> infra/pi_bot_debug.py:136:13
    |
134 |         if os.path.exists(CONTEXT_FILE):
135 |             try: ctx = json.load(open(CONTEXT_FILE))
136 |             except: ctx = {}
    |             ^^^^^^
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
138 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:136:19
    |
134 |         if os.path.exists(CONTEXT_FILE):
135 |             try: ctx = json.load(open(CONTEXT_FILE))
136 |             except: ctx = {}
    |                   ^
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
138 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:138:42
    |
136 |             except: ctx = {}
137 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
138 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |                                          ^
139 |     except Exception as e:
140 |         logging.error(f"Context save failed: {e}")
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:144:19
    |
142 |     if not items:
143 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
144 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
    |                   ^
145 |         else: bot.send_message(m.chat.id, msg)
146 |         return
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:145:13
    |
143 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
144 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
145 |         else: bot.send_message(m.chat.id, msg)
    |             ^
146 |         return
147 |     text = f"ğŸ¬ {title} : {cat}\n\n"
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:148:36
    |
146 |         return
147 |     text = f"ğŸ¬ {title} : {cat}\n\n"
148 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
    |                                    ^
149 |     markup = InlineKeyboardMarkup(row_width=5)
150 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:152:15
    |
150 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
151 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
152 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |               ^
153 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:153:9
    |
151 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
152 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
153 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |         ^
154 |
155 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:157:44
    |
155 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
156 | def media_callbacks(call):
157 |     if not is_authorized(call.from_user.id): return
    |                                            ^
158 |     d = call.data.split(":")
159 |     if d[0] == "sel":
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:161:46
    |
159 |     if d[0] == "sel":
160 |         try:
161 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
162 |             item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
163 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:177:46
    |
175 |     elif d[0] == "act":
176 |         try:
177 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
178 |             item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
179 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:187:46
    |
185 |     elif d[0] == "share_exec":
186 |         try:
187 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
188 |             item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
189 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:210:46
    |
208 |     elif d[0] == "share_final":
209 |         try:
210 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
211 |             item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
212 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:234:26
    |
232 |         else:
233 |             bot.send_message(call.message.chat.id, "âŒ Erreur: Ã‰chec du partage ou contenu hors limites.")
234 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                          ^
235 |     elif d[0] == "dl":
236 |         if d[1] == "no":
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:241:50
    |
239 |         elif d[1] == "yes":
240 |             try:
241 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                                  ^
242 |                 dl_data = ctx.get(str(call.message.chat.id) + "_dl")
243 |                 if not dl_data:
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/pi_bot_debug.py:246:33
    |
244 |                     bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
245 |                     return
246 |             except Exception as e:
    |                                 ^
247 |                 bot.answer_callback_query(call.id, "âŒ Erreur de session.")
248 |                 return
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:283:36
    |
281 | @bot.message_handler(commands=['status'])
282 | def status_command(m):
283 |     if not is_authorized(m.chat.id): return
    |                                    ^
284 |     try:
285 |         nvme = shutil.disk_usage('/')
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/pi_bot_debug.py:291:25
    |
289 |         msg = f"ğŸ“Š **Stockage Temps RÃ©el**\n\nğŸš€ **NVMe** : `{fmt(nvme)}`\nğŸ“š **HDD** : `{fmt(hdd)}`"
290 |         bot.reply_to(m, msg, parse_mode='Markdown')
291 |     except Exception as e:
    |                         ^
292 |         bot.reply_to(m, "âŒ Erreur de lecture disque temps rÃ©el.")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:296:36
    |
294 | @bot.message_handler(commands=['films'])
295 | def films_command(m):
296 |     if not is_authorized(m.chat.id): return
    |                                    ^
297 |     try:
298 |         logging.info(f"[DEBUG_API] Interrogation Radarr Ã  {RADARR_CFG['url']}")
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/pi_bot_debug.py:308:25
    |
306 |         text += "\n".join([f"â€¢ {f['title']} ({f['year']})" for f in owned[:50]])
307 |         bot.reply_to(m, text, parse_mode='Markdown')
308 |     except Exception as e:
    |                         ^
309 |         bot.reply_to(m, "âŒ Erreur API Radarr (Consultez les logs).")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:313:36
    |
311 | @bot.message_handler(commands=['series'])
312 | def series_command(m):
313 |     if not is_authorized(m.chat.id): return
    |                                    ^
314 |     try:
315 |         r = requests.get(f"{SONARR_CFG['url']}/api/v3/series", headers={"X-Api-Key": SONARR_CFG['key']}, timeout=5)
    |

F841 [*] Local variable `e` is assigned to but never used
   --> infra/pi_bot_debug.py:322:25
    |
320 |         text += "\n".join([f"â€¢ {s['title']} â€” `{s['statistics']['episodeFileCount']}` Ã©pisodes" for s in owned])
321 |         bot.reply_to(m, text, parse_mode='Markdown')
322 |     except Exception as e:
    |                         ^
323 |         bot.reply_to(m, "âŒ Erreur API Sonarr (Consultez les logs).")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:327:36
    |
325 | @bot.message_handler(commands=['queue'])
326 | def queue_command(m):
327 |     if not is_authorized(m.chat.id): return
    |                                    ^
328 |     
329 |     def clean_title(name):
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:337:24
    |
335 | â€¦     tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', râ€¦
336 | â€¦     clean = f"{title} ({year})" if year else title
337 | â€¦     for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
    |                      ^
338 | â€¦     return re.sub(r'\s+', ' ', clean).strip()
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:351:42
    |
349 |                     progress = round(t['progress'] * 100, 1)
350 |                     eta_sec = t['eta']
351 |                     if eta_sec >= 8640000: eta = "âˆ"
    |                                          ^
352 |                     else:
353 |                         eta = str(timedelta(seconds=eta_sec)).split(".")[0]
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:425:36
    |
423 | @bot.message_handler(commands=['get'])
424 | def handle_get_command_entry(m):
425 |     if not is_authorized(m.chat.id): return
    |                                    ^
426 |     parts = m.text.split(' ', 1)
427 |     if len(parts) > 1 and parts[1].strip():
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:435:36
    |
434 | def process_get_step(m):
435 |     if not is_authorized(m.chat.id): return
    |                                    ^
436 |     if m.text.startswith('/'):
437 |         return
    |

F841 Local variable `saison` is assigned to but never used
   --> infra/pi_bot_debug.py:458:9
    |
456 |         titre = str(data.get('titre'))
457 |         type_media = str(data.get('type'))
458 |         saison = int(data['saison']) if data.get('saison') is not None else None
    |         ^^^^^^
459 |         episode = int(data['episode']) if data.get('episode') is not None else None
460 |     except (ValueError, TypeError):
    |
help: Remove assignment to unused variable `saison`

F841 Local variable `episode` is assigned to but never used
   --> infra/pi_bot_debug.py:459:9
    |
457 |         type_media = str(data.get('type'))
458 |         saison = int(data['saison']) if data.get('saison') is not None else None
459 |         episode = int(data['episode']) if data.get('episode') is not None else None
    |         ^^^^^^^
460 |     except (ValueError, TypeError):
461 |         bot.reply_to(m, "âŒ Erreur de formatage des mÃ©tadonnÃ©es extraites.")
    |
help: Remove assignment to unused variable `episode`

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:506:20
    |
504 |             ctx = {}
505 |             if os.path.exists(CONTEXT_FILE):
506 |                 try: ctx = json.load(open(CONTEXT_FILE))
    |                    ^
507 |                 except: ctx = {}
508 |             ctx[str(m.chat.id) + "_dl"] = {
    |

E722 Do not use bare `except`
   --> infra/pi_bot_debug.py:507:17
    |
505 |             if os.path.exists(CONTEXT_FILE):
506 |                 try: ctx = json.load(open(CONTEXT_FILE))
507 |                 except: ctx = {}
    |                 ^^^^^^
508 |             ctx[str(m.chat.id) + "_dl"] = {
509 |                 "type_media": type_media,
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:507:23
    |
505 |             if os.path.exists(CONTEXT_FILE):
506 |                 try: ctx = json.load(open(CONTEXT_FILE))
507 |                 except: ctx = {}
    |                       ^
508 |             ctx[str(m.chat.id) + "_dl"] = {
509 |                 "type_media": type_media,
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:516:46
    |
514 |                 "images": item.get('images')
515 |             }
516 |             with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |                                              ^
517 |         except Exception as e:
518 |             logging.error(f"Context save failed: {e}")
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:545:36
    |
543 | @bot.message_handler(func=lambda m: True)
544 | def handle_ai_request(m):
545 |     if not is_authorized(m.chat.id): return
    |                                    ^
546 |     if m.text.startswith('/'): return # Ignore native commands
547 |     process_get_request(m, m.text)
    |

E701 Multiple statements on one line (colon)
   --> infra/pi_bot_debug.py:546:30
    |
544 | def handle_ai_request(m):
545 |     if not is_authorized(m.chat.id): return
546 |     if m.text.startswith('/'): return # Ignore native commands
    |                              ^
547 |     process_get_request(m, m.text)
    |

F401 [*] `pathlib.Path` imported but unused
 --> scripts/cleanup_share.py:5:21
  |
3 | import time
4 | import logging
5 | from pathlib import Path
  |                     ^^^^
6 |
7 | # --- CONFIGURATION GLOBALE ---
  |
help: Remove unused import: `pathlib.Path`

F541 [*] f-string without any placeholders
   --> scripts/cleanup_share.py:114:26
    |
112 |             # CrÃ©ation du symlink pour tromper Sonarr/Radarr
113 |             os.symlink(dest_path, file_path)
114 |             logging.info(f"Migration rÃ©ussie : Symlink crÃ©Ã© sur le NVMe.")
    |                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
115 |             
116 |         except Exception as e:
    |
help: Remove extraneous `f` prefix

E722 Do not use bare `except`
   --> scripts/cleanup_share.py:123:18
    |
121 |                      shutil.move(dest_path, file_path)
122 |                      logging.info(f"Rollback rÃ©ussi pour {file_path}")
123 |                  except:
    |                  ^^^^^^
124 |                      pass
    |

E701 Multiple statements on one line (colon)
   --> scripts/cleanup_share.py:143:36
    |
142 |         for item in os.listdir(hdd_dir):
143 |             if item.startswith('.'): continue
    |                                    ^
144 |             
145 |             hdd_item_path = os.path.join(hdd_dir, item)
    |

E401 [*] Multiple imports on one line
 --> scripts/config.py:1:1
  |
1 | import json, os
  | ^^^^^^^^^^^^^^^
2 |
3 | # --- Helper ---
  |
help: Split imports

E701 Multiple statements on one line (colon)
  --> scripts/config.py:39:26
   |
38 | def is_authorized(uid):
39 |     if uid == SUPER_ADMIN: return True
   |                          ^
40 |     try:
41 |         if not os.path.exists(USERS_FILE):
   |

E401 [*] Multiple imports on one line
 --> scripts/handlers_admin.py:1:1
  |
1 | import telebot, os, shutil, json, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Split imports

F401 [*] `telebot` imported but unused
 --> scripts/handlers_admin.py:1:8
  |
1 | import telebot, os, shutil, json, logging
  |        ^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Remove unused import

F401 [*] `logging` imported but unused
 --> scripts/handlers_admin.py:1:35
  |
1 | import telebot, os, shutil, json, logging
  |                                   ^^^^^^^
2 | from telebot import types
3 | from config import *
  |
help: Remove unused import

F403 `from config import *` used; unable to detect undefined names
 --> scripts/handlers_admin.py:3:1
  |
1 | import telebot, os, shutil, json, logging
2 | from telebot import types
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 |
5 | def save_users(users):
  |

F405 `USERS_FILE` may be undefined, or defined from star imports
 --> scripts/handlers_admin.py:6:15
  |
5 | def save_users(users):
6 |     with open(USERS_FILE, "w") as f:
  |               ^^^^^^^^^^
7 |         json.dump({"allowed": users}, f)
  |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:12:45
   |
10 |     @bot.message_handler(commands=['status'])
11 |     def status_cmd(m):
12 |         if not is_authorized(m.from_user.id): return
   |                                             ^
13 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
14 |         try:
   |

E731 Do not assign a `lambda` expression, use a `def`
  --> scripts/handlers_admin.py:13:9
   |
11 |     def status_cmd(m):
12 |         if not is_authorized(m.from_user.id): return
13 |         fmt = lambda u: f"{u.used/(1024**3):.1f}/{u.total/(1024**3):.1f}Go ({int(u.used/u.total*100)}%)"
   |         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
14 |         try:
15 |             nvme = shutil.disk_usage('/')
   |
help: Rewrite `fmt` as a `def`

F541 [*] f-string without any placeholders
  --> scripts/handlers_admin.py:21:24
   |
19 |                 msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
20 |             else:
21 |                 msg += f"\nâš ï¸ **HDD** : `Non dÃ©tectÃ© sur /mnt/externe`"
   |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
22 |             bot.reply_to(m, msg, parse_mode='Markdown')
23 |         except Exception as e:
   |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:28:45
   |
26 |     @bot.message_handler(commands=['admin'])
27 |     def admin_menu(m):
28 |         if not is_authorized(m.from_user.id): return
   |                                             ^
29 |         markup = types.InlineKeyboardMarkup(row_width=1)
30 |         markup.add(types.InlineKeyboardButton("ğŸ“‚ Partage", callback_data="adm:share"),
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_admin.py:39:23
   |
37 |         try:
38 |             uid = int(m.text)
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:39:44
   |
37 |         try:
38 |             uid = int(m.text)
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_admin.py:41:34
   |
39 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
40 |             if uid not in users:
41 |                 users.append(uid); save_users(users)
   |                                  ^
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:43:17
   |
41 |                 users.append(uid); save_users(users)
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |                 ^
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |

E722 Do not use bare `except`
  --> scripts/handlers_admin.py:44:9
   |
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |         ^^^^^^
45 |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:44:15
   |
42 |                 bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
43 |             else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
44 |         except: bot.reply_to(m, "âŒ ID invalide.")
   |               ^
45 |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:48:48
   |
46 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
47 |     def admin_callback_router(call):
48 |         if not is_authorized(call.from_user.id): return
   |                                                ^
49 |         d = call.data.split(":")
50 |         cmd = d[1]
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_admin.py:65:23
   |
63 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
64 | â€¦     elif cmd == "users_list":
65 | â€¦         with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                     ^^^^^^^^^^
66 | â€¦         text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
67 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=types.InlineKeyboardMarkup().add(typâ€¦
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:65:44
   |
63 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
64 | â€¦     elif cmd == "users_list":
65 | â€¦         with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                          ^
66 | â€¦         text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
67 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=types.InlineKeyboardMarkup().add(typâ€¦
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_admin.py:72:23
   |
70 |             bot.register_next_step_handler(msg, process_user_add)
71 |         elif cmd == "users_rev":
72 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:72:44
   |
70 |             bot.register_next_step_handler(msg, process_user_add)
71 |         elif cmd == "users_rev":
72 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
   |

F405 `SUPER_ADMIN` may be undefined, or defined from star imports
  --> scripts/handlers_admin.py:75:25
   |
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
75 |                 if u == SUPER_ADMIN: continue
   |                         ^^^^^^^^^^^
76 |                 markup.add(types.InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
77 |             markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:75:36
   |
73 |             markup = types.InlineKeyboardMarkup(row_width=1)
74 |             for u in users:
75 |                 if u == SUPER_ADMIN: continue
   |                                    ^
76 |                 markup.add(types.InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
77 |             markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

F405 `USERS_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_admin.py:81:23
   |
79 |         elif cmd == "users_del":
80 |             uid = int(d[2])
81 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                       ^^^^^^^^^^
82 |             if uid in users:
83 |                 users.remove(uid)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_admin.py:81:44
   |
79 |         elif cmd == "users_del":
80 |             uid = int(d[2])
81 |             with open(USERS_FILE, 'r') as f: users = json.load(f)["allowed"]
   |                                            ^
82 |             if uid in users:
83 |                 users.remove(uid)
   |

F541 [*] f-string without any placeholders
  --> scripts/handlers_admin.py:85:52
   |
83 | â€¦             users.remove(uid)
84 | â€¦             save_users(users)
85 | â€¦             bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
   |                                                  ^^^^^^^^^^^^^^
86 | â€¦         admin_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chatâ€¦
87 | â€¦     elif cmd == "share_owned":
   |
help: Remove extraneous `f` prefix

E401 [*] Multiple imports on one line
 --> scripts/handlers_media.py:1:1
  |
1 | import requests, logging, os, json, subprocess, re, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import timedelta
3 | from telebot import types
  |
help: Split imports

F401 [*] `logging` imported but unused
 --> scripts/handlers_media.py:1:18
  |
1 | import requests, logging, os, json, subprocess, re, pathlib
  |                  ^^^^^^^
2 | from datetime import timedelta
3 | from telebot import types
  |
help: Remove unused import: `logging`

F403 `from config import *` used; unable to detect undefined names
 --> scripts/handlers_media.py:4:1
  |
2 | from datetime import timedelta
3 | from telebot import types
4 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
5 | import share_engine
  |

F405 `SCRIPT_PATH` may be undefined, or defined from star imports
  --> scripts/handlers_media.py:14:38
   |
13 | def list_media_unified(bot, m, cat, title, is_edit=False):
14 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
   |                                      ^^^^^^^^^^^
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_media.py:16:39
   |
14 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
   |                                       ^
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_media.py:17:27
   |
15 |     try:
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
   |                           ^^^^^^^^^^^^
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:18:16
   |
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_media.py:18:39
   |
16 |         items = json.loads(res.stdout); ctx = {}
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                                       ^^^^^^^^^^^^
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

E722 Do not use bare `except`
  --> scripts/handlers_media.py:19:13
   |
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |             ^^^^^^
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:19:19
   |
17 |         if os.path.exists(CONTEXT_FILE):
18 |             try: ctx = json.load(open(CONTEXT_FILE))
19 |             except: ctx = {}
   |                   ^
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_media.py:21:19
   |
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                   ^^^^^^^^^^^^
22 |     except: return
23 |     if not items:
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:21:42
   |
19 |             except: ctx = {}
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
22 |     except: return
23 |     if not items:
   |

E722 Do not use bare `except`
  --> scripts/handlers_media.py:22:5
   |
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
22 |     except: return
   |     ^^^^^^
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:22:11
   |
20 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
21 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
22 |     except: return
   |           ^
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:25:19
   |
23 |     if not items:
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
25 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
   |                   ^
26 |         else: bot.send_message(m.chat.id, msg)
27 |         return
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:26:13
   |
24 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
25 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
26 |         else: bot.send_message(m.chat.id, msg)
   |             ^
27 |         return
28 |     text = f"{title} : {cat}\n\n"
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:29:36
   |
27 |         return
28 |     text = f"{title} : {cat}\n\n"
29 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
   |                                    ^
30 |     markup = types.InlineKeyboardMarkup(row_width=5)
31 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:33:15
   |
31 |     markup.add(*[types.InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
32 |     markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
33 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |               ^
34 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:34:9
   |
32 |     markup.add(types.InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
33 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
34 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |         ^
35 |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> scripts/handlers_media.py:37:11
   |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
37 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
   |           ^^^^^^^^^^
38 |     endpoint = "movie" if category == "films" else "series"
39 |     try:
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> scripts/handlers_media.py:37:50
   |
36 | def show_media_list(bot, chat_id, message_id, category, page=0, is_new=False, is_authorized=None):
37 |     cfg = RADARR_CFG if category == "films" else SONARR_CFG
   |                                                  ^^^^^^^^^^
38 |     endpoint = "movie" if category == "films" else "series"
39 |     try:
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_media.py:41:29
   |
39 |     try:
40 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=10)
41 |         r.raise_for_status(); data = r.json()
   |                             ^
42 |         data.sort(key=lambda x: x.get('added', ''), reverse=True)
43 |         total = len(data)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:46:21
   |
44 |         start, end = page * 10, (page + 1) * 10
45 |         items = data[start:end]
46 |         if not items: bot.send_message(chat_id, "Vide."); return
   |                     ^
47 |         text = f"**{category.capitalize()} ({total})**\n\n"
48 |         for i, item in enumerate(items, 1):
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_media.py:46:57
   |
44 |         start, end = page * 10, (page + 1) * 10
45 |         items = data[start:end]
46 |         if not items: bot.send_message(chat_id, "Vide."); return
   |                                                         ^
47 |         text = f"**{category.capitalize()} ({total})**\n\n"
48 |         for i, item in enumerate(items, 1):
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:55:20
   |
53 |         markup.add(*btns)
54 |         nav_row = []
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
   |                    ^
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
57 |         if nav_row: markup.row(*nav_row)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:56:23
   |
54 |         nav_row = []
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
   |                       ^
57 |         if nav_row: markup.row(*nav_row)
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:57:19
   |
55 |         if page > 0: nav_row.append(types.InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
56 |         if end < total: nav_row.append(types.InlineKeyboardButton(f"â¡ï¸ ({total-end})", callback_data=f"m_pag:{category}:{page+1}"))
57 |         if nav_row: markup.row(*nav_row)
   |                   ^
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:59:18
   |
57 |         if nav_row: markup.row(*nav_row)
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
   |                  ^
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:60:13
   |
58 |         markup.add(types.InlineKeyboardButton("ğŸ  Menu Admin", callback_data="adm:main"))
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
   |             ^
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:61:26
   |
59 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
60 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
61 |     except Exception as e: bot.send_message(chat_id, f"âŒ Erreur API : {e}")
   |                          ^
62 |
63 | def register_media_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:66:36
   |
64 |     @bot.message_handler(commands=['films'])
65 |     def films_cmd(m):
66 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "films", 0, True, is_authorized)
   |                                    ^
67 |
68 |     @bot.message_handler(commands=['series'])
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:70:36
   |
68 |     @bot.message_handler(commands=['series'])
69 |     def series_cmd(m):
70 |         if is_authorized(m.chat.id): show_media_list(bot, m.chat.id, None, "series", 0, True, is_authorized)
   |                                    ^
71 |
72 |     @bot.message_handler(commands=['queue'])
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:74:40
   |
72 |     @bot.message_handler(commands=['queue'])
73 |     def queue_command(m):
74 |         if not is_authorized(m.chat.id): return
   |                                        ^
75 |         def clean_title(name):
76 |             name = os.path.splitext(name)[0]
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:83:28
   |
81 | â€¦         tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b'â€¦
82 | â€¦         clean = f"{title} ({year})" if year else title
83 | â€¦         for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
   |                          ^
84 | â€¦         return re.sub(r'\s+', ' ', clean).strip()
85 | â€¦     try:
   |

F405 `QBIT_URL` may be undefined, or defined from star imports
  --> scripts/handlers_media.py:86:33
   |
84 |             return re.sub(r'\s+', ' ', clean).strip()
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                 ^^^^^^^^
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_media.py:86:76
   |
84 |             return re.sub(r'\s+', ' ', clean).strip()
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
   |                                                                            ^
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:87:28
   |
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
   |                            ^
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
89 |             for t in torrents:
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_media.py:87:62
   |
85 |         try:
86 |             r = requests.get(f"{QBIT_URL}/api/v2/torrents/info", timeout=5); torrents = r.json()
87 |             if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
   |                                                              ^
88 |             q_text = "ğŸ“¥ **Queue :**\n\n"
89 |             for t in torrents:
   |

E722 Do not use bare `except`
  --> scripts/handlers_media.py:96:9
   |
94 |                     q_text += f"â€¢ **{clean_name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB | â³ {eta}  â€¦
95 |             bot.reply_to(m, q_text, parse_mode='Markdown')
96 |         except: bot.reply_to(m, "âŒ Erreur qBit.")
   |         ^^^^^^
97 |
98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_â€¦
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_media.py:96:15
   |
94 |                     q_text += f"â€¢ **{clean_name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB | â³ {eta}  â€¦
95 |             bot.reply_to(m, q_text, parse_mode='Markdown')
96 |         except: bot.reply_to(m, "âŒ Erreur qBit.")
   |               ^
97 |
98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "share_â€¦
   |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:100:48
    |
 98 |     @bot.callback_query_handler(func=lambda call: call.data.startswith(("m_pag", "m_sel", "m_act", "sel", "act", "share_exec", "shareâ€¦
 99 |     def media_callback_router(call):
100 |         if not is_authorized(call.from_user.id): return
    |                                                ^
101 |         d = call.data.split(":")
    |

F405 `RADARR_CFG` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:107:19
    |
105 |         elif d[0] == "m_sel":
106 |             cat, item_id = d[1], d[2]
107 |             cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                   ^^^^^^^^^^
108 |             endpoint = "movie" if cat == "films" else "series"
109 |             display_title = f"ID {item_id}"
    |

F405 `SONARR_CFG` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:107:53
    |
105 |         elif d[0] == "m_sel":
106 |             cat, item_id = d[1], d[2]
107 |             cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                                                     ^^^^^^^^^^
108 |             endpoint = "movie" if cat == "films" else "series"
109 |             display_title = f"ID {item_id}"
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:112:40
    |
110 |             try:
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
    |                                        ^
113 |             except: pass
114 |             markup = types.InlineKeyboardMarkup()
    |

E722 Do not use bare `except`
   --> scripts/handlers_media.py:113:13
    |
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
113 |             except: pass
    |             ^^^^^^
114 |             markup = types.InlineKeyboardMarkup()
115 |             markup.add(types.InlineKeyboardButton("ğŸ—‘ï¸ Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:113:19
    |
111 |                 r = requests.get(f"{cfg['url']}/api/v3/{endpoint}/{item_id}", headers={"X-Api-Key": cfg['key']}, timeout=5)
112 |                 if r.status_code == 200: display_title = r.json().get('title', display_title)
113 |             except: pass
    |                   ^
114 |             markup = types.InlineKeyboardMarkup()
115 |             markup.add(types.InlineKeyboardButton("ğŸ—‘ï¸ Supprimer", callback_data=f"m_act:del:{d[1]}:{d[2]}"),
    |

F405 `RADARR_CFG` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:123:23
    |
121 |             if action == "share":
122 |                 bot.answer_callback_query(call.id, "â³ GÃ©nÃ©ration du lien...")
123 |                 cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                       ^^^^^^^^^^
124 |                 endpoint = "movie" if cat == "films" else "series"
125 |                 try:
    |

F405 `SONARR_CFG` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:123:57
    |
121 |             if action == "share":
122 |                 bot.answer_callback_query(call.id, "â³ GÃ©nÃ©ration du lien...")
123 |                 cfg = RADARR_CFG if cat == "films" else SONARR_CFG
    |                                                         ^^^^^^^^^^
124 |                 endpoint = "movie" if cat == "films" else "series"
125 |                 try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:134:33
    |
132 |                                 msg = f"âœ… **Lien de partage gÃ©nÃ©rÃ© :**\n\nğŸ”— `{data['video']}`"
133 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
    |                                 ^
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:135:29
    |
133 |                                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
    |                             ^
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E722 Do not use bare `except`
   --> scripts/handlers_media.py:136:17
    |
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |                 ^^^^^^
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:136:23
    |
134 |                             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec lien.")
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
    |                       ^
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:137:17
    |
135 |                         else: bot.send_message(call.message.chat.id, "âŒ Chemin absent.")
136 |                 except: bot.send_message(call.message.chat.id, "âŒ Erreur API.")
137 |             else: bot.answer_callback_query(call.id, f"Action {action} ok.")
    |                 ^
138 |
139 |         elif d[0] == "sel":
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:141:27
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                           ^^^^^^^^^^^^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:141:50
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                  ^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/handlers_media.py:141:70
    |
139 |         elif d[0] == "sel":
140 |             try:
141 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                      ^
142 |                 markup = types.InlineKeyboardMarkup(row_width=2)
143 |                 act = "arc" if item['is_nvme'] else "res"
    |

F405 `SUPER_ADMIN` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:145:41
    |
143 | â€¦     act = "arc" if item['is_nvme'] else "res"
144 | â€¦     markup.add(types.InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("ğŸ—‘â€¦
145 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                               ^^^^^^^^^^^
146 | â€¦     markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:145:52
    |
143 | â€¦     act = "arc" if item['is_nvme'] else "res"
144 | â€¦     markup.add(types.InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), types.InlineKeyboardButton("ğŸ—‘â€¦
145 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(types.InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                                          ^
146 | â€¦     markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E722 Do not use bare `except`
   --> scripts/handlers_media.py:148:13
    |
146 |                 markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 |                 bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
148 |             except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |             ^^^^^^
149 |         elif d[0] == "act":
150 |             try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:148:19
    |
146 |                 markup.add(types.InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
147 |                 bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
148 |             except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |                   ^
149 |         elif d[0] == "act":
150 |             try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:151:27
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                           ^^^^^^^^^^^^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:151:50
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                  ^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/handlers_media.py:151:70
    |
149 |         elif d[0] == "act":
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                      ^
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

F405 `SCRIPT_PATH` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:152:50
    |
150 |             try:
151 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
    |                                                  ^^^^^^^^^^^
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |

E722 Do not use bare `except`
   --> scripts/handlers_media.py:154:13
    |
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |             ^^^^^^
155 |         elif d[0] == "share_exec":
156 |             try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:154:19
    |
152 |                 res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
153 |                 bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
154 |             except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |                   ^
155 |         elif d[0] == "share_exec":
156 |             try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:157:27
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                           ^^^^^^^^^^^^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:157:50
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                  ^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/handlers_media.py:157:70
    |
155 |         elif d[0] == "share_exec":
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                      ^
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
159 |                 if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/handlers_media.py:158:49
    |
156 |             try:
157 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
158 |                 src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                                 ^
159 |                 if subtitles:
160 |                     markup = types.InlineKeyboardMarkup(row_width=1)
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:163:21
    |
161 | â€¦                 markup.add(types.InlineKeyboardButton("âš¡ Symlink", callback_data=f"share_final:{d[1]}:link"), types.InlineKeyboardBâ€¦
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
    |                   ^
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
165 | â€¦     elif d[0] == "share_final":
    |

E722 Do not use bare `except`
   --> scripts/handlers_media.py:164:13
    |
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |           ^^^^^^
165 | â€¦     elif d[0] == "share_final":
166 | â€¦         try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:164:19
    |
162 | â€¦                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mâ€¦
163 | â€¦             else: media_callback_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"sharâ€¦
164 | â€¦         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |                 ^
165 | â€¦     elif d[0] == "share_final":
166 | â€¦         try:
    |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
   --> scripts/handlers_media.py:167:27
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                           ^^^^^^^^^^^^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:167:50
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                  ^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/handlers_media.py:167:70
    |
165 |         elif d[0] == "share_final":
166 |             try:
167 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                      ^
168 |                 remux_opt = True if d[2] == "remux" else False
169 |                 bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:171:44
    |
169 | â€¦         bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
170 | â€¦         data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
171 | â€¦         if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", parse â€¦
    |                                      ^
172 | â€¦         else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦     except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:172:21
    |
170 | â€¦             data = share_engine.generate_secure_link(item['path'], remux=remux_opt)
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
    |                   ^
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> scripts/handlers_media.py:173:13
    |
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |           ^^^^^^
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:173:19
    |
171 | â€¦             if data and "video" in data: bot.send_message(call.message.chat.id, f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`", p â€¦
172 | â€¦             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 | â€¦         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |                 ^
174 | â€¦     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/handlers_media.py:174:30
    |
172 |                 else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec.")
173 |             except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
174 |         elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                              ^
    |

E401 [*] Multiple imports on one line
 --> scripts/handlers_search.py:1:1
  |
1 | import telebot, json, requests, re, logging, os
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  |
help: Split imports

F401 [*] `telebot` imported but unused
 --> scripts/handlers_search.py:1:8
  |
1 | import telebot, json, requests, re, logging, os
  |        ^^^^^^^
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  |
help: Remove unused import: `telebot`

F403 `from config import *` used; unable to detect undefined names
 --> scripts/handlers_search.py:3:1
  |
1 | import telebot, json, requests, re, logging, os
2 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 |
5 | def stream_gpt_json(query):
  |

F405 `OPENAI_KEY` may be undefined, or defined from star imports
 --> scripts/handlers_search.py:6:79
  |
5 | def stream_gpt_json(query):
6 |     headers = {"Content-Type": "application/json", "Authorization": f"Bearer {OPENAI_KEY}"}
  |                                                                               ^^^^^^^^^^
7 |     prompt = f"Analyse : '{query}'. Renvoie JSON : {{\"titre\": \"str\", \"type\": \"serie|film\"}}"
8 |     try:
  |

E722 Do not use bare `except`
  --> scripts/handlers_search.py:11:5
   |
 9 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [â€¦
10 |         return res.json()['choices'][0]['message']['content']
11 |     except: return None
   |     ^^^^^^
12 |
13 | def register_search_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:11:11
   |
 9 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": [â€¦
10 |         return res.json()['choices'][0]['message']['content']
11 |     except: return None
   |           ^
12 |
13 | def register_search_handlers(bot, is_authorized):
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:16:45
   |
14 |     @bot.message_handler(commands=['get'])
15 |     def handle_get(m):
16 |         if not is_authorized(m.from_user.id): return
   |                                             ^
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:18:26
   |
16 |         if not is_authorized(m.from_user.id): return
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
   |                          ^
19 |         else: bot.reply_to(m, "ğŸ¬ Que veux-tu ? (Ex: /get Titanic)")
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:19:13
   |
17 |         parts = m.text.split(' ', 1)
18 |         if len(parts) > 1: process_get_request(bot, m, parts[1])
19 |         else: bot.reply_to(m, "ğŸ¬ Que veux-tu ? (Ex: /get Titanic)")
   |             ^
20 |
21 |     @bot.message_handler(func=lambda m: True)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:23:40
   |
21 |     @bot.message_handler(func=lambda m: True)
22 |     def handle_ai_request(m):
23 |         if not is_authorized(m.chat.id): return
   |                                        ^
24 |         if m.text.startswith('/'): return
25 |         process_get_request(bot, m, m.text)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:24:34
   |
22 |     def handle_ai_request(m):
23 |         if not is_authorized(m.chat.id): return
24 |         if m.text.startswith('/'): return
   |                                  ^
25 |         process_get_request(bot, m, m.text)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:29:48
   |
27 |     @bot.callback_query_handler(func=lambda call: call.data.startswith("dl_sel:"))
28 |     def download_callback_handler(call):
29 |         if not is_authorized(call.from_user.id): return
   |                                                ^
30 |         d = call.data.split(":")
31 |         cat, idx = d[1], int(d[2])
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:33:23
   |
31 |         cat, idx = d[1], int(d[2])
32 |         try:
33 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
   |                       ^^^^^^^^^^^^
34 |             search_data = ctx.get(f"{call.message.chat.id}_search")
35 |             if not search_data:
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:33:46
   |
31 |         cat, idx = d[1], int(d[2])
32 |         try:
33 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
   |                                              ^
34 |             search_data = ctx.get(f"{call.message.chat.id}_search")
35 |             if not search_data:
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:40:19
   |
39 |             item = search_data['results'][idx]
40 |             cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                   ^^^^^^^^^^
41 |             endpoint = "movie" if cat == "movie" else "series"
42 |             id_key = "tmdbId" if cat == "movie" else "tvdbId"
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:40:53
   |
39 |             item = search_data['results'][idx]
40 |             cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                                                     ^^^^^^^^^^
41 |             endpoint = "movie" if cat == "movie" else "series"
42 |             id_key = "tmdbId" if cat == "movie" else "tvdbId"
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:54:31
   |
52 |             }
53 |             payload[id_key] = item[id_key]
54 |             if cat == "series": payload["languageProfileId"] = 1
   |                               ^
55 |
56 |             r = requests.post(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, json=payload, timeout=10)
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_search.py:70:30
   |
68 |     try:
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
   |                              ^
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |

E722 Do not use bare `except`
  --> scripts/handlers_search.py:71:5
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |     ^^^^^^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:71:11
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |           ^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_search.py:71:26
   |
69 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
   |                          ^
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
73 |     try:
   |

F405 `RADARR_CFG` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:72:11
   |
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |           ^^^^^^^^^^
73 |     try:
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |

F405 `SONARR_CFG` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:72:45
   |
70 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
71 |     except: titre = query; cat = "movie"
72 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
   |                                             ^^^^^^^^^^
73 |     try:
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:76:23
   |
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
75 |         results = r.json()
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
   |                       ^
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/handlers_search.py:76:73
   |
74 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
75 |         results = r.json()
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
   |                                                                          ^
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:78:27
   |
76 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
   |                           ^^^^^^^^^^^^
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:79:16
   |
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:79:39
   |
77 |         ctx = {}
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                                       ^^^^^^^^^^^^
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
   |

E722 Do not use bare `except`
  --> scripts/handlers_search.py:80:13
   |
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |             ^^^^^^
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:80:19
   |
78 |         if os.path.exists(CONTEXT_FILE):
79 |             try: ctx = json.load(open(CONTEXT_FILE))
80 |             except: ctx = {}
   |                   ^
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

F405 `CONTEXT_FILE` may be undefined, or defined from star imports
  --> scripts/handlers_search.py:82:19
   |
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                   ^^^^^^^^^^^^
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:82:42
   |
80 |             except: ctx = {}
81 |         ctx[f"{m.chat.id}_search"] = {"cat": cat, "results": results[:5]}
82 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:85:52
   |
83 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
84 |         limit = min(len(results), 5)
85 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
   |                                                    ^
86 |         markup = InlineKeyboardMarkup()
87 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i-1}") for i in range(1, limit+1)]
   |

E722 Do not use bare `except`
  --> scripts/handlers_search.py:90:5
   |
88 |         markup.add(*btns)
89 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
90 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
   |     ^^^^^^
   |

E701 Multiple statements on one line (colon)
  --> scripts/handlers_search.py:90:11
   |
88 |         markup.add(*btns)
89 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
90 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
   |           ^
   |

E401 [*] Multiple imports on one line
 --> scripts/main.py:1:1
  |
1 | import telebot, threading, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from flask import Flask
3 | from config import *
  |
help: Split imports

F403 `from config import *` used; unable to detect undefined names
 --> scripts/main.py:3:1
  |
1 | import telebot, threading, logging
2 | from flask import Flask
3 | from config import *
  | ^^^^^^^^^^^^^^^^^^^^
4 | from handlers_admin import register_admin_handlers
5 | from handlers_media import register_media_handlers
  |

F405 `TOKEN` may be undefined, or defined from star imports
  --> scripts/main.py:9:23
   |
 8 | # --- CONFIGURATION PRINCIPALE ---
 9 | bot = telebot.TeleBot(TOKEN)
   |                       ^^^^^
10 |
11 | # --- FLASK SERVER ---
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> scripts/main.py:30:34
   |
29 |     # 2. Register Modules
30 |     register_admin_handlers(bot, is_authorized)
   |                                  ^^^^^^^^^^^^^
31 |     register_media_handlers(bot, is_authorized)
32 |     register_search_handlers(bot, is_authorized)
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> scripts/main.py:31:34
   |
29 |     # 2. Register Modules
30 |     register_admin_handlers(bot, is_authorized)
31 |     register_media_handlers(bot, is_authorized)
   |                                  ^^^^^^^^^^^^^
32 |     register_search_handlers(bot, is_authorized)
   |

F405 `is_authorized` may be undefined, or defined from star imports
  --> scripts/main.py:32:35
   |
30 |     register_admin_handlers(bot, is_authorized)
31 |     register_media_handlers(bot, is_authorized)
32 |     register_search_handlers(bot, is_authorized)
   |                                   ^^^^^^^^^^^^^
33 |     
34 |     print("ğŸš€ Bot dÃ©marrÃ© en mode modulaire (Orchestrateur Clean)...")
   |

E401 [*] Multiple imports on one line
 --> scripts/media_manager.py:1:1
  |
1 | import os, shutil, sys, json, re, subprocess
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 |
3 | DOCKER_MODE = os.environ.get("DOCKER_MODE") == "true"
  |
help: Split imports

F401 [*] `subprocess` imported but unused
 --> scripts/media_manager.py:1:35
  |
1 | import os, shutil, sys, json, re, subprocess
  |                                   ^^^^^^^^^^
2 |
3 | DOCKER_MODE = os.environ.get("DOCKER_MODE") == "true"
  |
help: Remove unused import: `subprocess`

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:23:20
   |
21 |     tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', r'\bâ€¦
22 |     clean = f"{title} ({year})" if year else title
23 |     for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
   |                    ^
24 |     return re.sub(r'\s+', ' ', clean).strip()
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:28:29
   |
26 | def get_size(p):
27 |     try:
28 |         if os.path.isfile(p): return os.path.getsize(p)
   |                             ^
29 |         return sum(os.path.getsize(os.path.join(r, f)) for r, d, fs in os.walk(p) for f in fs)
30 |     except Exception as e:
   |

F841 [*] Local variable `e` is assigned to but never used
  --> scripts/media_manager.py:30:25
   |
28 |         if os.path.isfile(p): return os.path.getsize(p)
29 |         return sum(os.path.getsize(os.path.join(r, f)) for r, d, fs in os.walk(p) for f in fs)
30 |     except Exception as e:
   |                         ^
31 |         return 0
   |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:39:37
   |
37 |     for cat in PATHS:
38 |         for d, is_nvme in [(p, True) for p in PATHS[cat]["nvme"]] + [(PATHS[cat]["hdd"], False)]:
39 |             if not os.path.exists(d): continue
   |                                     ^
40 |             for item in os.listdir(d):
41 |                 if q in item.lower().replace(" ", "").replace(".", ""):
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:56:16
   |
54 |     media = []
55 |     conf = PATHS.get(category)
56 |     if not conf: return []
   |                ^
57 |     for d, is_nvme in [(p, True) for p in conf["nvme"]] + [(conf["hdd"], False)]:
58 |         if not os.path.exists(d): continue
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:58:33
   |
56 |     if not conf: return []
57 |     for d, is_nvme in [(p, True) for p in conf["nvme"]] + [(conf["hdd"], False)]:
58 |         if not os.path.exists(d): continue
   |                                 ^
59 |         for f in os.listdir(d):
60 |             if f.startswith('.'): continue
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:60:33
   |
58 |         if not os.path.exists(d): continue
59 |         for f in os.listdir(d):
60 |             if f.startswith('.'): continue
   |                                 ^
61 |             path = os.path.join(d, f); size = get_size(path)
62 |             if size < MIN_SIZE_BYTES: continue
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/media_manager.py:61:38
   |
59 | â€¦     for f in os.listdir(d):
60 | â€¦         if f.startswith('.'): continue
61 | â€¦         path = os.path.join(d, f); size = get_size(path)
   |                                    ^
62 | â€¦         if size < MIN_SIZE_BYTES: continue
63 | â€¦         media.append({"name": clean_media_name(f), "real_name": f, "size_gb": round(size / (1024**3), 2), "is_nvme": is_nvme, "path"â€¦
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:62:37
   |
60 |             if f.startswith('.'): continue
61 |             path = os.path.join(d, f); size = get_size(path)
62 |             if size < MIN_SIZE_BYTES: continue
   |                                     ^
63 |             media.append({"name": clean_media_name(f), "real_name": f, "size_gb": round(size / (1024**3), 2), "is_nvme": is_nvme, "patâ€¦
64 |     return sorted(media, key=lambda x: x['size_gb'], reverse=True)
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:67:25
   |
66 | if __name__ == "__main__":
67 |     if len(sys.argv) < 2: sys.exit(1)
   |                         ^
68 |     cmd = sys.argv[1]
69 |     if cmd == "json_list": print(json.dumps(get_media_list(sys.argv[2])))
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:69:26
   |
67 |     if len(sys.argv) < 2: sys.exit(1)
68 |     cmd = sys.argv[1]
69 |     if cmd == "json_list": print(json.dumps(get_media_list(sys.argv[2])))
   |                          ^
70 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
71 |     elif cmd == "status":
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:70:31
   |
68 |     cmd = sys.argv[1]
69 |     if cmd == "json_list": print(json.dumps(get_media_list(sys.argv[2])))
70 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
   |                               ^
71 |     elif cmd == "status":
72 |         u = shutil.disk_usage("/"); h = shutil.disk_usage(HDD_ROOT) if os.path.exists(HDD_ROOT) else u
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/media_manager.py:72:35
   |
70 |     elif cmd == "search_local": print(json.dumps(find_local_media(sys.argv[2])))
71 |     elif cmd == "status":
72 |         u = shutil.disk_usage("/"); h = shutil.disk_usage(HDD_ROOT) if os.path.exists(HDD_ROOT) else u
   |                                   ^
73 |         print(json.dumps({"nvme_free": u.free//1024**3, "hdd_free": h.free//1024**3}))
74 |     elif cmd == "action":
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:77:35
   |
75 |         act, cat, path = sys.argv[2], sys.argv[3], sys.argv[4]
76 |         if act == "del":
77 |             if os.path.isdir(path): shutil.rmtree(path)
   |                                   ^
78 |             else: os.remove(path)
79 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:78:17
   |
76 |         if act == "del":
77 |             if os.path.isdir(path): shutil.rmtree(path)
78 |             else: os.remove(path)
   |                 ^
79 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
80 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:79:26
   |
77 |             if os.path.isdir(path): shutil.rmtree(path)
78 |             else: os.remove(path)
79 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
   |                          ^
80 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
81 |         print("Done")
   |

E701 Multiple statements on one line (colon)
  --> scripts/media_manager.py:80:26
   |
78 |             else: os.remove(path)
79 |         elif act == "arc": shutil.move(path, os.path.join(PATHS[cat]["hdd"], os.path.basename(path)))
80 |         elif act == "res": shutil.move(path, os.path.join(PATHS[cat]["nvme"][0], os.path.basename(path)))
   |                          ^
81 |         print("Done")
   |

E401 [*] Multiple imports on one line
 --> scripts/pi_bot.py:1:1
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import datetime, timedelta
3 | from telebot import types
  |
help: Split imports

F401 [*] `time` imported but unused
 --> scripts/pi_bot.py:1:62
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  |                                                              ^^^^
2 | from datetime import datetime, timedelta
3 | from telebot import types
  |
help: Remove unused import: `time`

F401 [*] `datetime.datetime` imported but unused
 --> scripts/pi_bot.py:2:22
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                      ^^^^^^^^
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import

F401 [*] `datetime.timedelta` imported but unused
 --> scripts/pi_bot.py:2:32
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                                ^^^^^^^^^
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import

F401 [*] `flask.request` imported but unused
 --> scripts/pi_bot.py:5:26
  |
3 | from telebot import types
4 | from telebot.types import InlineKeyboardMarkup, InlineKeyboardButton
5 | from flask import Flask, request
  |                          ^^^^^^^
6 | import share_engine
  |
help: Remove unused import: `flask.request`

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:25:8
   |
23 | # --- UTILS & STORAGE ---
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
   |        ^
26 |     except: return [SUPER_ADMIN]
   |

E722 Do not use bare `except`
  --> scripts/pi_bot.py:26:5
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
26 |     except: return [SUPER_ADMIN]
   |     ^^^^^^
27 |
28 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:26:11
   |
24 | def load_allowed_users():
25 |     try: return json.load(open(USERS_FILE))["allowed"]
26 |     except: return [SUPER_ADMIN]
   |           ^
27 |
28 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:35:94
   |
34 | def get_storage_emoji(item):
35 |     if not item.get('hasFile') and item.get('statistics', {}).get('episodeFileCount', 0) == 0: return "ğŸ”´"
   |                                                                                              ^
36 |     path = item.get('path', '')
37 |     return "ğŸ“š" if path and "/mnt/externe" in path else "ğŸš€"
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:42:37
   |
40 | @bot.message_handler(commands=['admin'])
41 | def admin_main(m):
42 |     if m.from_user.id != SUPER_ADMIN: return
   |                                     ^
43 |     markup = InlineKeyboardMarkup(row_width=1)
44 |     markup.add(InlineKeyboardButton("ğŸ“‚ Partage", callback_data="adm:share"),
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/pi_bot.py:55:30
   |
53 |         users = load_allowed_users()
54 |         if uid not in users:
55 |             users.append(uid); save_users(users)
   |                              ^
56 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
57 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:57:13
   |
55 |             users.append(uid); save_users(users)
56 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
57 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
   |             ^
58 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |

E722 Do not use bare `except`
  --> scripts/pi_bot.py:58:5
   |
56 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
57 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
58 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |     ^^^^^^
59 |
60 | # --- MEDIA ENGINE (ORIGINAL) ---
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:58:11
   |
56 |             bot.reply_to(m, f"âœ… ID {uid} ajoutÃ©.")
57 |         else: bot.reply_to(m, "â„¹ï¸ DÃ©jÃ  autorisÃ©.")
58 |     except: bot.reply_to(m, "âŒ ID invalide.")
   |           ^
59 |
60 | # --- MEDIA ENGINE (ORIGINAL) ---
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/pi_bot.py:64:39
   |
62 |     res = subprocess.run(["python3", SCRIPT_PATH, "json_list", cat], capture_output=True, text=True)
63 |     try:
64 |         items = json.loads(res.stdout); ctx = {}
   |                                       ^
65 |         if os.path.exists(CONTEXT_FILE):
66 |             try: ctx = json.load(open(CONTEXT_FILE))
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:66:16
   |
64 |         items = json.loads(res.stdout); ctx = {}
65 |         if os.path.exists(CONTEXT_FILE):
66 |             try: ctx = json.load(open(CONTEXT_FILE))
   |                ^
67 |             except: ctx = {}
68 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
   |

E722 Do not use bare `except`
  --> scripts/pi_bot.py:67:13
   |
65 |         if os.path.exists(CONTEXT_FILE):
66 |             try: ctx = json.load(open(CONTEXT_FILE))
67 |             except: ctx = {}
   |             ^^^^^^
68 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
69 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:67:19
   |
65 |         if os.path.exists(CONTEXT_FILE):
66 |             try: ctx = json.load(open(CONTEXT_FILE))
67 |             except: ctx = {}
   |                   ^
68 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
69 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:69:42
   |
67 |             except: ctx = {}
68 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
69 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
   |                                          ^
70 |     except: return
71 |     if not items:
   |

E722 Do not use bare `except`
  --> scripts/pi_bot.py:70:5
   |
68 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
69 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
70 |     except: return
   |     ^^^^^^
71 |     if not items:
72 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:70:11
   |
68 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
69 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
70 |     except: return
   |           ^
71 |     if not items:
72 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:73:19
   |
71 |     if not items:
72 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
73 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
   |                   ^
74 |         else: bot.send_message(m.chat.id, msg)
75 |         return
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:74:13
   |
72 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
73 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
74 |         else: bot.send_message(m.chat.id, msg)
   |             ^
75 |         return
76 |     text = f"ğŸ¬ {title} : {cat}\n\n"
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:77:36
   |
75 |         return
76 |     text = f"ğŸ¬ {title} : {cat}\n\n"
77 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
   |                                    ^
78 |     markup = InlineKeyboardMarkup(row_width=5)
79 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:81:15
   |
79 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
80 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
81 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
   |               ^
82 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:82:9
   |
80 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
81 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
82 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
   |         ^
83 |
84 | # --- PAGED MEDIA UI (LIVE API) ---
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/pi_bot.py:90:29
   |
88 |     try:
89 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
90 |         r.raise_for_status(); data = r.json()
   |                             ^
91 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
92 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:91:31
   |
89 |         r = requests.get(f"{cfg['url']}/api/v3/{endpoint}", headers={"X-Api-Key": cfg['key']}, timeout=5)
90 |         r.raise_for_status(); data = r.json()
91 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
   |                               ^
92 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
93 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:92:13
   |
90 |         r.raise_for_status(); data = r.json()
91 |         if category == "films": owned = [f for f in data if f.get('hasFile') is True]
92 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
   |             ^
93 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
94 |         total = len(owned); start, end = page * 10, (page + 1) * 10
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/pi_bot.py:94:27
   |
92 |         else: owned = [s for s in data if s.get('statistics', {}).get('episodeFileCount', 0) > 0]
93 |         owned.sort(key=lambda x: x.get('added', ''), reverse=True)
94 |         total = len(owned); start, end = page * 10, (page + 1) * 10
   |                           ^
95 |         items = owned[start:end]
96 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot.py:96:21
   |
94 |         total = len(owned); start, end = page * 10, (page + 1) * 10
95 |         items = owned[start:end]
96 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |                     ^
97 |         text = f"{'ğŸ¬' if category == 'films' else 'ğŸ“º'} **{category.capitalize()}** ({total})\n\n"
98 |         for i, item in enumerate(items, 1):
   |

E702 Multiple statements on one line (semicolon)
  --> scripts/pi_bot.py:96:59
   |
94 |         total = len(owned); start, end = page * 10, (page + 1) * 10
95 |         items = owned[start:end]
96 |         if not items: bot.send_message(chat_id, "ğŸ“‚ Vide."); return
   |                                                            ^
97 |         text = f"{'ğŸ¬' if category == 'films' else 'ğŸ“º'} **{category.capitalize()}** ({total})\n\n"
98 |         for i, item in enumerate(items, 1):
   |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:104:20
    |
102 |         markup.add(*btns)
103 |         nav = []
104 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
    |                    ^
105 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
106 |         if nav: markup.row(*nav)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:105:23
    |
103 |         nav = []
104 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
105 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
    |                       ^
106 |         if nav: markup.row(*nav)
107 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:106:15
    |
104 |         if page > 0: nav.append(InlineKeyboardButton("â¬…ï¸", callback_data=f"m_pag:{category}:{page-1}"))
105 |         if end < total: nav.append(InlineKeyboardButton("â¡ï¸", callback_data=f"m_pag:{category}:{page+1}"))
106 |         if nav: markup.row(*nav)
    |               ^
107 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
108 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:108:18
    |
106 |         if nav: markup.row(*nav)
107 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
108 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
    |                  ^
109 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
110 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:109:13
    |
107 |         markup.add(InlineKeyboardButton("ğŸ  Menu Principal", callback_data="adm:main"))
108 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
109 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
    |             ^
110 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:110:5
    |
108 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
109 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
110 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |     ^^^^^^
111 |
112 | @bot.message_handler(commands=['films'])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:110:11
    |
108 |         if is_new: bot.send_message(chat_id, text, reply_markup=markup, parse_mode='Markdown')
109 |         else: bot.edit_message_text(text, chat_id, message_id, reply_markup=markup, parse_mode='Markdown')
110 |     except: bot.send_message(chat_id, "âŒ Erreur API.")
    |           ^
111 |
112 | @bot.message_handler(commands=['films'])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:114:32
    |
112 | @bot.message_handler(commands=['films'])
113 | def films_cmd(m):
114 |     if is_authorized(m.chat.id): show_media_list(m.chat.id, None, "films", 0, True)
    |                                ^
115 |
116 | @bot.message_handler(commands=['series'])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:118:32
    |
116 | @bot.message_handler(commands=['series'])
117 | def series_cmd(m):
118 |     if is_authorized(m.chat.id): show_media_list(m.chat.id, None, "series", 0, True)
    |                                ^
119 |
120 | # --- SEARCH ENGINE (/GET) ---
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:127:5
    |
125 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": â€¦
126 |         return res.json()['choices'][0]['message']['content']
127 |     except: return None
    |     ^^^^^^
128 |
129 | @bot.message_handler(commands=['get'])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:127:11
    |
125 |         res = requests.post("https://api.openai.com/v1/chat/completions", headers=headers, json={"model": "gpt-4o-mini", "messages": â€¦
126 |         return res.json()['choices'][0]['message']['content']
127 |     except: return None
    |           ^
128 |
129 | @bot.message_handler(commands=['get'])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:131:36
    |
129 | @bot.message_handler(commands=['get'])
130 | def handle_get(m):
131 |     if not is_authorized(m.chat.id): return
    |                                    ^
132 |     parts = m.text.split(' ', 1)
133 |     if len(parts) > 1: process_get_request(m, parts[1])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:133:22
    |
131 |     if not is_authorized(m.chat.id): return
132 |     parts = m.text.split(' ', 1)
133 |     if len(parts) > 1: process_get_request(m, parts[1])
    |                      ^
134 |     else: bot.reply_to(m, "ğŸ¬ Que veux-tu ?")
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:134:9
    |
132 |     parts = m.text.split(' ', 1)
133 |     if len(parts) > 1: process_get_request(m, parts[1])
134 |     else: bot.reply_to(m, "ğŸ¬ Que veux-tu ?")
    |         ^
135 |
136 | def process_get_request(m, query):
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:141:30
    |
139 |     try:
140 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
141 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
    |                              ^
142 |     except: titre = query; cat = "movie"
143 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:142:5
    |
140 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
141 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
142 |     except: titre = query; cat = "movie"
    |     ^^^^^^
143 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
144 |     try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:142:11
    |
140 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
141 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
142 |     except: titre = query; cat = "movie"
    |           ^
143 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
144 |     try:
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:142:26
    |
140 |         data = json.loads(re.search(r'\{.*\}', ai_res, re.DOTALL).group(0))
141 |         titre = data['titre']; cat = "movie" if data['type'] == "film" else "series"
142 |     except: titre = query; cat = "movie"
    |                          ^
143 |     cfg = RADARR_CFG if cat == "movie" else SONARR_CFG
144 |     try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:147:23
    |
145 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
146 |         results = r.json()
147 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
    |                       ^
148 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
149 |         limit = min(len(results), 5)
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:147:73
    |
145 |         r = requests.get(f"{cfg['url']}/api/v3/{cat}/lookup?term={titre}", headers={"X-Api-Key": cfg['key']}, timeout=5)
146 |         results = r.json()
147 |         if not results: bot.send_message(m.chat.id, "âŒ Aucun rÃ©sultat."); return
    |                                                                          ^
148 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
149 |         limit = min(len(results), 5)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:150:52
    |
148 |         text = f"ğŸ” **RÃ©sultats pour '{titre}'**\n\n"
149 |         limit = min(len(results), 5)
150 |         for i, res in enumerate(results[:limit], 1): text += f"{i}. {res['title']} ({res.get('year', 'N/A')})\n"
    |                                                    ^
151 |         markup = InlineKeyboardMarkup()
152 |         btns = [InlineKeyboardButton(str(i), callback_data=f"dl_sel:{cat}:{i}") for i in range(1, limit+1)]
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:155:5
    |
153 |         markup.add(*btns)
154 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
155 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
    |     ^^^^^^
156 |
157 | # --- MASTER CALLBACK ROUTER ---
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:155:11
    |
153 |         markup.add(*btns)
154 |         bot.send_message(m.chat.id, text, reply_markup=markup, parse_mode='Markdown')
155 |     except: bot.send_message(m.chat.id, "âŒ Erreur.")
    |           ^
156 |
157 | # --- MASTER CALLBACK ROUTER ---
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:160:44
    |
158 | @bot.callback_query_handler(func=lambda call: True)
159 | def master_router(call):
160 |     if not is_authorized(call.from_user.id): return
    |                                            ^
161 |     d = call.data.split(":")
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:165:27
    |
163 |     # 1. New Paged UI Callbacks
164 |     if d[0] in ["m_pag", "m_sel", "m_act", "dl_sel"]:
165 |         if d[0] == "m_pag": show_media_list(call.message.chat.id, call.message.message_id, d[1], int(d[2]))
    |                           ^
166 |         elif d[0] == "m_sel":
167 |             markup = InlineKeyboardMarkup()
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:172:30
    |
170 | â€¦                    InlineKeyboardButton("â¬…ï¸ Retour", callback_data=f"m_pag:{d[1]}:0"))
171 | â€¦         bot.edit_message_text(f"ğŸ¯ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
172 | â€¦     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "ğŸ“¥ AjoutÃ©.")
    |                            ^
173 | â€¦     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistrÃ©e.", show_alert=True)
174 | â€¦     return
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:173:29
    |
171 | â€¦         bot.edit_message_text(f"ğŸ¯ **Action sur ID {d[2]}**", call.message.chat.id, call.message.message_id, reply_markup=markup)
172 | â€¦     elif d[0] == "dl_sel": bot.answer_callback_query(call.id, "ğŸ“¥ AjoutÃ©.")
173 | â€¦     elif d[0] == "m_act": bot.answer_callback_query(call.id, f"Action {d[1]} enregistrÃ©e.", show_alert=True)
    |                           ^
174 | â€¦     return
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:192:41
    |
190 | â€¦         bot.edit_message_text("ğŸ‘¥ **Gestion des Utilisateurs**", call.message.chat.id, call.message.message_id, reply_markup=markup)
191 | â€¦     elif cmd == "users_list":
192 | â€¦         users = load_allowed_users(); text = "ğŸ“‹ **Utilisateurs :**\n\n" + "\n".join([f"â€¢ `{u}`" for u in users])
    |                                       ^
193 | â€¦         bot.edit_message_text(text, call.message.chat.id, call.message.message_id, reply_markup=InlineKeyboardMarkup().add(InlineKeâ€¦
194 | â€¦     elif cmd == "users_add":
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:198:41
    |
196 |             bot.register_next_step_handler(msg, process_user_add)
197 |         elif cmd == "users_rev":
198 |             users = load_allowed_users(); markup = InlineKeyboardMarkup(row_width=1)
    |                                         ^
199 |             for u in users:
200 |                 if u == SUPER_ADMIN: continue
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:200:36
    |
198 |             users = load_allowed_users(); markup = InlineKeyboardMarkup(row_width=1)
199 |             for u in users:
200 |                 if u == SUPER_ADMIN: continue
    |                                    ^
201 |                 markup.add(InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
202 |             markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:205:28
    |
203 | â€¦         bot.edit_message_text("SÃ©lectionnez l'ID Ã  rÃ©voquer :", call.message.chat.id, call.message.message_id, reply_markup=markup)
204 | â€¦     elif cmd == "users_del":
205 | â€¦         uid = int(d[2]); users = load_allowed_users()
    |                          ^
206 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
207 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:206:28
    |
204 | â€¦     elif cmd == "users_del":
205 | â€¦         uid = int(d[2]); users = load_allowed_users()
206 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                          ^
207 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
208 | â€¦     elif cmd == "share_owned":
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:206:47
    |
204 | â€¦     elif cmd == "users_del":
205 | â€¦         uid = int(d[2]); users = load_allowed_users()
206 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                             ^
207 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
208 | â€¦     elif cmd == "share_owned":
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:206:66
    |
204 | â€¦     elif cmd == "users_del":
205 | â€¦         uid = int(d[2]); users = load_allowed_users()
206 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                                                ^
207 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
208 | â€¦     elif cmd == "share_owned":
    |

F541 [*] f-string without any placeholders
   --> scripts/pi_bot.py:206:103
    |
204 | â€¦     elif cmd == "users_del":
205 | â€¦         uid = int(d[2]); users = load_allowed_users()
206 | â€¦         if uid in users: users.remove(uid); save_users(users); bot.answer_callback_query(call.id, f"âœ… RÃ©voquÃ©.")
    |                                                                                                     ^^^^^^^^^^^^^^
207 | â€¦         master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data="adm:users", chat_instanâ€¦
208 | â€¦     elif cmd == "share_owned":
    |
help: Remove extraneous `f` prefix

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:212:33
    |
210 | â€¦         markup.add(InlineKeyboardButton("ğŸ¬ Films", callback_data="adm:list_owned:movies"), InlineKeyboardButton("ğŸ“º SÃ©ries", callba â€¦
211 | â€¦         bot.edit_message_text("CatÃ©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
212 | â€¦     elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
    |                               ^
213 | â€¦     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
214 | â€¦     return
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:213:28
    |
211 |             bot.edit_message_text("CatÃ©gorie :", call.message.chat.id, call.message.message_id, reply_markup=markup)
212 |         elif cmd == "list_owned": list_media_unified(call.message, d[2], "Partage", True)
213 |         elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                            ^
214 |         return
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:219:46
    |
217 |     if d[0] == "sel":
218 |         try:
219 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                              ^
220 |             markup = InlineKeyboardMarkup(row_width=2)
221 |             act = "arc" if item['is_nvme'] else "res"
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:219:66
    |
217 |     if d[0] == "sel":
218 |         try:
219 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
    |                                                                  ^
220 |             markup = InlineKeyboardMarkup(row_width=2)
221 |             act = "arc" if item['is_nvme'] else "res"
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:223:48
    |
221 | â€¦     act = "arc" if item['is_nvme'] else "res"
222 | â€¦     markup.add(InlineKeyboardButton("ğŸ“¦ Archiv/Rest", callback_data=f"act:{act}:{d[1]}:{d[2]}"), InlineKeyboardButton("ğŸ—‘ï¸ Supprimer"â€¦
223 | â€¦     if call.from_user.id == SUPER_ADMIN: markup.add(InlineKeyboardButton("ğŸ”— Partager", callback_data=f"share_exec:{d[2]}"))
    |                                          ^
224 | â€¦     markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
225 | â€¦     bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:226:9
    |
224 |             markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
225 |             bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
226 |         except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |         ^^^^^^
227 |     elif d[0] == "act":
228 |         try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:226:15
    |
224 |             markup.add(InlineKeyboardButton("âŒ Annuler", callback_data="cancel"))
225 |             bot.edit_message_text(f"ğŸ› ï¸ {item['name']}", call.message.chat.id, call.message.message_id, reply_markup=markup)
226 |         except: bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
    |               ^
227 |     elif d[0] == "act":
228 |         try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:229:46
    |
227 |     elif d[0] == "act":
228 |         try:
229 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                              ^
230 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
231 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:229:66
    |
227 |     elif d[0] == "act":
228 |         try:
229 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
    |                                                                  ^
230 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
231 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:232:9
    |
230 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
231 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
232 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |         ^^^^^^
233 |     elif d[0] == "share_exec":
234 |         try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:232:15
    |
230 |             res = subprocess.run(["python3", SCRIPT_PATH, "action", d[1], d[2], item['path']], capture_output=True, text=True)
231 |             bot.edit_message_text(f"âœ… {item['name']}: {res.stdout.strip()}", call.message.chat.id, call.message.message_id)
232 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |               ^
233 |     elif d[0] == "share_exec":
234 |         try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:235:46
    |
233 |     elif d[0] == "share_exec":
234 |         try:
235 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                              ^
236 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
237 |             if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:235:66
    |
233 |     elif d[0] == "share_exec":
234 |         try:
235 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                  ^
236 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
237 |             if subtitles:
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:236:45
    |
234 |         try:
235 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
236 |             src = pathlib.Path(item['path']); subtitles = list(src.parent.glob(f"{src.stem}*.srt"))
    |                                             ^
237 |             if subtitles:
238 |                 markup = InlineKeyboardMarkup(row_width=1)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:241:17
    |
239 |                 markup.add(InlineKeyboardButton("âš¡ Symlink", callback_data=f"share_final:{d[1]}:link"), InlineKeyboardButton("ğŸ¬ Remu â€¦
240 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
241 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
    |                 ^
242 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
243 |     elif d[0] == "share_final":
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:242:9
    |
240 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
241 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
242 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |         ^^^^^^
243 |     elif d[0] == "share_final":
244 |         try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:242:15
    |
240 |                 bot.edit_message_text(f"ğŸ¯ **Options Partage**\n{len(subtitles)} sous-titres trouvÃ©s.", call.message.chat.id, call.mesâ€¦
241 |             else: master_router(types.CallbackQuery(id=call.id, from_user=call.from_user, message=call.message, data=f"share_final:{dâ€¦
242 |         except: bot.answer_callback_query(call.id, "âŒ Erreur.")
    |               ^
243 |     elif d[0] == "share_final":
244 |         try:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:245:46
    |
243 |     elif d[0] == "share_final":
244 |         try:
245 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                              ^
246 |             remux_opt = True if d[2] == "remux" else False
247 |             bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:245:66
    |
243 |     elif d[0] == "share_final":
244 |         try:
245 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f); item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
    |                                                                  ^
246 |             remux_opt = True if d[2] == "remux" else False
247 |             bot.edit_message_text("â³ Traitement...", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:252:17
    |
250 |                 msg = f"âœ… **PartagÃ©**\n\nğŸ”— VidÃ©o : `{data['video']}`"
251 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
252 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
    |                 ^
253 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
254 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:253:9
    |
251 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
252 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
253 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |         ^^^^^^
254 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:253:15
    |
251 |                 bot.send_message(call.message.chat.id, msg, parse_mode='Markdown')
252 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
253 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
    |               ^
254 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:254:26
    |
252 |             else: bot.send_message(call.message.chat.id, "âŒ Ã‰chec du partage.")
253 |         except: bot.send_message(call.message.chat.id, "âŒ Erreur interne.")
254 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                          ^
255 |
256 | # --- STATUS & QUEUE ---
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:259:36
    |
257 | @bot.message_handler(commands=['status'])
258 | def status_command(m):
259 |     if not is_authorized(m.chat.id): return
    |                                    ^
260 |     try:
261 |         nvme = shutil.disk_usage('/')
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:268:5
    |
266 |             msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
267 |         bot.reply_to(m, msg, parse_mode='Markdown')
268 |     except: bot.reply_to(m, "âŒ Erreur lecture disque.")
    |     ^^^^^^
269 |
270 | @bot.message_handler(commands=['queue'])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:268:11
    |
266 |             msg += f"\nğŸ“š **HDD** : `{fmt(hdd)}`"
267 |         bot.reply_to(m, msg, parse_mode='Markdown')
268 |     except: bot.reply_to(m, "âŒ Erreur lecture disque.")
    |           ^
269 |
270 | @bot.message_handler(commands=['queue'])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:272:36
    |
270 | @bot.message_handler(commands=['queue'])
271 | def queue_command(m):
272 |     if not is_authorized(m.chat.id): return
    |                                    ^
273 |     try:
274 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:274:82
    |
272 |     if not is_authorized(m.chat.id): return
273 |     try:
274 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
    |                                                                                  ^
275 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
276 |         q_text = "ğŸ“¥ **Queue :**\n\n"
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:275:24
    |
273 |     try:
274 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
275 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
    |                        ^
276 |         q_text = "ğŸ“¥ **Queue :**\n\n"
277 |         for t in torrents:
    |

E702 Multiple statements on one line (semicolon)
   --> scripts/pi_bot.py:275:58
    |
273 |     try:
274 |         r = requests.get("http://localhost:8090/api/v2/torrents/info", timeout=5); torrents = r.json()
275 |         if not torrents: bot.reply_to(m, "â€¢ Queue vide."); return
    |                                                          ^
276 |         q_text = "ğŸ“¥ **Queue :**\n\n"
277 |         for t in torrents:
    |

E722 Do not use bare `except`
   --> scripts/pi_bot.py:282:5
    |
280 |                 q_text += f"â€¢ **{name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB\n"
281 |         bot.reply_to(m, q_text, parse_mode='Markdown')
282 |     except: bot.reply_to(m, "âŒ Erreur qBit.")
    |     ^^^^^^
283 |
284 | # --- STARTUP ---
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot.py:282:11
    |
280 |                 q_text += f"â€¢ **{name}**\n  â”” ğŸ“Š {round(t['progress']*100,1)}% | ğŸ“‚ {round(t['size']/1024**3,2)}GB\n"
281 |         bot.reply_to(m, q_text, parse_mode='Markdown')
282 |     except: bot.reply_to(m, "âŒ Erreur qBit.")
    |           ^
283 |
284 | # --- STARTUP ---
    |

E401 [*] Multiple imports on one line
 --> scripts/pi_bot_debug.py:1:1
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Split imports

F401 [*] `time` imported but unused
 --> scripts/pi_bot_debug.py:1:62
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
  |                                                              ^^^^
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |
help: Remove unused import: `time`

F401 [*] `datetime.datetime` imported but unused
 --> scripts/pi_bot_debug.py:2:22
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
  |                      ^^^^^^^^
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
4 | from flask import Flask, request
  |
help: Remove unused import: `datetime.datetime`

F401 [*] `telebot.types.BotCommand` imported but unused
 --> scripts/pi_bot_debug.py:3:27
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                           ^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `telebot.types.BotCommandScopeChat` imported but unused
 --> scripts/pi_bot_debug.py:3:39
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                                       ^^^^^^^^^^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `telebot.types.BotCommandScopeDefault` imported but unused
 --> scripts/pi_bot_debug.py:3:60
  |
1 | import telebot, subprocess, os, json, requests, logging, re, time, threading, shutil, pathlib
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
  |                                                            ^^^^^^^^^^^^^^^^^^^^^^
4 | from flask import Flask, request
5 | import share_engine
  |
help: Remove unused import

F401 [*] `flask.request` imported but unused
 --> scripts/pi_bot_debug.py:4:26
  |
2 | from datetime import datetime, timedelta
3 | from telebot.types import BotCommand, BotCommandScopeChat, BotCommandScopeDefault, InlineKeyboardMarkup, InlineKeyboardButton
4 | from flask import Flask, request
  |                          ^^^^^^^
5 | import share_engine
  |
help: Remove unused import: `flask.request`

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot_debug.py:26:8
   |
25 | def load_allowed_users():
26 |     try: return json.load(open(USERS_FILE))["allowed"]
   |        ^
27 |     except: return [SUPER_ADMIN]
   |

E722 Do not use bare `except`
  --> scripts/pi_bot_debug.py:27:5
   |
25 | def load_allowed_users():
26 |     try: return json.load(open(USERS_FILE))["allowed"]
27 |     except: return [SUPER_ADMIN]
   |     ^^^^^^
28 |
29 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot_debug.py:27:11
   |
25 | def load_allowed_users():
26 |     try: return json.load(open(USERS_FILE))["allowed"]
27 |     except: return [SUPER_ADMIN]
   |           ^
28 |
29 | def is_authorized(uid): return uid in load_allowed_users()
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot_debug.py:50:40
   |
48 | @bot.callback_query_handler(func=lambda call: call.data.startswith("adm:"))
49 | def admin_router(call):
50 |     if call.from_user.id != SUPER_ADMIN: return
   |                                        ^
51 |     parts = call.data.split(":")
52 |     cmd = parts[1]
   |

E701 Multiple statements on one line (colon)
  --> scripts/pi_bot_debug.py:86:32
   |
84 |         markup = InlineKeyboardMarkup(row_width=1)
85 |         for u in users:
86 |             if u == SUPER_ADMIN: continue
   |                                ^
87 |             markup.add(InlineKeyboardButton(f"âŒ {u}", callback_data=f"adm:users_del:{u}"))
88 |         markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:users"))
   |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:114:24
    |
112 |         bot.edit_message_text("ğŸ§¹ **Nettoyage SSD**\n\nFonctionnalitÃ© en cours de dÃ©veloppement.", call.message.chat.id, call.message.â€¦
113 |     
114 |     elif cmd == "close": bot.delete_message(call.message.chat.id, call.message.message_id)
    |                        ^
115 |
116 | def process_user_add(m):
    |

E722 Do not use bare `except`
   --> scripts/pi_bot_debug.py:126:5
    |
124 |         else:
125 |             bot.reply_to(m, "â„¹ï¸ Cet utilisateur est dÃ©jÃ  autorisÃ©.")
126 |     except:
    |     ^^^^^^
127 |         bot.reply_to(m, "âŒ ID invalide. Veuillez envoyer un nombre.")
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:136:16
    |
134 |         ctx = {}
135 |         if os.path.exists(CONTEXT_FILE):
136 |             try: ctx = json.load(open(CONTEXT_FILE))
    |                ^
137 |             except: ctx = {}
138 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
    |

E722 Do not use bare `except`
   --> scripts/pi_bot_debug.py:137:13
    |
135 |         if os.path.exists(CONTEXT_FILE):
136 |             try: ctx = json.load(open(CONTEXT_FILE))
137 |             except: ctx = {}
    |             ^^^^^^
138 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
139 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:137:19
    |
135 |         if os.path.exists(CONTEXT_FILE):
136 |             try: ctx = json.load(open(CONTEXT_FILE))
137 |             except: ctx = {}
    |                   ^
138 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
139 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:139:42
    |
137 |             except: ctx = {}
138 |         ctx[str(m.chat.id)] = {"category": cat, "list": items}
139 |         with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |                                          ^
140 |     except Exception as e:
141 |         logging.error(f"Context save failed: {e}")
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:145:19
    |
143 |     if not items:
144 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
145 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
    |                   ^
146 |         else: bot.send_message(m.chat.id, msg)
147 |         return
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:146:13
    |
144 |         msg = f"ğŸ“‚ Aucun(e) {cat} trouvÃ©(e)."
145 |         if is_edit: bot.edit_message_text(msg, m.chat.id, m.message_id)
146 |         else: bot.send_message(m.chat.id, msg)
    |             ^
147 |         return
148 |     text = f"ğŸ¬ {title} : {cat}\n\n"
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:149:36
    |
147 |         return
148 |     text = f"ğŸ¬ {title} : {cat}\n\n"
149 |     for i, f in enumerate(items, 1): text += f"{i}. {f['name']} ({f['size_gb']}G)\n"
    |                                    ^
150 |     markup = InlineKeyboardMarkup(row_width=5)
151 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:153:15
    |
151 |     markup.add(*[InlineKeyboardButton(str(i), callback_data=f"sel:{cat}:{i-1}") for i in range(1, len(items)+1)])
152 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
153 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
    |               ^
154 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:154:9
    |
152 |     markup.add(InlineKeyboardButton("â¬…ï¸ Retour", callback_data="adm:share_owned"))
153 |     if is_edit: bot.edit_message_text(text, m.chat.id, m.message_id, reply_markup=markup)
154 |     else: bot.send_message(m.chat.id, text, reply_markup=markup)
    |         ^
155 |
156 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:158:44
    |
156 | @bot.callback_query_handler(func=lambda call: call.data.startswith(("sel:", "act:", "share_exec:", "cancel", "dl:")))
157 | def media_callbacks(call):
158 |     if not is_authorized(call.from_user.id): return
    |                                            ^
159 |     d = call.data.split(":")
160 |     if d[0] == "sel":
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:162:46
    |
160 |     if d[0] == "sel":
161 |         try:
162 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
163 |             item = ctx[str(call.message.chat.id)]["list"][int(d[2])]
164 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:178:46
    |
176 |     elif d[0] == "act":
177 |         try:
178 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
179 |             item = ctx[str(call.message.chat.id)]["list"][int(d[3])]
180 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:188:46
    |
186 |     elif d[0] == "share_exec":
187 |         try:
188 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
189 |             item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
190 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:211:46
    |
209 |     elif d[0] == "share_final":
210 |         try:
211 |             with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                              ^
212 |             item = ctx[str(call.message.chat.id)]["list"][int(d[1])]
213 |         except Exception as e:
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:235:26
    |
233 |         else:
234 |             bot.send_message(call.message.chat.id, "âŒ Erreur: Ã‰chec du partage ou contenu hors limites.")
235 |     elif d[0] == "cancel": bot.edit_message_text("âŒ FermÃ©.", call.message.chat.id, call.message.message_id)
    |                          ^
236 |     elif d[0] == "dl":
237 |         if d[1] == "no":
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:242:50
    |
240 |         elif d[1] == "yes":
241 |             try:
242 |                 with open(CONTEXT_FILE, "r") as f: ctx = json.load(f)
    |                                                  ^
243 |                 dl_data = ctx.get(str(call.message.chat.id) + "_dl")
244 |                 if not dl_data:
    |

F841 [*] Local variable `e` is assigned to but never used
   --> scripts/pi_bot_debug.py:247:33
    |
245 |                     bot.answer_callback_query(call.id, "âŒ Session expirÃ©e.")
246 |                     return
247 |             except Exception as e:
    |                                 ^
248 |                 bot.answer_callback_query(call.id, "âŒ Erreur de session.")
249 |                 return
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:284:36
    |
282 | @bot.message_handler(commands=['status'])
283 | def status_command(m):
284 |     if not is_authorized(m.chat.id): return
    |                                    ^
285 |     try:
286 |         nvme = shutil.disk_usage('/')
    |

F841 [*] Local variable `e` is assigned to but never used
   --> scripts/pi_bot_debug.py:292:25
    |
290 |         msg = f"ğŸ“Š **Stockage Temps RÃ©el**\n\nğŸš€ **NVMe** : `{fmt(nvme)}`\nğŸ“š **HDD** : `{fmt(hdd)}`"
291 |         bot.reply_to(m, msg, parse_mode='Markdown')
292 |     except Exception as e:
    |                         ^
293 |         bot.reply_to(m, "âŒ Erreur de lecture disque temps rÃ©el.")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:297:36
    |
295 | @bot.message_handler(commands=['films'])
296 | def films_command(m):
297 |     if not is_authorized(m.chat.id): return
    |                                    ^
298 |     try:
299 |         logging.info(f"[DEBUG_API] Interrogation Radarr Ã  {RADARR_CFG['url']}")
    |

F841 [*] Local variable `e` is assigned to but never used
   --> scripts/pi_bot_debug.py:309:25
    |
307 |         text += "\n".join([f"â€¢ {f['title']} ({f['year']})" for f in owned[:50]])
308 |         bot.reply_to(m, text, parse_mode='Markdown')
309 |     except Exception as e:
    |                         ^
310 |         bot.reply_to(m, "âŒ Erreur API Radarr (Consultez les logs).")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:314:36
    |
312 | @bot.message_handler(commands=['series'])
313 | def series_command(m):
314 |     if not is_authorized(m.chat.id): return
    |                                    ^
315 |     try:
316 |         r = requests.get(f"{SONARR_CFG['url']}/api/v3/series", headers={"X-Api-Key": SONARR_CFG['key']}, timeout=5)
    |

F841 [*] Local variable `e` is assigned to but never used
   --> scripts/pi_bot_debug.py:323:25
    |
321 |         text += "\n".join([f"â€¢ {s['title']} â€” `{s['statistics']['episodeFileCount']}` Ã©pisodes" for s in owned])
322 |         bot.reply_to(m, text, parse_mode='Markdown')
323 |     except Exception as e:
    |                         ^
324 |         bot.reply_to(m, "âŒ Erreur API Sonarr (Consultez les logs).")
    |
help: Remove assignment to unused variable `e`

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:328:36
    |
326 | @bot.message_handler(commands=['queue'])
327 | def queue_command(m):
328 |     if not is_authorized(m.chat.id): return
    |                                    ^
329 |     
330 |     def clean_title(name):
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:338:24
    |
336 | â€¦     tags = [r'\b\d{3,4}p\b', r'\b2160p\b', r'\b4k\b', r'\bHEVC\b', r'\bx26[45]\b', r'\bBluRay\b', r'\bWEB-DL\b', r'\bCOMPLETE\b', râ€¦
337 | â€¦     clean = f"{title} ({year})" if year else title
338 | â€¦     for tag in tags: clean = re.sub(tag, '', clean, flags=re.IGNORECASE)
    |                      ^
339 | â€¦     return re.sub(r'\s+', ' ', clean).strip()
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:352:42
    |
350 |                     progress = round(t['progress'] * 100, 1)
351 |                     eta_sec = t['eta']
352 |                     if eta_sec >= 8640000: eta = "âˆ"
    |                                          ^
353 |                     else:
354 |                         eta = str(timedelta(seconds=eta_sec)).split(".")[0]
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:426:36
    |
424 | @bot.message_handler(commands=['get'])
425 | def handle_get_command_entry(m):
426 |     if not is_authorized(m.chat.id): return
    |                                    ^
427 |     parts = m.text.split(' ', 1)
428 |     if len(parts) > 1 and parts[1].strip():
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:436:36
    |
435 | def process_get_step(m):
436 |     if not is_authorized(m.chat.id): return
    |                                    ^
437 |     if m.text.startswith('/'):
438 |         return
    |

F841 Local variable `saison` is assigned to but never used
   --> scripts/pi_bot_debug.py:459:9
    |
457 |         titre = str(data.get('titre'))
458 |         type_media = str(data.get('type'))
459 |         saison = int(data['saison']) if data.get('saison') is not None else None
    |         ^^^^^^
460 |         episode = int(data['episode']) if data.get('episode') is not None else None
461 |     except (ValueError, TypeError):
    |
help: Remove assignment to unused variable `saison`

F841 Local variable `episode` is assigned to but never used
   --> scripts/pi_bot_debug.py:460:9
    |
458 |         type_media = str(data.get('type'))
459 |         saison = int(data['saison']) if data.get('saison') is not None else None
460 |         episode = int(data['episode']) if data.get('episode') is not None else None
    |         ^^^^^^^
461 |     except (ValueError, TypeError):
462 |         bot.reply_to(m, "âŒ Erreur de formatage des mÃ©tadonnÃ©es extraites.")
    |
help: Remove assignment to unused variable `episode`

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:507:20
    |
505 |             ctx = {}
506 |             if os.path.exists(CONTEXT_FILE):
507 |                 try: ctx = json.load(open(CONTEXT_FILE))
    |                    ^
508 |                 except: ctx = {}
509 |             ctx[str(m.chat.id) + "_dl"] = {
    |

E722 Do not use bare `except`
   --> scripts/pi_bot_debug.py:508:17
    |
506 |             if os.path.exists(CONTEXT_FILE):
507 |                 try: ctx = json.load(open(CONTEXT_FILE))
508 |                 except: ctx = {}
    |                 ^^^^^^
509 |             ctx[str(m.chat.id) + "_dl"] = {
510 |                 "type_media": type_media,
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:508:23
    |
506 |             if os.path.exists(CONTEXT_FILE):
507 |                 try: ctx = json.load(open(CONTEXT_FILE))
508 |                 except: ctx = {}
    |                       ^
509 |             ctx[str(m.chat.id) + "_dl"] = {
510 |                 "type_media": type_media,
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:517:46
    |
515 |                 "images": item.get('images')
516 |             }
517 |             with open(CONTEXT_FILE, "w") as f: json.dump(ctx, f)
    |                                              ^
518 |         except Exception as e:
519 |             logging.error(f"Context save failed: {e}")
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:546:36
    |
544 | @bot.message_handler(func=lambda m: True)
545 | def handle_ai_request(m):
546 |     if not is_authorized(m.chat.id): return
    |                                    ^
547 |     if m.text.startswith('/'): return # Ignore native commands
548 |     process_get_request(m, m.text)
    |

E701 Multiple statements on one line (colon)
   --> scripts/pi_bot_debug.py:547:30
    |
545 | def handle_ai_request(m):
546 |     if not is_authorized(m.chat.id): return
547 |     if m.text.startswith('/'): return # Ignore native commands
    |                              ^
548 |     process_get_request(m, m.text)
    |

E401 [*] Multiple imports on one line
 --> scripts/share_engine.py:1:1
  |
1 | import os, json, subprocess, hashlib, time, logging
  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
2 | from pathlib import Path
3 | from datetime import datetime
  |
help: Split imports

F401 [*] `datetime.datetime` imported but unused
 --> scripts/share_engine.py:3:22
  |
1 | import os, json, subprocess, hashlib, time, logging
2 | from pathlib import Path
3 | from datetime import datetime
  |                      ^^^^^^^^
4 | from config import DOCKER_MODE
  |
help: Remove unused import: `datetime.datetime`

E701 Multiple statements on one line (colon)
  --> scripts/share_engine.py:16:41
   |
14 | def load_config():
15 |     try:
16 |         with open(CONFIG_FILE, 'r') as f: return json.load(f)
   |                                         ^
17 |     except: return {"max_gb": 4.0, "max_res": 1080}
   |

E722 Do not use bare `except`
  --> scripts/share_engine.py:17:5
   |
15 |     try:
16 |         with open(CONFIG_FILE, 'r') as f: return json.load(f)
17 |     except: return {"max_gb": 4.0, "max_res": 1080}
   |     ^^^^^^
18 |
19 | def get_video_info(path):
   |

E701 Multiple statements on one line (colon)
  --> scripts/share_engine.py:17:11
   |
15 |     try:
16 |         with open(CONFIG_FILE, 'r') as f: return json.load(f)
17 |     except: return {"max_gb": 4.0, "max_res": 1080}
   |           ^
18 |
19 | def get_video_info(path):
   |

E722 Do not use bare `except`
  --> scripts/share_engine.py:42:9
   |
40 |             res = subprocess.run(cmd, capture_output=True, text=True, timeout=5)
41 |             height = int(res.stdout.strip()) if res.stdout.strip().isdigit() else 1080
42 |         except:
   |         ^^^^^^
43 |             logging.warning("ffprobe not found or failed, defaulting to 1080p.")
44 |             height = 1080
   |

E722 Do not use bare `except`
  --> scripts/share_engine.py:61:5
   |
59 |         res = subprocess.run(cmd, capture_output=True, text=True)
60 |         return res.returncode == 0
61 |     except: return False
   |     ^^^^^^
62 |
63 | def generate_secure_link(source_path, remux=False):
   |

E701 Multiple statements on one line (colon)
  --> scripts/share_engine.py:61:11
   |
59 |         res = subprocess.run(cmd, capture_output=True, text=True)
60 |         return res.returncode == 0
61 |     except: return False
   |           ^
62 |
63 | def generate_secure_link(source_path, remux=False):
   |

E701 Multiple statements on one line (colon)
   --> scripts/share_engine.py:127:36
    |
126 |     try:
127 |         if video_dest_path.exists(): video_dest_path.unlink()
    |                                    ^
128 |         os.symlink(src, video_dest_path)
129 |         logging.info(f"Symlink created: {video_dest_path}")
    |

E701 Multiple statements on one line (colon)
   --> scripts/share_engine.py:139:38
    |
137 |         sub_dest_path = Path(SHARE_DIR) / sub_share_name
138 |         try:
139 |             if sub_dest_path.exists(): sub_dest_path.unlink()
    |                                      ^
140 |             os.symlink(sub, sub_dest_path)
141 |             result["subtitles"].append(f"{current_base_url}/{sub_share_name}")
    |

E722 Do not use bare `except`
   --> scripts/share_engine.py:142:9
    |
140 |             os.symlink(sub, sub_dest_path)
141 |             result["subtitles"].append(f"{current_base_url}/{sub_share_name}")
142 |         except: pass
    |         ^^^^^^
143 |     return result
    |

E701 Multiple statements on one line (colon)
   --> scripts/share_engine.py:142:15
    |
140 |             os.symlink(sub, sub_dest_path)
141 |             result["subtitles"].append(f"{current_base_url}/{sub_share_name}")
142 |         except: pass
    |               ^
143 |     return result
    |

E401 [*] Multiple imports on one line
 --> scripts/storage_manager.py:1:1
  |
1 | import os, shutil, sys
  | ^^^^^^^^^^^^^^^^^^^^^^
2 |
3 | NVME_DIR = "/data/media/films"
  |
help: Split imports

F401 [*] `shutil` imported but unused
 --> scripts/storage_manager.py:1:12
  |
1 | import os, shutil, sys
  |            ^^^^^^
2 |
3 | NVME_DIR = "/data/media/films"
  |
help: Remove unused import: `shutil`

E701 Multiple statements on one line (colon)
  --> scripts/storage_manager.py:9:29
   |
 7 |     s = 0
 8 |     try:
 9 |         if os.path.isfile(p): s = os.path.getsize(p)
   |                             ^
10 |         else:
11 |             for r, d, f in os.walk(p):
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_manager.py:12:30
   |
10 |         else:
11 |             for r, d, f in os.walk(p):
12 |                 for file in f: s += os.path.getsize(os.path.join(r, file))
   |                              ^
13 |     except: return 0
14 |     return round(s / (1024**3), 2)
   |

E722 Do not use bare `except`
  --> scripts/storage_manager.py:13:5
   |
11 |             for r, d, f in os.walk(p):
12 |                 for file in f: s += os.path.getsize(os.path.join(r, file))
13 |     except: return 0
   |     ^^^^^^
14 |     return round(s / (1024**3), 2)
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_manager.py:13:11
   |
11 |             for r, d, f in os.walk(p):
12 |                 for file in f: s += os.path.getsize(os.path.join(r, file))
13 |     except: return 0
   |           ^
14 |     return round(s / (1024**3), 2)
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_manager.py:17:32
   |
16 | def list_items(path):
17 |     if not os.path.exists(path): return f"âŒ {path} absent."
   |                                ^
18 |     items = [f for f in os.listdir(path) if not f.startswith('.')]
19 |     out = f"ğŸ“‚ **{os.path.basename(path)}** :\n"
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_manager.py:28:21
   |
26 | if __name__ == "__main__":
27 |     arg = sys.argv[1] if len(sys.argv) > 1 else ""
28 |     if arg == "nvme": print(list_items(NVME_DIR))
   |                     ^
29 |     elif arg == "hdd": print(list_items(HDD_DIR))
30 |     else: print("Commande reÃ§ue : " + arg)
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_manager.py:29:22
   |
27 |     arg = sys.argv[1] if len(sys.argv) > 1 else ""
28 |     if arg == "nvme": print(list_items(NVME_DIR))
29 |     elif arg == "hdd": print(list_items(HDD_DIR))
   |                      ^
30 |     else: print("Commande reÃ§ue : " + arg)
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_manager.py:30:9
   |
28 |     if arg == "nvme": print(list_items(NVME_DIR))
29 |     elif arg == "hdd": print(list_items(HDD_DIR))
30 |     else: print("Commande reÃ§ue : " + arg)
   |         ^
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_skill.py:11:32
   |
 9 | def list_media(category="movies"):
10 |     path = PATHS.get(category)
11 |     if not os.path.exists(path): return f"âŒ Dossier {category} introuvable."
   |                                ^
12 |     items = [f for f in os.listdir(path) if not f.startswith('.')]
13 |     return f"ğŸ¥ **{category.capitalize()} :**\n" + "\n".join([f"â€¢ {i}" for i in sorted(items)]) if items else f"ğŸ“‚ Aucun contenu dans { â€¦
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_skill.py:25:53
   |
23 |     if len(sys.argv) > 1:
24 |         cmd = sys.argv[1]
25 |         if cmd == "list_media" and len(sys.argv) > 2: print(list_media(sys.argv[2]))
   |                                                     ^
26 |         elif cmd == "get_status": print(get_status())
   |

E701 Multiple statements on one line (colon)
  --> scripts/storage_skill.py:26:33
   |
24 |         cmd = sys.argv[1]
25 |         if cmd == "list_media" and len(sys.argv) > 2: print(list_media(sys.argv[2]))
26 |         elif cmd == "get_status": print(get_status())
   |                                 ^
   |

F401 [*] `json` imported but unused
 --> scripts/tests/test_admin.py:4:8
  |
2 | import os
3 | import sys
4 | import json
  |        ^^^^
5 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `json`

F401 [*] `unittest.mock.patch` imported but unused
 --> scripts/tests/test_admin.py:5:38
  |
3 | import sys
4 | import json
5 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
6 |
7 | # Add scripts to path
  |
help: Remove unused import: `unittest.mock.patch`

F401 [*] `shutil` imported but unused
 --> scripts/tests/test_cleanup.py:4:8
  |
2 | import os
3 | import sys
4 | import shutil
  |        ^^^^^^
5 | import time
6 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `shutil`

F401 [*] `time` imported but unused
 --> scripts/tests/test_cleanup.py:5:8
  |
3 | import sys
4 | import shutil
5 | import time
  |        ^^^^
6 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `time`

F401 [*] `unittest.mock.patch` imported but unused
 --> scripts/tests/test_cleanup.py:6:38
  |
4 | import shutil
5 | import time
6 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
7 |
8 | # Add scripts to path
  |
help: Remove unused import: `unittest.mock.patch`

E701 Multiple statements on one line (colon)
  --> scripts/tests/test_cleanup.py:43:34
   |
42 |     def side_effect_lstat(path):
43 |         if 'old_file.mkv' in path: return mock_stat_old
   |                                  ^
44 |         return mock_stat_new
   |

E712 Avoid equality comparisons to `True`; use `config.is_authorized(config.SUPER_ADMIN):` for truth checks
  --> scripts/tests/test_config.py:31:12
   |
29 | def test_is_authorized_super_admin():
30 |     import config
31 |     assert config.is_authorized(config.SUPER_ADMIN) == True
   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
help: Replace with `config.is_authorized(config.SUPER_ADMIN)`

F401 [*] `unittest.mock.patch` imported but unused
 --> scripts/tests/test_library.py:4:38
  |
2 | import os
3 | import sys
4 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
5 |
6 | # Add scripts to path
  |
help: Remove unused import: `unittest.mock.patch`

F401 [*] `pytest` imported but unused
 --> scripts/tests/test_managers.py:1:8
  |
1 | import pytest
  |        ^^^^^^
2 | import os
3 | import sys
  |
help: Remove unused import: `pytest`

F401 [*] `shutil` imported but unused
 --> scripts/tests/test_managers.py:4:8
  |
2 | import os
3 | import sys
4 | import shutil
  |        ^^^^^^
5 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `shutil`

F401 [*] `unittest.mock.patch` imported but unused
 --> scripts/tests/test_managers.py:5:38
  |
3 | import sys
4 | import shutil
5 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
6 |
7 | # Add scripts to path
  |
help: Remove unused import: `unittest.mock.patch`

F401 [*] `json` imported but unused
 --> scripts/tests/test_media.py:4:8
  |
2 | import os
3 | import sys
4 | import json
  |        ^^^^
5 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `json`

F401 [*] `unittest.mock.patch` imported but unused
 --> scripts/tests/test_media.py:5:38
  |
3 | import sys
4 | import json
5 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
6 |
7 | # Add scripts to path
  |
help: Remove unused import: `unittest.mock.patch`

F401 [*] `config.RADARR_CFG` imported but unused
  --> scripts/tests/test_media.py:40:24
   |
38 | def test_show_media_list_radarr(mock_bot, mocker):
39 |     import handlers_media
40 |     from config import RADARR_CFG
   |                        ^^^^^^^^^^
41 |     
42 |     # Mock requests.get
   |
help: Remove unused import: `config.RADARR_CFG`

F401 [*] `re` imported but unused
 --> scripts/tests/test_search.py:5:8
  |
3 | import sys
4 | import json
5 | import re
  |        ^^
6 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `re`

F401 [*] `unittest.mock.patch` imported but unused
 --> scripts/tests/test_search.py:6:38
  |
4 | import json
5 | import re
6 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
7 |
8 | # Add scripts to path
  |
help: Remove unused import: `unittest.mock.patch`

F401 [*] `shutil` imported but unused
 --> scripts/tests/test_share.py:5:8
  |
3 | import sys
4 | import json
5 | import shutil
  |        ^^^^^^
6 | from pathlib import Path
7 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `shutil`

F401 [*] `pathlib.Path` imported but unused
 --> scripts/tests/test_share.py:6:21
  |
4 | import json
5 | import shutil
6 | from pathlib import Path
  |                     ^^^^
7 | from unittest.mock import MagicMock, patch
  |
help: Remove unused import: `pathlib.Path`

F401 [*] `unittest.mock.patch` imported but unused
 --> scripts/tests/test_share.py:7:38
  |
5 | import shutil
6 | from pathlib import Path
7 | from unittest.mock import MagicMock, patch
  |                                      ^^^^^
8 |
9 | # Add scripts to path
  |
help: Remove unused import: `unittest.mock.patch`

Found 1038 errors.
[*] 146 fixable with the `--fix` option (10 hidden fixes can be enabled with the `--unsafe-fixes` option).
Exit Code: 1
Process Group PGID: 320629